{% extends "base_dashboard.html" %} {% load static %} {% block dashboard_body %}

<style>
  .table-box {
    box-shadow: 1px 0 11px #d3cccc;
    border-radius: 17px;
    padding-top: 12px;
    padding-bottom: 12px !important;
  }
  #chartdiv {
    width: 100%;
    height: 500px;
  }

  .fund {
    font-size: 15px;
    font-weight: 700;
    color: #000;
    background-color: #eff9ff;
    border: none;
    padding: 10px;
    white-space: nowrap;
  }

  .table thead tr {
    font-size: 17px;
    font-weight: 700;
    color: white;
    background-color: #59aaf9;
    border: none;
    padding: 10px;
    white-space: nowrap;
  }
  .fund_dates {
    color: #4399eb;
    border: 1px solid #4399eb !important;
    border: none;
    padding: 5px 12px;
    border-radius: 5px;
    font-size: 15px;
    margin-right: 9px;
    background: white;
    transition: ease-in-out;
    cursor: pointer;
  }

  .active {
    background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
    color: white !important;
    border: 1px solid #4399eb;
    border-radius: 5px;
  }

  .fund-activity {
    font-size: 15px;
    font-weight: 700;
    color: #000;
    background-color: #eff9ff;
    border: none;
    padding: 10px;
    white-space: nowrap;
  }
  .what_filter {
    color: #4399eb;
    border: 1px solid #4399eb !important;
    border: none;
    padding: 5px 12px;
    border-radius: 5px;
    font-size: 15px;
    margin-right: 9px;
    background: white;
    cursor: pointer;
    transition: ease-in-out;
  }
  .what_active {
    background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
    color: white !important;
    border: 1px solid #4399eb;
    border-radius: 5px;
  }

  .Mutualnews-wq {
    display: inline-block;
    width: 49%;
    right: 12px;
    margin-right: 1%;
    margin-top: 19px;
    background: #fff 0 0 no-repeat padding-box;
    box-shadow: inset -10px -10px 20px rgba(4, 115, 233, 0.0784313725490196);
    border-radius: 28px;
    padding: 1rem;
    position: relative;
    right: auto;
  }

  .times ul li:hover {
    background: linear-gradient(180deg, #4399eb, #5cadfb);
    color: white;
  }

  .performance_active {
    background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
    color: white !important;
  }

  .times ul li {
    background: white;
    color: #4399eb;
    padding: 0px 7px;
    text-align: center;
    height: 29px;
    display: flex;
    font-weight: 500;
    border-radius: 4px;
    border: 1px solid #4399eb !important;
    -webkit-box-shadow: none !important;
    box-shadow: none !important;
    outline: 0 !important;
    -webkit-transition: all 0.2s ease-in-out !important;
    -moz-transition: all 0.2s ease-in-out !important;
    transition: all 0.2s ease-in-out !important;
    cursor: pointer;
    font-weight: 600;
    align-items: center;
  }

  .place_holder_chart {
    height: 500px;
    width: 50px;
  }

  .place_holder_chart_two {
    height: 300px;
    width: 50px;
  }

  .place_holder_chart_one {
    height: 400px;
    width: 50px;
  }

  .main_placeholder {
    display: flex;
    gap: 2rem;
    align-items: flex-end;
  }

  .nav_initial_filter {
    display: flex;
    gap: 0.5rem;
  }

  .historical_data {
    display: flex;
    gap: 0.5rem;
    width: 60%;
  }

  .main_nav_filter_mutual_funds button {
    background: white;

    color: #4399eb;
    padding: 0px 7px;
    text-align: center;
    height: 29px;
    display: flex;
    font-weight: 500;
    border-radius: 4px;
    border: 1px solid #4399eb !important;
    -webkit-box-shadow: none !important;
    box-shadow: none !important;
    outline: 0 !important;
    -webkit-transition: all 0.2s ease-in-out !important;
    -moz-transition: all 0.2s ease-in-out !important;
    transition: all 0.2s ease-in-out !important;
    cursor: pointer;
    font-weight: 600;
    align-items: center;
  }
  .nav_filter_active {
    background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
    color: white !important;
  }

  .table>:not(caption)>*>* {
    padding: 0.5rem 0.5rem;
    background-color: var(--bs-table-bg);
    border-bottom-width:0 !important;
    box-shadow: inset 0 0 0 9999px var(--bs-table-accent-bg);
}

tbody>tr:nth-child(2n)>td,
tbody>tr:nth-child(2n)>th {
    background-color: rgb(240, 247, 253) !important;
   
  }
  .fund_table{
    border-radius: 10px;
  }


  .dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
    color: white !important;
    border: 1px solid #59aaf9 !important;
    background-color: rgba(230, 230, 230, 0.1);
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, rgba(230, 230, 230, 0.1)), color-stop(100%, rgba(0, 0, 0, 0.1)));
    background: -webkit-linear-gradient(top, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%);
    background: -moz-linear-gradient(top, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%);
    background: -ms-linear-gradient(top, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%);
    background: -o-linear-gradient(top, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%);
    /* background: linear-gradient(to bottom, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%); */
    background: #59aaf9;
}
.dataTables_wrapper .dataTables_paginate .paginate_button {
    box-sizing: border-box;
    display: inline-block;
    min-width: 1.5em;
    padding: 0.5em 1em;
    margin-left: 7px;
    text-align: center;
    text-decoration: none !important;
    cursor: pointer;
    color: inherit !important;
    border: 1px solid transparent;
    border-radius: 7px;
    background: transparent;
}

.dataTables_wrapper .dataTables_paginate .paginate_button:active {
    outline: none;
    background-color: #2b2b2b;
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #2b2b2b), color-stop(100%, #0c0c0c));
    background: -webkit-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
    background: -moz-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
    background: -ms-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
    background: -o-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
    background: #59aaf9 !important;
    box-shadow: inset 0 0 3px #111;
}

.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
    color: white !important;
    border: 1px solid #59aaf9 !important;
    background-color: #585858;
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #585858), color-stop(100%, #111));
    background: -webkit-linear-gradient(top, #585858 0%, #111 100%);
    background: -moz-linear-gradient(top, #585858 0%, #111 100%);
    background: -ms-linear-gradient(top, #585858 0%, #111 100%);
    background: -o-linear-gradient(top, #585858 0%, #111 100%);
    background: linear-gradient(to bottom, #585858 0%, #111 100%);
    background: #59aaf9 !important;
}

.paginate_button.previous::before {
  content: "<"; /* Unicode left arrow character */
  font-size: 16px !important;
}

/* Next page button icon */
.paginate_button.next::before {
  content: ">"; /* Unicode right arrow character */
  font-size: 16px !important;
}

.paginate_button.next:hover::before{
  color: white !important;
}

.dataTables_wrapper .dataTables_paginate {
  padding: 20px !important;
}

.dataTables_wrapper .dataTables_info {
  padding-top: 1.7rem !important;
}

table.dataTable.no-footer{
  padding-top: 20px !important;
}

/* Hide text for Previous and Next buttons */
#what_in_out_previous {
  font-size: 0 !important;
  background-color: white; 
  color: black;
  padding: 7px 18px; 
  border-radius: 4px; 
  cursor: pointer; 
  transition: background-color 0.3s ease; 
  box-shadow: 0 3px 16px 0 rgba(35,47,62,.15)!important;
}
#what_in_out_previous:hover {
  color: white !important;
  
}
#what_in_out_next {
  font-size: 0 !important;
  background-color: white; /* Button background color */
  color: black; /* Button text color */
   /* Button border */
  padding: 7px 18px; /* Button padding */
  border-radius: 4px; /* Button border-radius */
  cursor: pointer; /* Add pointer cursor on hover */
  transition: background-color 0.3s ease; 
  box-shadow: 0 3px 16px 0 rgba(35,47,62,.15)!important;
}

.paginate_button {
  box-shadow: 0 3px 16px 0 rgba(35,47,62,.15)!important; /* Adjust the values as needed */
}

.dataTables_length select{
  border: 1px solid #aaa;
    
    background-color: transparent;
    
    margin: 0 5px !important;
    font-weight: 500 !important;
}

.dataTables_length label {
  text-transform: capitalize !important;
}

  @media only screen and (max-width: 768px) {
    .holdings_filter {
      flex-wrap: wrap !important;
      gap: 0.5rem !important;
    }

    .mutual_fund_section {
      padding: 3rem 2rem;
    }

    .dividend_filter {
      flex-wrap: wrap !important;
      gap: 0.5rem !important;
    }
    .whats_in_out {
      flex-wrap: wrap !important;
      gap: 1rem !important;
    }
    .table_filter {
      flex-wrap: wrap !important;
    }
    .fund_dates {
      padding: 2px 6px;
      font-size: 15px;
    }
    .category {
      flex-wrap: wrap !important;
      gap: 1rem !important;
    }
    .options {
      width: 100% !important;
    }
    .times ul {
      gap: 0.5rem !important;
      padding-left: 0 !important;
    }
    .times ul li {
      padding: 0px 4px;
    }
    .new_fund_offer_category {
      width: 100% !important;
    }
    .MF-Performance-dates ul {
      padding-left: 0 !important;
    }
    .whats_filter {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .fund_perform_filter {
      flex-wrap: wrap !important;
    }
    .nav_initial_filter {
      flex-wrap: wrap !important;
    }
    .historical_data {
      flex-wrap: wrap !important;
      width: 100%;
    }
    #nav_symbol_body {
      overflow: auto;
    }
    #performer {
      width: 100%;
    }
    .holdings-select {
      width: 100%;
    }
  }
</style>
<section class="mutual_fund_section container">
  <section>
    <div class="cate_performance mt-4">
      <h4>Category Performance</h4>

      <div class="table-box mt-3 p-5">
        <div class="category d-flex justify-content-between">
          <div class="options">
            <select
              id="myOptions"
              class="form-select"
              aria-label="Default select example"
            >
              <option class="category_per" value="EQUITY" selected>
                Equity
              </option>
              <option class="category_per" value="HYBRID">Hybrid</option>
              <option class="category_per" value="DEBT">Debt</option>
            </select>
          </div>
          <div class="timelines">
            <div class="times">
              <ul class="d-flex gap-3">
                <li
                  id="1WEEK"
                  data-value="1WEEK"
                  class="dates performance_active"
                >
                  1W
                </li>
                <li data-value="1MONTH" class="dates">1M</li>
                <li data-value="3MONTH" class="dates">3M</li>
                <li data-value="6MONTH" class="dates">6M</li>
                <li data-value="1YEAR" class="dates">1Y</li>
                <li data-value="3YEAR" class="dates">3Y</li>
              </ul>
            </div>
          </div>
        </div>

        <div id="chartdiv" style="width: 100%; height: 500px">
          <div class="main_placeholder">
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart_one"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart_two"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart_one"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart"
              ></span>
            </div>

            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart_one"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart_two"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart_one"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart_one"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart_two"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart_one"
              ></span>
            </div>
            <div class="placeholder-glow">
              <span
                class="placeholder bg-secondary-subtle place_holder_chart"
              ></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- NAV -->
  <section id="Nav_mutual_funds">
    <h4 class="mt-5">NAV</h4>

    <div class="table-box">
      <div class="dividend_box p-4">
        <div class="nav_initial_filter">
          <select
            id="navFirst_drop"
            class="form-select"
            aria-label="Default select example"
          ></select>
          <select
            id="navSecond_drop"
            class="form-select"
            aria-label="Default select example"
          ></select>
          <select
            id="navThird_drop"
            class="form-select"
            aria-label="Default select example"
          ></select>
        </div>

        <div class="historical_data" style="display: none">
          <select
            name="period_dropdown"
            id="period_dropdown"
            class="form-select"
          >
            <option value="1week">1Week</option>
            <option value="1Month">1Month</option>
            <option value="1Year">1Year</option>
          </select>

          <select
            name="All_Historical_options"
            id="All_Historical_options"
            class="form-control"
          ></select>
        </div>

        <div class="main_nav_filter_mutual_funds mt-4 d-flex gap-2">
          <button class="nav_filter_active" data-nav-filter="daily">
            Daily</button
          ><button data-nav-filter="historical">Historical</button>
        </div>

        <div id="nav_symbol_body" class="mt-3"></div>
      </div>
    </div>
  </section>

  <!-- Funds Performance -->
  <section class="mt-5">
    <h4>Fund Performance</h4>
    <div class="table-box p-4">
      <div class="table_filter d-flex justify-content-between">
        <div class="MF-Performance-dates">
          <ul class="d-flex gap-2 align-items-center">
            <li id="1Week" data-value="1Week" class="fund_dates active">1W</li>
            <li data-value="1Month" class="fund_dates">1M</li>
            <li data-value="3month" class="fund_dates">3M</li>
            <li data-value="6month" class="fund_dates">6M</li>
            <li data-value="1year" class="fund_dates">1Y</li>
            <li data-value="3year" class="fund_dates">3Y</li>
          </ul>
        </div>
        <div class="fund_perform_filter d-flex gap-1">
          <div class="holdings-select">
            <select class="form-select" id="performer">
              <option>Select Category</option>
              <option value="T" selected>Top performance</option>
              <option value="B">Bottom Performance</option>
            </select>
          </div>
          <div class="holdings-select">
            <select name="" id="holdings" class="form-select"></select>
          </div>
        </div>
      </div>
      <div class="fund_table table-responsive mt-3">
        <table class="table table-bordered">
          <thead class="fund">
            <tr>
              <th>Scheme Name</th>
              <th>% Return</th>
            </tr>
          </thead>
          <tbody id="table_b_data"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Mutual Fund Activity -->
  <section class="mt-5">
    <h4>Mutual Fund Activity</h4>
    <div class="table-box">
      <div class="funds_activity_table p-4 table-responsive">
        <table class="table table-bordered" id="data-table">
          <thead>
            <tr class="fund-activity">
              <th>As on Date</th>
              <th>Equity/Debt</th>
              <th>Gross Purchase(₹)</th>
              <th>Gross Sale(₹)</th>
              <th>Net Purchase(₹)</th>
            </tr>
          </thead>
          <tbody id="fund_activity_body">
            <tr>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Top Holdings -->
  <section class="top_holding_section mt-5">
    <h4>Top 10 Holdings</h4>
    <div class="table-box">
      <div class="dividend_box p-4">
        <div class="holdings_filter d-flex gap-4">
          <select
            id="topHCate1"
            class="form-select"
            aria-label="Default select example"
          ></select>
          <select
            id="topHCate2"
            class="form-select"
            aria-label="Default select example"
          ></select>
          <select
            id="selectScheme"
            class="form-select"
            aria-label="Default select example"
          ></select>
        </div>
        <div class="holdings mt-4 table-responsive">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th scope="col">Company Name</th>
                <th scope="col">%Hold</th>
              </tr>
            </thead>
            <tbody id="top_holding_table"></tbody>
          </table>
        </div>
      </div>
    </div>
      
  </section>

  <!-- Whats in/out -->
  <section class="mt-5">
    <h4>What’s In /Out</h4>
    <div class="table-box">
      <div class="whats_box p-4">
        <div class="whats_in_out d-flex justify-content-between">
          <div class="whats_filter">
            <span class="what_filter what_active w-100" data-value="In"
              >What’s In</span
            >
            <span class="what_filter w-100" data-value="Out">What’s Out</span>
          </div>
          <div class="funds_name">
            <select class="form-select" id="funds_dropdown">
              <option>Select Category</option>
            </select>
          </div>
        </div>
        <div class="what_in_out_table mt-3 table-responsive p-4">
          <table class="table table-bordered" id="what_in_out">
            <thead>
              <tr>
                <th scope="col">Company Name</th>
                <th scope="col">No. Of Shares</th>
                <th scope="col">Market Value(in Cr.)</th>
              </tr>
            </thead>
            <tbody id="what_in_out_body"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!--Dividend  -->
  <section class="Dividend_section mt-5">
    <h4>Dividend</h4>
    <div class="table-box">
      <div class="dividend_box p-4">
        <div class="dividend_filter d-flex gap-4">
          <select
            id="fundHouse"
            class="form-select"
            aria-label="Default select example"
          ></select>
          <select
            id="myCategory"
            class="form-select"
            aria-label="Default select example"
          ></select>
          <select
            id="selectDate"
            class="form-select"
            aria-label="Default select example"
          ></select>
        </div>
        <div class="dividend mt-4 table-responsive">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th scope="col">Company Name</th>
                <th scope="col">Nav</th>
                <th scope="col">Dividend</th>
                <th scope="col">Record Date</th>
                <th scope="col">1 Year(%)</th>
                <th scope="col">3 Year(%)</th>
              </tr>
            </thead>
            <tbody id="dividend_table"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- Fund profile -->

  <section class="fund_profile_section mt-5">
    <h4>Fund Profile</h4>
    <div class="table-box">
      <div class="fund_profile p-4 table-responsive">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th scope="col">Fund House</th>
              <th scope="col">Incorporation Date</th>
              <th scope="col">Fund Type</th>
              <th scope="col">Total Assets* (Rs Cr.)</th>
              <th scope="col">As On Date</th>
            </tr>
          </thead>
          <tbody id="fund_profile_table"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- New Fund Offer -->
  <section class="new_fund_section mt-5">
    <h4>New Fund Offer</h4>
    <div class="table-box">
      <div class="new_funds_offer p-4">
        <div class="new_fund_filter d-flex justify-content-end">
          <div class="new_fund_offer_category">
            <select
              id="new_fundOptions"
              class="form-select"
              aria-label="Default select example"
            >
              <option class="category_per" value="equity" selected>
                Equity
              </option>
              <option class="category_per" value="Debt">Debt</option>
              <option class="category_per" value="hybrid">Hybrid</option>
            </select>
          </div>
        </div>
        <div class="new_fund_table mt-4 table-responsive">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th scope="col">Scheme</th>
                <th scope="col">Type</th>
                <th scope="col">Open Date</th>
                <th scope="col">Close Date</th>
                <th scope="col">Min Amount</th>
                <th scope="col">Offer Price</th>
                <th scope="col">Category</th>
              </tr>
            </thead>
            <tbody id="new_fund"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- IPO News -->
  <section class="mt-5">
    <h4>Mutual Fund News</h4>
    <div class="table-box">
      <div class="news_table d-flex flex-wrap"></div>
    </div>
  </section>
</section>

<script>
  $(document).ready(function () {
    var selectCate = "EQUITY";
    var selectDate = "1WEEK";

    // Function to update the chart with data
    function updateChart(data) {
      // console.log(data);
      var main_return_data = data.data;
      const tbody = $("#return_ipo tbody");
      tbody.empty(); // Clear previous data
      var chartData = [];
      main_return_data.forEach(function (stock) {
        console.log(stock.TypeName);
        var companyNameParts = stock.TypeName.split("-");
        console.log(companyNameParts);

        chartData.push({
          company_name: companyNameParts[1],
          PerChange: stock.Return,
        });
      });

      var chart = am4core.create("chartdiv", am4charts.XYChart);
      chart.paddingBottom = 30; // Add some padding at the bottom to accommodate the labels

      // Enable mouse wheel zoom for the x-axis
      chart.mouseWheelZoomEnabled = true;

      // Remove chart watermark
      chart.logo.disabled = true;

      // Add data to the chart
      chart.data = chartData;

      // Create category axis (company_name)
      var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
      categoryAxis.dataFields.category = "company_name";
      categoryAxis.title.text = "Company Name";

      // Create value axis (PerChange)
      var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
      valueAxis.title.text = "PerChange";

      // Draw a horizontal line at y-axis 0
      var zeroLine = valueAxis.axisRanges.create();
      zeroLine.value = 0;
      zeroLine.grid.stroke = am4core.color("#000"); // Color of the line
      zeroLine.grid.strokeWidth = 2; // Line width
      zeroLine.grid.strokeOpacity = 0.5; // Line opacity

      // Find the maximum PerChange value and its corresponding category
      var maxPerChange = -Infinity;
      var maxPerChangeCategory = "";
      chartData.forEach(function (dataItem) {
        if (dataItem.PerChange > maxPerChange) {
          maxPerChange = dataItem.PerChange;
          maxPerChangeCategory = dataItem.company_name;
        }
      });

      var minPerChange = Infinity;
      chartData.forEach(function (dataItem) {
        if (dataItem.PerChange < minPerChange) {
          minPerChange = dataItem.PerChange;
        }
      });

      if (minPerChange > 0) {
        valueAxis.min = 0;
      }

var allNegative = chartData.every(function (dataItem) {
  return dataItem.PerChange < 0;
});

if (allNegative) {
  valueAxis.max = 0;
}


      // Create a vertical line at the maximum PerChange value
      var maxLine = valueAxis.axisRanges.create();
      maxLine.value = maxPerChange.toFixed(5);
      maxLine.grid.stroke = am4core.color("rgb(249,108,146)"); // Color of the line
      maxLine.grid.strokeWidth = 2; // Line width
      maxLine.grid.strokeOpacity = 0.5; // Line opacity
      maxLine.label.text = "Max: " + maxPerChange.toFixed(5); // Display the maximum value as a label
      maxLine.label.fill = am4core.color("rgb(249,108,146)"); // Label text color
      maxLine.label.fontSize = 12; // Label font size

      // Create a series for the column chart
      var series = chart.series.push(new am4charts.ColumnSeries());
      series.dataFields.valueY = "PerChange";
      series.dataFields.categoryX = "company_name";
      series.name = "PerChange";
      series.columns.template.tooltipText = "{categoryX}: [bold]{valueY}[/]";

      // Set the background color of the bars and border color manually based on the value of PerChange
      series.columns.template.adapter.add("fill", function (fill, target) {
        if (target.dataItem && target.dataItem.dataContext.PerChange < 0) {
          return am4core.color("rgb(249,108,146)"); // Red for negative values
        } else {
          return am4core.color("rgb(33,150,243)"); // Green for positive or zero values
        }
      });
      series.columns.template.adapter.add("stroke", function (stroke, target) {
        if (target.dataItem && target.dataItem.dataContext.PerChange < 0) {
          // Red border for negative values
          target.column.cornerRadiusBottomLeft = 5;
          target.column.cornerRadiusBottomRight = 5;
          target.column.cornerRadiusTopLeft = 0;
          target.column.cornerRadiusTopRight = 0;
          return am4core.color("rgb(249,108,146)");
        } else {
          // Green border for positive or zero values
          target.column.cornerRadiusBottomLeft = 0;
          target.column.cornerRadiusBottomRight = 0;
          target.column.cornerRadiusTopLeft = 5;
          target.column.cornerRadiusTopRight = 5;
          return am4core.color("rgb(33,150,243)");
        }
      });
      series.columns.template.width = am4core.percent(50);

      var labelBullet = series.bullets.push(new am4charts.LabelBullet());
      // Get the full company_name
      var fullCompanyName = "{company_name}";

      labelBullet.label.text = fullCompanyName;
      labelBullet.label.truncate = false; // Don't truncate text if it doesn't fit in the bar
      labelBullet.label.hideOversized = false; // Show the text even if it's oversized

      labelBullet.label.rotation = 270; // Rotate the label horizontally
      labelBullet.label.fontSize = 15; // Set the font size to 10px

      labelBullet.locationY = 1; // Move the label to the starting point of the bar

      // Use an adapter to set horizontalCenter based on the condition
      labelBullet.label.adapter.add(
        "horizontalCenter",
        function (horizontalCenter, target) {
          if (target.dataItem && target.dataItem.dataContext.PerChange < 0) {
            return "right"; // Set to "right" if PerChange < 0
          } else {
            return "left"; // Set to "left" for other cases
          }
        }
      );

      // Set labelBullet.dy conditionally outside the adapter function
      labelBullet.label.adapter.add("dy", function (dy, target) {
        if (target.dataItem && target.dataItem.dataContext.PerChange < 0) {
          return 3; // Set to 10 if PerChange < 0
        } else {
          return -3; // Set to -10 for other cases
        }
      });

      categoryAxis.renderer.labels.template.disabled = true; // Hide the labels

      // Enable pan and zoom features for the chart
      chart.cursor = new am4charts.XYCursor();
      chart.cursor.behavior = "selectX";
      chart.events.on("datavalidated", function () {
        maxLine.value = maxPerChange;
      });

      // Configure pan and zoom settings
      chart.scrollbarX = new am4core.Scrollbar();
      chart.scrollbarX.wheelX = "zoomX";
      chart.scrollbarX.parent = chart.bottomAxesContainer;

      // Finally, update the chart
      chart.invalidateData();
    }

    // Function to fetch data using AJAX
    function get_category_data(get_cate, get_time) {
      $.ajax({
        type: "POST",
        url: "/category_performance",
        data: {
          category: get_cate,
          times_date: get_time,
        },
        success: function (response) {
          if (response.success) {
            // Update the chart with the received data
            updateChart(response);
          } else {
            console.error("Error: Data retrieval unsuccessful.");
          }
        },
        error: function () {
          console.error("Error: AJAX request failed.");
        },
      });
    }

    // Initial data load
    get_category_data(selectCate, selectDate);

    // Handle category and date changes
    $("#myOptions").change(function () {
      var selectedText = $(this).val();
      selectCate = selectedText;
      get_category_data(selectCate, selectDate);
    });

    $(".dates").click(function () {
      $(".dates").removeClass("performance_active");
      $(this).addClass("performance_active");
      var time_value = $(this).data("value");
      selectDate = time_value;
      get_category_data(selectCate, selectDate);
    });

    function holdings_get() {
      $.ajax({
        type: "get",
        url: "/holdings_select",
        dataType: "json",
        success: function (data) {
          var holdings_name = data.data;
          holdings_name.forEach((element) => {
            $("#holdings").append(
              $("<option>").val(element.VCLASSCODE).text(element.VCLASS)
            );
          });
        },
      });
    }
    holdings_get();

    var initial_date = "1Week";
    var perform = $("#performer").val();
    var initial_val = $("#holdings option:first").val();

    $(".fund_dates").click(function () {
      $(".fund_dates").removeClass("active");
      $(this).addClass("active");
      var get_date = $(this).data("value");
      initial_date = get_date;
      to_get_params();
    });

    $("#performer").change(function () {
      var get_val = $(this).val();
      perform = get_val;
      to_get_params();
    });

    $("#holdings").change(function () {
      var co_val = $(this).val();
      initial_val = co_val;
      to_get_params();
    });

    function to_get_params() {
      performance_table(initial_date, perform, initial_val);
    }

    to_get_params();
    function performance_table(get_date, get_perform, get_init_val) {
      // console.log(get_date);
      // console.log(get_perform);
      // console.log(get_init_val);
      $.ajax({
        type: "post",
        url: "/performances_data",
        data: {
          p_date: get_date,
          p_cate: get_perform,
          p_co_name: get_init_val,
        },
        success: function (data) {
          var perfomance_datas = data.data;
          //  console.log(perfomance_datas);
          $("#table_b_data").empty();

          perfomance_datas.forEach((element) => {
            var settd;

            if (get_date === "1Week") {
              settd = element.week1;
            } else if (get_date === "1Month") {
              settd = element.month1;
            } else if (get_date === "3month") {
              settd = element.month3;
            } else if (get_date === "6month") {
              settd = element.month6;
            } else if (get_date === "1year") {
              settd = element.year1;
            } else if (get_date === "3year") {
              settd = element.year3;
            }
            var row = `<tr>
                         <td>${element.Sch_Name}</td>
                         <td>
                            ${parseFloat(settd).toFixed(2)}
                         </td>
                        </tr>  `;
            var table = $("#table_b_data");
            table.append(row);
          });
        },
      });
    }

    //NAV

    //NAV

    var nav_header_conditions = true;
    var first_args_nav;
    var second_args_nav;
    var nav_header_second_conditions = true;
    var third_args_nav;
    var nav_pagination_limits = 8;
    var nav_final_conditions = true;
    function main_nav_data() {
      $.ajax({
        type: "get",
        url: "/top_holdings_fund_house",
        dataType: "json",
        success: function (data) {
          var holdings_h_dropdown = data.data;

          var topHCate1 = $("#navFirst_drop");
          topHCate1.empty();
          holdings_h_dropdown.forEach((element) => {
            topHCate1.append(
              $("<option>").val(element.mf_cocode).text(element.co_name)
            );
          });
          first_args_nav = topHCate1.val();
          if (nav_header_conditions) {
            get_second_nav(first_args_nav);
            nav_header_conditions = false;
          }

          topHCate1.off("change").on("change", function () {
            var get_scheme = $(this).val();

            first_args_nav = get_scheme;
            get_second_nav(first_args_nav);
          });
        },
      });
    }

    function get_second_nav(get_val) {
      $.ajax({
        type: "post",
        url: "/top_holdings_category",
        data: {
          pass_val: get_val,
        },
        success: function (data) {
          var get_data = data.data;
          var topHCate2 = $("#navSecond_drop");
          topHCate2.empty();
          get_data.forEach((element) => {
            topHCate2.append(
              $("<option>").val(element.VCLASSCODE).text(element.VCLASS)
            );
          });

          second_args_nav = topHCate2.val();
          get_third_nav(first_args_nav, second_args_nav);
          nav_header_second_conditions = false;

          topHCate2.off("change").on("change", function () {
            second_args_nav = $(this).val();

            get_third_nav(first_args_nav, second_args_nav);
          });
        },
      });
    }

    function get_third_nav(get_hold_house, get_schemes) {
      $.ajax({
        type: "post",
        url: "/holdings_scheme",
        data: {
          pass_hold_house: get_hold_house,
          pass_schemes: get_schemes,
        },
        success: function (data) {
          var selectScheme = $("#navThird_drop");
          selectScheme.empty(); // Clear previous options

          var options = data.data.map(function (item) {
            return $("<option>").val(item.MF_SCHCODE).text(item.SCH_NAME);
          });

          selectScheme.append(options);

          third_args_nav = selectScheme.val();

          get_main_nav_data(
            first_args_nav,
            second_args_nav,
            third_args_nav,
            nav_pagination_limits
          );

          selectScheme.off("change").on("change", function () {
            hodling_last_dropdown = $(this).val();
            third_args_nav = hodling_last_dropdown;
            console.log(third_args_nav);

            get_main_nav_data(
              first_args_nav,
              second_args_nav,
              third_args_nav,
              nav_pagination_limits
            );
          });
        },
      });
    }

    function get_main_nav_data(
      first_args_nav,
      second_args_nav,
      third_args_nav,
      nav_pagination_limits
    ) {
      $.ajax({
        type: "post",
        url: "/main_nav_data",
        data: {
          first_args_nav: first_args_nav,
          second_args_nav: second_args_nav,
          third_args_nav: third_args_nav,
          nav_pagination_limits: nav_pagination_limits,
        },
        success: function (data) {
          console.log(data);
          var nav_symbol_body = $("#nav_symbol_body");
          var table = $("<table>").addClass("nav_table table");
          var thead = $("<thead>");
          var tbody = $("<tbody>");
          nav_symbol_body.empty();

          // Create table headers (thead)
          var headerRow = `
        <tr>
          <th>Scheme Name</th>
          <th>Nav Date</th>
          <th>NAV (Rs)</th>
          <th>Repurchase Price (Rs)</th>
          <th>Company</th>
        </tr>
      `;

          thead.append(headerRow);

          // Check if data is empty
          if (data.data === null) {
            var noDataMessage = `
          <tr>
            <td colspan="5">No data found</td>
          </tr>
        `;
            tbody.append(noDataMessage);
          } else {
            // Populate table with data
            $.each(data.data, function (index, row) {
              var rowHTML = `
            <tr>
              <td>${row.sch_name}</td>
              <td>${row.navdate}</td>
              <td>${row.navrs}</td>
              <td>${row.RepurchasePrice}</td>
              <td><img src="${row.Logo}" class="logo" style="width:20px"></td>
            </tr>
          `;
              tbody.append(rowHTML);
            });
          }

          // Append the table to your desired container
          table.append(thead, tbody);
          nav_symbol_body.append(table);
        },
      });
    }

    main_nav_data();

    var period_selected;
    var All_nav_symbol_selected;
    var historical_pagiantion_limit = 8;
    function All_Historical_options() {
      $.ajax({
        type: "post",
        url: "/main_nav_historical_data",

        success: function (data) {
          var get_data = data.data;
          var All_hostorical_opiton = $("#All_Historical_options");
          All_hostorical_opiton.empty();

          get_data.forEach((element) => {
            All_hostorical_opiton.append(
              $("<option>").val(element.MF_SCHCODE).text(element.SCH_NAME)
            );
          });

          All_nav_symbol_selected = All_hostorical_opiton.val();

          period_selected = $("#period_dropdown").val();
          All_nav_historical_table_data(
            period_selected,
            All_nav_symbol_selected,
            historical_pagiantion_limit
          );
          console.log(historical_pagiantion_limit);

          $("#period_dropdown")
            .off("change")
            .on("change", function () {
              period_selected = $(this).val();

              All_nav_historical_table_data(
                period_selected,
                All_nav_symbol_selected,
                historical_pagiantion_limit
              );
            });
          All_hostorical_opiton.off("change").on("change", function () {
            All_nav_symbol_selected = $(this).val();

            All_nav_historical_table_data(
              period_selected,
              All_nav_symbol_selected,
              historical_pagiantion_limit
            );
          });
        },
      });
    }

    All_Historical_options();

    function formatDate(inputDate) {
      const options = { year: "numeric", month: "short", day: "numeric" };
      return new Date(inputDate).toLocaleDateString("en-US", options);
    }

    function All_nav_historical_table_data(
      period_selected,
      All_nav_symbol_selected,
      historical_pagiantion_limit
    ) {
      console.log(historical_pagiantion_limit);
      $.ajax({
        type: "post",
        url: "/All_nav_historical_table_data",
        data: {
          period_selected: period_selected,
          All_nav_symbol_selected: All_nav_symbol_selected,
          historical_pagiantion_limit: historical_pagiantion_limit,
        },
        success: function (data) {
          console.log(data);

          var nav_symbol_body = $("#nav_symbol_body");
          var table = $("<table>").addClass("historical_table table");
          var thead = $("<thead>");
          var tbody = $("<tbody>");
          nav_symbol_body.empty();

          // Create table headers (thead)
          var headerRow = `
        <tr>
          <th>Scheme Name</th>
          <th>Nav Date</th>
          <th>NAV (Rs)</th>
          <th>Yearly Low(₹)</th>
       
        </tr>
      `;

          thead.append(headerRow);

          // Check if data is empty
          if (data.data === null) {
            var noDataMessage = `
          <tr>
            <td colspan="5">No data found</td>
          </tr>
        `;
            tbody.append(noDataMessage);
          } else {
            // Populate table with data
            $.each(data.data, function (index, row) {
              var formattedDate = formatDate(row.NAVDATE);
              var rowHTML = `
            <tr>
              <td>${row.sch_name}</td>
              <td>${formattedDate}</td>
              <td>${row.NAVRS}</td>
              <td>${row.NAVREPRICE}</td>
      
            </tr>
          `;
              tbody.append(rowHTML);
            });
          }

          // Append the table to your desired container
          table.append(thead, tbody);
          nav_symbol_body.append(table);
        },
      });
    }

    $(".main_nav_filter_mutual_funds button").click(function () {
      $(".main_nav_filter_mutual_funds button").removeClass(
        "nav_filter_active"
      );
      $(this).addClass("nav_filter_active");

      var selectedFilter = $(this).data("nav-filter");

      var hasActiveClass = $(this).hasClass("nav_filter_active");
      if (hasActiveClass) {
        if (selectedFilter === "daily") {
          $(".historical_data").hide();
          $(".nav_initial_filter").show();

          get_main_nav_data(
            first_args_nav,
            second_args_nav,
            third_args_nav,
            nav_pagination_limits
          );
        } else if (selectedFilter === "historical") {
          $(".historical_data").show();
          $(".nav_initial_filter").hide();

          All_nav_historical_table_data(
            period_selected,
            All_nav_symbol_selected,
            historical_pagiantion_limit
          );
        }
      }
    });

    // Mutual Fund Activity Start Here !!!

    function mutual_fund_activity() {
      $.ajax({
        type: "get",
        url: "/fund_activity",
        dataType: "json",
        success: function (data) {
          $("#fund_activity_body").empty();
          var table_data = data.data;
          //  console.log(table_data);
          table_data.forEach((element) => {
            var row = `<tr>
                        <td>${element.TRANS_DATE.split("T")[0]}</td>
                        <td>Equity</td>
                        <td>${element.EQ_GR_PURC}</td>
                        <td>${element.EQ_GR_SALE}</td>
                        <td class=${
                          element.EQ_G_NE_PS >= 0
                            ? "text-success"
                            : "text-danger"
                        }>${element.EQ_G_NE_PS}</td>
                        <tr>
                          <td></td>
                          <td>Debt</td>
                          <td>${element.DE_GR_PURC}</td>
                          <td>${element.DE_GR_SALE}</td>
                          <td class=${
                            element.DB_G_NE_PS < 0
                              ? "text-danger"
                              : "text-success"
                          }>${element.DB_G_NE_PS}</td>
                        </tr>
                      </tr>
                      `;

            var table = $("#fund_activity_body");
            table.append(row);
            // $("#data-table").DataTable()
          });
        },
      });
    }
    mutual_fund_activity();

     // Top 10 Holdings
     var top_holding_header_conditions = true;
     var cate_one;
     var initial_secondd_val;
     var get_second_cate_val_condition = true;
     var scheme_last_dropdown;
     var final_pagination_limit = 8;
     var final_data_condition_dropdown = true;
     function top_holding_header() {
       $.ajax({
         type: "get",
         url: "/top_holdings_fund_house",
         dataType: "json",
         success: function (data) {
           var holdings_h_dropdown = data.data;
           console.log(holdings_h_dropdown);
           var topHCate1 = $("#topHCate1");
           topHCate1.empty();
           holdings_h_dropdown.forEach((element) => {
             topHCate1.append(
               $("<option>").val(element.mf_cocode).text(element.co_name)
             );
           });
           cate_one = topHCate1.val();
           if (top_holding_header_conditions) {
             get_second_cate_val(cate_one);
             top_holding_header_conditions = false;
             console.log(top_holding_header_conditions);
           }
 
           topHCate1.off("change").on("change", function () {
             var get_scheme = $(this).val();
             console.log(get_scheme);
             cate_one = get_scheme;
             get_second_cate_val(cate_one);
           });
         },
       });
     }
 
     function get_second_cate_val(get_val) {
       console.log("GET" + get_val);
       $.ajax({
         type: "post",
         url: "/top_holdings_category",
         data: {
           pass_val: get_val,
         },
         success: function (data) {
           var get_data = data.data;
           var topHCate2 = $("#topHCate2");
           topHCate2.empty();
           get_data.forEach((element) => {
             topHCate2.append(
               $("<option>").val(element.VCLASSCODE).text(element.VCLASS)
             );
           });
 
           initial_secondd_val = topHCate2.val();
           get_third_cate_val(cate_one, initial_secondd_val);
           get_second_cate_val_condition = false;
           console.log(get_second_cate_val_condition);
 
           topHCate2.off("change").on("change", function () {
             initial_secondd_val = $(this).val();
             console.log(initial_secondd_val);
             get_third_cate_val(cate_one, initial_secondd_val);
 
             console.log(cate_one);
           });
         },
       });
     }
 
     function get_third_cate_val(get_hold_house, get_schemes) {
       $.ajax({
         type: "post",
         url: "/holdings_scheme",
         data: {
           pass_hold_house: get_hold_house,
           pass_schemes: get_schemes,
         },
         success: function (data) {
           var selectScheme = $("#selectScheme");
           selectScheme.empty(); // Clear previous options
           console.log(data.data);
           var options = data.data.map(function (item) {
             return $("<option>").val(item.MF_SCHCODE).text(item.SCH_NAME);
           });
 
           selectScheme.append(options);
 
           console.log(selectScheme.val());
           var scheme_last_dropdown = selectScheme.val();
 
           get_main_holding_table_data(
             scheme_last_dropdown,
             final_pagination_limit
           );
 
           selectScheme.off("change").on("change", function () {
             hodling_last_dropdown = $(this).val();
             scheme_last_dropdown = hodling_last_dropdown;
             console.log(hodling_last_dropdown);
             get_main_holding_table_data(
               scheme_last_dropdown,
               final_pagination_limit
             );
           });
         },
       });
     }
     function get_main_holding_table_data(cate_one, initial_secondd_val) {
       $.ajax({
         type: "post",
         url: "/main_holding_table_data",
         data: {
           cate_one: cate_one,
           initial_secondd_val: initial_secondd_val,
         },
         success: function (data) {
           var hold_table_data = data.data;
           $("#top_holding_table").empty()
           hold_table_data.forEach((element) => {
             var row = `<tr>
                         <td>${element.co_name}</td>
                         <td>${parseFloat(element.Perc_hold).toFixed(2)}</td>
                       </tr>`;
             var table = $("#top_holding_table");
             table.append(row);
           });
         },
       });
     }
 
     top_holding_header();
    

    // Whats In/Out Start Here !!!!

    function whats_in_out() {
      $.ajax({
        type: "get",
        url: "/whats_in_out_category",
        dataType: "json",
        success: function (data) {
          var drop_down_data = data.data;
          drop_down_data.forEach((element) => {
            $("#funds_dropdown").append(
              $("<option>").val(element.mf_cocode).text(element.co_name)
            );
          });
        },
      });
    }
    whats_in_out();
    var intial_what = "In";
    var intial_co_val = "41331";

    $(".what_filter").click(function () {
      $(".what_filter").removeClass("what_active");
      $(this).addClass("what_active");
      var get_w_val = $(this).data("value");
      intial_what = get_w_val;
      to_pass_data();
    });

    $("#funds_dropdown").change(function () {
      var get_w_c_val = $(this).val();
      intial_co_val = get_w_c_val;
      to_pass_data();
    });

    function to_pass_data() {
      name(intial_what, intial_co_val);
    }
    to_pass_data();

    function name(get_intial_what, get_intial_co_val) {
      // console.log(get_intial_what, get_intial_co_val);
      $.ajax({
        type: "post",
        url: "/whats_table_val",
        data: {
          pass_data1: get_intial_what,
          pass_data2: get_intial_co_val,
        },
        success: function (data) {
          var all_data = data.data;
          $("#what_in_out_body").empty();
          all_data.forEach((element) => {
            var row = `<tr>
                       <td>${element.CO_NAME}</td>
                       <td>${element.NO_SHARES}</td>
                       <td>${parseFloat(element.mktvalue).toFixed(2)}</td>
                    </tr>`;
            var table = $("#what_in_out_body");
            table.append(row);
          });

          $("#what_in_out").DataTable({
            "dom": '<"top"lf>rt<"bottom"ip><"clear">',
            "language": {
            "search": '<div class="custom-search" style="position: relative"><i class="bi bi-search" style="position: absolute;right: 7px;top: 10px;"></i></i><input class="form-control" type="search" placeholder="Search" aria-controls="volume_shocker_table"></div>'
           }
          });
          $('#what_in_out_filter input:eq(1)').hide();
          $('#what_in_out_filter input[type="search"]').attr('placeholder', 'Search...');
        },
      });
    }

    // Dividend
       // Dividend
       var initial_fund = "5946";
       $("#fundHouse").change(function () {
         var div_fund_h = $(this).val();
         initial_fund = div_fund_h;
         name_is_div();
       });
   
       function get_dividend_category(get_fund_h) {
         $.ajax({
           type: "post",
           url: "/dividend_category",
           data: {
             pass_fund_h: get_fund_h,
           },
           success: function (data) {
             var cate_data = data.data;
             $("#myCategory").empty();
             cate_data.forEach((element) => {
               $("#myCategory").append(
                 $("<option>").val(element.VCLASSCODE).text(element.VCLASS)
               );
             });
           },
         });
       }
   
       function dividend_fund_house() {
         $.ajax({
           type: "get",
           url: "/dividend_data",
           dataType: "json",
           success: function (data) {
             var dividend_dropdown = data.data;
       
             $("#fundHouse").empty();
             dividend_dropdown.forEach((element) => {
               $("#fundHouse").append(
                 $("<option>").val(element.mf_cocode).text(element.co_name)
               );
             });
             var initialValue = dividend_dropdown.length > 0 ? dividend_dropdown[0].mf_cocode : "";
             $("#fundHouse").val(initialValue);
             console.log("Initial value:", initialValue);
           }
         });
       
         $("#fundHouse").change(function () {
           var initialValue = $(this).val();
           console.log("Selected value:", initialValue);
           get_dividend_category(initialValue);
         });
       }
       
       dividend_fund_house();
       
       function divdend_date_dropdown() {
         $.ajax({
           type: "get",
           url: "/dividend_date",
           dataType: "json",
           success: function (data) {
             var div_date = data.data;
   
             div_date.forEach((element) => {
               var original_val = element.DivDate;
               encodedDate = original_val.replace(/ /g, "%20");
   
               $("#selectDate").append(
                 $("<option>").val(encodedDate).text(element.DivDate)
               );
             });
           },
         });
       }
   
       var initial_d_cate = "26";
       $("#myCategory").change(function () {
         var div_cate = $(this).val();
         initial_d_cate = div_cate;
         name_is_div();
       });
   
       var initial_d_date = "Sep%202023";
       $("#selectDate").change(function () {
         var div_o_date = $(this).val();
         initial_d_date = div_o_date;
         name_is_div();
       });
   
       function name_is_div() {
         dividend_table_date(initial_fund, initial_d_cate, initial_d_date);
       }
       name_is_div();
      function dividend_table_date(
     get_initial_fund,
     get_initial_d_cate,
     get_initial_d_date
   ) {
     $.ajax({
       type: "post",
       url: "/dividend_datas",
       data: {
         param1: get_initial_fund,
         param2: get_initial_d_cate,
         param3: get_initial_d_date,
       },
       success: function (data) {
         var dividends = data.data;
         var table = $("#dividend_table").empty();
   
         if (!dividends || dividends.length === 0) {
           table.html("<p class='text-danger text-center'>No records found !!</p>");
         } else {
           dividends.forEach((element) => {
             var row = `<tr>
                           <td>${element.Sch_Name}</td>
                           <td>${parseFloat(element.NAVRS).toFixed(2)}</td>
                           <td>${parseFloat(element.DivAmount).toFixed(2)}</td>
                           <td>${element.RecordDate.split("T")[0]}</td>
                           <td>${parseFloat(element.year1).toFixed(2)}</td>
                           <td>${element.year3}</td>
                        </tr>`;
             table.append(row);
           });
         }
       },
     });
   }
   
       // dividend_table_date()
   
       divdend_date_dropdown();
       get_dividend_category();

    // Fund Profile

    function fund_profile_data() {
      $.ajax({
        type: "get",
        url: "/fund_profile",
        dataType: "json",
        success: function (data) {
          var fundData = data.data;
          fundData.forEach((element) => {
            var row = `<tr>
                        <td>${element.LNAME}</td>
                        <td>${element.STARTED_ON.split("T")[0]}</td>
                        <td>${element.FUND_TYPE}</td>
                        <td>${element.SumOfTOTNAV}</td>
                        <td>${element.dateas.split("T")[0]}</td>
                      </tr>`;
            var table = $("#fund_profile_table");
            table.append(row);
          });
        },
      });
    }

    fund_profile_data();

    // New Fund offer Start Here !!!!!

    var intial_type = "equity";

    $("#new_fundOptions").change(function () {
      var new_fund_value = $(this).val();
      new_fund_param(new_fund_value);
    });

    function new_fund_param(intial_type) {
      // console.log(intial_type);

      $.ajax({
        type: "post",
        url: "/new_funds_offer",
        data: {
          pass_intial_type: intial_type,
        },
        success: function (data) {
          var new_fund_all_data = data.data;
          $("#new_fund").empty();
          if (!new_fund_all_data) {
            $("#new_fund").html(
              "<p class='text-danger text-center'>no record found !!"
            );
          } else {
            new_fund_all_data.forEach((element) => {
              if (intial_type === "equity") {
                tdVal = element.TypeName;
              } else if (intial_type === "Debt") {
                tdVal = element.TypeName;
              } else if (intial_type === "hybrid") {
                tdVal = element.TypeName;
              }

              var row = `<tr>
                              <td>${element.Sch_Name}</td>
                              <td>${tdVal}</td>
                              <td>${element.Launc_Date.split("T")[0]}</td>
                              <td>${element.CLDATE.split("T")[0]}</td>
                              <td>${element.MININVT}</td>
                              <td>${element.OFFERPRICE}</td>
                              <td>${element.VClass}</td>
                              </tr>`;
              var table = $("#new_fund");
              table.append(row);
            });
          }
        },
      });
    }

    new_fund_param(intial_type);

    // Mutual Fund news

    $(".news_table").on("click", ".Mutualnews-wq", function () {
      var news_id = $(this).data("value");
      // console.log(news_id);
    });

    function mutual_fund_news_data() {
      $.ajax({
        type: "get",
        url: "/mutual_fund_news",
        dataType: "json",
        success: function (data) {
          var mutual_news = data.data.slice(0, 6);
          mutual_news.forEach((element) => {
            var news_box = `<div class="Mutualnews-wq" data-value=${
              element.Sno
            }>
                                  <div>
                                    <p>${element.Heading}</p>
                                    <span>${
                                      element.Date.split("T")[0]
                                    }</span> <span>(${element.Time})</span>
                                    </div>
                               </div>   
                                `;
            $(".news_table").append(news_box);
          });
        },
      });
    }

    mutual_fund_news_data();
  });
</script>

{% endblock dashboard_body %}
