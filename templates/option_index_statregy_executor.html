{% extends "base_dashboard.html" %} {% load static %} {% block dashboard_body %}



<style>
  .day_1 {
    border-radius: 4px;
    color: white;
    background: cornflowerblue;
    width: fit-content;
    height: 28px;
    padding: 0 6px 0 5px;
    transition: 0.3s;
    cursor: pointer;
    display: flex;
    align-items: center;
  }

  .day_1:hover {
    color: cornflowerblue;
    border: 1px solid cornflowerblue;
    background: transparent;
  }

  .button_left_simu,
  .button_right_simu {
    display: flex;
    gap: 1rem;
  }

  .main_all_button_filter {
    display: flex;
    justify-content: space-between;
  }

  .pre_built_simu {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 0 0;
    gap: 0.5rem;
    padding: 0px 15px 17px 14px;
  }

  .straddle {
    color: #4399eb;
    border: 1px solid #4399eb;
    background-color: #fff;
    -webkit-box-shadow: none;
    box-shadow: none;
    -webkit-transition: 0.3s;
    -moz-transition: 0.3s;
    transition: 0.3s;
    outline: 0;
    font-size: 13px;
    padding: 7px 11px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 5px;
  }

  .straddle:hover {
    background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
    color: #fff !important;
  }

  .option_strategies_active {
    background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
    color: #fff !important;
  }

  .success_cvr {
    background: #90eeae65 !important;
    color: rgb(13, 162, 0);
  }

  .danger_cvr {
    background: #ff000054 !important;
    color: red;
  }
</style>
<style>
  p {
    margin-bottom: auto !important;
  }

  .main_option_chain_table,
  .main_option_oi,
  .main_option_greeks {
    height: 75vh;

    overflow: auto;
    margin: 1rem 0;
  }

  .bg-light-green {
    background-color: #c9ffed;
  }

  .bg-light-red {
    background-color: #ffd2cf;
  }

  #put_call_put {
    right: 0;
  }

  .put_call_btns {
    outline: none;
    border: none;
    height: 30px;
    margin: 2px 0 0 0;
    color: black;
    transition: 0.3s;
  }

  .call-pul-ltp-btns {
    gap: 0.5rem !important;
    display: none;
  }

  .main_option_chain_table table thead tr th {
    font-size: 14px !important;
    color: #000000a3 !important;
    font-family: system-ui !important;
  }

  .main_option_oi table thead tr th,
  .main_option_greeks table thead tr th {
    font-size: 14px !important;
    color: #000000a3 !important;
    font-family: system-ui !important;
  }

  .main_option_chain_table table thead {
    width: 100%;
    position: sticky;
    top: -1px;
    z-index: 70;
    background-color: var(--backgroundColor);
    box-shadow: 1px 0px 0 0.5px var(--dividerColor2);

    background-color: white;
  }

  .main_option_oi table thead,
  .main_option_greeks table thead {
    width: 100%;
    position: sticky;
    top: -1px;
    z-index: 70;
    background-color: var(--backgroundColor);
    box-shadow: 1px 0px 0 0.5px var(--dividerColor2);

    background-color: white;
  }

  .strategy_option_chain tr td,
  .strategy_option_chain_oi tr td,
  .strategy_option_chain_greeks tr td {
    font-size: 13px;
    font-weight: 700;
    color: #0000009e;
    font-family: system-ui;
  }

  .call_put_tr:hover .call-pul-ltp-btns {
    display: flex !important;
  }

  .strategy_table_input {
    padding-bottom: 1rem !important;
    display: flex;
    row-gap: 0.5rem;
    column-gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    align-items: center;
  }

  .background_opiton_closest {
    background-color: #004597f7 !important;
    color: white !important;
  }

  .background_opiton_closest_payoff_table {
    background: #dddddd9c;
  }


  .add-btn {
    font-size: 22px;
    position: relative;
    /* background: linear-gradient(180deg,#4399eb,#5cadfb)!important;  */
    color: #4399eb;
    height: auto;
    width: auto;
  }

  .delete-btn {
    margin-left: 9px;
    font-size: 22px;
    color: #7f7e7ed6;
    transition: 0.2s;
    cursor: pointer;
  }

  .delete-btn:hover {
    color: rgb(210, 0, 0);
  }
</style>
<style>
  .option_chain_strategies,
  .main_max_pain_strategies,
  .lot_size_strategies,
  .open_strategies,
  .low_strategies,
  .high_strategies,
  .high52_strategies,
  .low52_strategies,
  .spot_strategies {
    font-size: 16px;
    font-weight: 700;
    color: #00000099;
  }

  .spot_strategies {
    display: flex;
    gap: 0.2rem;
    background: #E4F3EF;
    font-size: 16px;
    padding: 6px 5px;
  }

  .main_futures_price_as_per_expiries {
    display: flex;
    gap: 0.2rem;
    background: #E8F7E4;
    font-size: 16px;
    padding: 6px 5px;
  }

  .main_max_pain_strategies {
    display: flex;
    align-items: center;
    font-size: 16px;
    background: #F6EDEB;
    padding: 6px 5px;
  }

  .lot_size_strategies {

    display: flex;
    align-items: center;
    font-size: 16px;
    background: #E8F2FB;
    gap: 0.2rem;
    padding: 6px 5px;
  }



  .low52_strategies {
    display: flex;
    gap: 0.2rem;
    background: #E8F7E4;
    align-items: center;
    padding: 6px 5px;


  }

  .high52_strategies {
    display: flex;
    gap: 0.2rem;
    background: #F7E4E6;
    align-items: center;
    padding: 6px 5px;


  }

  .open_strategies {
    display: flex;
    gap: 0.2rem;
    background: #EEEDFB;
    align-items: center;
    padding: 6px 5px;


  }

  .low_strategies {
    display: flex;
    gap: 0.2rem;
    background: #E8F3FC;
    align-items: center;
    padding: 6px 5px;


  }

  .high_strategies {
    display: flex;
    gap: 0.2rem;
    background: #F6EAE8;
    align-items: center;
    padding: 6px 5px;


  }



  .option_chain_strategies:hover {
    color: #5cadfb;
    cursor: pointer;
  }

  .main_top_all_left_right {
    flex-wrap: wrap;
    row-gap: 1rem;
  }

  .main_top_strategies {
    flex-wrap: wrap;
  }

  .strategy_simu {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .right_side_top_strategies {
    display: flex;
    flex-wrap: wrap;
    row-gap: 0.5rem;
    justify-content: flex-end;
    column-gap: 0.5rem;
  }

  #spot_arrow {
    font-family: boxicons !important;
    font-weight: 600;
    font-style: normal;
    font-variant: normal;
    line-height: 1;
    text-rendering: auto;
    display: inline-block;
    font-size: 10px !important;
    text-transform: none;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  .btn_outline_primary,
  .bi-arrow-clockwise {
    background: linear-gradient(180deg, #4399eb, #5cadfb);
    color: #fff;
    border: 1px solid #4399eb;
    transition: 0.3s;
    border-radius: 6px;
    height: 33px;
    font-size: 14px;
    font-weight: 500;
  }

  .btn_outline_primary:hover,
  i.bi.bi-arrow-clockwise:hover {
    color: #4399eb !important;
    background: white !important;
    border: 1px solid #4399eb !important;
  }

  i.bi.bi-arrow-clockwise {
    /* width: 36px; */
    border: 1px solid;
    padding: 6px 0px 1px 10px !important;
    border-radius: 6px;
    height: 31px !important;
    transition: 0.3s;
  }
</style>
<style>
  .textOnInput {
    position: relative;
    width: 11rem;
  }

  .textOnInput label {
    position: absolute;
    top: -9px;
    font-weight: 700;
    left: 10px;
    padding: 2px;
    color: rgb(56, 56, 56);
    z-index: 1;
    font-size: 12px;
    white-space: nowrap;
  }

  .textOnInput label:after {
    content: " ";
    background-color: #fff;
    width: 100%;
    height: 13px;
    position: absolute;
    left: 0;
    bottom: 0;
    z-index: -1;
  }

  label {
    font-size: 16px;
    font-weight: 500;
    display: inline-block;
    margin-bottom: 0.5rem;
  }

  .form-control {
    box-shadow: none !important;
  }

  .data-display-table {
    display: flex;
    justify-content: center;
    flex-direction: column;
  }

  .put_call_btns:hover {
    background-color: white;
    color: #4399eb;
  }

  .put_max_profit {
    font-weight: 600;
    font-size: 13px !important;
    color: #21d052 !important;
  }

  .long_max_loss,
  .breakever_probaility_profit {
    font-weight: 600;
    font-size: 13px !important;
  }

  .strategy_cost_table,
  .payoff_charts,
  .payoff_table,
  .oi_chart,
  .adjustment,
  .targets,
  .stoploss,
  .alerts,
  .history,
  .greek_table {
    font-family: system-ui;
    color: #767f88;

    font-weight: 600;

    font-size: 15px;
    padding: 7px;
    font-family: system-ui;
    cursor: pointer;
  }

  #resultTable thead tr th,
  .PL-table thead tr th,
  .payoff_table_main_table thead tr th,
  .targets_table thead tr th,
  .stoploss_table thead tr th,
  #positionsTable thead tr th,
  .adjsuments_table_thead {
    background: #4399eb;
    color: white;
    font-size: 12px;
    font-weight: 600;
    font-family: system-ui;
  }

  .bg_option_for {
    background: #fffee5 !important;
  }

  .closestStrike_bg {
    background: #0055978f !important;
    color: white !important;
  }

  #resultTable tbody tr td,
  .PL-table tbody tr td,
  .payoff_table_main_table tbody tr td {
    font-size: 14px;
  }

  #resultTable tbody tr td,
  .PL-table tbody tr td,
  .payoff_table_main_table tbody tr td {
    border-color: inherit !important;
    border: none;
    border-bottom-style: inherit !important;

    border-width: 1px !important;
  }

  .table-striped-custom>tbody>tr:nth-child(2n)>td,
  .table-striped-custom>tbody>tr:nth-child(2n)>th {
    background-color: rgb(240, 247, 253) !important;
  }

  .table-striped-custom>tr:nth-child(2n)>td,
  .table-striped-custom>tr:nth-child(2n)>th {
    background-color: rgb(240, 247, 253) !important;
  }
</style>
<style>
  .inner_greek_p_l {
    margin-bottom: 0.5rem;
  }

  .greek_strategy_active {
    color: #2196f3 !important;
    border-bottom: 2px solid #2196f3 !important;
  }
</style>
<style>
  .strategy_inputs,
  .textOnInput_edit {
    position: relative;
    width: 259px;
    display: flex;
    gap: 0.5rem;
    height: 2.5rem !important;
    margin-bottom: 0.5rem;
  }

  .futures_segements_main {
    position: relative;
    width: 200px;
    display: flex;
    gap: 0.5rem;
    height: 2.5rem !important;
    margin-bottom: 0.5rem;
  }

  .futures_segements_main_expiry {
    position: relative;
    width: 200px;
    display: flex;
    gap: 0.5rem;
    height: 2.5rem !important;
    margin-bottom: 0.5rem;
  }

  .add_broker_api_fields {
    position: relative;

    display: flex;
    gap: 0.5rem;

  }

  .order_place_input {
    position: relative;
    width: 115px;
    display: flex;
    gap: 0.5rem;
    height: 2.5rem !important;
    margin-bottom: 0.5rem;
  }

  .futures_segements_main label,
  .futures_segements_main_expiry label,
  .strategy_inputs label,
  .add_broker_api_fields label,
  .textOnInput_edit label,
  .order_place_input label {
    position: absolute;
    top: -9px;
    font-weight: 700;
    left: 10px;
    padding: 2px;
    color: rgb(56, 56, 56);
    z-index: 1;
    font-size: 12px;
    white-space: nowrap;
    background: white;
  }

  .strategy_inputs select:focus,
  .futures_segements_main select:focus,
  .futures_segements_main_expiry select:focus,
  .add_broker_api_fields select:focus,
  .textOnInput_edit select:focus {
    box-shadow: none !important;
  }

  .add_broker_api_fields label:after,
  .strategy_inputs label:after,
  .futures_segements_main label:after,
  .futures_segements_main_expiry label:after,
  .textOnInput_edit label:after,
  .order_place_input label:after {
    content: " ";
    background-color: transparent;
    width: 100%;
    height: 13px;
    position: absolute;
    left: 0;
    bottom: 0;
    z-index: -1;
  }

  .textOnInput_edit select {
    outline: none;
    height: 40px;
    width: 300px;
    padding: 0 15px;
    box-shadow: none;
    border-radius: 6px;
    border: 1px solid hsla(0, 0%, 72.5%, 0.3);
    background-color: #fff;
  }

  #modal_title_edit {
    font-size: 18px;
  }

  #modal_header_edit {
    border-bottom: 1px solid lightgray !important;
    padding: 7px 10px !important;
    margin-bottom: 1rem !important;
  }

  .Long_short,
  .Long_short_future {
    display: flex;
    gap: 1rem;
  }

  label {
    font-size: 16px;
    font-weight: 500;
    display: inline-block;
    /* margin-bottom: 0.5rem; */
  }

  p {
    margin-bottom: auto;
  }

  .form-control:disabled {
    background-color: white !important;
  }

  .main_body_fields_strangle,
  .main_body_fields_spread,
  .main_body_fields_ironFly,
  .main_body_fields_ironCondor,
  .main_body_fields_jaze_lizard,
  .main_body_fields_double_iron_fly {
    display: flex;
    flex-direction: column;
    /* align-items: center; */
  }

  .main_body_fields_straddle {
    display: flex;
    flex-direction: column;
  }

  .straddle_filter {
    display: flex;
    justify-content: center;
  }

  .straddle_active {
    border-bottom: 2px solid#4399eb !important;
    background: #4399eb12 !important;
    color: #4399eb !important;
  }

  .long_straddle,
  .short_straddle {
    padding: 4px 40px;
    cursor: pointer;
    font-size: 15px;
    transition: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    font-weight: 500;
    color: gray;
  }

  .strike_price,
  .expiry_straddle {
    display: flex;
    justify-content: center;
    align-items: baseline;
    gap: 1rem;
  }

  #strikePrice,
  #expiry_date {
    border: none !important;
    border-bottom: 3px solid gray !important;
    border-radius: inherit !important;
  }

  #strikePrice:focus,
  #expiry_date:focus {
    box-shadow: none !important;
    border-bottom: 3px solid #4399eb !important;
  }

  #strikePrice option:hover {
    background-color: transparent !important;
    color: #4399eb !important;
  }

  #strikePrice:active {
    background-color: white !important;
    color: #4399eb !important;
  }

  #strikePrice option {
    border: 1px solid gray !important;
  }

  .Strike_dropdown,
  .expiry_dropdown {
    width: 186px;
  }

  .Strike_price_label,
  .Expiry_date_label {
    font-size: 10px;
  }

  #futures_counter_input,
  #counter_input,
  .counter_input_edit,
  #counter_input_strangle,
  #counter_input_ironFly,
  #counter_input_spread,
  #counter_input_ironCondor,
  #counter_input_jaze_lizard,
  #counter_input_double_iron_fly,
  #counter_input_double_iron_condor,
  #counter_input_put_butterfly,
  #counter_input_call_butter_fly,
  #counter_input_custom_strategy {
    width: 38px;
    text-align: center;
  }

  .modal-header {
    border-bottom: none !important;
  }

  #edit_modal {
    width: fit-content !important;
  }

  .main_strikePrice {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  #future_decrement,
  #future_increment,
  #decrement,
  #increment,
  .decrement_edit,
  .increment_edit,
  #decrement_strangle,
  #increment_strangle,
  #decrement_spread,
  #increment_spread,
  #decrement_ironFly,
  #increment_ironFly,
  #decrement_ironCondor,
  #increment_ironCondor,
  #decrement_double_iron_fly,
  #increment_double_iron_fly,
  #decrement_double_iron_condor,
  #increment_double_iron_condor,
  #decrement_jaze_lizard,
  #increment_jaze_lizard,
  #decrement_put_butterfly,
  #increment_put_butterfly,
  #decrement_call_butter_fly,
  #increment_call_butter_fly,
  #decrement_custom_strategy,
  #increment_custom_strategy {
    background: #4399eb;
    border: 1px solid #4399eb;
    width: 36px;
    height: 36px;
    border-radius: 0;
    font-size: 22px;
    color: white;
    transition: ease-out 0.3s;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #future_decrement:hover,
  #future_increment:hover,
  #decrement:hover,
  #increment:hover,
  #decrement_strangle:hover,
  #increment_strangle:hover,
  #decrement_spread:hover,
  #increment_spread:hover,
  #decrement_ironFly:hover,
  #increment_ironFly:hover,
  #decrement_ironCondor:hover,
  #increment_ironCondor:hover,
  #decrement_jaze_lizard:hover,
  #increment_jaze_lizard:hover,
  #decrement_double_iron_fly:hover,
  #increment_double_iron_fly:hover,
  #decrement_double_iron_condor:hover,
  #increment_double_iron_condor:hover,
  #decrement_put_butterfly:hover,
  #increment_put_butterfly:hover {
    background: white;
    color: #4399eb;
  }

  .pe_ce,
  .strangle_lot_size {
    font-size: 15px;
    padding: 6px 0 0 0;
    white-space: nowrap;
  }

  #modal_body {
    padding: 0 17px 27px 17px;
  }

  #straddle_modal {
    width: 22rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    border-radius: 8px;
    background-color: white;
    display: none;
    margin: 14px 0 0 0;
  }

  .option_simulator_strategy,
  .saveChanges,
  #saveStrategies {

    /* height: 34px; */

    background: -webkit-gradient(linear, left top, left bottom, from(#4399eb), to(#5cadfb));
    background: -moz-linear-gradient(top, #4399eb, #5cadfb);
    background: linear-gradient(180deg, #4399eb, #5cadfb);
    color: #fff;

    border: 1px solid #4399eb;

    -webkit-box-shadow: none !important;
    box-shadow: none !important;
    -webkit-transition: .3s !important;
    -moz-transition: .3s !important;
    transition: .3s !important;
    outline: 0 !important;
    text-align: center;
    padding: 6px 10px;
    font-size: 14px;
    border-radius: 5px;
    font-weight: 500;
    white-space: nowrap;
    cursor: pointer;
  }

  .option_simulator_strategy:hover,
  .saveChanges:hover,
  #saveStrategies:hover {
    color: #4399eb;
    border: 1px solid #4399eb;
    background: #fff;
  }

  #strangle_modal {
    width: 22rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #spread_modal {
    width: 22rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #ironFly_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #ironCondor_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #jaze_lizard_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #double_iron_fly_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #double_iron_condor_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #put_butterfly_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #call_butter_fly_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 15px 0px 1px 0;
    display: none;
    left: -61px;
    border-radius: 8px;
    background-color: white;

  }

  #custom_strategy_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    /* margin: 15px 0px 1px 0; */
    display: none;

    inset: 0px auto auto 0px;
    margin: 0px;
    transform: translate3d(0px, 48px, 0px);
    left: -61px;
    border-radius: 8px;
    background-color: white;
    border: none !important;

  }

  .dismiss {
    display: flex;
    flex-direction: row-reverse;
    padding: 5px 10px;

    position: relative;
  }

  .dismiss_icon {
    font-size: 18px;
    transform: rotate(45deg);
    cursor: pointer;
  }

  .lot_title {
    font-size: 1rem !important;
    padding-top: 7px;
  }

  #shortStraddle,
  #shortStrangle,
  #shortSpread,
  #shortironFly,
  #short_ironCondor,
  #shortjaze_lizard,
  #shortdouble_iron_fly,
  #shortdouble_iron_condor,
  #shortput_butterfly,
  #shortcall_butter_fly {
    width: 68px;
    text-align: center;
    font-size: 12px;
    height: 37px;
    font-weight: 700;
    background: #dd0000;
    color: white;
    border: 1px solid;
    border-radius: 5px;

    transition: 0.1s;

  }

  #shortcustom_strategy {
    width: 122px;
    text-align: center;
    font-size: 16px;
    height: 37px;
    font-weight: 700;
    background: #dd0000;
    color: white;
    border: 1px solid;
    border-radius: 5px;
    transition: 0.1s;
  }

  #shortStraddle:hover,
  #shortStrangle:hover,
  #shortSpread:hover,
  #shortironFly:hover,
  #short_ironCondor:hover,
  #shortjaze_lizard:hover,
  #shortdouble_iron_fly:hover,
  #shortdouble_iron_condor:hover,
  #shortcall_butter_fly:hover,
  #shortcustom_strategy:hover,
  #shortput_butterfly:hover {
    background: white;
    border: 1px solid #dd0000;
    color: #dd0000;
  }

  #shortStraddle:focus,
  #shortStrangle:focus,
  #shortSpread:focus,
  #shortironFly:focus,
  #short_ironCondor:focus,
  #shortjaze_lizard:focus,
  #shortdouble_iron_fly:focus,
  #shortdouble_iron_condor:focus,
  #shortcall_butter_fly:focus,
  #shortcustom_strategy:focus,
  #shortput_butterfly:focus {
    background: #dd0000;
    color: white;
    border: 1px solid #dd0000;
  }

  .innerStraddle_lot_size {
    display: flex;
    gap: 0.5rem;
  }

  input[type="text"]:disabled {
    background: #ccc0 !important;
  }

  .triangle-up {
    width: 0;
    height: 0;
    left: 54px;

    position: absolute;
  }

  .triangle-up-call_butterfly {
    width: 0;
    height: 0;
    left: 54px;

    position: absolute;
  }

  .triangle-up::before {
    content: "";
    position: absolute;
    width: 0;
    height: 0;
    top: -2px;
    margin-left: -0.5em;

    box-sizing: border-box;
    border: 11px solid #ffecec00;
    border-color: transparent transparent #ffffff #ffffff;
    transform-origin: 0 0;
    box-shadow: -3px 3px 3px 0 #4399eb3b;
    transform: rotate(135deg);
  }

  .triangle-up-call_butterfly::before {
    content: "";
    position: absolute;
    width: 0;
    height: 0;
    top: -2px;
    margin-left: -0.5em;
    box-sizing: border-box;
    border: 11px solid #ffecec00;
    border-color: transparent transparent #ffffff #ffffff;
    transform-origin: 0 0;
    box-shadow: -3px 3px 3px 0 #4399eb3b;
    transform: rotate(135deg);
    left: 54px;
  }

  .triangle-up-custom_strategy::before {
    content: "";
    position: absolute;
    width: 0;
    height: 0;
    top: -5px;
    margin-left: -0.5em;
    box-sizing: border-box;
    border: 11px solid #ffecec00;
    border-color: transparent transparent #ffffff #ffffff;
    transform-origin: 0 0;
    box-shadow: -3px 3px 3px 0 #4399eb3b;
    transform: rotate(135deg);

  }

  .main_counter {
    align-items: center;
    justify-content: center;
  }
</style>

<style>
  .main_option_strategy_optimizer {
    box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
    padding: 10px 15px;
    padding-bottom: 8rem;
  }

  .left_main_strategy_position {
    box-shadow: #4399eb29 0px 1px 4px;
    padding: 18px 18px;
  }

  .right_p_l_greeks {
    box-shadow: #4399eb29 0px 1px 4px;
    padding: 0 18px 18px 18px;
  }

  .inner_p_l_greeks {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }

  .inner_position,
  .ltpValue,
  .unitPrice,
  .adjsutedLotSize,
  .absoluteQuantity,
  .totalCurrentCost,
  .final_P_L,
  .greeks_iv,
  .greeks_delta,
  .greeks_theta,
  .greeks_gamma,
  .greeks_vega,
  .greeks_rho,
  .greeks_position,
  .p_l_position {
    font-size: 14px;
    font-weight: 600;
    font-family: system-ui;
    color: #666;

    padding: 9px 0;
    align-items: center;
  }

  .main_add_position_actions {
    border-bottom: 1px solid #8080803b;
    transition: 0.3s;

  }

  .main_add_position_actions:hover {
    box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;

  }

  .green-option-indicator {
    color: #00b865;
    width: 6px;
    background: #00b865;
    height: 28px;
    /* border-radius: 8px 0px 0px 9px; */
  }

  .red-option-indicator {



    width: 6px;
    background: #e6191e;
    height: 28px;
    /* border-radius: 8px 0px 0px 9px; */
  }


  .history_table {
    display: flex;
    justify-content: center;
    height: 400px;
    align-items: center;

  }

  /* 
    .table-striped-custom>tbody>tr:nth-child(2n)>td,
    .table-striped-custom>tbody>tr:nth-child(2n)>th {
        background-color: rgb(240, 247, 253) ;
    } */
  .max_pain_strategies p,
  .spot_title,
  .lot_size_strategies p,
  .low52_strategies p,
  .high52_strategies p,
  .open_strategies p,
  .low_strategies p,
  .high_strategies p,
  .option_chain_strategies p {
    font-weight: 700 !important;
    font-size: 16px;
    color: #353535;
  }

  .savedStrategies {
    border-bottom: 1px solid rgba(128, 128, 128, 0.229);
    padding: 6px 10px;
  }

  .savedStrategies:hover {
    background-color: rgba(128, 128, 128, 0.103);

  }

  .savedStrategies:hover .left_strategy_name {
    color: #4399EB;
  }

  .text-danger {
    color: #C22E00 !important;
  }

  .text-success {
    color: #039855 !important;
  }

  .payoff_table_main_table tr td:nth-child(n+2):nth-child(-n+7) {
    text-align: center;
  }

  .payoff_table_main_table thead th:nth-child(n+2):nth-child(-n+7) {
    text-align: center;
  }

  .payoff_table_main_table td:nth-child(8) {
    text-align: center;
    /* Set to 'end' for right alignment */
  }

  .payoff_table_main_table thead th:nth-child(8) {
    text-align: center;
    /* Set to 'end' for right alignment */
  }

  .main_all_spot_futures_val {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
</style>
<div class="title my-2 d-flex">
  <h5>Option Strategy Tester</h5>

</div>
<!-- <div class="main_all_indices d-flex" style="    justify-content: center;
  gap: 1rem;">


</div> -->

<script>
  function fetchData() {
    $.ajax({
      url: "/fetch_indices_data",
      dataType: "json",
      success: function (data) {
        // Handle the data here as per your requirements
        // //////console.log(data);

        // Clear existing data
        $(".main_all_indices").empty();

        // Iterate over the data and create the HTML elements
        data.forEach(function (item) {
          var priceClass = item.change_value > 0 ? "text-success" : "text-danger";
          var progress_caret = item.change_value > 0 ? "up" : "down";
          var background_color_global_indicator = item.change_value > 0 ? "#32cd4c2e" : "#cd32322e";
          var background_color_global_indicator_minus_plus = item.change_value > 0 ? "+" : "";

          var countryTable = `
          <div class="child_table">
            <div class="main_global_card" style="width: 19rem; display: flex; align-items: flex-end; column-gap: 1rem; margin-bottom: 1rem; border-radius: 10px; padding: 7px 11px; box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 1px 3px 1px; justify-content: space-between;">
              <div class="left_global_content" style="display: flex; align-items: flex-end; gap: 1rem;">
                <div class="gain_loss_icon">
                  <i class="bx bx-${progress_caret}-arrow-alt ${priceClass}" style="font-size: 34px; padding: 13px; font-weight: 300 !important; background-color: ${background_color_global_indicator}; border-radius: 20px;"></i>
                </div>
                <div class="stock_name_price">
                  <h5 style="font-size: 16px;">${item.symbol_name}</h5>
                  <h5 style="font-weight: 600 !important; font-size: 14px; color: darkslategray;">${item.last_trade_price}</h5>
                </div>
              </div>
              <div class="left_global_content">
                <div class="gain_loss_price">
                  <h5 class="${priceClass} percent_gain_loss_global" style="font-size: 16px;">${background_color_global_indicator_minus_plus}${item.change_per}%</h5>
                  <h5 class="${priceClass} percent_gain_loss_globla" style="font-weight: 600 !important; font-size: 14px; color: darkslategray;">${background_color_global_indicator_minus_plus}${item.change_value}</h5>
                </div>
              </div>
            </div>
          </div>`;

          $(".main_all_indices").append(countryTable);
        });
      }
    });
  }

  // Call initially
  fetchData();

  // Call at intervals of 10 seconds
  // setInterval(fetchData, 10000);




</script>


<div class="main_option_strategy_optimizer">
  <div class="top_content_option_chain p-3">
    <div class="main_top_all_left_right d-flex align-items-center justify-content-between">
      <div class="left_side_top_strategies">
        <div class="main_top_strategies d-flex align-items-center" style="gap: 0.80rem;">
          <select class="form-select stockDropdown" style="width: 200px;">
            <optgroup label="Indices">
              <option value="NIFTY">NIFTY</option>
              <option value="BANKNIFTY">BANKNIFTY</option>
              <option value="FINNIFTY">FINNIFTY</option>
            </optgroup>
            {% comment %} <optgroup label="Stocks"></optgroup> {% endcomment %}
          </select>


          <div class="main_futures_option_chains mb-2">

            <div class="main_futures_inputs">

              <div class="futures_segements_main">
                <label for="">Futures Segment</label>
                <select class="form-select">

                  <option value="futures">Futures</option>
                </select>
              </div>


              <div class="futures_segements_main_expiry">
                <label for="">Select Expiry</label>
                <select class="form-select futures_expiry">


                </select>
              </div>

              <div class="main_futures_buy_sell">
                <div class="form-check mb-0">
                  <input class="form-check-input" type="radio" name="callAction" id="callBuyRadio" value="Long" checked>
                  <label class="form-check-label mb-0" for="callBuyRadio">
                    Buy
                  </label>
                </div>
                <div class="form-check mb-0">
                  <input class="form-check-input" type="radio" name="callAction" id="callSellRadio" value="Short">
                  <label class="form-check-label mb-0" for="callSellRadio">
                    Sell
                  </label>
                </div>
              </div>

              <div class="innerStraddle_lot_size">
                <p class="fs-6 lot_title">Qty:</p>
                <div class="counter_straddle d-flex justify-content-center gap-1">
                  <button class="btn" id="future_decrement">
                    <i class="bx bx-minus"></i>
                  </button>
                  <input type="text" name="" id="futures_counter_input" min="1" disabled>
                  <button class="btn" id="future_increment">
                    <i class="bx bx-plus"></i>
                  </button>
                </div>
              </div>

              <button class="btn btn-primary put_call_btns" id="future_add_positions" data-f&o="future" style=" color: white !important;
              background-color: #042452; height: 36px;
              border-color: #021a3d;">ADD POSITION</button>
            </div>




          </div>

          <!-- <div class="option_chain_strategies d-flex align-items-center gap-1">
            <p>Option Chain</p>
            <i class="bx bx-link-external"></i>
          </div> -->

        </div>
      </div>


      <style>
        .zerodha_add_api {
          display: flex;
          width: 11rem;
          flex-direction: column;
          align-items: center;
          background: white;
          row-gap: 0.5rem;
          box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
          padding: 20px;
        }

        .zerodha_add_api img {
          width: 9rem;
        }

        .offcanvas-body input {
          margin-bottom: 1rem;
        }

        #zerodha_data_display {
          margin-top: 1rem;
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
        }

        .main_api_card {
          border-bottom: 1px solid #8080804f;
          display: flex;
          column-gap: 1rem;
          align-items: flex-end;
          padding: 1rem;
          /* box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px; */
          flex-direction: column;
        }

        .btn_add_broker {
          background-color: red;
          color: white;
          transition: 0.3s;
          border: 1px solid red;
          border-radius: 5px;
        }

        .btn_add_broker:hover {
          background-color: white;
          color: red;
          border: 1px solid red;
        }
      </style>

      <style>
        .dismiss_active_modal {
          display: flex;
          padding: 5px 10px;
          position: relative;
        }

        .dismiss_icon_active_modal {
          font-size: 18px;
          transform: rotate(45deg);
          cursor: pointer;
        }

        .triangle-up-active-modal {
          width: 0;
          right: 12px;
          height: 0;
          position: absolute;
        }

        .triangle-up-active-modal::before {
          content: "";
          position: absolute;
          width: 0;
          height: 0;
          top: -2px;
          margin-left: -0.5em;

          box-sizing: border-box;
          border: 11px solid #ffecec00;
          border-color: transparent transparent #ffffff #ffffff;
          transform-origin: 0 0;
          box-shadow: -3px 3px 3px 0 #4399eb3b;
          transform: rotate(135deg);
        }

        #active_broker_modal {
          width: max-content;
          box-shadow: 0px 0px 1px 2px #4399eb3b;
          position: absolute;
          right: 153px;
          z-index: 99;
          border-radius: 8px;
          background-color: white;
          margin: 12px 0 0 0;
          padding: 0 0 31px 0;
        }

        #overlay {
          display: none;
          position: fixed;
          z-index: 99;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
        }
      </style>

      <style>
        #order_btn {
          text-decoration: none;
          padding: 5px;
          background: linear-gradient(180deg, #4399eb, #5cadfb);
          color: #fff;
          border: 1px solid #4399eb;
          transition: 0.3s;
          border-radius: 6px;
          height: 33px;
          font-size: 14px;
        }

        #order_btn:hover {
          background: none;
          color: #4399eb;
        }

        div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm {
          background-color: linear-gradient(180deg, #4399eb, #5cadfb) !important;
        }

        .add_broker_api_fields input {
          height: 40px;
        }

        .dataTables_wrapper .dataTables_paginate {
          padding-top: 2.25em !important;

        }

        .dataTables_wrapper .dataTables_info {
          padding-top: 2.755em !important;
        }

        .Total_p_l {
          position: absolute;
          right: 20px;
          padding: 6px 0;
          width: 100%;
          display: flex;
          justify-content: space-between;
        }

        .Total_p_l span {
          padding-left: 66px;
        }

        .normal_order_background {
          background: #F2EDFD;
          width: fit-content;
          color: #A14AEE;
          padding: 0 5px;
        }

        .main_exit_positions {
          margin-left: 30px;
        }

        .main_futures_option_chains {
          display: flex;
          align-items: center;
          justify-content: space-between;
        }

        .futures_segements_main {
          margin-top: 1rem;
        }

        .futures_segements_main_expiry {
          margin-top: 1rem;
        }

        .main_futures_inputs {
          display: flex;
          gap: 1.5rem;
          align-items: center;
          flex-wrap: wrap;
        }

        .main_futures_inputs#future_add_positions {
          all: unset !important;

          color: white !important;
          background-color: #042452;
          border-color: #021a3d;
        }

        .main_futures_inputs#future_add_positions:hover {
          all: unset !important;

          color: white !important;
          background-color: #042452;
          border-color: #021a3d;
        }

        #callBuyRadio,
        #putBuyRadio {

          border-radius: 13% !important;
          cursor: pointer;
        }

        #callBuyRadio:checked,
        #putBuyRadio:checked {
          background-color: #00b865 !important;
          border-color: #00b865 !important;
        }

        #callBuyRadio:focus,
        #putBuyRadio:focus {
          box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
          background-color: #00b865 !important;
          border-color: #00b865 !important;
        }

        #callSellRadio,
        #putSellRadio {

          border-radius: 13% !important;
          cursor: pointer;

        }

        #callSellRadio:focus,
        #putSellRadio:focus {
          background-color: #e6191e !important;
          border-color: #e6191e !important;
          box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
        }

        #callSellRadio:checked,
        #putSellRadio:checked {
          background-color: #e6191e !important;
          border-color: #e6191e !important;

        }

        .main_futures_buy_sell {
          display: flex;
          gap: 1.3rem;
        }

        .main_futures_buy_sell.form-check label {
          margin-bottom: 0 !important;
        }
      </style>




      <div class="modal fade" id="saved_startegyModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Saved Strategies</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">

              <div class="all_strategies">

              </div>

            </div>

          </div>
        </div>
      </div>

    </div>



    <div class="main_all_spot_futures_val">
      <div class="spot_strategies">
        <p class="spot_title">Spot :</p>

        <div id="last_traded_price"></div>
        <div id="closest_strike_price" style="display: none"></div>
        <div id="closen_expiry_date"></div>
      </div>

      <div class="main_futures_price_as_per_expiries">
        <p class="futures_title">Futures :</p>

        <div class="futures_ltp"></div>
      </div>

      <div class="main_max_pain_strategies">
        <div class="max_pain_strategies d-flex align-items-center gap-1">
          <p>Max Pain : </p>

        </div>
        <div id="max_pain_value" style="font-size: 16px;"></div>
      </div>
      <div class="lot_size_strategies">
        <p>Lot Size :</p>
        <div id="lot_size_value"></div>
      </div>
      <div class="low52_strategies">
        <p>Low 52 Wk : </p>

        <div id="low52_value"></div>
      </div>

      <div class="high52_strategies">
        <p>High 52 Wk :</p>

        <div id="high52_value"></div>
      </div>
      <div class="open_strategies">
        <p>Open :</p>

        <div id="open_value"></div>
      </div>

      <div class="low_strategies">
        <p>Low : </p>

        <div id="low_value"></div>
      </div>
      <div class="high_strategies">
        <p>High : </p>

        <div id="high_value"></div>
      </div>

    </div>
    <div class="right_side_top_strategies">

      <button class="d-flex align-items-center" id="saveStrategies"><i class='bx bxs-bookmark'></i>
        <p style="margin-bottom: 0;">Strategies saved</p>
      </button>
      <button style="padding: 0px 14px;" class="btn_outline_primary" type="button" data-bs-toggle="offcanvas"
        data-bs-target="#optionChain_canvas" aria-controls="optionChain_canvasLabel" id="buid_custom_strategy_btn">
        Option Chain
        <i class="bx bx-chevron-down"></i>
      </button>

      <button class="btn_add_broker" data-bs-toggle="offcanvas" data-bs-target="#add_api" aria-controls="add_api">
        Add Broker
      </button>

      <div class="activate_broker_toggle_main_btn">



        <button class="btn_outline_primary" class="all_api_details" data-bs-toggle="collapse" id="Activate_broker_btn">
          Activate Broker <i class="bx bx-chevron-down"></i>
        </button>


        <div id="overlay"></div>

        <div class="" id="active_broker_modal" style="display: none;">
          <div class="dismiss_active_modal">
            <!-- <i class="bx bx-plus dismiss_icon_active_modal"></i> -->
            <div class="triangle-up-active-modal"></div>
          </div>
          <div class="modal_dialog">
            <div class="modal_content">


              <div class="all_broker">
                <div id="zerodha_data_display"></div>
              </div>





            </div>
          </div>
        </div>

      </div>




      <button id="order_btn">OrderÂ History</button>


    </div>



    <div class="modal fade" id="order_history" tabindex="-1" aria-labelledby="order_historyLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <div class="broker_position_icon">

            </div>
            <div class="position_names_user_details">
              <h5></h5>
              <p></p>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="All_positions table-responsive">
              <table id="positionsTable" class="display table">
                <thead>
                  <tr>
                    <th>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">

                      </div>
                    </th>
                    <th>Products</th>
                    <th>Symbol</th>
                    <th>Exchange</th>
                    <th>Quantity</th>
                    <th>Average Price</th>

                    <th>Last Price</th>
                    <th>P&L</th>

                  </tr>
                </thead>
                <tbody>
                  <!-- DataTable will populate this tbody dynamically -->
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="4"><button type="button" class="button-small button-blue" fdprocessedid="x3nu1">
                        Exit 1 position<!----> <!----></button></td>
                    <td colspan="2"></td>
                    <td class="text-right">Total</td>
                    <td class="text-right"><span class="main_all_pnl"></span>
                    </td>

                  </tr>
                </tfoot>
              </table>

            </div>
          </div>
          <!-- <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div> -->
        </div>
      </div>
    </div>

    <!-- <script>

      $(document).ready(function () {



        $("#order_btn").click(function () {
          $("#order_history").modal("show")
          //   var totalPLAdded = false; // Variable to track whether Total_p_l is already added
          //   var total_positions=  0
          //   var all_holdings_pnl=0
          //   const zerodha_socker = new WebSocket("ws://localhost:8001/ws/zerodha/")
          // //////console.log(zerodha_socker)
          // zerodha_socker.onmessage = function (event) {
          //     const data = JSON.parse(event.data);
          //     // //////console.log(data);

          //    var response=data
          //     //////console.log(response);


          //       $(".broker_position_icon").empty().append(`<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 60">
          //                   <defs>
          //                     <style>
          //                       .cls-1 {
          //                         fill: #f6461a;
          //                       }

          //                       .cls-2 {
          //                         fill: #db342c;
          //                       }
          //                     </style>
          //                   </defs>
          //                   <title>Kite logo trimmed</title>
          //                   <polygon class="cls-1" points="30 0 0 30 30 60 60 30 90 0 30 0" />
          //                   <polygon class="cls-2" points="30 60 60 30 90 60 30 60" />
          //                 </svg>`)


          //       var zerodha_kite_profile = response.all_profile.data
          //       $(".position_names_user_details h5").text(zerodha_kite_profile.user_name);
          //       $(".position_names_user_details p").text(`Client ID:${zerodha_kite_profile.user_id}`);

          //       if ($.fn.DataTable.isDataTable('#positionsTable')) {
          //         $('#positionsTable').DataTable().destroy();
          //       }


          //       $('#positionsTable tbody').empty();
          //       // Create a template for table rows
          //       // Create a template for table rows
          //       const rowTemplate = (position) =>


          //         `




          //             <tr>

          //               <td><div class="form-check">
          //               <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">

          //             </div></td>
          //                 <td ><div class="${position.product === "NRML" ? 'normal_order_background' : 'text-danger'}">${position.product}</div></td>
          //                 <td >${position.tradingsymbol}</td>
          //                 <td>${position.exchange}</td>
          //                 <td class="${parseFloat(position.exchange) > 0 ? 'text-success' : 'text-danger'}">${position.quantity}</td>
          //                 <td>${position.average_price}</td>
          //                 <td>${position.close_price}</td>
          //                 <td>${position.last_price}</td>
          //                 <td class="${position.pnl > 0 ? 'text-success' : 'text-danger'}">${position.pnl > 0 ? '+' : '-'}${position.pnl}</td>

          //             </tr>
          //         `;

          //       // Populate table body dynamically

          //       response.all_position.net.forEach(function (position) {
          //          total_positions+= position.pnl
          //         $('#positionsTable tbody').append(rowTemplate(position));
          //       });

          //       response.all_holding.forEach(function (holdings) {
          //         all_holdings_pnl+=holdings.pnl
          //         // //////console.log(holdings);

          //       })

          //       //////console.log(total_positions);
          //       //////console.log(all_holdings_pnl);
          //       // Initialize DataTable with custom drawCallback option
          //       $('#positionsTable').DataTable({
          //         order: [[6, 'asc']], // 6 is the column index for "Unrealised P&L"
          //         drawCallback: function () {
          //           // Check if Total_p_l is already added
          //           if (!totalPLAdded) {
          //             // Calculate and display the total value
          //             var totalUnrealised = response.all_position.net.reduce(function (sum, position) {
          //               return sum + position.unrealised;
          //             }, 0);

          //             // Add Total_p_l class within DataTable after the table
          //             var totalPLDiv = $(`
          //                          <div class="Total_p_l">
          //                               <div class="main_exit_positions">
          //               <button class="exit_all_positions_zerodha">Exit Positions</button>
          //               </div>


          //                               <div class="main_p_l_table">  Total P&L: <span class="${totalUnrealised > 0 ? 'text-success' : 'text-danger'}">${totalUnrealised > 0 ? '+' : '-'}${totalUnrealised.toFixed(2)}</span></div>
          //                             </div>
          //                         `);

          //             $('#positionsTable_wrapper').append(totalPLDiv);

          //             // Set totalPLAdded to true to indicate that Total_p_l is added
          //             totalPLAdded = true;
          //           }
          //            // Reset total_positions after DataTable is drawn
          //     total_positions = 0;
          //     all_holdings_pnl = 0;
          //         }
          //       });


          // }

          var intervalId_order = null; // Initialize the interval ID variable
          var totalPLAdded = false; // Variable to track if Total_p_l is added

          function fetchData() {
            $.ajax({
              type: "GET",
              url: "/get_order_positions_details", // Replace with the actual URL
              success: function (response) {
                // Log the response
                //////console.log(response);

                $(".broker_position_icon").empty().append(`<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 60">
                  <defs>
                    <style>
                      .cls-1 {
                        fill: #f6461a;
                      }

                      .cls-2 {
                        fill: #db342c;
                      }
                    </style>
                  </defs>
                  <title>Kite logo trimmed</title>
                  <polygon class="cls-1" points="30 0 0 30 30 60 60 30 90 0 30 0" />
                  <polygon class="cls-2" points="30 60 60 30 90 60 30 60" />
                </svg>`);

                var zerodha_kite_profile = response.all_profile.data;
                $(".position_names_user_details h5").text(zerodha_kite_profile.user_name);
                $(".position_names_user_details p").text(`Client ID:${zerodha_kite_profile.user_id}`);

                if ($.fn.DataTable.isDataTable('#positionsTable')) {
                  $('#positionsTable').DataTable().destroy();
                }

                $('#positionsTable tbody').empty();

                const rowTemplate = (position) => `
        <tr>
          <td><div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
          </div></td>
          <td><div class="${position.product === "NRML" ? 'normal_order_background' : 'text-danger'}">${position.product}</div></td>
          <td>${position.tradingsymbol}</td>
          <td>${position.exchange}</td>
          <td class="${parseFloat(position.exchange) > 0 ? 'text-success' : 'text-danger'}">${position.quantity}</td>
          <td>${position.average_price}</td>
          <td>${position.close_price}</td>
          <td>${position.last_price}</td>
          <td class="${position.pnl > 0 ? 'text-success' : 'text-danger'}">${position.pnl > 0 ? '+' : '-'}${position.pnl}</td>
        </tr>`;

                response.all_position.net.forEach(function (position) {
                  $('#positionsTable tbody').append(rowTemplate(position));
                });

                $('#positionsTable').DataTable({
                  order: [[6, 'asc']], // 6 is the column index for "Unrealised P&L"
                  drawCallback: function () {
                    if (!totalPLAdded) {
                      var totalUnrealised = response.all_position.net.reduce(function (sum, position) {
                        return sum + position.unrealised;
                      }, 0);

                      var totalPLDiv = $(`
              <div class="Total_p_l">
                <div class="main_exit_positions">
                  <button class="exit_all_positions_zerodha">Exit Positions</button>
                </div>
                <div class="main_p_l_table">Total P&L: <span class="${totalUnrealised > 0 ? 'text-success' : 'text-danger'}">${totalUnrealised > 0 ? '+' : '-'}${totalUnrealised.toFixed(2)}</span></div>
              </div>`);

                      $('#positionsTable_wrapper').append(totalPLDiv);
                      totalPLAdded = true;
                    }
                  }
                });
              },
              error: function (error) {
                console.error("Error:", error);
              }
            });
          }

          $("#order_btn").click(function () {
            $("#order_history").modal("show");

            if (intervalId_order === null) {
              //////console.log('Show');

              // Run the fetchData function every 1000 milliseconds (1 second)
              intervalId_order = setInterval(fetchData, 1000);
            }
          });

        })
        $("#order_history").on("hidden.bs.modal", function () {
          if (intervalId_order !== null) {
            // Clear the interval only if it's running
            clearInterval(intervalId_order);
            intervalId_order = null; // Reset the interval ID variable
          }
        });
        fetchData()


      })


    </script> -->



    <!-- Ajax_order_hostory -->




    <script>

      $(document).ready(function () {
        var intervalId_order = null; // Initialize the interval ID variable
        var totalPLAdded = false; // Variable to track if Total_p_l is added

        function fetchData() {
          $.ajax({
            type: "GET",
            url: "/get_order_positions_details", // Replace with the actual URL
            success: function (response) {
              // Log the response
              // //////console.log(response.main_net_ohlc);
              let mainNetOHLC = response.main_net_ohlc;
              let lastPrices = {};

              // Loop through the mainNetOHLC array
              for (let i = 0; i < mainNetOHLC.length; i++) {
                let tradingsymbol = Object.keys(mainNetOHLC[i])[0];
                let lastPrice = mainNetOHLC[i][tradingsymbol].last_price;

                // Remove "NFO:" from the tradingsymbol
                tradingsymbol = tradingsymbol.replace('NFO:', '');

                // Store lastPrice in the object
                lastPrices[tradingsymbol] = lastPrice;
              }

              // //////console.log(lastPrices);

              $(".broker_position_icon").empty().append(`
                      <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 60">
                        <defs>
                          <style>
                            .cls-1 {
                              fill: #f6461a;
                            }

                            .cls-2 {
                              fill: #db342c;
                            }
                          </style>
                        </defs>
                        <title>Kite logo trimmed</title>
                        <polygon class="cls-1" points="30 0 0 30 30 60 60 30 90 0 30 0" />
                        <polygon class="cls-2" points="30 60 60 30 90 60 30 60" />
                      </svg>
                    `);

              var zerodha_kite_profile = response.all_profile.data;
              $(".position_names_user_details h5").text(zerodha_kite_profile.user_name);
              $(".position_names_user_details p").text(`Client ID:${zerodha_kite_profile.user_id}`);

              if ($.fn.DataTable.isDataTable('#positionsTable')) {
                $('#positionsTable').DataTable().destroy();
              }

              $('#positionsTable tbody').empty();

              const rowTemplate = (position, lastPrice, main_p_n_l) => `
                                <tr class="selected">
                                  <td>
                                    <div class="form-check">
                                      <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                                    </div>
                                  </td>
                                  <td>
                                    <div class="${position.product === "NRML" ? 'normal_order_background' : 'text-danger'}">${position.product}</div>
                                  </td>
                                  <td>${position.tradingsymbol}</td>
                                  <td>${position.exchange}</td>
                                  <td class="${parseFloat(position.exchange) > 0 ? 'text-success' : 'text-danger'}">${position.quantity}</td>
                                  <td>${position.average_price.toFixed(2)}</td>


                                  <td>${lastPrice}</td>
                                  <td class="${main_p_n_l > 0 ? 'text-success' : 'text-danger'}">${main_p_n_l > 0 ? '+' : ''}${(main_p_n_l).toFixed(2)}</td>
                                </tr>`;

              // Assuming 'tradingsymbol' is available in the position object
              // Initialize a variable to store the total P&L
              let totalMainPNL = 0;

              response.all_position.net.forEach(function (position) {
                let tradingsymbol = position.tradingsymbol;
                // //////console.log(tradingsymbol);

                // Remove "NFO:" from the tradingsymbol
                tradingsymbol = tradingsymbol.replace('NFO:', '');

                let lastPrice = lastPrices[tradingsymbol] || ''; // Retrieve lastPrice from the object
                var average_price_main = position.average_price;
                var quantity_main = position.quantity;

                // Check if both average_price_main and quantity_main are zero
                if (average_price_main === 0 && quantity_main === 0) {
                  var main_p_n_l = position.pnl;
                } else {
                  var main_p_n_l = lastPrice * quantity_main - average_price_main * quantity_main;
                }

                // //////console.log(main_p_n_l);

                // Add main_p_n_l to the total
                totalMainPNL += main_p_n_l;

                // Use the modified row template with lastPrice
                $('#positionsTable tbody').append(rowTemplate(position, lastPrice, main_p_n_l));
              });

              // Display the total P&L in the element with the class .main_all_pnl
              let totalPNLElement = $('.main_all_pnl');
              totalPNLElement.text(`Total P&L: ${(totalMainPNL.toFixed(2))}`);

              // Add class based on the condition
              if (totalMainPNL < 0) {
                totalPNLElement.addClass('text-danger');
              } else {
                totalPNLElement.addClass('text-success');
              }




              //     $('#positionsTable').DataTable({
              //       order: [[6, 'asc']], // 6 is the column index for "Unrealised P&L"
              //       drawCallback: function () {
              //         if (!totalPLAdded) {
              //           var totalUnrealised = response.all_position.net.reduce(function (sum, position) {
              //             return sum + position.unrealised;
              //           }, 0);

              //           var totalPLDiv = $(`
              // <div class="Total_p_l">
              //   <div class="main_exit_positions">
              //     <button class="exit_all_positions_zerodha">Exit Positions</button>
              //   </div>
              //   <div class="main_p_l_table">Total P&L: <span class="${totalUnrealised > 0 ? 'text-success' : 'text-danger'}">${totalUnrealised > 0 ? '+' : '-'}${totalUnrealised.toFixed(2)}</span></div>
              // </div>`);

              //           $('#positionsTable_wrapper').append(totalPLDiv);
              //           totalPLAdded = true;
              //         }
              //       }
              //     });
            },
            error: function (error) {
              console.error("Error:", error);
            }
          });
        }

        $("#order_btn").click(function () {
          fetchData();
          $("#order_history").modal("show");

          if (intervalId_order === null) {
            // //////console.log('Show');

            // Run the fetchData function every 1000 milliseconds (1 second)
            intervalId_order = setInterval(fetchData, 5000);
          }
        });

        $("#order_history").on("hidden.bs.modal", function () {
          if (intervalId_order !== null) {
            // Clear the interval only if it's running
            clearInterval(intervalId_order);
            intervalId_order = null; // Reset the interval ID variable
          }
        });

        // Initial call to fetchData
        fetchData();
      });


    </script>



























    <div class="offcanvas offcanvas-end" tabindex="-1" id="add_api" aria-labelledby="offcanvasRightLabel"
      style="z-index: 9999999999999999">
      <div class="offcanvas-header">




        <h5 class="offcanvas-title" id="offcanvasRightLabel">
          Add broker API details
        </h5>





        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <form>
          <div class="add_broker_api_fields">
            <label for="expirydate">Select Broker</label>
            <select name="All_brokers" id="all_brokers" class="form-select mb-3">
              <option value="zerodha">Zerodha</option>
              <option value="upstocks">Upstox</option>
              <option value="angelone">Angel One</option>
              <option value="fyers">Fyers</option>
              <option value="icicidirectbreeze">ICICI Direct Breeze</option>
              <option value="groww">Groww</option>
              <option value="hdfcsecurities">HDFC Securities</option>
              <option value="kotaksecurities">Kotak Securities</option>
              <option value="motilaloswal">Motilal Oswal</option>
              <option value="paytmmoney">Paytm Money</option>
              <option value="sbi">SBI Securities</option>
              <option value="sharekhan">Sharekhan</option>
              <option value="5paisa">5paisa</option>
              <option value="iiflsecurities">IIFL Securities</option>
              <option value="axisdirect">Axis Direct</option>
              <option value="dhan">Dhan</option>
              <option value="geojit">Geojit</option>
            </select>

          </div>



          <div id="zerodhaFields">

            <div class="add_broker_api_fields">
              <label for="expirydate">Select Api</label>
              <select class="form-select mb-3" id="zerodha_platform" required>
                <option value="zerodha_kite">zerodha_kite</option>
                <!-- Add more options if needed -->
              </select>
            </div>

            <div class="add_broker_api_fields">
              <label for="zerodha_login_id">Login Id</label>
              <input type="text" class="form-control" id="zerodha_login_id"
                placeholder="Enter Trading Platform Login ID" required />
            </div>
            <div class="add_broker_api_fields">
              <label for="zerodha_password">Password</label>

              <input type="password" class="form-control" id="zerodha_password"
                placeholder="Enter Trading Platform Password" required />
            </div>
            <div class="add_broker_api_fields">
              <label for="zerodha_totp_key">TOTP Secret key </label>


              <input type="text" class="form-control" id="zerodha_totp_key" placeholder="Enter TOTP Key" required />
            </div>




            <div class="add_broker_api_fields">
              <label for="zerodha_app_name">App name </label>

              <input type="text" class="form-control" id="zerodha_app_name" placeholder="Enter App Name" required />
            </div>

          </div>

          <div id="angeloneFields" style="display: none;">
            <select class="form-select mb-3" id="angelone_platform" name="angelone_platform" required>
              <option value="smart_api">smart_api</option>
              <!-- Add more options if needed -->
            </select>
            <input type="text" class="form-control" id="angelone_login_id" name="angelone_login_id"
              placeholder="Enter Trading Platform Login ID" required />
            <input type="password" class="form-control" id="angelone_password" name="angelone_password"
              placeholder="Enter your MPIN" required />
            <input type="text" class="form-control" id="angelone_totp_key" name="angelone_totp_key"
              placeholder="Enter TOTP Key" required />
            <input type="text" class="form-control" id="angelone_api_key" name="angelone_api_key"
              placeholder="Enter API Key" required />
            <input type="text" class="form-control" id="angelone_app_name" name="angelone_app_name"
              placeholder="Enter App Name" required />
          </div>

          <div id="upstocksFields" style="display: none;">

            <select class="form-select mb-3" id="upstocks_platform" name="upstocks_platform" required>
              <option value="upstox_api">upstox_api</option>
              <!-- Add more options if needed -->
            </select>
            <input type="text" class="form-control" id="upstocks_login_id" name="upstocks_login_id" value="7DB863"
              placeholder="Enter Upstox Login ID" required />

            <input type="password" class="form-control" id="upstocks_password" name="upstocks_password" value="747474"
              placeholder="Enter Upstox 2FA pin" required />

            <input type="text" class="form-control" id="upstocks_totp_key" name="upstocks_totp_key"
              value="BS3GAWAMAG25MO7MGDA73HQAZBYZUZJQ" placeholder="Enter TOTP Key" required />

            <input type="text" class="form-control" id="upstocks_phone_number" name="upstocks_phone_number"
              value="9885443405" placeholder="Enter Registered phone Number" required />

            <input type="text" class="form-control" id="upstocks_api_key" name="upstocks_api_key"
              value="a6c092df-00a3-4e61-86ad-8cf0b0a72de3" placeholder="Enter API Key" required />

            <input type="text" class="form-control" id="upstocks_secret_key" name="upstocks_secret_key"
              value="ghjv4yytiu" placeholder="Enter Secret Key" required />

            <input type="text" class="form-control" id="upstocks_app_name" name="upstocks_app_name" value="navin"
              placeholder="Enter App Name" required />
          </div>

          <div class="validating_space"></div>


          <!-- Add similar div blocks for other brokers -->
          <div class="action_broker_btn_save_validate d-flex gap-1">
            <button class="btn btn-success save_validate_btn">Validate</button>
            <button class="btn btn-primary save_zerodha_btn">Add Broker</button>
          </div>
        </form>
      </div>







































      <style>
        .main_broker_card {
          box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
          width: 19rem;
          padding: 0.5rem 1rem;
          border-radius: 10px;
        }

        .top_head_broker_card {
          display: flex;
          justify-content: space-between;
          align-items: flex-end;
        }

        .left_app_name_broker {
          display: flex;
          gap: 0.2rem;
          padding: 5px 5px 0 5px;
          border-radius: 7px;
        }

        .right_broker_id h6 {
          background: #dedede;
          padding: 2px 13px;
          font-size: 12px;
          color: darkslategray;
          border-radius: 5px;
          color: dimgray;
        }

        .main_broker_loggin_id {
          margin-top: 10px;
          color: dimgray;
        }

        .main_broker_password {
          margin-bottom: 10px;
          color: dimgray;
        }

        .activate_api {
          width: 39px;
          height: 22px;
          border-radius: 13px;
        }

        .app_name_main,
        .broker_name_main {
          color: dimgray;
        }

        .checkbox-wrapper-14 label {
          all: unset;
          color: dimgray;
        }

        .checkbox-wrapper-14 {
          display: flex;
        }

        .main_broker_action_btn {
          display: flex;
          justify-content: space-between;
          align-items: center;

        }


        .delete_btn_broker i {
          font-size: 20px;
          color: dimgray;
          transition: 0.3s;

        }

        .delete_btn_broker.delete_broker:hover {

          color: rgb(199, 0, 0);

        }

        .delete_btn_broker.edit_broker:hover {

          color: rgb(0, 143, 2);

        }

        .main_broker_password h6 i {
          font-size: 0.8rem;
        }

        .broker_active_status {
          background-color: #E6F4EA;
          color: #137333;
        }

        .broker_deactive_status {
          background-color: #FCE8E6;
          color: #A50E0E;
        }

        .broker_activation_status_text_true {
          color: #137333;
        }

        .broker_activation_status_text_false {
          color: #A50E0E;
        }

        .delete_btn_broker {
          display: flex;
          gap: 0.6rem;
        }
      </style>





      <style>
        .main_broker_api_box {
          box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
          margin: 13px;
          padding: 11px;
        }
      </style>

      <!-- <script>
        $(document).ready(function () {
          // Set default selected option
          $("#all_brokers").val("zerodha");

          // Show/hide fields based on the selected broker
          $("#all_brokers").change(function () {
            var selectedBroker = $(this).val();

            // Hide all broker fields
            $("div[id$='Fields']").hide();

            // Show fields for the selected broker
            $("#" + selectedBroker + "Fields").show();
          });


          $(".save_zerodha_btn").click(function (event) {
            event.preventDefault(); // Prevent the default form submission

            // Get values based on the selected broker
            var selectedBroker = $("#all_brokers").val();
            var platform = $("#" + selectedBroker + "_platform").val();
            var loginId = $("#" + selectedBroker + "_login_id").val();
            var password = $("#" + selectedBroker + "_password").val();
            var totpKey = $("#" + selectedBroker + "_totp_key").val();
            var appName = $("#" + selectedBroker + "_app_name").val();
            var apiKey = $("#" + selectedBroker + "_api_key").val();

            // Remove undefined values
            const definedValues = [platform, loginId, password, totpKey, appName, apiKey].filter(val => val !== undefined);

            // Check if any of the remaining values is an empty string
            if (definedValues.some(val => val.trim() === '')) {
              // Display SweetAlert2 warning message
              Swal.fire({
                icon: 'warning',
                title: 'Warning',
                text: 'Please fill in all fields.',
              });
              return; // Stop execution if any field is an empty string
            }





            // Log the values
            //////console.log("Broker: " + selectedBroker);
            //////console.log("Platform: " + platform);
            //////console.log("Login ID: " + loginId);
            //////console.log("Password: " + password);
            //////console.log("TOTP Key: " + totpKey);
            //////console.log("App Name: " + appName);
            //////console.log("Api Key: " + apiKey);

            var data = {
              'broker_name': selectedBroker,
              'trading_platform': platform,
              'logging_id': loginId,
              'password': password,
              'totp_key': totpKey,
              'api_key': apiKey,
              'app_name': appName,
              // Add other fields as needed
            };
            data = Object.fromEntries(Object.entries(data).filter(([_, v]) => v !== undefined));

            //////console.log(data);


            // Display loading indicator
            $('.validating_space').text('Validating your broker API...'); // Assuming '.validating_space' is a placeholder for your loading message

            // Perform AJAX request
            $.ajax({
              url: '/add_broker_api_main',
              method: 'POST',
              contentType: 'application/json',
              data: JSON.stringify(data),
              beforeSend: function () {
                // You can also show a loader or disable certain elements during the request
                // Example: $('.loader').show();
              },
              success: function (response) {
                //////console.log('Success:', response);

                // Reset form fields
                // $("#" + selectedBroker + "_platform").val('');
                $("#" + selectedBroker + "_login_id").val('');
                $("#" + selectedBroker + "_password").val('');
                $("#" + selectedBroker + "_totp_key").val('');
                $("#" + selectedBroker + "_app_name").val('');
                $("#" + selectedBroker + "_api_key").val('');

                // Display SweetAlert2 success message
                Swal.fire({
                  icon: 'success',
                  title: 'Success',
                  text: response.message,
                });
                getAllBrokers()

                // Add more fields if needed

              },
              error: function (error) {
                //////console.log('Error:', error);

                // Display SweetAlert2 error message
                Swal.fire({
                  icon: 'error',
                  title: 'Error',
                  text: error.responseJSON.message,
                });

                // Display validation message
                $('.validating_space').text('Validation of your broker API failed.');

              },
              complete: function () {
                // This function will be called regardless of success or error
                // You can hide loaders or re-enable elements here
                // Example: $('.loader').hide();
                $('.validating_space').text('');
              }
            });



          });
          function getAllBrokers() {
            // Make an AJAX GET request to your Django view
            $.ajax({
              type: 'GET',
              url: '/add_broker_api_main',  // Replace with your actual Django view URL
              dataType: 'json',
              success: function (response) {
                // Log the response to the console
                //////console.log(response.brokers);

                // Clear the existing content in #zerodha_data_display
                $('#zerodha_data_display').empty();

                // Loop through the brokers array and display the data
                var brokers = response.brokers;
                var displayElement = $('#zerodha_data_display');

                for (var i = 0; i < brokers.length; i++) {
                  var broker = brokers[i];

                  var checkboxState = broker.active_api ? 'checked' : '';
                  var switch_text = broker.active_api ? 'Activated' : 'Inactive';
                  var delete_btn_action_con = broker.active_api ? 'd-none' : '';
                  var broker_activation_status = broker.active_api ? 'broker_active_status' : 'broker_deactive_status';
                  var broker_activation_status_text = broker.active_api ? 'broker_activation_status_text_true' : 'broker_activation_status_text_false';

                  var brokerHtml = `
                <div class="main_broker_card">

                                  <div class="top_head_broker_card">
                                    <div class="left_app_name_broker ${broker_activation_status}">

                                      <div class="app_name_main"><h6 class="${broker_activation_status}">${broker.app_name}</h6></div> <div>-</div> <div class="broker_name_main"><h6 class="${broker_activation_status}">${broker.broker_name}</h6></div>


                                    </div>
                                    <div class="right_broker_id">
                                      <h6 > ${broker.id}</h6>
                                    </div>

                                  </div>


                                  <div class="main_broker_loggin_id">
                                    <h6 >Loggin Id :  <span class="${broker_activation_status_text}">  ${broker.logging_id}</span></h6>
                                  </div>
                                  <div class="main_broker_password">
                                  <h6 >Password :  <span class="${broker_activation_status_text}">  <i class="bi bi-asterisk"></i> <i class="bi bi-asterisk"></i> <i class="bi bi-asterisk"></i> <i class="bi bi-asterisk"></i> <i class="bi bi-asterisk"></i></span></h6>
                                  </div>

                                  <div  class="main_broker_action_btn">
                                  <div class="checkbox-wrapper-14">
                                    <input id="s1-14" type="checkbox" class="switch activate_api" ${checkboxState} data-id="${broker.id}">
                                    <label for="s1-14">${switch_text}</label>
                                  </div>

                                  <div class="delete_btn_broker ${delete_btn_action_con}">
                                    <i class="bi bi-pencil-square edit_broker" data-edit_id="${broker.id}"></i>
                                    <i class="bi bi-trash-fill delete_broker" data-delete_id="${broker.id}"></i>
                                    
                                    </div>

                                  </div>

                                  </div>
                `;
                  displayElement.append(brokerHtml);
                }

                $(".delete_btn_broker .delete_broker").click(function () {
                  var brokerId = $(this).data("delete_id");

                  //////console.log(brokerId);

                  Swal.fire({
                    title: "Are you sure?",
                    text: "You won't be able to revert this!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Yes, delete it!"
                  }).then((result) => {
                    if (result.isConfirmed) {
                      // Get CSRF token from the cookie
                      var csrftoken = $("[name=csrfmiddlewaretoken]").val();

                      // Send AJAX request to delete broker
                      $.ajax({
                        url: "/delete_broker",  // Replace with your Django URL
                        method: "POST",
                        data: {
                          csrfmiddlewaretoken: csrftoken,
                          brokerId: brokerId
                        },
                        success: function (data) {
                          Swal.fire({
                            title: "Deleted!",
                            text: "Your broker has been deleted.",
                            icon: "success"
                          });
                          getAllBrokers()
                          // Optionally, you can remove the broker from the UI
                          // $(this).closest('.broker-container').remove();
                        },
                        error: function (error) {
                          //////console.log("Error deleting broker:", error);
                          Swal.fire({
                            title: "Error!",
                            text: "There was an error deleting the broker.",
                            icon: "error"
                          });
                        }
                      });
                    }
                  });
                });

               $(".edit_broker").click(function () {
    //////console.log($(this).data("edit_id"));

    // Use slideDown to show the element with a slide animation
    $("#update_api").slideDown();

    // $(".update_broker_canvas").click(function () {
    //     // Use slideUp to hide the element with a slide animation
    //     $("#update_api").slideUp();
    // });
});












                // Add event listener for checkbox change
                $('.activate_api').on('change', function () {

                  //         ('.activate_api').prop('checked', false);
                  // // Check the current checkbox
                  // $(this).prop('checked', true);


                  var brokerId = $(this).data('id');
                  var isActive = $(this).prop('checked');

                  // Make an AJAX POST request to update the active_api value
                  $.ajax({
                    type: 'POST',
                    url: '/update_active_api',
                    data: {
                      'broker_id': brokerId,
                      'is_active': isActive
                    },
                    success: function (response) {
                      //////console.log('API activation status updated successfully.');

                      getAllBrokers()
                    },
                    error: function (error) {
                      console.error('Error updating API activation status:', error);
                    }
                  });
                });

              },
              error: function (error) {
                // Log the error to the console
                console.error(error);

                // Handle the error as needed
                // For example, you can show an error message to the user
              }
            });
          }


          // Call the function to get and display brokers
          getAllBrokers();



        });
      </script> -->



    </div>
    <div class="offcanvas offcanvas-end" tabindex="-1" id="update_api" aria-labelledby="update_broker_offcanvas"
      style="z-index: 9999999999999999">
      <div class="offcanvas-header">




        <h5 class="offcanvas-title" id="update_broker_offcanvas">
          Udpate broker API details
        </h5>





        <button type="button" class="btn-close" id="update_broker_canvas" data-bs-dismiss="offcanvas"
          aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <form>
          <div class="add_broker_api_fields">
            <label for="expirydate">Select Broker</label>
            <select name="All_brokers" id="all_brokers" class="form-select mb-3">
              <option value="zerodha">Zerodha</option>
              <option value="upstocks">Upstocks</option>
              <option value="angelone">Angel One</option>
              <option value="fyers">Fyers</option>
              <option value="icicidirectbreeze">ICICI Direct Breeze</option>
            </select>
          </div>



          <div id="zerodhaFields">

            <div class="add_broker_api_fields">
              <label for="expirydate">Select Api</label>
              <select class="form-select mb-3" id="zerodha_platform" required>
                <option value="zerodha_kite">zerodha_kite</option>
                <!-- Add more options if needed -->
              </select>
            </div>

            <div class="add_broker_api_fields">
              <label for="zerodha_login_id">Login Id</label>
              <input type="text" class="form-control" id="zerodha_login_id"
                placeholder="Enter Trading Platform Login ID" required />
            </div>
            <div class="add_broker_api_fields">
              <label for="zerodha_password">Password</label>

              <input type="password" class="form-control" id="zerodha_password"
                placeholder="Enter Trading Platform Password" required />
            </div>
            <div class="add_broker_api_fields">
              <label for="zerodha_totp_key">TOTP Secret key </label>


              <input type="text" class="form-control" id="zerodha_totp_key" placeholder="Enter TOTP Key" required />
            </div>




            <div class="add_broker_api_fields">
              <label for="zerodha_app_name">App name </label>

              <input type="text" class="form-control" id="zerodha_app_name" placeholder="Enter App Name" required />
            </div>

          </div>

          <div id="angeloneFields" style="display: none;">
            <select class="form-select mb-3" id="angelone_platform" name="angelone_platform" required>
              <option value="smart_api">smart_api</option>
              <!-- Add more options if needed -->
            </select>
            <input type="text" class="form-control" id="angelone_login_id" name="angelone_login_id"
              placeholder="Enter Trading Platform Login ID" required />
            <input type="password" class="form-control" id="angelone_password" name="angelone_password"
              placeholder="Enter your MPIN" required />
            <input type="text" class="form-control" id="angelone_totp_key" name="angelone_totp_key"
              placeholder="Enter TOTP Key" required />
            <input type="text" class="form-control" id="angelone_api_key" name="angelone_api_key"
              placeholder="Enter API Key" required />
            <input type="text" class="form-control" id="angelone_app_name" name="angelone_app_name"
              placeholder="Enter App Name" required />
          </div>

          <div class="validating_space"></div>


          <!-- Add similar div blocks for other brokers -->
          <div class="action_broker_btn_save_validate d-flex gap-1">
            <!-- <button class="btn btn-success save_validate_btn">Validate</button> -->
            <button class="btn btn-primary save_zerodha_btn">Update Broker</button>
          </div>
        </form>
      </div>





    </div>


    <style>
      .main_broker_card {
        box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
        width: 19rem;
        padding: 0.5rem 1rem;
        border-radius: 10px;
      }

      .top_head_broker_card {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
      }

      .left_app_name_broker {
        display: flex;
        gap: 0.2rem;
        padding: 5px 5px 0 5px;
        border-radius: 7px;
      }

      .right_broker_id h6 {
        background: #dedede;
        padding: 2px 13px;
        font-size: 12px;
        color: darkslategray;
        border-radius: 5px;
        color: dimgray;
      }

      .main_broker_loggin_id {
        margin-top: 10px;
        color: dimgray;
      }

      .main_broker_password {
        margin-bottom: 10px;
        color: dimgray;
      }

      .activate_api {
        width: 39px;
        height: 22px;
        border-radius: 13px;
      }

      .app_name_main,
      .broker_name_main {
        color: dimgray;
      }

      .checkbox-wrapper-14 label {
        all: unset;
        color: dimgray;
      }

      .checkbox-wrapper-14 {
        display: flex;
      }

      .main_broker_action_btn {
        display: flex;
        justify-content: space-between;
        align-items: center;

      }


      .delete_btn_broker i {
        font-size: 20px;
        color: dimgray;
        transition: 0.3s;

      }

      .delete_btn_broker.delete_broker:hover {

        color: rgb(199, 0, 0);

      }

      .delete_btn_broker.edit_broker:hover {

        color: rgb(0, 143, 2);

      }

      .main_broker_password h6 i {
        font-size: 0.8rem;
      }

      .broker_active_status {
        background-color: #E6F4EA;
        color: #137333;
      }

      .broker_deactive_status {
        background-color: #FCE8E6;
        color: #A50E0E;
      }

      .broker_activation_status_text_true {
        color: #137333;
      }

      .broker_activation_status_text_false {
        color: #A50E0E;
      }

      .delete_btn_broker {
        display: flex;
        gap: 0.6rem;
      }
    </style>





    <style>
      .main_broker_api_box {
        box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
        margin: 13px;
        padding: 11px;
      }

      .main_symbol_liqiuidity {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
    </style>

    <script>
      $(document).ready(function () {
        // Set default selected option
        $("#all_brokers").val("zerodha");

        // Show/hide fields based on the selected broker
        $("#all_brokers").change(function () {
          var selectedBroker = $(this).val();
          console.log(selectedBroker);

          // Hide all broker fields
          $("div[id$='Fields']").hide();

          // Show fields for the selected broker
          $("#" + selectedBroker + "Fields").show();
        });


        $(".save_zerodha_btn").click(function (event) {
          event.preventDefault(); // Prevent the default form submission

          // Get values based on the selected broker
          var selectedBroker = $("#all_brokers").val();
          var platform = $("#" + selectedBroker + "_platform").val();
          var loginId = $("#" + selectedBroker + "_login_id").val();
          var password = $("#" + selectedBroker + "_password").val();
          var totpKey = $("#" + selectedBroker + "_totp_key").val();
          var appName = $("#" + selectedBroker + "_app_name").val();
          var apiKey = $("#" + selectedBroker + "_api_key").val();
          var apiKey = $("#" + selectedBroker + "_api_key").val();
          //upstocks_secret_key
          var secret_key = $("#" + selectedBroker + "_secret_key").val();
          // Remove undefined values

          var phone_number_val = $("#" + selectedBroker + "_phone_number").val();
          console.log(phone_number_val);
          //upstocks_phone_number
          const definedValues = [platform, loginId, password, totpKey, appName, apiKey, secret_key, phone_number_val].filter(val => val !== undefined);

          // Check if any of the remaining values is an empty string
          if (definedValues.some(val => val.trim() === '')) {
            // Display SweetAlert2 warning message
            Swal.fire({
              icon: 'warning',
              title: 'Warning',
              text: 'Please fill in all fields.',
            });
            return; // Stop execution if any field is an empty string
          }





          // Log the values
          //////console.log("Broker: " + selectedBroker);
          //////console.log("Platform: " + platform);
          //////console.log("Login ID: " + loginId);
          //////console.log("Password: " + password);
          //////console.log("TOTP Key: " + totpKey);
          //////console.log("App Name: " + appName);
          //////console.log("Api Key: " + apiKey);

          var data = {
            'broker_name': selectedBroker,
            'trading_platform': platform, //trading_platform
            'logging_id': loginId,
            'password': password,
            'totp_key': totpKey,
            'api_key': apiKey,
            'app_name': appName,
            'secret_key': secret_key,
            'phone_number_val': phone_number_val,
            // Add other fields as needed
          };
          data = Object.fromEntries(Object.entries(data).filter(([_, v]) => v !== undefined));

          console.log(data);


          // Display loading indicator
          $('.validating_space').text('Validating your broker API...'); // Assuming '.validating_space' is a placeholder for your loading message

          // Perform AJAX request
          $.ajax({
            url: '/add_broker_api_main',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            beforeSend: function () {
              // You can also show a loader or disable certain elements during the request
              // Example: $('.loader').show();
            },
            success: function (response) {
              //////console.log('Success:', response);

              // Reset form fields
              // $("#" + selectedBroker + "_platform").val('');
              $("#" + selectedBroker + "_login_id").val('');
              $("#" + selectedBroker + "_password").val('');
              $("#" + selectedBroker + "_totp_key").val('');
              $("#" + selectedBroker + "_app_name").val('');
              $("#" + selectedBroker + "_api_key").val('');

              // Display SweetAlert2 success message
              Swal.fire({
                icon: 'success',
                title: 'Success',
                text: response.message,
              });
              getAllBrokers()

              // Add more fields if needed

            },
            error: function (error) {
              //////console.log('Error:', error);

              // Display SweetAlert2 error message
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: error.responseJSON.message,
              });

              // Display validation message
              $('.validating_space').text('Validation of your broker API failed.');

            },
            complete: function () {
              // This function will be called regardless of success or error
              // You can hide loaders or re-enable elements here
              // Example: $('.loader').hide();
              $('.validating_space').text('');
            }
          });



        });
        function getAllBrokers() {
          // Make an AJAX GET request to your Django view
          $.ajax({
            type: 'GET',
            url: '/add_broker_api_main',  // Replace with your actual Django view URL
            dataType: 'json',
            success: function (response) {
              // Log the response to the console
              //////console.log(response.brokers);

              // Clear the existing content in #zerodha_data_display
              $('#zerodha_data_display').empty();

              if (response.brokers.length === 0) {
                $('#zerodha_data_display').append('<p>No APIs Available</p>');
              } else {

                var brokers = response.brokers;
                var displayElement = $('#zerodha_data_display');

                for (var i = 0; i < brokers.length; i++) {
                  var broker = brokers[i];

                  var checkboxState = broker.active_api ? 'checked' : '';
                  var switch_text = broker.active_api ? 'Activated' : 'Inactive';
                  var delete_btn_action_con = broker.active_api ? 'd-none' : '';
                  var broker_activation_status = broker.active_api ? 'broker_active_status' : 'broker_deactive_status';
                  var broker_activation_status_text = broker.active_api ? 'broker_activation_status_text_true' : 'broker_activation_status_text_false';

                  var brokerHtml = `
                <div class="main_broker_card">

                                  <div class="top_head_broker_card">
                                    <div class="left_app_name_broker ${broker_activation_status}">

                                      <div class="app_name_main"><h6 class="${broker_activation_status}">${broker.app_name}</h6></div> <div>-</div> <div class="broker_name_main"><h6 class="${broker_activation_status}">${broker.broker_name}</h6></div>


                                    </div>
                                    <div class="right_broker_id">
                                      <h6 > ${broker.id}</h6>
                                    </div>

                                  </div>


                                  <div class="main_broker_loggin_id">
                                    <h6 >Loggin Id :  <span class="${broker_activation_status_text}">  ${broker.logging_id}</span></h6>
                                  </div>
                                  <div class="main_broker_password">
                                  <h6 >Password :  <span class="${broker_activation_status_text}">  <i class="bi bi-asterisk"></i> <i class="bi bi-asterisk"></i> <i class="bi bi-asterisk"></i> <i class="bi bi-asterisk"></i> <i class="bi bi-asterisk"></i></span></h6>
                                  </div>

                                  <div  class="main_broker_action_btn">
                                  <div class="checkbox-wrapper-14">
                                    <input id="s1-${broker.id}" type="checkbox" class="switch activate_api" ${checkboxState} data-id="${broker.id}">
                                    <label for="s1-${broker.id}">${switch_text}</label>
                                  </div>

                                  <div class="delete_btn_broker ${delete_btn_action_con}">
                                    <i class="bi bi-pencil-square edit_broker" data-edit_id="${broker.id}"></i>
                                    <i class="bi bi-trash-fill delete_broker" data-delete_id="${broker.id}"></i>
                                    
                                    </div>

                                  </div>

                                  </div>
                `;
                  displayElement.append(brokerHtml);
                }             // Loop through the brokers array and display the data

              }
              $(".delete_btn_broker .delete_broker").click(function () {
                var brokerId = $(this).data("delete_id");

                //////console.log(brokerId);

                Swal.fire({
                  title: "Are you sure?",
                  text: "You won't be able to revert this!",
                  icon: "warning",
                  showCancelButton: true,
                  confirmButtonColor: "#3085d6",
                  cancelButtonColor: "#d33",
                  confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                  if (result.isConfirmed) {
                    // Get CSRF token from the cookie
                    var csrftoken = $("[name=csrfmiddlewaretoken]").val();

                    // Send AJAX request to delete broker
                    $.ajax({
                      url: "/delete_broker",  // Replace with your Django URL
                      method: "POST",
                      data: {
                        csrfmiddlewaretoken: csrftoken,
                        brokerId: brokerId
                      },
                      success: function (data) {
                        Swal.fire({
                          title: "Deleted!",
                          text: "Your broker has been deleted.",
                          icon: "success"
                        });
                        getAllBrokers()
                        // Optionally, you can remove the broker from the UI
                        // $(this).closest('.broker-container').remove();
                      },
                      error: function (error) {
                        //////console.log("Error deleting broker:", error);
                        Swal.fire({
                          title: "Error!",
                          text: "There was an error deleting the broker.",
                          icon: "error"
                        });
                      }
                    });
                  }
                });
              });

              $(".edit_broker").click(function () {

                //////console.log($(this).data("edit_id"));

                $("#update_api").collapse("show")

                $(".btn-close").click(function () {
                  $("#update_api").collapse("hide");
                });

              })











              // Add event listener for checkbox change
              $('.activate_api').on('change', function () {

                //         ('.activate_api').prop('checked', false);
                // // Check the current checkbox
                // $(this).prop('checked', true);


                var brokerId = $(this).data('id');
                var isActive = $(this).prop('checked');

                // Make an AJAX POST request to update the active_api value
                $.ajax({
                  type: 'POST',
                  url: '/update_active_api',
                  data: {
                    'broker_id': brokerId,
                    'is_active': isActive
                  },
                  success: function (response) {
                    //////console.log('API activation status updated successfully.');

                    getAllBrokers()
                  },
                  error: function (error) {
                    console.error('Error updating API activation status:', error);
                  }
                });
              });

            },
            error: function (error) {
              // Log the error to the console
              console.error(error);

              // Handle the error as needed
              // For example, you can show an error message to the user
            }
          });
        }


        // Call the function to get and display brokers
        getAllBrokers();



      });
    </script>






  </div>
  <script>
    $(document).ready(function () {
      const optionChainButton = $("#optionChain_canvas");
      const allApiButton = $("#all_api_button");
      const optionChainCollapse = $("#collapseExample");
      const allApiCollapse = $("#all_api_collapse");

      function toggleChevron($element) {
        if ($element.hasClass("bx-chevron-down")) {
          $element.removeClass("bx-chevron-down").addClass("bx-chevron-up");
        } else {
          $element.removeClass("bx-chevron-up").addClass("bx-chevron-down");
        }
      }

      optionChainButton.click(function () {
        allApiCollapse.collapse("hide");
        optionChainCollapse.collapse("toggle");
        toggleChevron(optionChainButton.find(".bx"));
      });

      allApiButton.click(function () {
        optionChainCollapse.collapse("hide");
        allApiCollapse.collapse("toggle");
        toggleChevron(allApiButton.find(".bx"));
      });



      // $("#Activate_broker_btn").click(function () {
      //   $("#active_broker_modal").slideToggle();
      // });

      function checkUserLoggedIn() {
        $.ajax({
          type: 'GET',
          url: '/check_user_logged_in', // Update the URL to the appropriate endpoint
          success: function (response) {
            // If the user is logged in, toggle the broker activation modal

            if (response.user_logged_in) {
              $("#signinModal").modal("show");
            } else {

              $("#overlay").fadeIn();
              $("#active_broker_modal").slideToggle();
            }
          },
          error: function (xhr, status, error) {
            // Handle the error, for example, display an error message
            console.error("Error:", error);
            alert("Error checking user login status.");
          }
        });
      }

      $("#Activate_broker_btn").click(function (e) {
        e.stopPropagation(); // Prevent the click event from propagating to the document
        checkUserLoggedIn(); // Call the function to check if the user is logged in
      });

      // Close the modal when a click occurs anywhere outside of the modal
      $(document).on("click", function (e) {
        if (!$("#active_broker_modal").is(e.target) && $("#active_broker_modal").has(e.target).length === 0) {
          $("#active_broker_modal").slideUp();
          $("#overlay").fadeOut();
        }
      });





    });



  </script>

  <style>
    #reset_icon {
      all: unset !important;
    }

    .reset_button,
    .setTarget,
    .adjust {
      display: flex !important;
      align-items: center !important;
      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
      padding: 0px 7px;
      text-align: center;
      height: 29px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all 0.2s ease-in-out !important;
      -moz-transition: all 0.2s ease-in-out !important;
      transition: all 0.2s ease-in-out !important;
      cursor: pointer;

      font-weight: 600;
    }

    .reset_button:hover,
    .setTarget:hover,
    .adjust:hover {
      background: #fff !important;
      color: #4399eb !important;
    }

    .main_short_long_lot_size {
      display: flex;
    }

    .edit-button,
    .edit_strategy,
    .delete_strategy,
    .delete-button {
      color: #767f88;
      transition: 0.3s;
    }

    .right_strategy_action {

      display: flex;
      gap: 0.6rem;
    }

    .edit-button:hover,
    .edit_strategy:hover {
      color: #4399eb !important;
    }

    .delete-button:hover,
    .delete_strategy:hover {
      color: #c70000 !important;
    }

    .action_option_strategy {
      font-size: 19px !important;
      gap: 0.5rem !important;
    }

    .main_position {
      margin-top: 0.5rem;
      display: none;
    }

    .inner_greek_p_l {
      background-color: #f1f5fa;
      margin-bottom: 0.5rem;
    }

    .main_all_profit_loss {
      display: flex;
      flex-direction: column;
      row-gap: 0.8rem;
    }

    .exit_price {
      font-size: 11px;
      font-weight: 700;
    }

    .strike_symbols_per_main_order {
      font-size: 12px;
    }

    /* .strategy_inputs.mb-3:not(:first-child) {
      margin-left: 22px;
    } */
    /* .strategy_inputs.mb-3:not(:first-of-type){ margin-left: 22px; 
    } */

    /* .strategy_inputs.mb-3:not(.strategy_inputs.mb-3 ~ .strategy_inputs.mb-3){
      margin-left: 22px;
    } */


    .strategy_inputs.mb-3:not(:first-of-type) {
      margin-left: 22px;
    }
  </style>

  <div class="All_option_startegies_builder">
    <div class="pre_built_simu">
      <p style="margin-bottom: auto">Pre Built :</p>
      <div class="strategy_simu">
        <div class="main_straddle">
          <p class="straddle" id="straddle">STRADDLE</p>

          <div class="" id="straddle_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_straddle">
                    <h5 class="text-center">Straddle</h5>

                    <div class="main_body_fields_straddle">
                      <div class="main_strikePrice mb-3">
                        <div class="strategy_inputs">
                          <label for="strikePrice">Strike Price</label>
                          <select class="strike_price_input form-select" id="strikeSelect_straddle"></select>
                        </div>
                        <p class="pe_ce">PE / CE</p>
                      </div>
                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_straddle"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="innerStraddle_lot_size">
                          <p class="fs-6 lot_title">Qty:</p>
                          <div class="counter_straddle d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input" min="1" disabled />
                            <button class="btn" id="increment">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>
                        </div>
                        <button class="" id="shortStraddle">SELL</button>
                      </div>
                    </div>
                  </div>

                  <div class="buy_sell_buttons d-flex gap-2 justify-content-center"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="main-stranggle">
          <p class="straddle" id="strangle">STRANGLE</p>
          <div class="" id="strangle_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_strangle">
                    <h5 class="text-center">Strangle</h5>

                    <div class="main_body_fields_strangle">
                      <div class="main_strikePrice mb-3">
                        <div class="strangle_lot_size">
                          <span id="put_stangle_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_strangle"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="strangle_lot_size">
                          <span id="call_stangle_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_strangle"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_strangle"></select>
                      </div>

                      <div class="main_counter d-flex gap-2 mb-3">
                        <div class="innerStraddle_lot_size d-flex gap-2">
                          <p class="fs-5 lot_title">Qty:</p>
                          <div class="counter_strangle d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_strangle">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_strangle" min="1" disabled />
                            <button class="btn" id="increment_strangle">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>
                        </div>
                        <button class="" id="shortStrangle">SELL</button>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                                  

                                </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="main-spread">
          <p class="straddle" id="spread">SPREAD</p>
          <div class="" id="spread_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_spread">
                    <h5 class="text-center">Spread</h5>

                    <div class="main_body_fields_spread">
                      <div class="main_strikePrice mb-3">
                        <div class="spread_lot_size">
                          <span id="put_spread_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_spread"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="spread_lot_size">
                          <span id="call_spread_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_spread"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_spread"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_spread_lot_size d-flex gap-2">
                          <p class="fs-5 lot_title">Qty:</p>
                          <div class="counter_spread d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_spread">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_spread" min="1" disabled />
                            <button class="btn" id="increment_spread">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>
                        </div>
                        <button class="" id="shortSpread">SELL</button>
                      </div>
                    </div>
                  </div>

                  <div class="buy_sell_buttons d-flex gap-2 justify-content-center"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="main-ironfly">
          <p class="straddle" id="iron_fly">IRON FLY</p>
          <div class="" id="ironFly_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_ironFly">
                    <h5 class="text-center">Iron Fly</h5>

                    <div class="main_body_fields_ironFly">
                      <div class="main_strikePrice mb-3">
                        <div class="ironFly_lot_size">
                          <span id="put_ironFly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_ironFly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>
                      <div class="main_strikePrice mb-3" id="put_call_select">
                        <div class="ironFly_lot_size">
                          <span id="put_call_ironFly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select" id="put_call_strikeSelect_ironFly"></select>
                        </div>
                        <p class="pe_ce">PE/CE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="ironFly_lot_size">
                          <span id="call_ironFly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_ironFly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_ironFly"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Qty:</p>
                          <div class="counter_ironFly d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_ironFly">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_ironFly" min="1" disabled />
                            <button class="btn" id="increment_ironFly">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortironFly">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                          

                            </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>


        <style>
          @media (min-width: 992px) {
            .col-lg-4 {
              flex: 0 0 auto !important;
              width: 31.333333% !important;
            }

            .col-lg-7 {
              flex: 0 0 auto !important;
              width: 67.333333% !important;
            }
          }

          .payoff_table_main_table thead {
            position: sticky;
            top: 0px;
          }
        </style>

        <div class="main-ironCondor">
          <p class="straddle" id="iron_condor">IRON CONDOR</p>
          <div class="" id="ironCondor_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_ironCondor">
                    <h5 class="text-center">Iron Condor</h5>

                    <div class="main_body_fields_ironCondor">
                      <div class="main_strikePrice mb-3">
                        <div class="ironCondor_lot_size">
                          <span id="put_ironCondor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_ironCondor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>
                      <div class="main_strikePrice mb-3">
                        <div class="ironCondor_lot_size">
                          <span id="put_2nd_ironCondor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select" id="put_2nd_strikeSelect_ironCondor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>
                      <div class="main_strikePrice mb-3">
                        <div class="ironCondor_lot_size">
                          <span id="call_2nd_ironCondor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_2nd_strikeSelect_ironCondor"></select>
                        </div>
                        <p class="pe_middla">CE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="ironCondor_lot_size">
                          <span id="call_ironCondor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_ironCondor"></select>
                        </div>
                        <p class="pe_middle">CE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_ironCondor"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Qty:</p>
                          <div class="counter_ironCondor d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_ironCondor">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_ironCondor" min="1" disabled />
                            <button class="btn" id="increment_ironCondor">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="short_ironCondor">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="main-jaze_lizard">
          <p class="straddle" id="jaze_lizard">JAZE LIZARD</p>
          <div class="" id="jaze_lizard_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_jaze_lizard">
                    <h5 class="text-center">Jaze Lizard</h5>

                    <div class="main_body_fields_jaze_lizard">
                      <div class="main_strikePrice mb-3">
                        <div class="jaze_lizard_lot_size">
                          <span id="call_jaze_lizard_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_jaze_lizard"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>
                      <div class="main_strikePrice mb-3">
                        <div class="jaze_lizard_lot_size">
                          <span id="call_2nd_jaze_lizard_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_2nd_strikeSelect_jaze_lizard"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="jaze_lizard_lot_size">
                          <span id="put_jaze_lizard_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_jaze_lizard"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_jaze_lizard"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Qty:</p>
                          <div class="counter_jaze_lizard d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_jaze_lizard">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_jaze_lizard" min="1" disabled />
                            <button class="btn" id="increment_jaze_lizard">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortjaze_lizard">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="main-double-iron-fly">
          <p class="straddle" id="double_iron_fly">DOUBLE IRON FLY</p>



          <div class="" id="double_iron_fly_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_double_iron_fly">
                    <h5 class="text-center">Double Fly</h5>

                    <div class="main_body_fields_double_iron_fly">


                      <!-- first_position_double_fly -->







                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="put_strike_eight_hundred_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_strike_eight_hundred_Select_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- second_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="call_2nd_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_put_four_hundred_Select_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">PE/CE</p>
                      </div>


                      <!-- third_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="call_spot_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_spot_strikeSelect_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <!-- four_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="put_positive_four_hundred_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_positive_four_hundred_strikeSelect_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- five_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="call_put_positive_eight_hundred_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_put_positive_eight_hundred_strikeSelect_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>
                      <!-- six_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="call_twelve_hundred_positive_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_twelve_hundred_positive_strikeSelect_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>












                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_double_iron_fly"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Qty:</p>
                          <div class="counter_double_iron_fly d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_double_iron_fly">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_double_iron_fly" min="1" disabled />
                            <button class="btn" id="increment_double_iron_fly">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortdouble_iron_fly">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>





        </div>
        <div class="main-double-candor">
          <p class="straddle" id="double_iron_condor">DOUBLE CONDOR</p>

          <div class="" id="double_iron_condor_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_double_iron_condor">
                    <h5 class="text-center">Double Condor</h5>

                    <div class="main_body_fields_double_iron_condor">


                      <!-- first_position_double_condor -->


                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="put_spot_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="spot_Select_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- second_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="put_negative_fifty_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_negative_fifty_Select_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>


                      <!-- third_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="put_negative_two_hundred_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_negative_two_hundred_Select_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- four_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="negative_three_hundred_fifty_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="negative_three_hundred_fifty_Select_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- five_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="call_positive_three_hundred_fifty_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_positive_three_hundred_fifty_strikeSelect_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>



                      <!-- six_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="call_positive_five_hundred_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_positive_five_hundred_strikeSelect_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>



                      <!-- seven_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="call_positive_six_hundred_fifty_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_positive_six_hundred_fifty_strikeSelect_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <!-- eight_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="call_positive_eight_hundred_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_positive_eight_hundred_strikeSelect_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>












                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_double_iron_condor"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Qty:</p>
                          <div class="counter_double_iron_condor d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_double_iron_condor">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_double_iron_condor" min="1" disabled />
                            <button class="btn" id="increment_double_iron_condor">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortdouble_iron_condor">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>


        </div>

        <div class="main-put-butterfly">
          <p class="straddle" id="put_butter_fly">BEAR BUTTERFLY</p>

          <div class="" id="put_butterfly_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_put_butterfly">
                    <h5 class="text-center">Bear Butterfly</h5>

                    <div class="main_body_fields_put_butterfly">


                      <!-- first_position_put_butterfly -->
                      <div class="main_strikePrice mb-3">
                        <div class="put_butterfly_lot_size">
                          <span id="put_negative_nine_hundred_fifty_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_negative_nine_hundred_fifty_Select_put_butterfly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>




                      <!-- second_position_put_butterfly -->



                      <div class="main_strikePrice mb-3">
                        <div class="put_butterfly_lot_size">
                          <span id="five_hundred_put_call_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="five_hundred_put_call_Select_put_butterfly"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>


                      <!-- third_position_put_butterfly -->

                      <div class="main_strikePrice mb-3">
                        <div class="put_butterfly_lot_size">
                          <span id="put_negative_fifty_put_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_negative_fifty_Select_put_butterfly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>









                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_put_butterfly"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Qty:</p>
                          <div class="counter_put_butterfly d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_put_butterfly">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_put_butterfly" min="1" disabled />
                            <button class="btn" id="increment_put_butterfly">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortput_butterfly">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>




        </div>

        <div class="main-call-butterfly">
          <p class="straddle" id="call_butter_fly">BULL BUTTERFLY</p>


          <div class="" id="call_butter_fly_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up-call_butterfly"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_call_butter_fly">
                    <h5 class="text-center">Bull Butterfly</h5>

                    <div class="main_body_fields_call_butter_fly">


                      <!-- first_position_call_butter_fly -->
                      <div class="main_strikePrice mb-3">
                        <div class="call_butter_fly_lot_size">
                          <span id="put_positive_fifty_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_positive_fifty_Select_call_butter_fly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>




                      <!-- second_position_call_butter_fly -->



                      <div class="main_strikePrice mb-3">
                        <div class="call_butter_fly_lot_size">
                          <span id="four_hundred_put_call_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="four_hundred_put_call_Select_call_butter_fly"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>


                      <!-- third_position_call_butter_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="call_butter_fly_lot_size">
                          <span id="positive_seven_hundred_fifty_call_butter_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="positive_seven_hundred_fifty_Select_call_butter_fly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>









                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_call_butter_fly"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Qty:</p>
                          <div class="counter_call_butter_fly d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_call_butter_fly">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_call_butter_fly" min="1" disabled />
                            <button class="btn" id="increment_call_butter_fly">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortcall_butter_fly">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>



        </div>

        <div class="custom-strategy" style="position: relative;">
          <p class="straddle" id="custom_strategy">CUSTOM STRATEGY</p>

          <div class="dropdown-menu" id="custom_strategy_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up-custom_strategy"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_custom_strategy">
                    <h5 class="text-center mb-3">Nifty custom Strategy</h5>

                    <div class="main_body_fields_custom_strategy">


                      <!-- first_position_custom_strategy -->
                      <div class="main_strikePrice mb-3">
                        <div class="custom_strategy_lot_size">
                          <span id="call_two_hundered_buy_custom_strategy_lot_size"></span>5<span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_two_hundered_buy_Select_custom_strategy"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>
                      <!-- second_position_custom_strategy -->
                      <div class="main_strikePrice mb-3">
                        <div class="custom_strategy_lot_size">
                          <span id="call_negative_two_hundred_buy_custom_strategy_lot_size"></span>5<span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_negative_two_hundred_buy_Select_custom_strategy"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>
                      <!-- third_position_custom_strategy -->
                      <div class="main_strikePrice mb-3">
                        <div class="custom_strategy_lot_size">
                          <span id="put_call_negative_one_hundred_sell_custom_strategy_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_call_negative_one_hundred_sell_Select_custom_strategy"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="custom_strategy_lot_size">
                          <span id="put_call_negative_fifty_hundred_sell_custom_strategy_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_call_negative_fifty_hundred_sell_Select_custom_strategy"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="custom_strategy_lot_size">
                          <span id="put_call_spot_sell_custom_strategy_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_call_spot_sell_Select_custom_strategy"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="custom_strategy_lot_size">
                          <span id="put_call_positive_fifty_sell_custom_strategy_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_call_positive_fifty_sell_Select_custom_strategy"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="custom_strategy_lot_size">
                          <span id="put_call_positive_one_hundred_sell_custom_strategy_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_call_positive_one_hundred_Select_custom_strategy"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>









                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_custom_strategy"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <!-- <p class="fs-5 lot_title">Qty:</p> -->
                          <!-- <div class="counter_custom_strategy d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_custom_strategy">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_custom_strategy" min="1" disabled />
                            <button class="btn" id="increment_custom_strategy">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div> -->

                          <button class="" id="shortcustom_strategy">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>

        </div>


      </div>
    </div>
  </div>
  <style>
    .strategy_notes,
    .exit_all_positions_zerodha {
      display: flex !important;
      align-items: center !important;
      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
      padding: 0px 7px;
      text-align: center;
      font-size: 13px;
      height: 29px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all .2s ease-in-out !important;
      -moz-transition: all .2s ease-in-out !important;
      transition: all .2s ease-in-out !important;
      cursor: pointer;

      font-weight: 600;
    }

    #buid_custom_strategy_btn {
      display: flex !important;
      align-items: center !important;
      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
      padding: 0px 52px;
      text-align: center;
      font-size: 14px;
      height: 37px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all .2s ease-in-out !important;
      -moz-transition: all .2s ease-in-out !important;
      transition: all .2s ease-in-out !important;
      cursor: pointer;

      font-weight: 600;
    }

    .deploy_btn,
    .reset_button {

      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
      padding: 0px 27px;
      text-align: center;
      font-size: 13px;
      height: 34px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all .2s ease-in-out !important;
      -moz-transition: all .2s ease-in-out !important;
      transition: all .2s ease-in-out !important;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;

    }

    .save_strategy {
      background: #fff;
      color: #4399eb;
      padding: 0px 27px;
      text-align: center;
      font-size: 13px;
      height: 34px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all .2s ease-in-out !important;
      -moz-transition: all .2s ease-in-out !important;
      transition: all .2s ease-in-out !important;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;
    }

    .check_liquidity {
      background: #fff;
      color: #4399eb;
      /* padding: 0px 57px; */
      text-align: center;
      font-size: 13px;
      height: 34px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all .2s ease-in-out !important;
      -moz-transition: all .2s ease-in-out !important;
      transition: all .2s ease-in-out !important;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;
    }

    .place_order_btn {

      /* padding: 0px 57px; */

      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
      text-align: center;
      font-size: 13px;
      height: 34px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all .2s ease-in-out !important;
      -moz-transition: all .2s ease-in-out !important;
      transition: all .2s ease-in-out !important;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;
    }

    .place_order_btn:hover {
      background: #fff;
      color: #4399eb;
    }

    .save_strategy:hover,
    .check_liquidity:hover {
      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
    }

    .strategy_notes:hover,
    .exit_all_positions_zerodha:hover,
    #buid_custom_strategy_btn:hover {
      background: #fff !important;
      color: #4399eb !important;
    }

    .main_bottom_strategy_positions {
      display: flex;
      gap: 1rem;
      margin-top: 6rem;
    }

    .strategy_position_reset {
      white-space: nowrap;
      column-gap: 0.2rem;

    }

    .left_main_strategy_position {
      display: flex;
      flex-direction: column;
      /* justify-content: space-between; */
    }

    .main_build_custom_strategy_empty {
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
      margin-top: 6rem;
    }

    /* Dynamically set background color based on the values */
    .dynamic-width-bg.calls-oi {
      background-color: #CFEFDF;
      /* You can adjust the color as needed */
      border-radius: 10px 0 0 10px;
      text-align: justify;
      height: 20px;
      position: absolute;
      color: #0000009e;
    }

    .dynamic-width-bg.puts-oi {
      background-color: #FFE2E3;
      /* You can adjust the color as needed */
      border-radius: 0 10px 10px 0;
      text-align: justify;
      height: 20px;
      color: #0000009e;
    }

    .main_calls_oi_option {
      display: flex;
      justify-content: flex-end;
      color: #0000009e;
      position: relative;
    }
  </style>
  <style>
    .toastr-custom {
      z-index: 99999999999999999;
    }

    #toast-container {
      z-index: 999999999999999999 !important;
    }
  </style>
  <script>

  </script>

  <div class="main_option_p_l_greeks_charts">
    <div class="inner_p_l_greeks row">
      <div class="left_main_strategy_position col-md-4 col-lg-4 col-sm-12">

        <div class="main_top_startegy_positions">
          <div class="strategy_position_reset d-flex justify-content-between">
            <p class="fw-bold">Strategy Positions</p>


            <style>
              .main_right_reset_note_btn {
                display: flex;
                align-items: center;
                gap: 0.1rem;

              }
            </style>
            <div class="main_right_reset_note_btn">

              <button data-bs-toggle="modal" data-bs-target="#notesModal" class="strategy_notes">Notes</button>
              <i class="bi bi-arrow-clockwise" id="option_strategy_reset"></i>
            </div>


            <!-- Button trigger modal -->
            <style>
              .user_details {
                display: flex;
                gap: 0.6rem;
                align-items: center;
              }

              .zerodha_icon,
              .broker_position_icon {
                width: 40px;

              }

              .names_user_details h5,
              .position_names_user_details h5 {
                font-size: 15px;
                font-weight: 700 !important;
                margin-bottom: auto !important;
              }

              .names_user_details p,
              .position_names_user_details p {
                font-size: 11px;
              }

              .strike_symbols_per_main_order {
                gap: 0.2rem;
                display: flex;
                align-items: center;
              }

              .symbol_name_order p {
                color: #454242;
                font-weight: 100 !important;
              }

              .change_per_order p {
                font-size: 12px;
              }

              .main_header_order {
                display: flex;
                gap: 1rem;
                align-items: center;
              }

              .main_right_order_header {
                display: flex;

                align-items: center;
                gap: 0.8rem;
              }

              .main_limit_select,
              .main_mis_select,
              .main_updates_price_btn {
                display: flex;
                align-items: center;
                gap: 0.3rem;
              }

              .margin_footer {
                display: flex;
                gap: 1rem;
              }

              .margin_needed {
                width: 134px !important;
              }

              .order_place_input {
                width: 134px !important;
              }

              @media (min-width: 992px) {

                .modal-lg {
                  --bs-modal-width: 806px !important;
                }
              }


              .left_positions_reset_notes button,

              .updateStrategy,
              .saveStrategy {
                display: flex !important;
                align-items: center !important;
                background: linear-gradient(180deg, #4399eb, #5cadfb);
                color: #fff;
                padding: 0px 7px;
                text-align: center;
                height: 29px;
                font-weight: 500;
                border-radius: 4px;
                border: 1px solid #4399eb !important;
                -webkit-box-shadow: none !important;
                box-shadow: none !important;
                outline: 0 !important;
                -webkit-transition: all .2s ease-in-out !important;
                -moz-transition: all .2s ease-in-out !important;
                transition: all .2s ease-in-out !important;
                cursor: pointer;

                font-weight: 600;
              }

              .saveNotes,
              .editNotes:hover {
                display: flex !important;
                align-items: center !important;
                background: linear-gradient(180deg, #4399eb, #5cadfb);
                color: #fff;
                padding: 0px 30px;
                text-align: center;
                height: 34px;
                font-weight: 500;
                border-radius: 4px;
                border: 1px solid #4399eb !important;
                -webkit-box-shadow: none !important;
                box-shadow: none !important;
                outline: 0 !important;
                -webkit-transition: all .2s ease-in-out !important;
                -moz-transition: all .2s ease-in-out !important;
                transition: all .2s ease-in-out !important;
                cursor: pointer;

                font-weight: 600;
              }

              .editNotes {
                display: flex !important;
                align-items: center !important;
                background: white;
                color: #4399eb;
                padding: 0px 30px;
                text-align: center;
                height: 34px;
                font-weight: 500;
                border-radius: 4px;
                border: 1px solid #4399eb !important;
                -webkit-box-shadow: none !important;
                box-shadow: none !important;
                outline: 0 !important;
                -webkit-transition: all .2s ease-in-out !important;
                -moz-transition: all .2s ease-in-out !important;
                transition: all .2s ease-in-out !important;
                cursor: pointer;

                font-weight: 600;
              }

              .deploy_btn:hover,
              .reset_button:hover,
              .left_positions_reset_notes button:hover,
              .saveNotes:hover,

              .updateStrategy:hover,
              .saveStrategy:hover {
                background: #fff !important;
                color: #4399eb !important;
              }

              .main_filter_greek_P_L {
                overflow: auto;
                white-space: nowrap;

              }

              .main-call-butterfly {
                position: relative;
              }

              .table_pl_greek {
                padding: 0 0.5rem 0.5rem 0.5rem;
              }

              .maximize {
                font-size: 19px !important;
                display: flex;
                justify-content: flex-end;
                cursor: pointer;
              }

              .broker_icon {

                width: 35px;
                height: 23px;
              }
            </style>

            <!-- Modal -->
            <div class="modal fade" id="execute" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"
              style="z-index: 99999999999999 !important">
              <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <div class="user_details">
                      <div class="broker_icon">

                      </div>
                      <div class="names_user_details">
                        <h5></h5>
                        <p></p>
                      </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="main_header_order">
                      <div class="main_left_order_header">
                        <div class="strike_symbols_per_main_order">
                          <div class="symbol_name_order">
                            <p></p>
                          </div>
                          <div class="strike_price_order">
                            <p></p>
                          </div>
                          <div class="change_per_order">
                            <p></p>
                          </div>
                        </div>
                      </div>
                      <div class="main_right_order_header">
                        <div class="main_mis_select d-flex gap-1">
                          <select name="mis_select" id="mis_select" class="form-select mis_select">
                            <option value="overnight">Overnight</option>
                            <option value="intraday">Intraday</option>
                          </select>
                          <i class="bx bx-info-circle"></i>
                        </div>
                        <div class="main_limit_select">
                          <select name="limit_select" id="limit_select" class="form-select limit_select">
                            <option value="market">Market</option>
                            <option value="limit">Limit</option>
                          </select>
                          <i class="bx bx-info-circle"></i>
                        </div>
                        <div class="main_updates_price_btn">
                          <button class="btn btn-outline-primary">
                            <i class="bx bx-sync"></i>Updates Price
                          </button>
                          <i class="bx bx-info-circle"></i>
                        </div>
                        <style>
                          .settings_modal {
                            display: flex;
                            gap: 0.5rem;
                            justify-content: center;
                          }
                        </style>
                        <div class="main_settings_order dropdown">
                          <button class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <i class="bx bx-cog"></i>Settings
                          </button>
                          <div class="dropdown-menu" style="width: 200px !important">
                            <div class="form-check settings_modal">
                              <input class="form-check-input" type="checkbox" id="in_depth_check_box" checked />
                              <label class="form-check-label" for="in_depth_check_box">
                                Show Depth & Info
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="order_modal"></div>

                    <div class="main_extented_status_liquidity">

                      <p>Note : Please check the liquidity of all trades !!</p>

                    </div>
                  </div>
                  <div class="modal-footer justify-content-between align-items-end">
                    <div class="margin_footer">
                      <div class="form-group order_place_input">
                        <label for="expiryEdit">Margin Needed</label>
                        <input type="number" value="4.1" class="margin_needed form-control" disabled />
                      </div>
                      <div class="form-group order_place_input">
                        <label for="expiryEdit">Margin Available</label>
                        <input type="number" value="4.1" class="margin_available form-control" disabled />
                      </div>
                    </div>
                    <div class="right_place_order_check_liquidity">
                      <div class="maket_status">


                      </div>
                      <div class="main_place_order_check_liquidity">
                        <button type="button" class="check_liquidity">Check Liquidity</button>
                        <button type="button" class="place_order_btn" disabled>
                          Place All Order
                        </button>
                      </div>

                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="modal fade" id="save_startegyModal" tabindex="-1" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Update Strategy</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3">

                      <input type="text" class="form-control" id="strategy_input" placeholder="Enter strategy name">
                    </div>
                    <div class="mb-3">

                      <textarea class="form-control" placeholder="Write your strategy notes.." id="main_strategy_notes"
                        style="height: 100px"></textarea>

                    </div>
                  </div>
                  <div class="modal-footer">


                    <button type="button" class="saveStrategy">Save</button>
                  </div>
                </div>
              </div>
            </div>


            <script
              src="https://cdn.tiny.cloud/1/had8mtrpwst057oc5crzs0knwynnfccbsch7mi1hpi9hbri2/tinymce/5/tinymce.min.js"
              referrerpolicy="origin"></script>


            <div class="modal fade" id="notesModal" tabindex="-1" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Strategy Notes</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3">
                      <textarea class="form-control" id="editInput" contenteditable="true"
                        placeholder="Write your note here..." style="min-height: 150px;"></textarea>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="editNotes">Edit</button>
                    <button type="button" class="saveNotes">Save</button>
                  </div>
                </div>
              </div>
            </div>

            <script>
              $(document).ready(function () {
                tinymce.init({
                  selector: "#editInput",
                  height: 300,
                  plugins: "link image code",
                  plugins: [
                    'advlist', 'autolink', 'link', 'image', 'lists', 'charmap', 'preview', 'anchor', 'pagebreak',
                    'searchreplace', 'wordcount', 'visualblocks', 'code', 'fullscreen', 'insertdatetime', 'media',
                    'table', 'emoticons', 'template', 'help'
                  ],
                  toolbar: "undo redo  h2 h3 bold italic underline  blockquote bullist numlist  hr",
                  menubar: false,
                  statusbar: false,
                });


                // Hide the status bar using jQuery
                $(".tox-statusbar").hide();
              });

              $(document).ready(function () {
                let isEditing = false;

                $(".editNotes").on("click", function () {
                  isEditing = !isEditing;
                  tinymce.activeEditor.setMode(isEditing ? "design" : "readonly");
                });
              });
            </script>




















            <div class="modal fade edit_Strategy_modal" id="editStrategyModal" tabindex="-1"
              aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Update Strategy</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <input type="text" class="form-control" id="updateStrategyname">
                  </div>
                  <div class="modal-footer">

                    <button type="button" class="updateStrategy" id="updateStrategy_btn">Update
                      Strategy</button>
                  </div>
                </div>
              </div>
            </div>

            <script>
              $(document).ready(function () {



                $(".saveStrategy").click(function () {
                  var tradingPositions = [];

                  $(".inner_position").each(function (index) {
                    // Get values from the current card
                    var card = $(this);
                    var symbol = card.find(".symbol").text();
                    var expiry = card.find(".expiry").text();
                    var expiry_initial = card.find(".expiry_initial").text();
                    var strikePrice = card.find(".strikePrice").text();
                    var callPutEntrance = card.find(".call_put_entrance").text();
                    var entryPrice = card.find(".entryPrice").text();
                    var long_short_inner = card.find(".long_short_inner").text();
                    var option_lot_size_input = card.find(".option_lot_size_input").text();

                    // Create an object with the gathered values
                    var position = {
                      symbol: symbol,
                      expiry: expiry,
                      expiry_initial: expiry_initial,
                      strikePrice: strikePrice,
                      callPutEntrance: callPutEntrance,
                      entryPrice: entryPrice,
                      long_short_inner: long_short_inner,
                      option_lot_size_input: option_lot_size_input
                    };

                    // Push the object into the array
                    tradingPositions.push(position);
                  });

                  //////console.log(tradingPositions);




                  var strategy_input = $("#strategy_input").val();
                  var main_strategy_notes = $("#main_strategy_notes").val();

                  if (strategy_input.trim() === '') {
                    toastr.error("Please enter the strategy name");
                    return; // Stop further execution
                  }



                  $.ajax({
                    type: "POST",
                    url: "/save_strategy",
                    data: {

                      'strategy_input': strategy_input,
                      'main_strategy_notes': main_strategy_notes,
                      'trading_positions': JSON.stringify(tradingPositions),  // Convert array to JSON string

                      'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                      // handle success

                      if (response.user_not_logged_in) {
                        $("#signinModal").modal("show");
                      } else {
                        // alert(response.message);
                        $("#save_startegyModal").modal("hide")
                        toastr.success(response.message);
                        getStrategies_data()
                        $("#strategy_input").val('')
                        $("#main_strategy_notes").val('');
                      }


                    },
                    error: function (response) {
                      // handle error
                      alert(response.message);
                    }
                  });

                })


                $("#saveStrategies").click(function () {

                  getStrategies_data()
                })
                function getStrategies_data() {
                  $.ajax({
                    type: "GET",
                    url: "/get_all_strategies",
                    success: function (response) {
                      if (response.user_not_logged_in) {
                        // //////console.log("not logged");
                        $("#signinModal").modal("show");
                      } else {
                        // handle success
                        $("#saved_startegyModal").modal("show");
                        var strategyData = response.strategy_data;
                        $(".all_strategies").empty()
                        // Do something with the strategy data

                        if (strategyData.length === 0) {
                          $(".all_strategies").append(`
                                              <div class="d-flex  justify-content-center p-2"> <p>No Strategies Found...</p></div>
                                              `);
                        } else {
                          strategyData.forEach((strategy) => {

                            var tradingPositions = `
                                                      <div class="savedStrategies d-flex justify-content-between">
                                                          <div class="left_strategy_name">
                                                              ${strategy.strategy_name}
                                                          </div>
                                                          <div class="right_strategy_action">
                                                              <i class='bi bi-pencil-square fs-5 cursor-pointer edit_strategy'  data-bs-toggle="modal" data-bs-target="#editStrategyModal" data-edit="${strategy.id}"></i>
                                                              <i class='bi bi-trash-fill fs-5 cursor-pointer delete_strategy' data-delete="${strategy.id}"></i>
                                                          </div>
                                                      </div>
                                                  `;
                            $(".all_strategies").append(tradingPositions);
                          });
                        }



                        // //////console.log(strategyData);

                        $(".delete_strategy").click(function () {
                          var strategyId = $(this).data('delete');
                          // //////console.log(strategyId);

                          if (confirm("Are you sure you want to delete this strategy?")) {
                            // Perform delete operation with strategyId
                            $.ajax({
                              type: "POST",
                              url: "/delete_strategy",
                              data: {
                                'strategy_id': strategyId,
                                'csrfmiddlewaretoken': '{{ csrf_token }}'
                              }
                            })
                              .done(function (response) {
                                // handle success
                                // //////console.log(response.message);
                                getStrategies_data();
                                // Refresh the strategies list or remove the deleted strategy from the DOM
                              })
                              .fail(function (xhr, status, error) {
                                // handle error
                                console.error('Error deleting strategy:', error);
                              });
                          }
                        });

                        // Open the modal on clicking the edit icon
                        $(".edit_strategy").click(function () {
                          var strategyId = $(this).data('edit');
                          // //////console.log(strategyId);

                          $.ajax({
                            type: "POST",
                            url: "/get_unique_strategy",
                            data: {
                              'strategy_id': strategyId,

                            },
                            success: function (response) {
                              // handle success
                              // //////console.log(response.strategy_data);

                              $("#updateStrategyname").val(response.strategy_data.strategy_name).attr('data-id-update', strategyId);

                            },
                            error: function (response) {
                              // handle error
                              // //////console.log('Error updating strategy:', response);
                            }
                          });

                        });



                        // Update the strategy on clicking the update button
                        $("#updateStrategy_btn").click(function () {
                          var updatedStrategyName = $("#updateStrategyname").val();
                          var strategyId = $("#updateStrategyname").attr('data-id-update');

                          // Send AJAX request to update the strategy name
                          $.ajax({
                            type: "POST",
                            url: "/update_strategy",
                            data: {
                              'strategy_id': strategyId,
                              'updated_strategy_name': updatedStrategyName,
                              'csrfmiddlewaretoken': '{{ csrf_token }}'
                            },
                            success: function (response) {
                              // handle success
                              $("#editStrategyModal").modal("hide")
                              // //////console.log(response.message);
                              getStrategies_data(); // Refresh the strategies list

                            },
                            error: function (response) {
                              // handle error
                              //////console.log('Error updating strategy:', response);
                            }
                          });
                        });


                      }






                    },
                    error: function (response) {
                      // handle error
                      //////console.log('Error fetching strategies:', response);
                    }
                  });

                }







                toastr.options = {
                  "closeButton": true,
                  "debug": true,
                  "newestOnTop": true,
                  "progressBar": true,
                  "positionClass": "toast-bottom-right",
                  "preventDuplicates": true,
                  "showDuration": "300",
                  "hideDuration": "1000",
                  "timeOut": "5000",
                  "extendedTimeOut": "1000",
                  "showEasing": "swing",
                  "hideEasing": "linear",
                  "showMethod": "fadeIn",
                  "hideMethod": "fadeOut",
                  "toastClass": "toastr-custom", // Add a custom class
                };

                // Additional style for the custom class

                $(".saveNotes").click(function () {
                  var noteText = tinymce.activeEditor.getContent({ format: 'text' });

                  // alert(noteText)
                  $.ajax({
                    type: "POST",
                    url: "/save_note",
                    data: {
                      'id': 1,
                      'text': noteText,
                      'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                      // handle success
                      if (response.not_logged_in) {
                        $("#signinModal").modal("show");
                      } else {
                        // Use Toastr for success message
                        $("#notesModal").modal('hide')
                        toastr.success(response.message);

                        // Other actions
                        displayNotes();
                        disableNote();
                      }
                    },
                    error: function (response) {
                      // handle error
                      if (response.status === 401) {
                        // Handle 401 Unauthorized
                      } else {
                        // Use Toastr for error message
                        toastr.error(response.message);
                      }
                    }
                  });
                });


                // Add code to open the sign-in modal here
                // You can use Bootstrap modal or any other modal library for this purpose
                // Example code for opening Bootstrap modal:







                function displayNotes() {
                  $.ajax({
                    type: 'GET',
                    url: '/get_notes',  // Replace with your URL to fetch notes
                    success: function (notes) {
                      if (notes.length > 0) {
                        var latestNote = notes[notes.length - 1];
                        $("#editInput").val(latestNote.text);
                      }
                    },
                    error: function (error) {
                      //////console.log('Error fetching notes:', error);
                    }
                  });
                }
                displayNotes();

                $(".editNotes").click(function () {
                  editNote()
                })

                function disableNote() {
                  $("#editInput").prop('disabled', true); // Enable the textarea when editing
                  // Revert CSS properties to their defaults

                }
                function editNote() {
                  $("#editInput").prop('disabled', false); // Enable the textarea when editing
                  // Revert CSS properties to their defaults
                  $("#editInput").focus()
                }
              });


            </script>


          </div>

          <div class="main_position"></div>

          <div class="main_all_profit_loss" style="display: none;">
            <div class="d-flex align-items-center justify-content-between mt-2">
              <p class="fs-14 fw-500 label-color-6">Max. Profit</p>
              <p class="fs-14 fw-500 text-green" id="max_profit">Null</p>
            </div>
            <div class="d-flex align-items-center justify-content-between">
              <p class="fs-14 fw-500 label-color-6">Max. Loss</p>
              <p class="fs-14 fw-500 text-danger" id="max_loss">Null</p>
            </div>

            <div class="d-flex align-items-center justify-content-between">
              <p class="fs-14 fw-500 label-color-6">Breakevens</p>
              <p class="fs-14 fw-500 label-color-6" id="break_evens">
                Null
              </p>
            </div>

            <div class="d-flex align-items-center justify-content-between">
              <p class="fs-14 fw-500 label-color-6">Reward Risk:</p>
              <p class="fs-14 fw-500 label-color-6" id="ratio">No Defined</p>
            </div>

            <div class="d-flex align-items-center justify-content-between" id="margin_needed">
              <p class="fs-14 fw-500 label-color-6">Net Credit:</p>
              <p class="fs-14 fw-500 label-color-6" id="net_credit">null</p>
            </div>


            <div class="d-flex align-items-center justify-content-between" id="brokrage_needed">
              <p class="fs-14 fw-500 label-color-6">Approx Brokerage:</p>
              <p class="fs-14 fw-500 label-color-6" id="brokrage_fees">40</p>
            </div>
            <div class="d-flex align-items-center justify-content-between" id="margin_needed">
              <p class="fs-14 fw-500 label-color-6">Margin required:</p>
              <p class="fs-14 fw-500 label-color-6" id="margin_required">null</p>
            </div>


          </div>
        </div>
        <div class="main_bottom_strategy_positions" style="display: none;">
          <button data-bs-toggle="modal" data-bs-target="#save_startegyModal" class="save_strategy">Save
            Strategy</button>
          <button class="reset_button execute_all_strategies d-flex gap-1 align-items-center" disabled
            title="Please Activate your API for placing order">
            <p style="margin-bottom: auto; margin-top: auto; font-size: 12px" class="">
              Execute Order
            </p>
          </button>

          <button class="deploy_btn">Deploy</button>

        </div>

        <div class="main_build_custom_strategy_empty">

          <div class="main_empty_builder_icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="135" height="82" viewBox="0 0 135 82"
              class="SVGLoader__StyledComp-sc-1ak2cuz-1 SVGInline-svg ">
              <g fill="none" fill-rule="evenodd">
                <g fill-rule="nonzero">
                  <ellipse cx="71" cy="42" fill="#E5EFEF" opacity=".498" rx="39" ry="40"></ellipse>
                  <g>
                    <path fill="#FFF"
                      d="M38.4 1.18H3.554c-1.283 0-2.323 1.057-2.323 2.36v57.828c0 1.303 1.04 2.36 2.323 2.36h41.813c1.283 0 2.323-1.057 2.323-2.36V10.622L38.399 1.18z"
                      transform="translate(15)"></path>
                    <path fill="#AAA"
                      d="M45.368 64.908H3.555c-1.922 0-3.485-1.588-3.485-3.54V3.54C.07 1.588 1.633 0 3.555 0h34.844c.308 0 .604.124.821.345l9.292 9.441c.218.221.34.521.34.835v50.746c0 1.952-1.563 3.54-3.484 3.54zM3.555 2.361c-.64 0-1.162.529-1.162 1.18v57.827c0 .65.521 1.18 1.162 1.18h41.813c.64 0 1.162-.53 1.162-1.18V11.11l-8.612-8.75H3.555z"
                      transform="translate(15)"></path>
                  </g>
                  <g>
                    <path fill="#EFEFD2" d="M1.259 10.808L10.757 10.808 1.259 1.31z" transform="translate(52)"></path>
                    <path fill="#AAA"
                      d="M10.757 11.996H1.26c-.656 0-1.187-.531-1.187-1.188V1.31c0-.48.29-.913.733-1.096.444-.186.953-.082 1.293.257l9.498 9.498c.34.34.442.85.258 1.294-.184.444-.617.733-1.097.733zM2.447 9.62H7.89L2.446 4.176v5.445z"
                      transform="translate(52)"></path>
                  </g>
                  <g fill="#AAA" transform="translate(0 22)">
                    <path
                      d="M4.404 20.98c-.29 0-.582-.118-.804-.354L.382 17.22c-.444-.47-.444-1.233 0-1.703.445-.47 1.165-.47 1.61 0l3.217 3.407c.444.47.444 1.233 0 1.703-.222.236-.513.353-.805.353z">
                    </path>
                    <path
                      d="M1.187 20.98c-.291 0-.583-.118-.805-.354-.444-.47-.444-1.233 0-1.703L3.6 15.516c.444-.47 1.164-.47 1.609 0 .444.47.444 1.233 0 1.703L1.99 20.626c-.222.236-.513.353-.804.353z">
                    </path>
                    <ellipse cx="10.76" cy="14.457" rx="1.138" ry="1.205"></ellipse>
                    <ellipse cx="7.347" cy="1.205" rx="1.138" ry="1.205"></ellipse>
                  </g>
                </g><text fill="#A6A6A6" font-family="Roboto-Bold, Roboto" font-size="12" font-weight="bold">
                  <tspan x="79" y="49">No Trades </tspan>
                  <tspan x="79" y="63">Added</tspan>
                </text>
              </g>
            </svg>

          </div>
          <div class="main_strategy_builder_btn">
            <button class="" type="button" data-bs-toggle="offcanvas" data-bs-target="#optionChain_canvas"
              aria-controls="optionChain_canvasLabel" id="buid_custom_strategy_btn">Build Your Strategy</button>
          </div>

          <style>
            .main_strategy_builder_btn {

              margin-right: 41px;
            }

            .main_option_expiry_date {
              display: flex;
              align-items: center;
              gap: 1rem;
            }

            .main_option_chain_oi_ltp_greeks {
              padding: 4px 2px;
              border: 1px solid #c1c1c180;
              display: flex;
              gap: 0.2rem;
              border-radius: 5px;
            }

            .main_option_chain_oi_ltp_greeks button {
              width: 4.2rem;
              border: none;
              justify-content: center;
              display: flex;
              transition: color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
              background: white;

            }

            .active_oi_ltp_greeks {




              display: flex !important;
              align-items: center !important;
              background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
              color: #fff;

              text-align: center;
              font-size: 14px;

              font-weight: 500;
              border-radius: 4px;
              border: 1px solid #4399eb !important;
              -webkit-box-shadow: none !important;
              box-shadow: none !important;
              outline: 0 !important;


              cursor: pointer;

              font-weight: 600;
            }

            #taget_date_table {
              display: flex;
            }

            .swal2-confirm {
              background-color: linear-gradient(180deg, #4399eb, #5cadfb) !important;
            }


            .border_collapsed {

              border-color: inherit !important;
              border: none;
              border-bottom-style: inherit !important;
              border-width: 1px !important;
            }


            .main_indices_fut_opt_filter {
              display: flex;
              align-items: center;
              gap: 1rem;
            }

            .fut_opt_btns {
              padding: 4px 2px;
              border: 1px solid #c1c1c180;
              display: flex;
              gap: 0.2rem;
              border-radius: 5px;
            }

            .fut_opt_btns button {
              width: 4.2rem;
              border: none;
              justify-content: center;
              display: flex;
              transition: color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
              background: white;

            }

            .active_opt_fut {




              display: flex !important;
              align-items: center !important;
              background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
              color: #fff;

              text-align: center;
              font-size: 14px;

              font-weight: 500;
              border-radius: 4px;
              border: 1px solid #4399eb !important;
              -webkit-box-shadow: none !important;
              box-shadow: none !important;
              outline: 0 !important;


              cursor: pointer;

              font-weight: 600;
            }

            .action_future_buy,
            .action_future_sell {
              border: 1px solid #D8DCE3;
              padding: 0 9px;
              border-radius: 4px;

              cursor: pointer;
              transition: 0.2s;
            }

            .action_future_buy:hover,
            .action_future_sell:hover {
              color: #5cadfb;
              background-color: white;
            }

            .action_future_buy {
              background-color: #c9ffed;
            }

            .action_future_sell {
              background-color: #ffd2cf;
            }
          </style>













        </div>
      </div>
      <div class="offcanvas offcanvas-start" tabindex="-1" id="optionChain_canvas"
        aria-labelledby="optionChain_canvasLabel" style="    z-index: 99999999999999999999;     width: 50%;">
        <div class="offcanvas-header justify-content-end">

          <button type="button" class="btn-close option_chain_canvas" data-bs-dismiss="offcanvas"
            aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <div>



            <div class="main_option_inner d-flex justify-content-between align-items-center">

              <div class="main_indices_fut_opt_filter">
                <select class="form-select w-auto stockDropdown">
                  <optgroup label="Indices">
                    <option value="NIFTY">NIFTY</option>
                    <option value="BANKNIFTY">BANKNIFTY</option>
                    <option value="FINNIFTY">FINNIFTY</option>
                  </optgroup>
                  {% comment %} <optgroup label="Stocks"></optgroup> {% endcomment %}
                </select>
                <div class="fut_opt_btns">
                  <button class="opt_btn active_opt_fut" data-opt_fut="opt">OPT</button>

                  <button class="fut_btn" data-opt_fut="fut">FUT</button>
                </div>
              </div>

              <script>
                $(document).ready(function () {
                  $(".fut_opt_btns button").click(function () {
                    $(".fut_opt_btns button").removeClass("active_opt_fut")
                    // Check the data attribute value
                    var optionType = $(this).data("opt_fut");

                    // Handle the case when "opt" button is clicked
                    if (optionType === "opt") {



                      $(this).addClass("active_opt_fut")
                      $(".main_option_expiry_date").show()
                      $(".main_options_tables").show()
                      $(".main_futures_table").hide()
                      // Add your code logic here for the "opt" case
                      // For example, you can log a message or perform some action
                      ////console.log("OPT button clicked");
                    } else if (optionType === "fut") {
                      $(this).addClass("active_opt_fut")



                      getFutureData($(".stockDropdown").val());



                      $(".main_option_expiry_date").hide()
                      $(".main_options_tables").hide()
                      $(".main_futures_table").show()
                      // Handle the case when "fut" button is clicked
                      // Add your code logic here for the "fut" case
                      ////console.log("FUT button clicked");
                    }
                  });


                  $(".stockDropdown").change(function () {
                    var symbolIndices = $(this).val();
                    getFutureData(symbolIndices);
                  });


                  function formatFutureDate(inputDate) {
                    const options = { day: 'numeric', month: 'short' };
                    const formattedDate = new Date(inputDate).toLocaleDateString('en-US', options);
                    return formattedDate;
                  }

                  function getFutureData(symbolIndices) {
                    // Make an Ajax request to Django backend
                    $.ajax({
                      url: "/fetch-future-data",
                      method: "GET",
                      data: { symbol_indices: symbolIndices },
                      success: function (data) {
                        // Handle the successful response, e.g., update the table body
                        ////console.log(data);
                        populateExpiryDropdown(data.resultData.map(future => future.expiry), data);

                        var futureTableBody = $(".future_table_body");

                        // Clear existing table rows
                        futureTableBody.empty();

                        // Iterate through resultData and append rows to the table
                        $.each(data.resultData, function (index, future) {
                          ////console.log(future.expiry);
                          if (index === 0) {
                            $(".futures_ltp").text(future.last_price);
                          }
                          // Format the date using the formatFutureDate function
                          const formattedDate = formatFutureDate(future.expiry);

                          // Use template literals for creating HTML row
                          var row = `
                                            <tr>
                                                <td > 
                                                  <div class="future_expiry" style="display: flex;justify-content: space-between;">
                                                  <div class="future_expiry_main" style="display: none;">${future.expiry}</div>${formattedDate} (${calculateDaysDifference(future.expiry)} Days)
                                                  <button class="action action_future_buy actions_future_buy_sell" data-future_action="buy">B</button>

                                                </div>
                                                  </td>

                                                <td class="" >
                                                  <div class="future_close_action" style="display: flex;justify-content: space-between;">
                                                    <button class="action action_future_sell actions_future_buy_sell" data-future_action="sell">S</button>
                                                    <div class="future_close">${future.last_price}</div>
                                                    </div>
                                                  </td>
                                            </tr>
                                        `;

                          futureTableBody.append(row);
                        });


                        $(".actions_future_buy_sell").click(function () {
                          var future_tr = $(this).closest("tr")

                          var action_buy_sell_futures = $(this).data("future_action")
                          ////console.log(action_buy_sell_futures);

                          var futures_strikePrice = future_tr.find(".future_close").text()
                          ////console.log(futures_strikePrice);
                          var future_expiry_main = future_tr.find(".future_expiry_main").text()
                          ////console.log(future_expiry_main);

                        })
                      },
                      error: function (error) {
                        // Handle the error response
                        console.error("Error fetching future data:", error);
                      }
                    });
                  }
                  function populateExpiryDropdown(expiries, data) {
                    var expiryDropdown = $(".futures_expiry");

                    // Clear existing dropdown options
                    expiryDropdown.empty();

                    // Add an option for each expiry date
                    expiries.forEach(function (expiry) {
                      var formattedDate = formatFutureDate(expiry);
                      var option = `<option value="${expiry}">${expiry}</option>`;
                      expiryDropdown.append(option);
                    });

                    ////console.log($(".futures_expiry").val());
                    ////console.log(data);
                  }

                  // Function to calculate the difference in days
                  function calculateDaysDifference(expiryDate) {
                    const today = new Date();
                    const expiry = new Date(expiryDate);
                    const differenceInTime = expiry - today;
                    const differenceInDays = Math.floor(differenceInTime / (1000 * 3600 * 24));
                    return differenceInDays;
                  }

                  getFutureData($(".stockDropdown").val());



                  $(".futures_expiry").change(function () {
                    var symbol_names = $(".stockDropdown").val()
                    var future_expiry = $(this).val()

                    $.ajax({
                      url: "/fetch-future-unique-data",
                      method: "GET",
                      data: { symbol_indices: symbol_names, future_expiry: future_expiry },
                      success: function (data) {
                        // Handle the successful response, e.g., update the table body
                        ////console.log(data);

                        if (data && data.length > 0) {
                          var expiryValue = data[0].last_price;
                          $(".futures_ltp").text(expiryValue);
                        } else {
                          console.error("Empty or invalid data received");
                        }

                      },
                      error: function (error) {
                        // Handle the error response
                        console.error("Error fetching future data:", error);
                      }
                    });
                  })

                });
              </script>
              <!-- <p class="text-secondary">*Note: OI IN QUANTITY</p> -->

              <div class="main_option_expiry_date">

                <div class="main_option_chain_oi_ltp_greeks">
                  <Button class="ltp_option active_oi_ltp_greeks" data-option="ltp">LTP</Button>
                  <Button class="oi_option" data-option="oi">OI</Button>
                  <Button class="greeks_option" data-option="greeks">Greeks</Button>
                </div>

                <select id="optionExpiryDropdown" class="form-select w-auto">
                  <!-- Options will be populated dynamically from AJAX response -->
                </select>
              </div>

            </div>

            <div class="main_options_tables">

              <div class="main_option_chain_table">
                <table class="table table-hover">
                  <thead>
                    <th class="text-end">Call IV</th>
                    <th class="text-end">Call OI</th>
                    <th class="text-end">Call LTP</th>
                    <th class="text-center bg-light">

                      <div class="main_option_chain_strike_price">
                        Strike Price
                      </div>
                    </th>
                    <th class="text-start ">Put LTP</th>
                    <th class="text-start ">Put OI</th>
                    <th class="text-start ">Put IV</th>
                  </thead>

                  <tbody class="strategy_option_chain"></tbody>
                </table>
              </div>

              <div class="main_option_oi">
                <table class="table table-hover">
                  <thead>

                    <th class="text-start">Call OI(Chg%)</th>
                    <th class="text-end">Call OI</th>
                    <th class="text-center bg-light">

                      <div class="main_option_chain_strike_price">
                        Strike Price
                      </div>
                    </th>

                    <th class="text-start ">Put OI</th>
                    <th class="text-end ">Put OI(Chg%)</th>
                  </thead>

                  <tbody class="strategy_option_chain_oi"></tbody>
                </table>
              </div>

              <div class="main_option_greeks">
                <table class="table table-hover">
                  <thead>

                    <td class="text-start">Call Delta</td>
                    <td class="text-center">Call IV</td>
                    <td class="text-center bg-light">
                      <div class="main_option_chain_strike_price">
                        Strike Price
                      </div>
                    </td>
                    <td class="text-center">Put IV</td>
                    <td class="text-start">Put Delta</td>







                    <td>Theta</td>
                    <td>Vega</td>
                    <td>Gamma</td>








                  </thead>

                  <tbody class="strategy_option_chain_greeks"></tbody>
                </table>
              </div>
            </div>

            <div class="main_futures_table" style="display: none;">
              <table class="table table-hover">
                <thead>
                  <th>Expiry</th>
                  <th>price</th>
                </thead>
                <tbody class="future_table_body">

                </tbody>
              </table>

            </div>
          </div>


        </div>
      </div>


      <script>
        $(document).ready(function () {

          $(".main_option_chain_oi_ltp_greeks button").click(function () {
            $(".main_option_chain_oi_ltp_greeks button").removeClass("active_oi_ltp_greeks")
            $(this).addClass("active_oi_ltp_greeks")
            var filter_option = $(this).data("option")

            if (filter_option === "ltp") {
              $(".main_option_chain_table").show()
              $(".main_option_oi").hide()
              $(".main_option_greeks").hide()
            } else if (filter_option === "oi") {
              $(".main_option_chain_table").hide()
              $(".main_option_oi").show()
              $(".main_option_greeks").hide()
            }
            else if (filter_option === "greeks") {
              $(".main_option_chain_table").hide()
              $(".main_option_oi").hide()
              $(".main_option_greeks").show()
            }


          })


        })
      </script>

      <div class="right_p_l_greeks col-md-7 col-lg-7 col-sm-12">

        <i class='bx bx-fullscreen maximize'></i>
        <div class="table_pl_greek">
          <div class="main_filter_greek_P_L">
            <div class="inner_greek_p_l d-flex">
              <p class="payoff_charts greek_strategy_active">
                PAYOFF DIAGRAM

              </p>
              <p class="payoff_table">
                PAYOFF TABLE

              </p>
              <p class="strategy_cost_table">
                STRATEGY COST
              </p>
              <p class="greek_table">GREEKS</p>
              <p class="oi_chart">OI CHART</p>
              <p class="adjustment">ADJUSTMENT</p>
              <p class="targets">TARGET</p>
              <p class="stoploss">STOPLOSS</p>
              <p class="alerts">ALERT</p>
              <p class="history">HISTORY</p>
            </div>
          </div>

          <div id="payoff_charts">
            <div id="chartdiv" style="width: 100%; height: 500px;"></div>
          </div>
          <div id="payoff_table" style="width: 100%; height: 400px;     overflow: auto;">

            <table class="payoff_table_main_table table table-striped-custom">
              <thead>
                <tr>
                  <th>

                    <div class="strikePrice_payoff_table">

                      Strike Price
                    </div>
                  </th>


                  <th class="">


                    <span class="on_date_expiry">

                    </span>
                  </th>



                  <th class="d-flex gap-2 align-items-center">

                    <div class="on_expiry_profits">
                      On Expiry
                    </div>
                    <div class="payoff_expiry">

                    </div>
                  </th>


                </tr>
              </thead>

              <tbody class="payoff_table_data">

              </tbody>
            </table>

          </div>

          <div id="table-Greeks" class="table-responsive">
            <table id="resultTable" class="table table-striped-custom">
              <thead class="bg-light">
                <tr>
                  <th>POSITION</th>
                  <th>IV</th>
                  <th>DELTA</th>
                  <th>THETA</th>
                  <th>GAMMA</th>
                  <th>VEGA</th>
                  <th>RHO</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>


          <div id="table-PL_main" class="table-responsive">
            <table class="PL-table table table-striped-custom">
              <thead class="bg-light">
                <tr>
                  <th>POSITION</th>
                  <th>TRADED PRICE</th>
                  <th>CURRENT PRICE</th>
                  <th>LOTS</th>
                  <th>QTY.</th>
                  <th>TOTAL CUR. COST</th>
                  <th class="text-center">P/L</th>
                </tr>
              </thead>
              <tbody id="table-PL"></tbody>
            </table>
          </div>

          <div id="oi-charts">
            <div class="option_oi_charts">
              <div id="oi_charts" style="width: 100%; height: 600px;"></div>
            </div>

          </div>

          <div id="real_adjustment_table">
            <table class="table table-striped-custom">
              <thead class="adjsuments_table_thead">

                <tr>

                  <td>STRATEGY</td>
                  <td>BREAKEVENS</td>
                  <td>STRIKE PRICE</td>
                  <td>OPTION PRICE</td>
                  <td>ACTION</td>

                </tr>
              </thead>
              <tbody class="real_adjustment_table_body">
                <tr>
                  <td>
                    <div>ADJUSTMENTS 1</div>
                  </td>
                  <td>
                    <div>19318.75</div>
                  </td>
                  <td>
                    <div>19200</div>
                  </td>
                  <td>
                    <div>65.2</div>
                  </td>
                  <td>
                    <div><button class="adjust">Adjust</button></div>
                  </td>

                </tr>
                <tr>
                  <td>
                    <div>ADJUSTMENTS 1</div>
                  </td>
                  <td>
                    <div> 19781.25</div>
                  </td>
                  <td>
                    <div>19200</div>
                  </td>
                  <td>
                    <div>65.2</div>
                  </td>
                  <td>
                    <div><button class="adjust">Adjust</button></div>
                  </td>

                </tr>

              </tbody>

            </table>

          </div>

          <div class="targets_table">

            <table class="table table-striped-custom">
              <thead>
                <tr>

                  <th>STRATEGY</th>
                  <th> STRIKE PRICE</th>
                  <th>TARGET PRICE</th>
                  <th>TARGET PERCENTAGE</th>
                  <th>VARIANCE</th>
                  <th>ACTION</th>
                </tr>
              </thead>

              <tbody>
              <tbody>


                <tr>

                  <td>
                    Strategy 1
                  </td>

                  <td>19100</td>
                  <td>
                    <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                      <div class="" style="display: flex;align-items: center;">
                        <label for="exampleInputEmail1" class="form-label"></label>
                        <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                          aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                        <div id="emailHelp" class="form-text"></div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                      <div class="" style="display: flex;align-items: center;">
                        <label for="exampleInputEmail1" class="form-label"></label>
                        <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                          aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                        <div id="emailHelp" class="form-text">%</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="" style="display: flex;align-items: center;">
                      <label for="exampleInputEmail1" class="form-label"></label>
                      <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                        aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                      <div id="emailHelp" class="form-text"></div>
                    </div>
          </div>
          </td>
          <td><button class="setTarget">Set Target</button></td>




          </tr>

          <tr>

            <td>
              Strategy 2
            </td>

            <td>19100</td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text">%</div>
                </div>
              </div>
            </td>
            <td>
              <div class="" style="display: flex;align-items: center;">
                <label for="exampleInputEmail1" class="form-label"></label>
                <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                  aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                <div id="emailHelp" class="form-text"></div>
              </div>
        </div>

        </td>
        <td><button class="setTarget">Set Target</button></td>




        </tr>

        <tr>

          <td>
            Strategy 3
          </td>

          <td>19100</td>
          <td>
            <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

              <div class="" style="display: flex;align-items: center;">
                <label for="exampleInputEmail1" class="form-label"></label>
                <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                  aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                <div id="emailHelp" class="form-text"></div>
              </div>
            </div>
          </td>
          <td>
            <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

              <div class="" style="display: flex;align-items: center;">
                <label for="exampleInputEmail1" class="form-label"></label>
                <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                  aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                <div id="emailHelp" class="form-text">%</div>
              </div>
            </div>
          </td>
          <td>
            <div class="" style="display: flex;align-items: center;">
              <label for="exampleInputEmail1" class="form-label"></label>
              <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
              <div id="emailHelp" class="form-text"></div>
            </div>
      </div>
      </td>

      <td><button class="setTarget">Set Target</button></td>




      </tr>




      </tbody>
      </table>





    </div>











    <div class="stoploss_table">

      <table class="table table-striped-custom">
        <thead>
          <tr>

            <th>STRATEGY</th>
            <th> STRIKE PRICE</th>
            <th>STOPLOSS PRICE</th>
            <th>STOPLOSS PERCENTAGE</th>
            <th> VARIANCE</th>
            <th>ACTION</th>
          </tr>
        </thead>

        <tbody>
        <tbody>


          <tr>

            <td>
              Strategy 1
            </td>

            <td>19100</td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>


            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text">%</div>
                </div>
              </div>
            </td>


            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>

            <td><button class="setTarget">Set Stoploss</button></td>




          </tr>

          <tr>

            <td>
              Strategy 2
            </td>

            <td>19100</td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text">%</div>
                </div>
              </div>
            </td>

            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>

            <td><button class="setTarget">Set Stoploss</button></td>




          </tr>

          <tr>

            <td>
              Strategy 3
            </td>

            <td>19100</td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text">%</div>
                </div>
              </div>
            </td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>

            <td><button class="setTarget">Set Stoploss</button></td>




          </tr>




        </tbody>
      </table>


    </div>
    <div class="alerts_table">


      <table class="table table-striped-custom">
        <thead class="adjsuments_table_thead">

          <tr>

            <td>STRATEGY</td>
            <td>BREAKEVENS</td>
            <td>STRIKE PRICE</td>
            <td>OPTION PRICE</td>
            <td>ACTION</td>

          </tr>
        </thead>
        <tbody class="real_adjustment_table_body">
          <tr>
            <td>
              <div>ALerts 1</div>
            </td>
            <td>
              <div>19318.75</div>
            </td>
            <td>
              <div>19200</div>
            </td>
            <td>
              <div>65.2</div>
            </td>
            <td>
              <div><button class="adjust">Set Alert</button></div>
            </td>

          </tr>
          <tr>
            <td>
              <div>Alerts 1</div>
            </td>
            <td>
              <div> 19781.25</div>
            </td>
            <td>
              <div>19200</div>
            </td>
            <td>
              <div>65.2</div>
            </td>
            <td>
              <div><button class="adjust">Set Alert</button></div>
            </td>

          </tr>

        </tbody>

      </table>




    </div>
    <div class="history_table">
      <p>History is under developements</p>
    </div>

  </div>


  <div class="main_range_inputs" style="display: none !important;">

    <label for="customRange1" class="form-label justify-content-between" id="taget_date_table">

      <div id="target_date"></div>
      <div id="target_date_full"></div>
    </label>
    <input type="range" class="form-range " min="0" max="5" id="customRange2">
  </div>




</div>
<style>
  input[type="range"]::-webkit-slider-runnable-track {
    background-color: #c4c4c4;
    border-radius: 0.5rem;
    height: 0.5rem;
  }
</style>
<script>
  $(document).ready(function () {
    // Get today's date
    var todayDate = new Date();
    var todayDateString = formatDate(todayDate);

    // Generate options for the dropdown
    for (var i = 0; i <= 7; i++) {
      var optionDate = new Date();
      optionDate.setDate(todayDate.getDate() + i);
      var optionDateString = formatDate(optionDate);
      // $("#optionExpiryDropdown").append("<option value='" + optionDateString + "'>" + optionDateString + "</option>");
    }

    // Set the range min value as today's date


    // Event listener for dropdown change


    // Function to format date as 'YYYY-MM-DD'
    function formatDate(date) {
      var year = date.getFullYear();
      var month = (date.getMonth() + 1).toString().padStart(2, '0');
      var day = date.getDate().toString().padStart(2, '0');
      return year + '-' + month + '-' + day;
    }

    // Function to update the range max value based on dropdown selection
    function updateRangeLimits() {
      var selectedDate = new Date($("#optionExpiryDropdown").val());
      var daysLeft = Math.ceil((selectedDate - todayDate) / (1000 * 60 * 60 * 24));
      logDateInfo("customRange2");
    }

    // Function to log current date and days left to the selected date
    function logDateInfo(rangeId) {
      var currentDate = new Date();
      var selectedDate = new Date($("#optionExpiryDropdown").val());
      var daysLeft = Math.ceil((selectedDate - currentDate) / (1000 * 60 * 60 * 24));
      $("#customRange2").attr("max", daysLeft);
      //////console.log("Current Date: " + formatDate(currentDate));
      //////console.log("Days Left to Selected Date for " + rangeId + ": " + daysLeft);
    }
    updateRangeLimits();


  });
</script>
</div>
</div>


<script>
  $(".maximize").click(function () {
    var elem = document.querySelector('.right_p_l_greeks');
    var chartDiv = document.getElementById('chartdiv');
    var payoffTable = document.getElementById('payoff_table'); // Add this line to select the element by its ID
    var oi_charts = document.getElementById('oi_charts'); // Add this line to select the element by its ID
    var maximizeIcon = document.querySelector('.maximize');

    if (!document.fullscreenElement) {
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '90vh';
        payoffTable.style.height = '90vh'; // Set the height of the payoff_table to 90vh
        oi_charts.style.height = '90vh'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-fullscreen');
        maximizeIcon.classList.add('bx-exit-fullscreen');
      } else if (elem.webkitRequestFullscreen) { /* Safari */
        elem.webkitRequestFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '90vh';
        payoffTable.style.height = '90vh';
        oi_charts.style.height = '90vh'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-fullscreen');
        maximizeIcon.classList.add('bx-exit-fullscreen');
      } else if (elem.msRequestFullscreen) { /* IE11 */
        elem.msRequestFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '90vh';
        payoffTable.style.height = '90vh';
        oi_charts.style.height = '90vh'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-fullscreen');
        maximizeIcon.classList.add('bx-exit-fullscreen');
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '400px'; // Change back to initial height
        payoffTable.style.height = '400px'; // Revert to default height
        oi_charts.style.height = '400px'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-exit-fullscreen');
        maximizeIcon.classList.add('bx-fullscreen');
      } else if (document.webkitExitFullscreen) { /* Safari */
        document.webkitExitFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '400px'; // Change back to initial height
        payoffTable.style.height = '400px';
        oi_charts.style.height = '400px'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-exit-fullscreen');
        maximizeIcon.classList.add('bx-fullscreen');

      } else if (document.msExitFullscreen) { /* IE11 */
        document.msExitFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '400px'; // Change back to initial height
        payoffTable.style.height = '400px';
        oi_charts.style.height = '400px'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-exit-fullscreen');
        maximizeIcon.classList.add('bx-fullscreen');

      }
    }
  });

  document.onkeydown = function (evt) {
    evt = evt || window.event;
    var isEscape = false;
    if ("key" in evt) {
      isEscape = (evt.key === "Escape" || evt.key === "Esc");
    } else {
      isEscape = (evt.keyCode === 27);
    }
    if (isEscape) {
      alert("hi")
      minimizeFunction();
    }
  };

  function minimizeFunction() {
    var maximizeIcon = document.querySelector('.maximize');

    if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) { /* Safari */
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) { /* IE11 */
        document.msExitFullscreen();
      } else if (document.mozCancelFullScreen) { /* Firefox */
        document.mozCancelFullScreen();
      }
      $('.right_p_l_greeks').css('background-color', 'red');
      document.getElementById('chartdiv').style.height = '400px'; // Change back to initial height
      document.getElementById('payoff_table').style.height = '400px'; // Revert to default height
      document.getElementById('oi_charts').style.height = '400px'; // Set the height of the oi_charts to 400px
      maximizeIcon.classList.remove('bx-exit-fullscreen');
      maximizeIcon.classList.add('bx-fullscreen');
    }
  }



</script>



<style>
  .main_action_btn_api {
    display: flex;
    /* align-items: center; */
  }

  @supports (-webkit-appearance: none) or (-moz-appearance: none) {
    .checkbox-wrapper-14 input[type="checkbox"] {
      --active: #275efe;
      --active-inner: #fff;
      --focus: 2px rgba(39, 94, 254, 0.3);
      --border: #bbc1e1;
      --border-hover: #275efe;
      --background: #fff;
      --disabled: #f6f8ff;
      --disabled-inner: #e1e6f9;
      -webkit-appearance: none;
      -moz-appearance: none;
      height: 21px;
      outline: none;
      display: inline-block;
      vertical-align: top;
      position: relative;
      margin: 0;
      cursor: pointer;
      border: 1px solid var(--bc, var(--border));
      background: var(--b, var(--background));
      transition: background 0.3s, border-color 0.3s, box-shadow 0.2s;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:after {
      content: "";
      display: block;
      left: 0;
      top: 0;
      position: absolute;
      transition: transform var(--d-t, 0.3s) var(--d-t-e, ease),
        opacity var(--d-o, 0.2s);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:checked {
      --b: var(--active);
      --bc: var(--active);
      --d-o: 0.3s;
      --d-t: 0.6s;
      --d-t-e: cubic-bezier(0.2, 0.85, 0.32, 1.2);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:disabled {
      --b: var(--disabled);
      cursor: not-allowed;
      opacity: 0.9;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:disabled:checked {
      --b: var(--disabled-inner);
      --bc: var(--border);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:disabled+label {
      cursor: not-allowed;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:hover:not(:checked):not(:disabled) {
      --bc: var(--border-hover);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:focus {
      box-shadow: 0 0 0 var(--focus);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch) {
      width: 21px;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch):after {
      opacity: var(--o, 0);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch):checked {
      --o: 1;
    }

    .checkbox-wrapper-14 input[type="checkbox"]+label {
      display: inline-block;
      vertical-align: middle;
      cursor: pointer;
      margin-left: 4px;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch) {
      border-radius: 7px;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch):after {
      width: 5px;
      height: 9px;
      border: 2px solid var(--active-inner);
      border-top: 0;
      border-left: 0;
      left: 7px;
      top: 4px;
      transform: rotate(var(--r, 20deg));
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch):checked {
      --r: 43deg;
    }

    .checkbox-wrapper-14 input[type="checkbox"].switch {
      width: 39px;
      height: 22px;
      border-radius: 13px;
    }

    .checkbox-wrapper-14 input[type="checkbox"].switch:after {
      left: 2px;
      top: 2px;
      border-radius: 50%;
      width: 17px;
      height: 17px;
      background: var(--ab, var(--border));
      transform: translateX(var(--x, 0));
    }

    .checkbox-wrapper-14 input[type="checkbox"].switch:checked {
      --ab: var(--active-inner);
      --x: 17px;
    }

    .checkbox-wrapper-14 input[type="checkbox"].switch:disabled:not(:checked):after {
      opacity: 0.6;
    }
  }

  .checkbox-wrapper-14 * {
    box-sizing: inherit;
  }

  .checkbox-wrapper-14 *:before,
  .checkbox-wrapper-14 *:after {
    box-sizing: inherit;
  }
</style>

<style>
  .main_symbol_sell_buy {
    display: flex;
    gap: 0.2rem;
  }

  .sellTrade {
    background: #ff000029;
    color: #a20000;
    padding: 4px 8px 3px 8px;
    font-size: 11px;
    border-radius: 4px;
  }

  .buyTrade {
    background: #0daa0029;
    color: #02833e;
    padding: 4px 8px 3px 8px;
    font-size: 11px;
    border-radius: 4px;
  }

  .inner_order_modal {
    padding: 11px;
  }

  .ultra_main_order {
    box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;

    margin-top: 1.3rem;
    border-radius: 8px;
  }

  .main_bottom_card_order {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .left_bottom_card_order {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .main_price_qty {
    display: flex;
    gap: 0.3rem;
    align-items: center;
  }

  .api_actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 1rem;
    gap: 0.5rem;
  }

  .delete_api_btn {
    /* color: #d90000; */
    color: white;
    border: 1px solid red;
    background-color: red;
    border-radius: 5px;
    cursor: pointer;
    transition: 0.3s;
  }

  .delete_api_btn:hover {
    color: red;
    ;
    border: 1px solid red;
    background-color: white;
  }

  .btn_success {
    border: 1px solid green;
    color: green;
    padding: 2px 8px;
    background-color: white;
    border-radius: 5px;
    transition: 0.3s;
  }

  .btn_success:hover {
    background-color: green;
    color: white;
  }

  .btn_danger {
    border: 1px solid #d90000;
    color: #d90000;
    padding: 2px 8px;
    background-color: white;
    border-radius: 5px;
    text-decoration: none !important;
    transition: 0.3s;
  }

  .btn_danger:hover {
    background-color: #d90000;
    color: white !important;
  }

  .btn_danger a {
    text-decoration: none;
    color: #d90000;
  }

  .btn_danger:hover.btn_danger a {
    text-decoration: none;
    background-color: #d90000;
    color: white !important;
  }

  .bg_indicator_sell {
    background-color: #ffcdd2 !important;
    border-color: #ffcdd2 !important;
    color: #e53935 !important;
    caret-color: #e53935 !important;
    padding: 1px 10px;
    border-radius: 2px;

  }

  .bg_indicator_buy {
    color: #43a047 !important;
    caret-color: #43a047 !important;
    background-color: #c8e6c9 !important;
    border-color: #c8e6c9 !important;
    padding: 1px 10px;
    border-radius: 2px;

  }

  .box_shadow_order_execution_success {
    border-radius: 11px;
    box-shadow: rgb(0, 204, 44) 0px 0px 0px 1px;
  }

  .box_shadow_order_execution_error {
    border-radius: 11px;
    box-shadow: rgb(204, 0, 0) 0px 0px 0px 1px;
  }

  .order_success_text {
    color: green;
    text-wrap: pretty;
    text-align: center;
    font-size: 12px;
    background: #ddffee;
    padding: 4px;
    border-radius: 9px;
  }

  .order_error_text {
    color: rgb(204, 0, 0);
    text-wrap: pretty;
    text-align: center;
    font-size: 12px;
    background: #F9E3E3;
    padding: 4px;
    border-radius: 9px;
  }
</style>
</div>
<div class="modal fade" id="editPositionModal">
  <div class="modal-dialog modal-dialog-centered" id="edit_modal">
    <div class="modal-content">
      <div class="modal-header" id="modal_header_edit">
        <h5 class="modal-title" id="modal_title_edit">Edit Position</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <input type="text" id="options_futures_uniques" style="display: none;">

      <div class="modal-body options_edit" id="modal_body">
        <div class="form-group textOnInput_edit">
          <label for="expiryEdit">Select Expiry</label>
          <select name="selectExpiry" class="expiry_date_input" id="selectExpiry"></select>
        </div>
        <div class="form-group textOnInput_edit">
          <label for="strikeEdit">Select Strike Price</label>
          <select name="selectStrikePrice" class="strike_price_input" id="selectStrikePrice"></select>
        </div>
        <div class="form-group textOnInput_edit">
          <label for="optionType">Select Option Type</label>
          <select name="optionType" id="optionType">
            <option value="CE">CE</option>
            <option value="PE">PE</option>
            <option value="FUTURE">FUTURE</option>
          </select>
        </div>

        <div class="Long_short">
          <div class="form-check">
            <input class="form-check-input long_radio" type="radio" name="long_short" id="" value="Long" checked />
            <label class="form-check-label" for="long_radio"> Buy </label>
          </div>
          <div class="form-check">
            <input class="form-check-input short_radio" type="radio" name="long_short" id="" value="Short" />
            <label class="form-check-label" for="short_radio"> Sell </label>
          </div>
        </div>

        <div class="main_counter d-flex gap-3 mb-3">
          <div class="innerStraddle_lot_size">
            <p class="fs-6 lot_title">Qty:</p>
            <div class="counter_straddle d-flex justify-content-center gap-1">
              <button class="decrement_edit">
                <i class="bx bx-minus"></i>
              </button>
              <input type="text" name="" class="counter_input_edit" min="1" disabled />
              <button class="increment_edit">
                <i class="bx bx-plus"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="form-group textOnInput_edit">
          <label for="entryEdit">Entry Price</label>
          <input type="text" class="edit_entry form-control" />
        </div>
        <div class="form-group textOnInput_edit">
          <label for="exitPrice">Exit Price</label>
          <input type="number" class="exit_price form-control" />
        </div>
      </div>


      <div class="modal-body futures_edit" style="padding-top: 0;">



        <div class="futures_segements_main_expiry">
          <label for="">Select Expiry</label>
          <select class="form-select futures_expiry"></select>
        </div>

        <div class="Long_short_future">
          <div class="form-check">
            <input class="form-check-input long_radio" type="radio" name="long_short_future" id="" value="Long"
              checked />
            <label class="form-check-label" for="long_radio"> Buy </label>
          </div>
          <div class="form-check">
            <input class="form-check-input short_radio" type="radio" name="long_short_future" id="" value="Short" />
            <label class="form-check-label" for="short_radio"> Sell </label>
          </div>
        </div>



        <div class="main_counter d-flex gap-3 mb-3">
          <div class="innerStraddle_lot_size">
            <p class="fs-6 lot_title">Qty:</p>
            <div class="counter_straddle d-flex justify-content-center gap-1">
              <button class="decrement_edit">
                <i class="bx bx-minus"></i>
              </button>
              <input type="text" name="" class="counter_input_edit" min="1" disabled />
              <button class="increment_edit">
                <i class="bx bx-plus"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="form-group textOnInput_edit">
          <label for="entryEdit">Entry Price</label>
          <input type="text" class="edit_entry form-control" />
        </div>



        <div class="form-group textOnInput_edit">
          <label for="exitPrice">Exit Price</label>
          <input type="number" class="exit_price form-control" />
        </div>
      </div>

      <div class="modal-footer" id="modal_footer_edit">
        <button type="button" class="saveChanges" data-bs-dismiss="modal" id="saveChangesButton">
          Save
        </button>
      </div>
    </div>
  </div>
</div>
<style>
  .main_spot_order {
    display: flex;
    align-items: center;
  }

  .spot_main_table {
    display: flex;
    gap: 0.7rem;
  }

  .left_spot,
  .right_spot {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .left_spot {
    width: 7rem;
  }

  .right_spot {
    width: 12rem;
  }

  .main_indepth {
    display: flex;
    justify-content: center;
    gap: 3rem !important;
    align-items: flex-start;
  }

  .indepth_details table,
  .indepth_details_offer table {
    font-size: 10px;
  }

  .indepth_details table thead tr th,
  .indepth_details table tbody tr td,
  .indepth_details_offer table thead tr th,
  .indepth_details_offer table tbody tr td {
    border-style: none !important;
  }

  .main_spot_order {
    font-size: 12px;
  }

  .main_api_info {
    display: flex;
    gap: 1rem;
    flex-direction: column;
  }

  /* Styling for the title attribute */
  .bx-help-circle::after {
    content: attr(data-title);
    display: none;
    background-color: black;
    color: white;
    border-radius: 5px;
    padding: 5px;
    position: absolute;
    white-space: nowrap;
    z-index: 1;

    font-size: 12px;
    /* Additional styling as needed */
  }

  .bx-help-circle:hover::after {
    display: block;
  }

  .liquidity_failed,
  .liquidity_passed {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .failed_liquidity {
    text-align: center;
    white-space: initial;
    font-size: 12;
    color: red;
    border: 1px solid;
    border-radius: 6px;
    padding: 9px;
  }

  .passed_liquidity {
    text-align: center;
    white-space: initial;
    font-size: 12;
    color: green;
    border: 1px solid;
    border-radius: 6px;
    padding: 9px;
  }
</style>























<script>
  $(document).ready(function () {
    $("#resultTable tbody,#table-PL,.option_oi_charts,#chartdiv,.payoff_table_data").hide()
    $(".main_position,.main_all_profit_loss,.main_bottom_strategy_positions").hide()
    $("#customRange2").hide()
    $('#taget_date_table').hide()
    $(".main_build_custom_strategy_empty").css("display", "flex")

    // $("#buid_custom_strategy_btn").click(function () {
    //   $("#optionChain_canvas").collapse("toggle");
    // });

    // $(".option_chain_canvas").click(function () {
    //   $("#optionChain_canvas").collapse("toggle");
    // });
    loadSpotData("NIFTY");
    function checkMainPositionContent() {
      var mainPositionElements = $('.main_position');
      var resetButton = $('.reset_button');
      var isEmpty = true;

      mainPositionElements.each(function () {
        if ($(this).html().trim() !== "") {
          isEmpty = false;
          return false; // exit the loop if a non-empty element is found
        }
      });

      if (isEmpty) {
        resetButton.prop('disabled', true);
      } else {
        resetButton.prop('disabled', false);
      }
    }

    $(".dismiss_icon_active_modal").click(function () {
      $("#active_broker_modal").slideUp();
    });

    $("#in_depth_check_box").change(function () {
      if (this.checked) {
        // If the checkbox is checked, hide the .main_indepth element
        $(".main_indepth").show();
      } else {
        // If the checkbox is unchecked, show the .ultra_main_indepth element
        $(".main_indepth").hide();
      }
    });




    // // ACess_TOKEN

    // $(".save_zerodha_btn").click(function (event) {
    //   event.preventDefault();
    //   var app_name = $("#app_name").val();
    //   var api_key = $("#api_key").val();
    //   var secret_key = $("#secret_key").val();
    //   var all_brokers = $("#all_brokers").val();
    //   if (!app_name || !api_key || !secret_key) {
    //     alert("Please fill in all fields.");
    //     return; // Don't proceed with the AJAX request if any field is empty
    //   }

    //   $.ajax({
    //     url: "/save_zerodha_config", // URL of your Django view
    //     type: "POST",
    //     data: {
    //       app_name: app_name,
    //       api_key: api_key,
    //       secret_key: secret_key,
    //       all_brokers: all_brokers,
    //       csrfmiddlewaretoken: "{{ csrf_token }}", // Include CSRF token for security
    //     },
    //     success: function (response) {
    //       // //////console.log(response.message);
    //       get_api_data();

    //       $("#app_name").val("");
    //       $("#api_key").val("");
    //       $("#secret_key").val("");
    //       $(".btn-close[data-bs-dismiss='offcanvas']").click(); // Simulate a click event on the button with the specific data-bs-dismiss attribute


    //     },
    //     error: function (xhr, status, error) {
    //       console.error(xhr.responseText);
    //     },
    //   });
    // });
    // var hasRunOnPageLoad = false; // Initialize a flag to track whether the code has run on page load

    // function get_api_data() {
    //   $.ajax({
    //     url: "/get_zerodha_config", // URL of your Django view for data retrieval
    //     type: "GET",
    //     success: function (data) {
    //       // Handle the retrieved data
    //       // //////console.log(data);

    //       var all_data = "";

    //       if (data.length === 0) {
    //         // If data is empty, display "NO API available"
    //         all_data = "<p style='padding: 0 85px;''>No API available </p>";
    //       } else {
    //         $.each(data, function (index, item) {
    //           // Your existing code to format each API configuration item
    //           var connected_varifications =
    //             item.connected !== "Connected"
    //               ? `<a href="https://kite.zerodha.com/connect/login?api_key=${item.api_key}&v=3">${item.connected}</a>`
    //               : "Connected";
    //           var connected_btn_class =
    //             item.connected !== "Connected"
    //               ? `btn_danger edit_access_token`
    //               : "btn_success";
    //           var switch_btn_visibility =
    //             item.connected !== "Connected" ? `d-none` : "d-block";

    //           all_data += `
    //     <div class='main_api_card'>
    //         <div class="active_inactive_btn d-flex align-items-baseline gap-3"> 


    //             <div class="checkbox-wrapper-14 ${switch_btn_visibility}">
    //                 <input id="s1-14" type="checkbox" class="switch" style="padding: 7px 21px 14px 17px;">
    //                 <label for="s1-14">Inactive</label>
    //             </div>
    //         </div>

    //         <div class="main_api_info">
    //             <div class="app_name_main">
    //                 <p class="text-primary">App Name: </p>
    //                 <p>${item.app_name}</p>
    //             </div>

    //             <div class="api_key_main">
    //                 <p class=text-primary>Api Key:</p>
    //                 <p>${item.api_key}</p>
    //             </div>

    //             <div class="secret_key_main">
    //                 <p class=text-primary>Secret Key: </p>
    //                 <p>${item.secret_key}</p>
    //             </div>

    //             <div class="last_api_token_main" style="display:none;">
    //                 <p>last token updated:</p>
    //                 <p> ${item.api_added_at}</p>
    //             </div>

    //             <div class="access_teken">
    //                 <p class="text-primary" style="display: flex;
    // align-items: flex-end;"> Access Token <sup><i class='bx bx-help-circle ms-1' data-title="${item.api_added_at}"></i></sup>:</p>
    //                 <p>${item.access_token}</p>
    //             </div>
    //             <div class="api_actions">
    //                 <div class="main_action_btn_api d-flex gap-1">
    //                     <button class="${connected_btn_class}" data-id="${item.id}">${connected_varifications}</button>
    //                     <button class="delete_api_btn  cursor-pointer" data-id="${item.id}">Delete</button>
    //                 </div>
    //             </div>
    //         </div>
    //     </div>
    // `;
    //         });

    //         $('.help-icon').hover(function () {
    //           var index = $(this).data('data-added-at');
    //           $('#hover-info-' + index).css('display', 'block');
    //         }, function () {
    //           var index = $(this).data('data-added-at');
    //           $('#hover-info-' + index).css('display', 'none');
    //         });
    //       }

    //       $("#zerodha_data_display").empty().append(all_data);

    //       var $checkbox = $("#s1-14");
    //       var $label = $("label[for='s1-14']");
    //       var $button = $(".reset_button");

    //       // Add a change event handler to the checkbox
    //       $checkbox.on("change", function () {
    //         // Check if the checkbox is checked
    //         if ($checkbox.is(":checked")) {
    //           // If checked, change the label text and enable the button
    //           $label.text("Activated");
    //           checkMainPositionContent()
    //           $button.attr("title", ""); // Remove the title attribute
    //         } else {
    //           // If not checked, change the label text, disable the button, and set the title
    //           $label.text("Inactive");
    //           checkMainPositionContent()
    //           $button.attr(
    //             "title",
    //             "Please Activate your API for placing order"
    //           );
    //         }
    //       });

    //       // Attach a click event handler for the delete buttons
    //       $(".delete_api_btn").click(function () {
    //         var itemId = $(this).data("id");
    //         if (confirm("Are you sure you want to delete this Api?")) {
    //           deleteItem(itemId);
    //         }
    //       });


    //       $(".edit_access_token").click(function () {
    //         // Get the data-id attribute value
    //         var data_Id_access_token = $(this).data("id");

    //         // Check if the browser supports local storage
    //         if (typeof Storage !== "undefined") {
    //           // Use localStorage to store the data-id value
    //           localStorage.setItem(
    //             "data_Id_access_token",
    //             data_Id_access_token
    //           );

    //           // Optionally, you can also retrieve the stored value like this:
    //           // var storedData_Id_access_token = localStorage.getItem("data_Id_access_token");
    //         } else {
    //           // If the browser does not support local storage, you can handle it here
    //           //////console.log("Local storage is not supported in this browser.");
    //         }
    //       });

    //       if (!hasRunOnPageLoad) {
    //         // Check if the code has not run on page load

    //         var uniqueId = localStorage.getItem("data_Id_access_token");

    //         // Function to extract query parameters from a URL
    //         function getQueryParam(url, name) {
    //           name = name.replace(/[\[\]]/g, "\\$&");
    //           var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
    //           var results = regex.exec(url);
    //           if (!results) return null;
    //           if (!results[2]) return "";
    //           return decodeURIComponent(results[2].replace(/\+/g, " "));
    //         }

    //         // Get the current URL
    //         var currentUrl = window.location.href;

    //         // Extract the 'request_token' parameter from the URL
    //         var requestToken = getQueryParam(currentUrl, "request_token");

    //         // Check if 'requestToken' has a value and do something with it
    //         if (requestToken) {
    //           //////console.log("request_token:", requestToken);
    //           editAccessToken(uniqueId, requestToken);
    //           var urlWithoutParams = currentUrl.split("?")[0];
    //           window.history.replaceState({}, document.title, urlWithoutParams);
    //           // Now you can use 'requestToken' in your JavaScript code as needed.
    //         } else {
    //           //////console.log("Hii king");
    //         }

    //         hasRunOnPageLoad = true; // Set the flag to true after running the code on page load
    //       }

    //       // This code will run on subsequent AJAX requests as well as on page load.
    //     },
    //     error: function (xhr, status, error) {
    //       console.error(xhr.responseText);
    //     },
    //   });
    // }
    // function deleteItem(itemId) {
    //   //////console.log(itemId);
    //   $.ajax({
    //     url: `/delete_zerodha_config/${itemId}/`, // URL of your Django delete view
    //     type: "POST",
    //     success: function (response) {
    //       //////console.log(response.message);
    //       // Refresh the data display after successful deletion
    //       get_api_data();
    //     },
    //     error: function (xhr, status, error) {
    //       console.error(xhr.responseText);
    //     },
    //   });
    // }

    // function editAccessToken(uniqueId, newAccessToken) {

    //   //////console.log(newAccessToken);

    //   $.ajax({
    //     url: "/edit_access_token",
    //     type: "POST",
    //     data: {
    //       unique_id: uniqueId,
    //       access_token: newAccessToken,
    //     },
    //     success: function (data) {
    //       //////console.log(data.message); // Print the response message
    //       get_api_data();
    //     },
    //     error: function (xhr, status, error) {
    //       console.error(xhr.responseText);
    //     },
    //   });
    // }

    // get_api_data();
    //END ACess_TOKEN

    //PLACE ZERODHA ORDER

    var intervalId = null; // Initialize the interval ID variable
    $(".execute_all_strategies").click(function () {
      $(".order_modal").empty();

      var trading_quote = [];
      var zerodha_trading_symbol = [];
      var zerodha_lotSize = []
      var sortedOrderContent = []; // Array to store sorted order content



      $(".inner_position").each(function (index) {
        // Get values from the current card
        var card = $(this);
        var symbol = card.find(".symbol").text();
        var expiry = card.find(".expiry").text();
        var expiry_initial = card.find(".expiry_initial").text();
        var strikePrice = card.find(".strikePrice").text();
        var callPutEntrance = card.find(".call_put_entrance").text();
        var entryPrice = card.find(".entryPrice").text();
        var long_short_inner = card.find(".long_short_inner").text();
        var option_lot_size_input = card.find(".option_lot_size_input").text();
        var lot_size_value = $("#lot_size_value").text();

        var final_lot_size_along_with_qty = parseFloat(option_lot_size_input) * parseFloat(lot_size_value);

        if (symbol === "NIFTY") {
          zerodha_trading_symbol.push({
            tradingsymbol: "NSE:NIFTY 50",
          });
        } else if (symbol === "BANKNIFTY") {
          zerodha_trading_symbol.push({
            tradingsymbol: "NSE:NIFTY BANK",
          });
        } else if (symbol === "FINNIFTY") {
          zerodha_trading_symbol.push({
            tradingsymbol: "NSE:NIFTY FIN SERVICE",
          });
        } else {
          zerodha_trading_symbol.push({
            tradingsymbol: `NSE:${symbol}`,
          });
        }

        const dayPart = expiry.slice(0, 2);
        const monthPart = expiry.slice(2, 5).charAt(0);
        const yearPart = expiry.slice(7);


        //////console.log("expiry", expiry);

        function isLastThursday(expiryDate) {
          // Extract day, month, and year from the expiry date string
          const day = parseInt(expiryDate.substr(0, 2));
          const monthAbbreviation = expiryDate.substr(2, 3);
          const year = parseInt(expiryDate.substr(5, 4));

          // Map month abbreviation to month index
          const monthNames = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
          const month = monthNames.indexOf(monthAbbreviation);

          // Calculate the last day of the month
          const lastDayOfMonth = new Date(year, month + 1, 0);

          // Check if the expiry date is the last Thursday
          const expiry = new Date(year, month, day);
          const currentDay = expiry.getDay(); // 0 (Sunday) to 6 (Saturday)

          // Check if the expiry date is the last Thursday
          if (currentDay === 4 && day === lastDayOfMonth.getDate()) {
            //////console.log("Yes, the expiry date is the last Thursday of the month.");
          } else {
            //////console.log("No, the expiry date is not the last Thursday of the month.");
          }
        }

        // Call the function with the given expiry date

        isLastThursday(expiry);



        const combinedString = `${symbol}${yearPart}${monthPart}${dayPart}${strikePrice}${callPutEntrance}`;




        trading_quote.push({
          combinedString: combinedString,
          symbol: symbol,
          expiry: expiry,
          strikePrice: parseFloat(strikePrice), // Parse strikePrice to float
          callPutEntrance: callPutEntrance,
          expiry_initial: expiry_initial
        });
        var sell_buy_indicator = long_short_inner === "-" ? "SELL" : "BUY";

        zerodha_lotSize.push({
          combinedString,
          final_lot_size_along_with_qty,
          sell_buy_indicator,
          entryPrice
        });

        var buy_sale_bg = long_short_inner === "-" ? "sellTrade" : "buyTrade";

        var orderContent = `

    <div class="inner_order_modal mt-2" style="border-radius: 11px;"> 
              <div class="order_status mb-2"> <p style="       text-wrap: pretty;
                     text-align: center;"></p></div>
                     <div class="main_symbol_liqiuidity">
                <div class="main_symbol_sell_buy">
                    <div class='sell_buy_indicator ${buy_sale_bg}'>${sell_buy_indicator}</div>
                <div class="tradingsymbol">${combinedString}</div> 
                <div class="expiry_initial">${expiry_initial}</div> 
                <div class="d-block strikePrice_order_window">${strikePrice}</div>
                <div class="d-block main_trading_symbol"></div>
                <div class="d-block main_instrument_token"></div>
                    
                    </div>

                    <div class="liquidity_status"></div>
                  </div>
                  
                         <div class="gap-1 main_indepth">
                    <div class="indepth_details"></div>
                    <div class="indepth_details_offer"></div>
                    <div class="main_spot_order"> </div>
                </div>
               <hr>

               <div class="main_bottom_card_order">

            <div class="left_bottom_card_order">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="orderTypeLimit${index}" id="limitOrder${index}" value="limit">
                                <label class="form-check-label" for="limitOrder${index}">
                                    Limit
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="orderTypeLimit${index}" id="marketOrder${index}" checked value="market">
                                <label class="form-check-label" for="marketOrder${index}">
                                    Market
                                </label>
                            </div>




                  
              <div class="main_price_qty">
                    <div class="form-group order_place_input">
                    <label for="expiryEdit">Price</label>
                    <input type="number" value=${entryPrice}  class="priceTrade form-control">
                </div>
                    <div class="form-group order_place_input">
                    <label for="expiryEdit">Quantity</label>
                    <input type="number" class="quantityTrade form-control" value=${parseInt(option_lot_size_input) * parseInt(lot_size_value)
          } >
                </div>

            </div>
            </div>
            <div class='right_bottom_card_order'>
            <button class="btn btn-outline-secondary">Cancel</button>
            <button class="btn btn-primary">Place order</button> 
                
                </div>
            </div>
           
            </div>
            </div>
              
   
            </div>
    `;

        // Add the orderContent to the sortedOrderContent array
        sortedOrderContent.push({ strikePrice: parseFloat(strikePrice), combinedString: combinedString, content: orderContent });
      });

      // Sort the sortedOrderContent array based on strikePrice in descending order

      // //console.log(sortedOrderContent);
      sortedOrderContent.sort(function (a, b) {
        return b.strikePrice - a.strikePrice;
      });




      // Iterate over the sortedOrderContent array and append the content to the ".order_modal" element
      sortedOrderContent.forEach(function (sortedContent) {
        $(".order_modal").append(sortedContent.content);
      });



      //////console.log(trading_quote);
      //////console.log(zerodha_trading_symbol);
      //////console.log(zerodha_lotSize);
      trading_quote.sort(function (a, b) {
        return b.strikePrice - a.strikePrice;
      });

      send_quote_data(trading_quote, zerodha_trading_symbol[0], zerodha_lotSize);
      // if (intervalId === null) { // Start the interval only if it's not already running
      //     //////console.log('Show');

      //     // Run the function every 1000 milliseconds (1 second)
      //     intervalId = setInterval(function () {
      //         send_quote_data(trading_quote,zerodha_trading_symbol[0],zerodha_lotSize);
      //     }, 1000);
      // }
    });

    $("#execute").on("hidden.bs.modal", function () {
      if (intervalId !== null) {
        // Clear the interval only if it's running
        clearInterval(intervalId);
        intervalId = null; // Reset the interval ID variable
      } else {
        $(".place_order_btn").prop("disabled", true);

        $(".main_extented_status_liquidity")
          .empty()
          .append(`<p>Note: Please check the liquidity of all trades !!</p>`)
          .removeClass("passed_liquidity failed_liquidity");
      }
    });

    function send_quote_data(trading_quote, zerodha_trading_symbol, zerodha_lotSize) {


      $.ajax({
        type: 'GET',
        url: '/check_user_logged_in', // Update the URL to the appropriate endpoint
        success: function (response) {
          // If the user is logged in, toggle the broker activation modal

          if (response.user_logged_in) {

            $("#signinModal").modal("show");
            return
          } else {

            if (!$('.activate_api').is(':checked')) {

              Swal.fire({
                confirmButtonColor: '#5cadfb',
                icon: 'warning',
                title: 'Warning',
                text: "Please activate you api to place order !!"
                ,
              }).then((result) => {
                if (result.isConfirmed) {
                  $("#Activate_broker_btn").click()
                }
              });
            } else {
              // If not checked, show an alert


              $("#execute").modal("show")





              //////console.log('trading_quote' + JSON.stringify(trading_quote));
              //////console.log('zerodha_trading_symbol' + JSON.stringify(zerodha_trading_symbol));
              //////console.log('zerodha_lotSize' + JSON.stringify(zerodha_lotSize));

              // Save trading_quote data to local storage
              localStorage.setItem("trading_quote", JSON.stringify(trading_quote));

              $.ajax({
                type: "POST",
                url: "/quote_data_from_broker", // Replace with your Django endpoint
                data: JSON.stringify({
                  trading_quote: trading_quote,
                  zerodha_trading_symbol: zerodha_trading_symbol,
                  zerodha_lotSize, zerodha_lotSize
                }),
                contentType: "application/json",
                success: function (response) {
                  // //////console.log(response.broker_name);



                  if (response.broker_name === "zerodha") {
                    //////console.log(response);

                    if (response.status === "success") {

                      $(".broker_icon").empty().append(`<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 60">
                          <defs>
                            <style>
                              .cls-1 {
                                fill: #f6461a;
                              }

                              .cls-2 {
                                fill: #db342c;
                              }
                            </style>
                          </defs>
                          <title>Kite logo trimmed</title>
                          <polygon class="cls-1" points="30 0 0 30 30 60 60 30 90 0 30 0" />
                          <polygon class="cls-2" points="30 60 60 30 90 60 30 60" />
                        </svg>`)


                      var zerodha_kite_profile = response.all_profile.data
                      $(".names_user_details h5").text(zerodha_kite_profile.user_name);
                      $(".names_user_details p").text(`Client ID:${zerodha_kite_profile.user_id}`);

                      var zerodha_margin = response.margin_info.data.commodity.available.cash
                      //////console.log(zerodha_margin);

                      $(".margin_available").val(zerodha_margin);

                      if (
                        response &&
                        response.length > 0 &&
                        response[response.length - 1].hasOwnProperty("combined_data")
                      ) {
                        var combinedData = response[response.length - 1]["combined_data"];

                        // Now you can access the properties of 'combined_data'
                        var symbolSpot = combinedData["symbol_spot"];
                        // Remove 'NSE:' if it exists at the beginning of the string
                        if (symbolSpot.startsWith("NSE:")) {
                          symbolSpot = symbolSpot.substring(4);
                        }
                        var niftyLtp = combinedData["nifty_ltp"];
                        var percentageChange = combinedData["percentage_change"];
                        var profile = combinedData["profile"];
                        var available_cash = combinedData["available_cash"];
                        var userId = combinedData["user_id"];
                        var total_sum = combinedData["total_sum"];
                        var formattedPercentageChange;
                        var precent_color = "";
                        if (percentageChange > 0) {
                          formattedPercentageChange = "+" + percentageChange.toFixed(2);
                          precent_color = "text-success";
                        } else if (percentageChange < 0) {
                          formattedPercentageChange =
                            "-" + Math.abs(percentageChange).toFixed(2);
                          precent_color = "text-danger";
                        } else {
                          formattedPercentageChange = percentageChange.toFixed(2);
                        }



                        $(".margin_needed").val(total_sum.toFixed(2));
                        $(".symbol_name_order p").text(symbolSpot);
                        $(".strike_price_order p").text(niftyLtp);
                        $(".change_per_order p")
                          .text(formattedPercentageChange)
                          .addClass(precent_color);

                        // Use these values as needed in your JavaScript code
                        //////console.log("Symbol Spot:", symbolSpot);
                        //////console.log("Nifty LTP:", niftyLtp);
                        //////console.log("Percentage Change:", percentageChange);
                        //////console.log("Profile:", profile);
                        //////console.log("User ID:", userId);
                      }

                      console.log(response.result_data.ohlc_market_indepth);

                      // Assuming response is an array of objects
                      // Assuming 'response' is the JSON response from your server
                      for (let i = 0; i < response.result_data.ohlc_market_indepth.length; i++) {
                        // const trading_data = response.result_data.ohlc_market_indepth[i];
                        // const trading_symbol = trading_data.instrument_token; // Assuming instrument_token is the trading symbol
                        const trading_symbol = Object.keys(response.result_data.ohlc_market_indepth[i])[0];
                        const trading_data = response.result_data.ohlc_market_indepth[i][trading_symbol];
                        //////console.log(trading_symbol);
                        //////console.log(trading_data);

                        $(".main_trading_symbol").eq(i).append(trading_symbol.replace("NFO:", ""));




                        // Generate the table HTML
                        $(".indepth_details").eq(i).empty();
                        $(".indepth_details_offer").eq(i).empty();
                        $(".main_spot_order").eq(i).empty();

                        const table = generateBidTable(trading_data.depth.buy);
                        const tableOffer = generateOfferTable(trading_data.depth.sell);
                        const spot_data_order = generateSpotData(trading_data);

                        // Append the table to the elements with the corresponding classes

                        $(".indepth_details").eq(i).append(table);
                        $(".indepth_details_offer").eq(i).append(tableOffer);
                        $(".main_spot_order").eq(i).append(spot_data_order);
                      }



                    }

                  }
                  else if (response.broker_name === "angelone") {

                    console.log(response.market_data.data.fetched);
                    // $(".tradingsymbol").hide();

                    console.log(response);
                    //////console.log(response.market_data.data.fetched);

                    $(".broker_icon").empty().append(`  <img src="https://d2u8j8b25aupc8.cloudfront.net/assets/icons/logo.svg" alt="AngelOne Logo" class="h-5 w-5 mr-3">`)


                    const dataWithStrikePrice = [];

                    for (const entry of response.market_data.data.fetched) {
                      const tradingSymbol = entry.tradingSymbol;
                      if (tradingSymbol.endsWith("CE") || tradingSymbol.endsWith("PE")) {
                        const strikePrice = tradingSymbol.slice(12, 17);
                        entry.strikePrice = parseFloat(strikePrice);
                        dataWithStrikePrice.push(entry);
                      } else if (tradingSymbol.endsWith("FUT")) {
                        const strikePrice = entry.ltp
                        entry.strikePrice = parseFloat(strikePrice);
                        dataWithStrikePrice.push(entry);
                      }
                    }
                    console.log(dataWithStrikePrice)


                    dataWithStrikePrice.sort((a, b) => {
                      // First, sort by descending strikePrice
                      const strikePriceComparison = b.strikePrice - a.strikePrice;
                  
                      // If strikePrice is equal, prioritize CE over PE
                      if (strikePriceComparison === 0) {
                          const aIsCE = a.tradingSymbol.endsWith("CE");
                          const bIsCE = b.tradingSymbol.endsWith("CE");
                  
                          if (aIsCE && !bIsCE) {
                              return -1; // a should come before b
                          } else if (!aIsCE && bIsCE) {
                              return 1; // b should come before a
                          }
                      }
                  
                      return strikePriceComparison;
                  });
                  
                  console.log("dataWithStrikePrice", dataWithStrikePrice);
                  





                    // Assuming response is the variable containing your data
                    for (let i = 0; i < dataWithStrikePrice.length; i++) {
                      // Log the current value at index i
                      //////console.log(response.market_data.data.fetched[i].depth);

                      var marketData = dataWithStrikePrice[i]

                      //////console.log(marketData.close);


                      //     let gatheredValues = {
                      //     'last_price': marketData.ltp,
                      //     'open': marketData.open,
                      //     'high': marketData.high,
                      //     'low': marketData.low,
                      //     'Close': marketData.close,
                      //     'volume': marketData.tradeVolume,
                      //     'last_quantity': marketData.lastTradeQty,
                      //     'average_price': marketData.avgPrice,
                      //     'LTT': marketData.exchTradeTime,
                      //     'oi': marketData.opnInterest
                      // };

                      const {
                        ltp: last_price,
                        open: open,
                        high: high,
                        low: low,
                        close: Close,
                        tradeVolume: volume,
                        lastTradeQty: last_quantity,
                        avgPrice: average_price,
                        exchTradeTime: LTT,
                        opnInterest: oi
                      } = marketData;

                      const gatheredValues = {
                        last_price,
                        ohlc: { open, high, low, close: Close },
                        volume,
                        last_quantity,
                        average_price,
                        timestamp: LTT,
                        oi
                      };






                      // Generate the table HTML
                      $(".indepth_details").eq(i).empty();
                      $(".indepth_details_offer").eq(i).empty();
                      $(".main_spot_order").eq(i).empty();

                      const table = generateBidTable(dataWithStrikePrice[i].depth.buy);
                      const tableOffer = generateOfferTable(dataWithStrikePrice[i].depth.sell);
                      const spot_data_order = generateSpotData(gatheredValues);

                      $(".main_trading_symbol").eq(i).append(dataWithStrikePrice[i].tradingSymbol);


                      // Append the table to the elements with the corresponding classes
                      $(".indepth_details").eq(i).append(table);
                      $(".indepth_details_offer").eq(i).append(tableOffer);
                      $(".main_spot_order").eq(i).append(spot_data_order);
                    }



                    $(".names_user_details h5").text(response.all_profile.data.name);
                    $(".names_user_details p").text(`Client ID:${response.all_profile.data.clientcode}`);

                    $(".margin_available").val(response.margin_info.data.availablecash);


                  }
                  else if (response.broker_name === "upstocks") {

                    $(".broker_icon").empty().append(`<img src="https://upstox.com/favicon/mstile-310x310.png" style="width: 29px;" alt="Upstox" class="h-5 w-5 mr-3">`)

                    $(".names_user_details h5").text(response.all_profile.data.user_name);
                    $(".names_user_details p").text(`Client ID:${response.all_profile.data.user_id}`);

                    $(".margin_available").val(response.margin_info.data.commodity.available_margin);
                    console.log(response);
                    console.log(response.market_data.data);

                    const ohlc_market_indepth = [];

                    for (const symbol in response.market_data.data) {
                      if (response.market_data.data.hasOwnProperty(symbol)) {
                        const trading_data = response.market_data.data[symbol];
                        const trading_symbol = symbol.replace("NSE_FO:", "NFO:");

                        const ohlc_entry = {};
                        ohlc_entry[trading_symbol] = trading_data;

                        ohlc_market_indepth.push(ohlc_entry);
                      }
                    }

                    console.log('ohlc_market_indepth', ohlc_market_indepth);



                    const dataWithStrikePrice = [];

                    // Assuming ohlc_market_indepth is an array
                    for (let i = 0; i < ohlc_market_indepth.length; i++) {
                      const symbol = Object.keys(ohlc_market_indepth[i])[0];
                      const entry = ohlc_market_indepth[i][symbol];

                      let strikePrice;

                      if (symbol.endsWith("CE") || symbol.endsWith("PE")) {
                        strikePrice = parseFloat(entry.symbol.slice(-7));
                      } else if (symbol.endsWith("FUT")) {
                        strikePrice = entry.last_price;
                      }

                      entry.strikePrice = parseFloat(strikePrice);
                      dataWithStrikePrice.push(entry);
                    }

                    console.log(dataWithStrikePrice);

                    dataWithStrikePrice.sort((a, b) => {
                      // First, sort by descending strikePrice
                      const strikePriceComparison = b.strikePrice - a.strikePrice;
                  
                      // If strikePrice is equal, prioritize CE over PE
                      if (strikePriceComparison === 0) {
                          const aIsCE = a.symbol.endsWith("CE");
                          const bIsCE = b.symbol.endsWith("CE");
                  
                          if (aIsCE && !bIsCE) {
                              return -1; // a should come before b
                          } else if (!aIsCE && bIsCE) {
                              return 1; // b should come before a
                          }
                      }
                  
                      return strikePriceComparison;
                  });
                  


                    for (let i = 0; i < dataWithStrikePrice.length; i++) {
                      const trading_data = dataWithStrikePrice[i];
                      const trading_symbol = dataWithStrikePrice[i].symbol
                      const instrument_token = dataWithStrikePrice[i].instrument_token


                      $(".main_trading_symbol").eq(i).append(trading_symbol.replace("NFO:", ""));
                      $(".main_instrument_token").eq(i).append(instrument_token);
                      // $(".main_trading_symbol").eq(i).append(trading_symbol.replace("NFO:", ""));

                      // Generate the table HTML
                      $(".indepth_details").eq(i).empty();
                      $(".indepth_details_offer").eq(i).empty();
                      $(".main_spot_order").eq(i).empty();

                      const table = generateBidTable(trading_data.depth.buy);
                      const tableOffer = generateOfferTable(trading_data.depth.sell);
                      const spot_data_order = generateSpotData(trading_data);

                      // Append the table to the elements with the corresponding classes
                      $(".indepth_details").eq(i).append(table);
                      $(".indepth_details_offer").eq(i).append(tableOffer);
                      $(".main_spot_order").eq(i).append(spot_data_order);
                    }

                  }




                  else if (response.status === "error") {

                    Swal.fire({
                      icon: 'warning',
                      title: 'Warning',
                      text: response.message
                      ,
                    });
                    return; // Stop execution if any field is an empty string
                  }
                  else if (response.status === "user_not_unthenticated") {

                    $("#signinModal").modal("show")
                  }


                },
                error: function (error) {
                  console.error(error);
                },
              });


            }
          }
        },
        error: function (xhr, status, error) {
          // Handle the error, for example, display an error message
          console.error("Error:", error);
          alert("Error checking user login status.");
        }
      });



      // $.ajax({
      //   type: "POST",
      //   url: "/quote_data_zerodha", // Replace with your Django endpoint
      //   data: JSON.stringify({
      //     trading_quote: trading_quote,
      //     zerodha_trading_symbol: zerodha_trading_symbol,
      //     zerodha_lotSize, zerodha_lotSize
      //   }),
      //   contentType: "application/json",
      //   success: function (response) {
      //     //////console.log(response);

      //     if (
      //       response &&
      //       response.length > 0 &&
      //       response[response.length - 1].hasOwnProperty("combined_data")
      //     ) {
      //       var combinedData = response[response.length - 1]["combined_data"];

      //       // Now you can access the properties of 'combined_data'
      //       var symbolSpot = combinedData["symbol_spot"];
      //       // Remove 'NSE:' if it exists at the beginning of the string
      //       if (symbolSpot.startsWith("NSE:")) {
      //         symbolSpot = symbolSpot.substring(4);
      //       }
      //       var niftyLtp = combinedData["nifty_ltp"];
      //       var percentageChange = combinedData["percentage_change"];
      //       var profile = combinedData["profile"];
      //       var available_cash = combinedData["available_cash"];
      //       var userId = combinedData["user_id"];
      //       var total_sum = combinedData["total_sum"];
      //       var formattedPercentageChange;
      //       var precent_color = "";
      //       if (percentageChange > 0) {
      //         formattedPercentageChange = "+" + percentageChange.toFixed(2);
      //         precent_color = "text-success";
      //       } else if (percentageChange < 0) {
      //         formattedPercentageChange =
      //           "-" + Math.abs(percentageChange).toFixed(2);
      //         precent_color = "text-danger";
      //       } else {
      //         formattedPercentageChange = percentageChange.toFixed(2);
      //       }
      //       $(".names_user_details h5").text(profile);
      //       $(".names_user_details p").text(`Client ID:${userId}`);

      //       $(".margin_needed").val(total_sum.toFixed(2));
      //       $(".symbol_name_order p").text(symbolSpot);
      //       $(".strike_price_order p").text(niftyLtp);
      //       $(".change_per_order p")
      //         .text(formattedPercentageChange)
      //         .addClass(precent_color);
      //       $(".margin_available").val(available_cash);
      //       // Use these values as needed in your JavaScript code
      //       //////console.log("Symbol Spot:", symbolSpot);
      //       //////console.log("Nifty LTP:", niftyLtp);
      //       //////console.log("Percentage Change:", percentageChange);
      //       //////console.log("Profile:", profile);
      //       //////console.log("User ID:", userId);
      //     }

      //     // Assuming response is an array of objects
      //     for (let i = 0; i < response.length; i++) {
      //       const trading_symbol = Object.keys(response[i])[0];
      //       const trading_data = response[i][trading_symbol];
      //       //////console.log(trading_symbol);
      //       //////console.log(trading_data);
      //       // Generate the table HTML

      //       $(".indepth_details").eq(i).empty();
      //       $(".indepth_details_offer").eq(i).empty();
      //       $(".main_spot_order").eq(i).empty();

      //       // Generate the table HTML
      //       const table = generateBidTable(trading_data.depth.buy);
      //       const tableOffer = generateOfferTable(trading_data.depth.sell);

      //       const spot_data_order = generateSpotData(trading_data);
      //       // const Offer_table = generateOfferTable(trading_data.depth.buy);

      //       // Append the table to the element with the class 'indepth_details' at the corresponding index
      //       $(".indepth_details").eq(i).append(table);
      //       $(".indepth_details_offer").eq(i).append(tableOffer);
      //       $(".main_spot_order").eq(i).append(spot_data_order);

      //       // Append the table to the element with the class 'indepth_details' at the corresponding index
      //     }
      //   },
      //   error: function (error) {
      //     console.error(error);
      //   },
      // });


    }





    $(".main_updates_price_btn button").click(function () {
      // Select the second <p> tag inside .main_last_price_order

      var priceElements = $(".last_price_order_zerodha");

      // Select all .priceTrade inputs
      var priceTradeInputs = $(".priceTrade");

      // Loop through the .last_price_order_zerodha elements
      priceElements.each(function (index) {
        // Get the text of the current .last_price_order_zerodha element
        var priceText = $(this).text();

        // Set the value of the corresponding .priceTrade input
        priceTradeInputs.eq(index).val(priceText);
      });
    });

    $("#limit_select").change(function () {
      var selectedOption = $(this).val(); // Get the selected option value
      //////console.log(selectedOption);
      // Loop through each .inner_position element
      $(".left_bottom_card_order").each(function (index) {
        var card = $(this);

        // Find the radio buttons inside this .inner_position
        var limitRadio = card.find(`#limitOrder${index}`);
        var marketRadio = card.find(`#marketOrder${index}`);
        //////console.log(limitRadio);
        //////console.log(marketRadio);

        // Depending on the selected option, check/uncheck the radio buttons
        if (selectedOption === "limit") {
          limitRadio.prop("checked", true);
          marketRadio.prop("checked", false);
        } else if (selectedOption === "market") {
          limitRadio.prop("checked", false);
          marketRadio.prop("checked", true);
        }
      });
    });

    // Function to generate the BIDS table HTML
    function generateBidTable(bids) {
      let table = '<table class="table">';
      table +=
        "<thead><tr><th>BIDS</th><th>ORDERS</th><th>QTY</th></tr></thead>";
      table += "<tbody>";

      // Loop through the response array for BIDS
      bids.forEach(function (bid) {
        table += `<tr><td>${bid.price}</td><td class="text-primary">${bid.orders}</td><td class="text-primary">${bid.quantity}</td></tr>`;
      });

      // Calculate and add the total bid quantity row
      const totalBidQuantity = bids.reduce(
        (total, bid) => total + bid.quantity,
        0
      );
      table += `<tr class="text-primary"><td colspan="2">TOTAL</td><td>${totalBidQuantity}</td></tr>`;

      // Close the table body and table
      table += "</tbody></table>";

      return table;
    }
    function generateOfferTable(offers) {
      let table = '<table class="table">';
      table +=
        "<thead><tr><th>OFFERS</th><th>ORDERS</th><th>QTY</th></tr></thead>";
      table += "<tbody>";

      // Loop through the response array for offers
      offers.forEach(function (Offer) {
        table += `<tr><td>${Offer.price}</td><td class="text-danger">${Offer.orders}</td><td class="text-danger">${Offer.quantity}</td></tr>`;
      });

      // Calculate and add the total Offer quantity row
      const totalOfferQuantity = offers.reduce(
        (total, Offer) => total + Offer.quantity,
        0
      );
      table += `<tr class="text-danger"><td colspan="2">TOTAL</td><td>${totalOfferQuantity}</td></tr>`;

      // Close the table body and table
      table += "</tbody></table>";

      return table;
    }

    function generateSpotData(trading_data) {

      //////console.log(trading_data);
      // Extract the data for the first instrument
      const firstInstrument = trading_data;
      const {
        last_price,
        ohlc: { open, high, low, close },
        volume,
        last_quantity,
        average_price,
        timestamp,
        oi,
      } = firstInstrument;







      // Convert the timestamp to a more readable format
      const ltt = new Date(timestamp).toLocaleString();

      // Create the HTML structure with the extracted data
      let main_spot_data = '<div class="inner_main_spot_order">';
      main_spot_data += `
   <div class="spot_main_table">
    <div class='left_spot'>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding: 8px 0;">
            <p>Last Price:</p>
            <p class="last_price_order_zerodha">${last_price.toFixed(2)}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>Open:</p>
            <p>${open}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>High:</p>
            <p>${high}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>Low:</p>
            <p>${low}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>Close:</p>
            <p>${close}</p>
        </div>
    </div>
    <div class='right_spot'>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding: 8px 0;">
            <p>Volume:</p>
            <p>${volume}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>LTQ:</p>
            <p>${last_quantity}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>Avg. Price:</p>
            <p>${average_price}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>LTT:</p>
            <p>${ltt}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>OI:</p>
            <p>${oi}</p>
        </div>
    </div>
</div>


   `;
      main_spot_data += "</div>";

      return main_spot_data;
    }

    $(".check_liquidity").click(function () {
      var All_positionTrade = [];
      var inner_order_modal = $(".inner_order_modal");
      var mis_select = $(".mis_select").val()
      inner_order_modal.each(function (index_order) {
        var order_level = $(this);
        var sell_buy_indicator = order_level.find(".sell_buy_indicator").text();
        var expiry_initial = order_level.find(".expiry_initial").text();
        var tradingsymbol = order_level.find(".tradingsymbol").text();
        var main_trading_symbol = order_level.find(".main_trading_symbol").text();
        var priceTrade = order_level.find(".priceTrade").val();
        var quantityTrade = order_level.find(".quantityTrade").val();
        var strikePrice_order_window = order_level.find(".strikePrice_order_window").text();
        //////console.log(strikePrice_order_window);


        // Check if the radio button is checked
        var isRadioChecked = $(
          `input[name='orderTypeLimit${index_order}']:checked`
        ).val();

        //////console.log(isRadioChecked);

        All_positionTrade.push({
          expiry_initial: expiry_initial,

          sell_buy_indicator: sell_buy_indicator,
          tradingsymbol: tradingsymbol,
          main_trading_symbol: main_trading_symbol,
          strikePrice_order_window: strikePrice_order_window,
          Quantity: quantityTrade,
          price: priceTrade,
          isRadioChecked: isRadioChecked, // Add this property to the object
          mis_select: mis_select
        });
      });
      //////console.log(All_positionTrade);



      $.ajax({
        url: '/market-status/',  // Replace with your Django server URL
        type: 'GET',
        dataType: 'json',
        success: function (data) {

          //////console.log(data);

          const filteredMarket = data.marketState.find(item => item.market === "Capital Market");

          if (filteredMarket.marketStatus === "Open") {

            $(".maket_status").text(filteredMarket.marketStatusMessage);
            $.ajax({
              url: "/check_liquidity",
              type: "POST",
              data: JSON.stringify(All_positionTrade),
              contentType: "application/json",
              success: function (response) {
                //////console.log(response);

                // Initially, assume the button can be enabled

                if (response.broker === "zerodha") {

                  var isButtonDisabled = []

                  var liquidity_failed_msg = []

                  response.main_all_nudges.forEach(function (nudges, i) {
                    //////console.log(nudges.data);

                    // Variable to check if liquidity for this iteration has failed


                    nudges.data.forEach(function (x) {
                      //////console.log(x);

                      if (x && Object.keys(x).length > 0) {
                        $(".liquidity_status").eq(i).empty().append(`
                                      <div class="liquidity_failed">
                                        <div class="liquidity_text">Liquidity :</div>
                                        <div class="badge text-bg-danger">Failed</div>
                                      </div>
                                    `);

                        // Liquidity check failed for this iteration
                        isButtonDisabled.push(false)
                        x.forEach(function (failed_status) {
                          liquidity_failed_msg.push(failed_status.message);

                        })
                      } else {
                        $(".liquidity_status").eq(i).empty().append(`
                                <div class="liquidity_passed">
                                  <div class="liquidity_text">Liquidity :</div>
                                  <div class="badge text-bg-success">Passed</div>
                                  </div>
                                  `);
                        isButtonDisabled.push(true)


                      }
                    });

                    // If liquidity check failed for any iteration, set the flag to true

                  });



                  //////console.log(isButtonDisabled);
                  if (isButtonDisabled.includes(false)) {
                    $(".place_order_btn").prop("disabled", true);
                    $(".main_extented_status_liquidity").empty().removeClass("passed_liquidity").addClass("failed_liquidity").append(`${filteredMarket.marketStatusMessage} : ${liquidity_failed_msg[0]}`)
                  } else {
                    // If all the values are true, set
                    $(".place_order_btn").prop("disabled", false);
                    $(".main_extented_status_liquidity").empty().removeClass("failed_liquidity").addClass("passed_liquidity").append(`${filteredMarket.marketStatusMessage} : All the trade been passed the liquidity test, You can trade now. `)
                  }


                } else {
                  $(".place_order_btn").prop("disabled", false);
                }
                // $(".place_order_btn").prop("disabled", isButtonDisabled);
              },
            });
          } else {
            //////console.log("Market not found.");
            $(".maket_status").text(filteredMarket.marketStatusMessage);

            $(".main_extented_status_liquidity").empty().removeClass("passed_liquidity").addClass("failed_liquidity").append(`${filteredMarket.marketStatusMessage}`)



            $(".check_liquidity").prop("disabled", true)
          }


        },
        error: function (error) {
          //////console.log('Error:', error);
        }
      });






    })




    var OrderId = 1;
    $(".place_order_btn").click(function () {



      $(".main_extented_status_liquidity")
        .empty().removeClass("passed_liquidity failed_liquidity");
      var All_positionTrade = [];
      var inner_order_modal = $(".inner_order_modal");
      var mis_select = $(".mis_select").val()
      inner_order_modal.each(function (index_order) {
        var order_level = $(this);
        var sell_buy_indicator = order_level.find(".sell_buy_indicator").text();
        var tradingsymbol = order_level.find(".tradingsymbol").text();
        var main_trading_symbol = order_level.find(".main_trading_symbol").text();
        var main_instrument_token= order_level.find(".main_instrument_token").text();
        var priceTrade = order_level.find(".priceTrade").val();
        var quantityTrade = order_level.find(".quantityTrade").val();
        var strikePrice_order_window = order_level.find(".strikePrice_order_window").text();
        //////console.log(strikePrice_order_window);


        // Check if the radio button is checked
        var isRadioChecked = $(
          `input[name='orderTypeLimit${index_order}']:checked`
        ).val();

        //////console.log(isRadioChecked);

        All_positionTrade.push({
          orderNumber: OrderId++,
          sell_buy_indicator: sell_buy_indicator,
          tradingsymbol: tradingsymbol,
          main_trading_symbol: main_trading_symbol,
          strikePrice_order_window: strikePrice_order_window,
          Quantity: quantityTrade,
          price: priceTrade,
          isRadioChecked: isRadioChecked, // Add this property to the object
          mis_select: mis_select,
          main_instrument_token: main_instrument_token
        });
      });

      //////console.log(All_positionTrade);
      All_positionTrade.sort((a, b) => parseInt(a.strikePrice_order_window) - parseInt(b.strikePrice_order_window));

      // Sort based on sell_buy_indicator, putting "CE" first
      All_positionTrade.sort((a, b) => a.sell_buy_indicator === "BUY" ? -1 : 1);

      // sendPosition_to_kite(All_positionTrade);
      $.ajax({
        url: "/kite_order_zerodha", // Replace with the actual URL of your Django view
        type: "POST",
        data: JSON.stringify(All_positionTrade),
        contentType: "application/json",
        success: function (response) {
          // //////console.log(response);

          if (response.broker === "zerodha") {

            var order_status = $(".order_status p")
            var inner_order_modal = $(".inner_order_modal")
            //////console.log(response.order_details);


            // Assuming the format is consistent (NIFTY23NOV20050CE)


            response.order_details.sort((a, b) => {
              // Extract the numeric part before "CE" or "PE"
              let partsA = a.tradingsymbol.match(/(\d+)(CE|PE)/);
              let partsB = b.tradingsymbol.match(/(\d+)(CE|PE)/);

              // Extracted numeric parts for comparison
              let numericPartA = partsA ? parseInt(partsA[1]) : 0;
              let numericPartB = partsB ? parseInt(partsB[1]) : 0;

              // First, sort by the extracted numeric part
              const numericPartComparison = numericPartB - numericPartA;

              if (numericPartComparison !== 0) {
                return numericPartComparison;
              }

              // If numeric parts are equal, sort by strikeprice
              const strikePriceComparison = parseInt(b.strikeprice) - parseInt(a.strikeprice);

              if (strikePriceComparison !== 0) {
                return strikePriceComparison;
              }

              // If strike prices are equal, sort by transaction type
              return a.transaction_type === "BUY" ? -1 : 1;
            });















            response.order_details.forEach((order, index) => {
              var order_status_text = order.order_id;

              //////console.log(order_status_text);

              // Check if order_status_text is not an object
              if (typeof order_status_text === 'object') {
                // Run this code block if it's not an object
                inner_order_modal.eq(index).addClass("box_shadow_order_execution_success");
                order_status.eq(index).text(`Order Placed Successfully : Order Id - ${order_status_text.data.order_id}`).addClass("order_success_text");
              } else {
                // If it's an object, proceed with JSON parsing
                var orderObject = JSON.parse(order_status_text);

                if (orderObject.status === "error") {
                  inner_order_modal.eq(index).addClass("box_shadow_order_execution_error");


                  order_status.eq(index).text(orderObject.message.replace(/\s*\[Read more.\].*$/, '')).addClass("order_error_text");
                }
              }
            });
          }
          else if (response.broker === "angel_one") {
            var order_status = $(".order_status p");
            var inner_order_modal = $(".inner_order_modal");

            response.order_details.sort((a, b) => {
              // First, sort by strikeprice
              const strikePriceComparison = parseInt(b.strikeprice) - parseInt(a.strikeprice);

              // If strike prices are equal, sort by transaction type
              if (strikePriceComparison === 0) {
                return a.transactiontype === "BUY" ? -1 : 1;
              }

              return strikePriceComparison;
            });

            response.order_details.forEach((order, index) => {
              //////console.log(order);

              // Check if order_status_text is not an object
              if (order.orderstatus === "rejected") {
                // Run this code block if it's not an object
                inner_order_modal.eq(index).addClass("box_shadow_order_execution_error");
                order_status.eq(index).text(` Order Id - ${order.orderid} ${order.text}`).addClass("order_error_text");
              } else {
                // If it's an object, proceed with JSON parsing
                inner_order_modal.eq(index).addClass("box_shadow_order_execution_success");
                order_status.eq(index).text(`Order Placed Successfully : Order Id - ${order.orderid}`).addClass("order_success_text");
              }
            });
          }else if (response.broker ==="upstocks") {

            var order_status = $(".order_status p");
            var inner_order_modal = $(".inner_order_modal");
            console.log("Upstocks");


            response.order_details.forEach((order, index) => {
              //////console.log(order);

              // Check if order_status_text is not an object
              if (order.status === "rejected") {
                // Run this code block if it's not an object
                inner_order_modal.eq(index).addClass("box_shadow_order_execution_error");
                order_status.eq(index).text(` Order Id - ${order.order_id} ${order.status_message_raw}`).addClass("order_error_text");
              } else {
                // If it's an object, proceed with JSON parsing
                inner_order_modal.eq(index).addClass("box_shadow_order_execution_success");
                order_status.eq(index).text(`Order Placed Successfully : Order Id - ${order.order_id}`).addClass("order_success_text");
              }
            });
          }

          // Handle the response from the Django view if needed


          // Check if there's a success message in the response
          // if (response.message) {
          //   displayAlert(response.message, "success");
          // } else if (response.error) {
          //   // Check if there's an error message in the response
          //   displayAlert(response.error, "error");
          // }

          All_positionTrade = [];
        },
        error: function (error) {
          console.error(error);

          // Display a generic error alert
          displayAlert(
            "An error occurred while processing your request.",
            "error"
          );
        },
      });



    });

    // function sendPosition_to_kite(All_positionTrade) {
    //   //////console.log(All_positionTrade);

    //   // Send the data to the Django view using AJAX
    //   $.ajax({
    //     url: "/kiteOrder", // Replace with the actual URL of your Django view
    //     type: "POST",
    //     data: JSON.stringify(All_positionTrade),
    //     contentType: "application/json",
    //     success: function (response) {
    //       // Handle the response from the Django view if needed
    //       // //////console.log(response);

    //       // Check if there's a success message in the response
    //       if (response.message) {
    //         displayAlert(response.message, "success");
    //       } else if (response.error) {
    //         // Check if there's an error message in the response
    //         displayAlert(response.error, "error");
    //       }

    //       All_positionTrade = [];
    //     },
    //     error: function (error) {
    //       console.error(error);

    //       // Display a generic error alert
    //       displayAlert(
    //         "An error occurred while processing your request.",
    //         "error"
    //       );
    //     },
    //   });
    // }

    function displayAlert(message, type) {
      var alertElement = $(".alert-dismissible");
      alertElement
        .removeClass(type === "error" ? "success_alert" : "error_alert")
        .addClass(type === "error" ? "error_alert" : "success_alert")
        .text(message)
        .css({
          "max-width": "50%", // Set the maximum width
          width: "100%", // Set the width to 100%
          height: "fit-content", // Set the height to auto
          padding: "15px",
          position: "fixed",

          "z-index": "99999999999 !important",
          "border-radius": "5px",
        })
        .fadeIn();

      setTimeout(function () {
        alertElement.fadeOut();
      }, 3000);
    }

    var stockDropdown_edit = $(".stockDropdown").val();
    $("#selectExpiry").change(function () {
      // //////console.log($(this).val());
      get_edit_entry_price(stockDropdown_edit, $(this).val());
    });
    $("#selectStrikePrice").change(function () {
      get_edit_entry_price(stockDropdown_edit, $("#selectExpiry").val());
    });
    $("#optionType").change(function () {
      get_edit_entry_price(stockDropdown_edit, $("#selectExpiry").val());
    });

    function get_edit_entry_price(selectedOption, selectedExpiry) {
      $("#spinner").show();
      $.ajax({
        url:
          '{% url "get_option_strategy_optimizer_option_data" %}?selected_option=' +
          selectedOption +
          "&selected_expiry=" +
          selectedExpiry,
        type: "GET",
        success: function (response) {
          // //////console.log(response.option_data.resultData.opDatas);

          var option_Date = response.option_data.resultData.opDatas;
          Entry_edit(option_Date);

          $("#spinner").hide();
        },
      });
    }

    function Entry_edit(option_Date) {
      var selectStrikePrice = $("#selectStrikePrice").val();
      var optionType = $("#optionType").val();

      for (var i = 0; i < option_Date.length; i++) {
        var strikePrice = option_Date[i].strike_price; // Assuming strike_price is a property of each object in option_Date

        // Compare the current option's strike_price with selectStrikePrice
        if (strikePrice == selectStrikePrice) {
          // Do something when a matching strike_price is found
          if (optionType === "CE") {
            $(".edit_entry ").val(option_Date[i].calls_ltp);
            // //////console.log("Matching strike_price:", option_Date[i].calls_ltp);
          } else {
            // //////console.log("Matching strike_price:", option_Date[i].puts_ltp);
            $(".edit_entry ").val(option_Date[i].puts_ltp);
          }
        }
      }
    }

    $("#future_data").on("click", function () {
      // Set the value in local storage
      var selectedOption = $(".stockDropdown").val();
      localStorage.setItem("future_symbol", selectedOption);

      // Open a new tab and navigate to "stock_future"
      window.open("stock_future", "_blank");
    });
    $(".option_chain_strategies").on("click", function () {
      // Set the value in local storage
      var selectedOption = $(".stockDropdown").val();
      localStorage.setItem("symbol_Option_chain", selectedOption);

      // Open a new tab and navigate to "stock_future"
      window.open("stock_option_chain", "_blank");
    });

    $("#option_strategy_reset").click(function () {
      $(".straddle ").removeClass("option_strategies_active");

      $("#resultTable tbody,#table-PL,.option_oi_charts,#chartdiv,.payoff_table_data").hide()


      $(".main_position,.main_all_profit_loss,.main_bottom_strategy_positions").hide()

      $(".main_build_custom_strategy_empty").css("display", "flex")
      $("#customRange2").hide()
      $('#taget_date_table').hide()

      greeks = 1;
      p_l = 1;


      var selectedOption = $(".stockDropdown").val();


      $("#resultTable tbody,#table-PL,.option_oi_charts,#chartdiv,.payoff_table_data").hide()


      $(".main_position,.main_all_profit_loss,.main_bottom_strategy_positions").hide()

      $(".main_build_custom_strategy_empty").css("display", "flex")

      $("#table-PL").empty();
      $(".main_position").empty();
      $(".payoff_table_data").empty();
      $(".payoff_table_main_table").empty();
      $(".main_position").empty();
      $("#resultTable tbody").empty();

      // loadOptionData(selectedOption, "");
      // loadExpiryData(selectedOption);
      // checkMainPositionContent();
    });

    function hideIronFlyModal() {
      $("#ironFly_modal").hide();
    }

    // Function to hide the Straddle modal
    function hideStraddleModal() {
      $("#straddle_modal").hide();
    }

    // Function to hide the Strangle modal
    function hideStrangleModal() {
      $("#strangle_modal").hide();
    }

    // Function to hide the Spread modal
    function hideSpreadModal() {
      $("#spread_modal").hide();
    }
    function hideironCondorModal() {
      $("#ironCondor_modal").hide();
    }
    function hidejaze_lizardModal() {
      $("#jaze_lizard_modal").hide();
    }
    function hide_double_iron_fly_Modal() {
      $("#double_iron_fly_modal").hide();
    }
    function hide_double_iron_condor_Modal() {
      $("#double_iron_condor_modal").hide();
    }
    function hide_iron_butterfly() {
      $("#put_butterfly_modal").hide();
    }
    function hide_call_butterfly() {
      $("#call_butter_fly_modal").hide();
    }
    function hide_nifty_custom_strategy() {
      $("#custom_strategy_modal").hide();
    }

    // Click event on the document body
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#custom_strategy_modal").length &&
        !$(e.target).is("#custom_strategy")
      ) {
        hide_nifty_custom_strategy();
      }
    });
    // Click event on the document body
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#call_butter_fly_modal").length &&
        !$(e.target).is("#call_butter_fly")
      ) {
        hide_call_butterfly();
      }
    });

    // Click event on the document body
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#put_butterfly_modal").length &&
        !$(e.target).is("#put_butter_fly")
      ) {
        hide_iron_butterfly();
      }
    });



    // Click event on the document body
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#double_iron_condor_modal").length &&
        !$(e.target).is("#double_iron_condor")
      ) {
        hide_double_iron_condor_Modal();
      }
    });



    // Click event on the document body
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#double_iron_fly_modal").length &&
        !$(e.target).is("#double_iron_fly")
      ) {
        hide_double_iron_fly_Modal();
      }
    });




    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#jaze_lizard_modal").length &&
        !$(e.target).is("#jaze_lizard")
      ) {
        hidejaze_lizardModal();
      }
    });



    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#ironCondor_modal").length &&
        !$(e.target).is("#iron_condor")
      ) {
        hideironCondorModal();
      }
    });
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#ironFly_modal").length &&
        !$(e.target).is("#iron_fly")
      ) {
        hideIronFlyModal();
      }
    });
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#straddle_modal").length &&
        !$(e.target).is("#straddle")
      ) {
        hideStraddleModal();
      }
    });
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#strangle_modal").length &&
        !$(e.target).is("#strangle")
      ) {
        hideStrangleModal();
      }
    });
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#spread_modal").length &&
        !$(e.target).is("#spread")
      ) {
        hideSpreadModal();
      }
    });



    var expiryDateStraddle = $("#expiryDate_straddle");
    var optionExpiryDropdown = $("#optionExpiryDropdown");

    expiryDateStraddle.on("change", function () {
      var selectedValue_straddle = $(this).val();
      // //////console.log(selectedValue_straddle);

      // Set the value of optionExpiryDropdown to match the selected value
      optionExpiryDropdown.val(selectedValue_straddle).change();

      // Trigger a click event on the selected option
    });

    $("#straddle").click(function () {
      $("#straddle_modal").show();
      $("#strangle_modal").hide();
      $("#spread_modal").hide();
      $("#ironFly_modal").hide();
      $("#ironCondor_modal").hide();

      var closest_strike_price = $("#closest_strike_price");
      var strikeSelect_straddle = $("#strikeSelect_straddle");

      strikeSelect_straddle.find("option").each(function () {
        // Get the value of the current option
        var optionValue = $(this).val();

        // Check if the option value matches the value of closest_strike_price
        if (optionValue === closest_strike_price.text()) {
          // Add the 'selected' attribute to the matching option
          $(this).prop("selected", true);
        }
      });

      var closen_expiry_date = $("#closen_expiry_date");
      var expiryDate_straddle = $("#expiryDate_straddle");
      expiryDate_straddle.find("option").each(function () {
        var expiryvalue = $(this).val();

        if (expiryvalue === closen_expiry_date.text()) {
          $(this).prop("selected", true);
        }
      });

      var latestStrikePrice = $("#strikeSelect_straddle").val(); // Parse as a float


      // //////console.log(latestStrikePrice);
    });

    $(".dismiss_icon").click(function () {
      $("#straddle_modal").hide();
      $("#strangle_modal").hide();
      $("#spread_modal").hide();
      $("#ironFly_modal").hide();
      $("#ironCondor_modal").hide();
      $("#jaze_lizard_modal").hide();
      $("#double_iron_fly_modal").hide();
      $("#double_iron_condor_modal").hide();
      $("#put_butterfly_modal").hide();
      $("#call_butter_fly_modal").hide();
      $("#custom_strategy_modal").hide();
    });
    $(".long_straddle").addClass("straddle_active");
    $(".long_straddle").click(function () {
      $(this).addClass("straddle_active");
      $(".short_straddle").removeClass("straddle_active");
    });
    $(".short_straddle").click(function () {
      $(this).addClass("straddle_active");
      $(".long_straddle").removeClass("straddle_active");
    });

    // Set the initial value

    var counterValue_future = 1;

    // Function to update the input field with the current value
    function updateCounterInput_future() {
      $("#futures_counter_input").val(counterValue_future);
    }

    // Initialize the input field
    updateCounterInput_future();

    // Increment button click handler
    $("#future_increment").click(function () {

      counterValue_future++;
      updateCounterInput_future();
    });

    // Decrement button click handler
    $("#future_decrement").click(function () {
      if (counterValue_future > 1) {
        counterValue_future--;
        updateCounterInput_future();
      }
    });







    var counterValue = 1;

    // Function to update the input field with the current value
    function updateCounterInput() {
      $("#counter_input").val(counterValue);
    }

    // Initialize the input field
    updateCounterInput();

    // Increment button click handler
    $("#increment").click(function () {
      counterValue++;
      updateCounterInput();
    });

    // Decrement button click handler
    $("#decrement").click(function () {
      if (counterValue > 1) {
        counterValue--;
        updateCounterInput();
      }
    });

    // -----Strangle Counter----

    var counterValue_strangle = 1;

    // Function to update the input field with the current value
    function updateCounterInput_strangle() {
      $("#counter_input_strangle").val(counterValue_strangle);
      $("#put_stangle_lot_size").text(counterValue_strangle);
      $("#call_stangle_lot_size").text(counterValue_strangle);
    }

    // Initialize the input field
    updateCounterInput_strangle();

    // Increment button click handler
    $("#increment_strangle").click(function () {
      counterValue_strangle++;
      updateCounterInput_strangle();
    });

    // Decrement button click handler
    $("#decrement_strangle").click(function () {
      if (counterValue_strangle > 1) {
        counterValue_strangle--;
        updateCounterInput_strangle();
      }
    });

    // -----End Strangle Counter----

    //----------Spread Counter-------------

    var counterValue_spread = 1;

    // Function to update the input field with the current value
    function updateCounterInput_spread() {
      $("#counter_input_spread").val(counterValue_spread);
      $("#put_spread_lot_size").text(counterValue_spread);
      $("#call_spread_lot_size").text(counterValue_spread);
    }

    // Initialize the input field
    updateCounterInput_spread();

    // Increment button click handler
    $("#increment_spread").click(function () {
      counterValue_spread++;
      updateCounterInput_spread();
    });

    // Decrement button click handler
    $("#decrement_spread").click(function () {
      if (counterValue_spread > 1) {
        counterValue_spread--;
        updateCounterInput_spread();
      }
    });

    //----------End Spread Counter-------------

    //---------Iron Fly------------------------

    var counterValue_iron_fly = 1;

    // Function to update the input field with the current value
    function updateCounterInput_iron_fly() {
      $("#counter_input_ironFly").val(counterValue_iron_fly);
      $("#put_ironFly_lot_size").text(counterValue_iron_fly);
      $("#put_call_ironFly_lot_size").text(counterValue_iron_fly);
      $("#call_ironFly_lot_size").text(counterValue_iron_fly);
    }

    // Initialize the input field
    updateCounterInput_iron_fly();

    // Increment button click handler
    $("#increment_ironFly").click(function () {
      counterValue_iron_fly++;
      updateCounterInput_iron_fly();
    });

    // Decrement button click handler
    $("#decrement_ironFly").click(function () {
      if (counterValue_iron_fly > 1) {
        counterValue_iron_fly--;
        updateCounterInput_iron_fly();
      }
    });

    //---------End Iron Fly------------------------

    //----------Iron Condor----------------

    var counterValue_ironCondor = 1;

    // Function to update the input field with the current value
    function updateCounterInput_ironCondor() {
      $("#counter_input_ironCondor").val(counterValue_ironCondor);
      $("#put_ironCondor_lot_size").text(counterValue_ironCondor);
      $("#put_2nd_ironCondor_lot_size").text(counterValue_ironCondor);
      $("#call_ironCondor_lot_size").text(counterValue_ironCondor);
      $("#call_2nd_ironCondor_lot_size").text(counterValue_ironCondor);
    }

    // Initialize the input field
    updateCounterInput_ironCondor();

    // Increment button click handler
    $("#increment_ironCondor").click(function () {
      counterValue_ironCondor++;
      updateCounterInput_ironCondor();
    });

    // Decrement button click handler
    $("#decrement_ironCondor").click(function () {
      if (counterValue_ironCondor > 1) {
        counterValue_ironCondor--;
        updateCounterInput_ironCondor();
      }
    });
    //----------End Iron Condor----------------



    //---------Jaz Lizard---------------

    var counterValue_jaze_lizard = 1;

    // Function to update the input field with the current value
    function updateCounterInput_jaze_lizard() {
      $("#counter_input_jaze_lizard").val(counterValue_jaze_lizard);
      $("#put_jaze_lizard_lot_size").text(counterValue_jaze_lizard);
      $("#call_2nd_jaze_lizard_lot_size").text(counterValue_jaze_lizard);
      $("#call_jaze_lizard_lot_size").text(counterValue_jaze_lizard);
    }

    // Initialize the input field
    updateCounterInput_jaze_lizard();

    // Increment button click handler
    $("#increment_jaze_lizard").click(function () {
      counterValue_jaze_lizard++;
      updateCounterInput_jaze_lizard();
    });

    // Decrement button click handler
    $("#decrement_jaze_lizard").click(function () {
      if (counterValue_jaze_lizard > 1) {
        counterValue_jaze_lizard--;
        updateCounterInput_jaze_lizard();
      }
    });
    //----------End Jaze Lizard----------------






    //---------Double IronFly--------------

    var counterValue_double_iron_fly = 1;

    // Function to update the input field with the current value


    function updateCounterInput_double_iron_fly() {
      $("#counter_input_double_iron_fly").val(counterValue_double_iron_fly);
      $("#put_strike_eight_hundred_iron_fly_lot_size").text(counterValue_double_iron_fly);
      $("#call_2nd_double_iron_fly_lot_size").text(counterValue_double_iron_fly);
      $("#call_spot_double_iron_fly_lot_size").text(counterValue_double_iron_fly);

      $("#put_positive_four_hundred_double_iron_fly_lot_size").text(counterValue_double_iron_fly);
      $("#call_put_positive_eight_hundred_double_iron_fly_lot_size").text(counterValue_double_iron_fly);
      $("#call_twelve_hundred_positive_double_iron_fly_lot_size").text(counterValue_double_iron_fly);
    }

    // Initialize the input field
    updateCounterInput_double_iron_fly();

    // Increment button click handler
    $("#increment_double_iron_fly").click(function () {
      counterValue_double_iron_fly++;
      updateCounterInput_double_iron_fly();
    });

    // Decrement button click handler
    $("#decrement_double_iron_fly").click(function () {
      if (counterValue_double_iron_fly > 1) {
        counterValue_double_iron_fly--;
        updateCounterInput_double_iron_fly();
      }
    });
    //----------End Double IronFly----------------








    //---------Double IronCondor-------------

    var counterValue_double_iron_condor = 1;

    // Function to update the input field with the current value


    function updateCounterInput_double_iron_condor() {
      $("#counter_input_double_iron_condor").val(counterValue_double_iron_condor);

      $("#put_spot_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#put_negative_fifty_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#put_negative_two_hundred_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#negative_three_hundred_fifty_double_iron_condor_lot_size").text(counterValue_double_iron_condor);

      $("#call_positive_three_hundred_fifty_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#call_positive_five_hundred_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#call_positive_six_hundred_fifty_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#call_positive_eight_hundred_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
    }

    // Initialize the input field
    updateCounterInput_double_iron_condor();

    // Increment button click handler
    $("#increment_double_iron_condor").click(function () {
      counterValue_double_iron_condor++;
      updateCounterInput_double_iron_condor();
    });

    // Decrement button click handler
    $("#decrement_double_iron_condor").click(function () {
      if (counterValue_double_iron_condor > 1) {
        counterValue_double_iron_condor--;
        updateCounterInput_double_iron_condor();
      }
    });
    //----------End Double IronCondor---------------




    //---------Put butterfly-------------

    var counterValue_put_buttterfly = 1;

    // Function to update the input field with the current value


    function updateCounterInput_put_buttterfly() {
      $("#counter_input_put_butterfly").val(counterValue_put_buttterfly);

      $("#put_negative_nine_hundred_fifty_butterfly_lot_size").text(counterValue_put_buttterfly);
      $("#five_hundred_put_call_butterfly_lot_size").text(counterValue_put_buttterfly);
      $("#put_negative_fifty_put_butterfly_lot_size").text(counterValue_put_buttterfly);



    }

    // Initialize the input field
    updateCounterInput_put_buttterfly();

    // Increment button click handler
    $("#increment_put_butterfly").click(function () {
      counterValue_put_buttterfly++;
      updateCounterInput_put_buttterfly();
    });

    // Decrement button click handler
    $("#decrement_put_butterfly").click(function () {
      if (counterValue_put_buttterfly > 1) {
        counterValue_put_buttterfly--;
        updateCounterInput_put_buttterfly();
      }
    });
    //----------End Put butterfly---------------



    //---------Put butterfly-------------

    var counterValue_call_butterfly = 1;

    // Function to update the input field with the current value


    function updateCounterInput_call_butterfly() {
      $("#counter_input_call_butter_fly").val(counterValue_call_butterfly);

      $("#put_positive_fifty_butterfly_lot_size").text(counterValue_call_butterfly);
      $("#four_hundred_put_call_butterfly_lot_size").text(counterValue_call_butterfly);
      $("#positive_seven_hundred_fifty_call_butter_fly_lot_size").text(counterValue_call_butterfly);



    }

    // Initialize the input field
    updateCounterInput_call_butterfly();

    // Increment button click handler
    $("#increment_call_butter_fly").click(function () {
      counterValue_call_butterfly++;
      updateCounterInput_call_butterfly();
    });

    // Decrement button click handler
    $("#decrement_call_butter_fly").click(function () {
      if (counterValue_call_butterfly > 1) {
        counterValue_call_butterfly--;
        updateCounterInput_call_butterfly();
      }
    });
    //----------End Put butterfly---------------



    //---------nifty custom strategy-------------

    var counterValue_nifty_custom_strategy = 1;

    // Function to update the input field with the current value


    function updateCounter_nifty_custom_strategy() {
      $("#counter_input_custom_strategy").val(counterValue_nifty_custom_strategy);


      // $("#call_two_hundered_buy_custom_strategy_lot_size").text(counterValue_nifty_custom_strategy);

      // $("#call_negative_two_hundred_buy_custom_strategy_lot_size").text(counterValue_nifty_custom_strategy);

      $("#put_call_negative_one_hundred_sell_custom_strategy_lot_size").text(counterValue_nifty_custom_strategy);

      $("#put_call_negative_fifty_hundred_sell_custom_strategy_lot_size").text(counterValue_nifty_custom_strategy);

      $("#put_call_spot_sell_custom_strategy_lot_size").text(counterValue_nifty_custom_strategy);

      $("#put_call_positive_fifty_sell_custom_strategy_lot_size").text(counterValue_nifty_custom_strategy);

      $("#put_call_positive_one_hundred_sell_custom_strategy_lot_size").text(counterValue_nifty_custom_strategy);





    }

    // Initialize the input field
    updateCounter_nifty_custom_strategy();

    // Increment button click handler
    $("#increment_custom_strategy").click(function () {
      counterValue_nifty_custom_strategy++;
      updateCounter_nifty_custom_strategy();
    });

    // Decrement button click handler
    $("#decrement_custom_strategy").click(function () {
      if (counterValue_nifty_custom_strategy > 1) {
        counterValue_nifty_custom_strategy--;
        updateCounter_nifty_custom_strategy();
      }
    });
    //----------End nifty custom strategy---------------





















    $("#table-PL_main").hide();
    $("#resultTable").hide();
    $("#oi-charts").hide();
    $("#real_adjustment_table").hide();
    $(".targets_table").hide();
    $(".stoploss_table").hide();
    $(".alerts_table").hide();
    $(".history_table").hide();
    $("#payoff_table").hide();

    $("#payoff_charts").show();

    $(".strategy_cost_table").click(function () {
      $("#table-PL_main").show();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".greek_table,.oi_chart,.payoff_charts,.adjustment,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });

    $(".payoff_table").click(function () {
      




      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").show();
      $(this).addClass("greek_strategy_active");
      $(".greek_table,.oi_chart,.payoff_charts,.adjustment,.targets,.stoploss,.alerts,.history,.strategy_cost_table").removeClass("greek_strategy_active");
    });







    $(".greek_table").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").show();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".strategy_cost_table, .oi_chart,.payoff_charts,.adjustment,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });


    $(".oi_chart").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").show();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".strategy_cost_table, .greek_table,.payoff_charts,.adjustment,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });
    $(".adjustment").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#oi-charts").hide();
      $("#real_adjustment_table").show();
      $("#payoff_charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".strategy_cost_table, .greek_table,.payoff_charts, .oi_chart,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });


    $(".payoff_charts").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#oi-charts").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").show();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".strategy_cost_table, .greek_table, .oi_chart, .adjustment,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });


    $(".targets").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").show();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".greek_table, .oi_chart, .payoff_charts, .adjustment,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });

    $(".stoploss").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").show();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".greek_table, .oi_chart, .payoff_charts, .adjustment,.targets,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });

    $(".alerts").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").show();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".greek_table, .oi_chart, .payoff_charts, .adjustment,.targets,.stoploss,.history,.payoff_table").removeClass("greek_strategy_active");
    });

    $(".history").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $("#payoff_table").hide();
      $(".history_table").show();
      $(this).addClass("greek_strategy_active");
      $(".greek_table, .oi_chart, .payoff_charts, .adjustment,.targets,.stoploss,.alerts,.payoff_table").removeClass("greek_strategy_active");
    });













    // After adding data row
    // Function to update empty message visibility based on data rows
    function updateEmptyMessageVisibility() {
      var numRows = $(".data-display-table tr.data-row").length;
      if (numRows === 0) {
        $(".empty_message").show();
      } else {
        $(".empty_message").hide();
      }
    }

    // After removing a data row, update the empty message visibility
    updateEmptyMessageVisibility();

    $("#saveChangesButton").click(function () {
      // Find the parent element containing the .edit_entry input
      var closest_edit_data = $(this).closest(".modal-content");

      // Navigate to .edit_entry input within the parent element
      var selectExpiry = closest_edit_data.find("#selectExpiry").val();
      var futures_expiry = closest_edit_data.find(".futures_expiry").val();
      var selectStrikePrice = closest_edit_data
        .find("#selectStrikePrice")
        .val();
      var options_futures_uniques = closest_edit_data
        .find("#options_futures_uniques")
        .val();
      var optionType = closest_edit_data.find("#optionType").val();

      // Navigate to the checked radio button within the parent element


      ////console.log(selectedLongShort);

      // Get the value of the counter_input_edit
      var counter_input_edit = closest_edit_data
        .find(".counter_input_edit")
        .val();

      // Get the value of the .edit_entry input
      var editEntryValue = closest_edit_data.find(".edit_entry").val();

      // Get the value of the .exit_price input
      var exit_price = closest_edit_data.find(".exit_price").val();

      // Log all the values
      // //////console.log("selectExpiry:", selectExpiry);
      // //////console.log("selectStrikePrice:", selectStrikePrice);
      // //////console.log("optionType:", optionType);
      // //////console.log("selectedLongShort:", selectedLongShort);
      // //////console.log("counter_input_edit:", counter_input_edit);
      // //////console.log("editEntryValue:", editEntryValue);
      // //////console.log("exit_price:", exit_price);
      var modal = $("#editPositionModal");
      var position = modal.data("position");


      var parsedDate = new Date(selectExpiry);


      var day = parsedDate.getDate().toString().padStart(2, "0");
      var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
      var year = parsedDate.getFullYear();
      var formattedDate_initial = day + "-" + month + "-" + year;

      function formatDate(inputDate) {
        const dateParts = inputDate.split("-"); // Split the input date by hyphen
        const day = dateParts[0]; // Extract day
        const month = dateParts[1]; // Extract month
        const year = dateParts[2]; // Extract year

        // Create an array of month abbreviations
        const monthAbbreviations = [
          "JAN",
          "FEB",
          "MAR",
          "APR",
          "MAY",
          "JUN",
          "JUL",
          "AUG",
          "SEP",
          "OCT",
          "NOV",
          "DEC",
        ];

        // Get the abbreviated month using the month value as an index
        const abbreviatedMonth = monthAbbreviations[parseInt(month) - 1];

        // Create the formatted date string
        const formattedDate = `${day}${abbreviatedMonth}${year}`;

        return formattedDate;
      }

      const inputDate = formattedDate_initial;
      const formattedDate = formatDate(inputDate);

      position.find(".expiry_initial").text(selectExpiry);

      position.find(".option_lot_size_input").text(counter_input_edit);



      if (options_futures_uniques === "OPT") {

        var checkedRadio = closest_edit_data.find(
          ".Long_short input[type='radio']:checked"
        );

        var selectedLongShort = checkedRadio.val();




        var long_short_val = "";
        if (selectedLongShort === "Short") {
          long_short_val = "-";
          position.find(".buy_sell_indicator_options_futures").removeClass("bg_indicator_buy").addClass("bg_indicator_sell").text("S")

        } else {
          long_short_val = "+";
          position.find(".buy_sell_indicator_options_futures").removeClass("bg_indicator_sell").addClass("bg_indicator_buy").text("B")
        }
        position.find(".long_short_inner").text(long_short_val);

        var parsedDate = new Date(selectExpiry);


        var day = parsedDate.getDate().toString().padStart(2, "0");
        var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
        var year = parsedDate.getFullYear();
        var formattedDate_initial = day + "-" + month + "-" + year;

        function formatDate(inputDate) {
          const dateParts = inputDate.split("-"); // Split the input date by hyphen
          const day = dateParts[0]; // Extract day
          const month = dateParts[1]; // Extract month
          const year = dateParts[2]; // Extract year

          // Create an array of month abbreviations
          const monthAbbreviations = [
            "JAN",
            "FEB",
            "MAR",
            "APR",
            "MAY",
            "JUN",
            "JUL",
            "AUG",
            "SEP",
            "OCT",
            "NOV",
            "DEC",
          ];

          // Get the abbreviated month using the month value as an index
          const abbreviatedMonth = monthAbbreviations[parseInt(month) - 1];

          // Create the formatted date string
          const formattedDate = `${day}${abbreviatedMonth}${year}`;

          return formattedDate;
        }

        const inputDate = formattedDate_initial;
        const formattedDate = formatDate(inputDate);


        position.find(".strikePrice").text(selectStrikePrice);
        position.find(".expiry_initial").text(selectExpiry);
        position.find(".expiry").text(formattedDate);

      } else {


        var secondChild = closest_edit_data.find(
          ".Long_short_future input[type='radio']:checked"
        );


        // Get the value of the checked radio button
        var selectedLongShort = secondChild.val();



        var long_short_val = "";
        if (selectedLongShort === "Short") {
          long_short_val = "-";
          position.find(".buy_sell_indicator_options_futures").removeClass("bg_indicator_buy").addClass("bg_indicator_sell").text("S")

        } else {
          long_short_val = "+";
          position.find(".buy_sell_indicator_options_futures").removeClass("bg_indicator_sell").addClass("bg_indicator_buy").text("B")
        }
        position.find(".long_short_inner").text(long_short_val);


        var parsedDate = new Date(futures_expiry);
        var day = parsedDate.getDate().toString().padStart(2, "0");
        var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
        var year = parsedDate.getFullYear();
        var formattedDate_initial = day + "-" + month + "-" + year;

        function formatDate(inputDate) {
          const dateParts = inputDate.split("-"); // Split the input date by hyphen
          const day = dateParts[0]; // Extract day
          const month = dateParts[1]; // Extract month
          const year = dateParts[2]; // Extract year

          // Create an array of month abbreviations
          const monthAbbreviations = [
            "JAN",
            "FEB",
            "MAR",
            "APR",
            "MAY",
            "JUN",
            "JUL",
            "AUG",
            "SEP",
            "OCT",
            "NOV",
            "DEC",
          ];

          // Get the abbreviated month using the month value as an index
          const abbreviatedMonth = monthAbbreviations[parseInt(month) - 1];

          // Create the formatted date string
          const formattedDate = `${day}${abbreviatedMonth}${year}`;

          return formattedDate;
        }

        const inputDate = formattedDate_initial;
        const formattedDate = formatDate(inputDate);
        position.find(".strikePrice").text(editEntryValue);
        position.find(".expiry_initial").text(futures_expiry);
        position.find(".expiry").text(formattedDate);
      }

      if (optionType === "CE") {
        position.find(".call_put_entrance").text("CE");

      } else if (optionType === "PE") {
        position.find(".call_put_entrance").text("PE");

      } else {
        position.find(".call_put_entrance").text("FUTURE");

      }
      position.find(".entryPrice").text(editEntryValue);
      if (exit_price > 0) {
        position
          .find(".exit_indicator")
          .removeClass("green-option-indicator")
          .addClass("red-option-indicator");
      } else {
        position
          .find(".exit_indicator")
          .removeClass("red-option-indicator")
          .addClass("green-option-indicator");
      }
      position.find(".current_price").text(exit_price);

      calculate_data();
      Table_chart_pyoff()
      margin_calculations()
    });
    // Load spot data for "NIFTY" initially


    function calculate_data() {
      var selectedOption = $(".stockDropdown").val();
      $("#spinner").show();
      // //////console.log("ca=" + selectedOption);
      loadExpiryData(selectedOption);

      var All_positions = $(".main_position").find(
        ".main_add_position_actions"
      );
      var allData = [];
      var conditionOrder = 1;
      All_positions.each(function () {
        var row = $(this);
        var optionSide = row.find(".call_put_entrance").text();

        var expiryDate = row.find(".expiry_initial").text();

        var strikePrice = row.find(".strikePrice").text();

        var long_short_inner = row.find(".long_short_inner").text();

        var action = "";

        if (long_short_inner === "-") {
          action = "Short";
        } else {
          action = "Long";
        }

        // var optionSide_main = "";
        // if (optionSide == "CE") {
        //   optionSide_main = "Call";
        // } else {
        //   optionSide_main = "Put";
        // }
        var optionSide_main = "";
        if (optionSide === "CE") {
          optionSide_main = "Call";
        } else if (optionSide === "PE") {
          optionSide_main = "Put";
        } else {
          optionSide_main = "Future";
        }

        var quantity = row.find(".option_lot_size_input").text();
        var ltpValue = row.find(".entryPrice").text();

        var option_lot_size = $("#lot_size_value").text();
        var main_conditionOrder = conditionOrder++;

        var childrenLength = $(".main_position").children().length;
        // //////console.log('childrenLength', childrenLength);

        if (parseInt(childrenLength) < 1) {
          // //////console.log("hii there zero");
          $("#spinner").hide();
          return false;
        } else {
          allData.push({
            selectedOption: selectedOption,
            optionSide: optionSide_main,
            option_lot_size: option_lot_size,
            expiryDate: expiryDate,
            strikePrice: strikePrice,
            action: action,
            quantity: parseInt(quantity),
            conditionOrder: main_conditionOrder,
            ltpValue: ltpValue,
          });
        }
      });

      get_position_data_from_django(allData);
      ////console.log("AllData", allData);
      $("#spinner").show();
    }



    function get_position_data_from_django(allData) {
      $("#spinner").show();
      $.ajax({
        type: "POST",
        url: "/filter_iv_data",
        data: JSON.stringify(allData),
        contentType: "application/json",
        success: function (response) {
          // //////console.log("Data sent to Django:", response);
          // //////console.log(response.stock_data.resultData);

          // Clear previous table data
          $("#table-PL").empty();

          $("#resultTable tbody").empty();

          // Process response data and populate the table
          const resultData = response.iv_data.resultData;
          let totalDelta = 0;
          let totalTheta = 0;
          let totalGamma = 0;
          let totalVega = 0;
          let totalRho = 0;
          let leg = 1;
          var greeks = 1;
          var p_l = 1;



          for (const item of resultData) {
            const optionType = item.optiontype;
            const symbol = item.symbol;
            const strikePrice = item.strikeprice;
            const expiry = item.expiry;
            const position = item.position;
            const iv = item.calls_iv || item.puts_iv;

            // //////console.log('optionType' + optionType);

            const delta =
              optionType === "Call" ? item.call_delta : item.put_delta;
            const theta =
              optionType === "Call" ? item.call_theta : item.put_theta;
            const gamma =
              optionType === "Call" ? item.call_gamma : item.put_gamma;
            const vega = optionType === "Call" ? item.call_vega : item.put_vega;
            const rho = optionType === "Call" ? item.call_rho : item.put_rho;
            var parsedDate = new Date(expiry);
            var day = parsedDate.getDate().toString().padStart(2, "0");
            var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
            var year = parsedDate.getFullYear();
            var formattedDate_initial = day + "-" + month + "-" + year;

            function formatDate(inputDate) {
              const dateParts = inputDate.split("-"); // Split the input date by hyphen
              const day = dateParts[0]; // Extract day
              const month = dateParts[1]; // Extract month
              const year = dateParts[2]; // Extract year

              // Create an array of month abbreviations
              const monthAbbreviations = [
                "JAN",
                "FEB",
                "MAR",
                "APR",
                "MAY",
                "JUN",
                "JUL",
                "AUG",
                "SEP",
                "OCT",
                "NOV",
                "DEC",
              ];

              // Get the abbreviated month using the month value as an index
              const abbreviatedMonth = monthAbbreviations[parseInt(month) - 1];

              // Create the formatted date string
              const formattedDate = `${day}${abbreviatedMonth}${year}`;

              return formattedDate;
            }

            const inputDate = formattedDate_initial;
            const formattedDate = formatDate(inputDate);
            const absoluteQuantity = Math.abs(item.quantity);
            // //////console.log(formattedDate); // Output: "14SEP"
            var stockDropdown = $(".stockDropdown").val();
            // Create the table row for each option

            const tableRow = `
                                        <tr id=${greeks++}>
                                            <td>
                                                                    <div class="greeks_position d-flex gap-1">
                                            <div class="main_short_long_lot_size">
                                            <div class="short_long"><span class="long_short_inner">${position === "Long" ? "+" : "-"
              }</span></div> <div class="option_lot_size_input">${absoluteQuantity}</div>x
                                        </div>
                                        <div class="symbol_expiry"><span class="symbol">${stockDropdown}</span><span class="expiry">${formattedDate}</span></div>
                                        <div class="strike_price_call_put"> <span class="strikePrice">${parseFloat(
                strikePrice
              )}</span><span class="call_put_entrance">${optionType === "Call" ? "CE" : (optionType === "Put" ? "PE" : "FUTURE")
              }</span>
</div> </div></td>
                                        
                                            <td><div class="greeks_iv">${iv !== null ? iv.toFixed(2) : 0
              }</div></td>
                                            <td><div class="greeks_delta">${delta !== null
                ? delta.toFixed(2)
                : 0
              }</div></td>
                                            <td><div class="greeks_theta">${theta !== null
                ? theta.toFixed(4)
                : 0
              }</div></td>
                                            <td><div class="greeks_gamma">${gamma !== null
                ? gamma.toFixed(4)
                : 0
              } </div></td>
                                            <td ><div class="greeks_vega">${vega !== null
                ? vega.toFixed(2)
                : 0
              }</div></td>
                                            <td><div class="greeks_rho">${rho !== null ? rho.toFixed(2) : 0
              }</div></td>
                                        </tr>
                

                        `;

            $("#resultTable tbody").append(tableRow);

            // Calculate positional Greeks
            totalDelta += parseFloat(delta) || 0;
            totalTheta += parseFloat(theta) || 0;
            totalGamma += parseFloat(gamma) || 0;
            totalVega += parseFloat(vega) || 0;
            totalRho += parseFloat(rho) || 0;

          }

          // Add the row for positional Greeks
          const totalRow = `
                                                                    <tr>
                                                                        <td>POSITIONAL GREEKS</td>
                                                                    
                                                                        <td></td>
                                                                        <td>${totalDelta !==
              null
              ? totalDelta.toFixed(
                2
              )
              : 0
            }</td>
                                                                        <td>${totalTheta !==
              null
              ? totalTheta.toFixed(
                4
              )
              : 0
            }</td>
                                                                        <td>${totalGamma !==
              null
              ? totalGamma.toFixed(
                4
              )
              : 0
            }</td>
                                                                        <td>${totalVega !==
              null
              ? totalVega.toFixed(
                2
              )
              : 0
            }</td>
                                                                        <td>${totalRho !==
              null
              ? totalRho.toFixed(
                2
              )
              : 0
            }</td>
                                                                    </tr>
                                                                `;

          $("#resultTable tbody").append(totalRow);

          const updatedResultData = response.stock_data.resultData.map(
            (item, index) => {
              // Find the current_price element within the corresponding .main_add_position_actions
              const ltpValue = $(".main_add_position_actions")
                .eq(index)
                .find(".current_price")
                .text();

              // Initialize parsedLtpValue to ltpValue (assuming it contains a numeric value)
              let parsedLtpValue = parseFloat(ltpValue);

              // Check if parsedLtpValue is 0 and if item.unitPrice is available
              if (parsedLtpValue === 0 && item.unitPrice) {
                // If ltpValue is 0, set parsedLtpValue to item.unitPrice
                parsedLtpValue = item.unitPrice;
              }

              // Log the values for debugging
              // //////console.log('ltpValue', ltpValue);
              // //////console.log('parsedLtpValue', parsedLtpValue);
              // //////console.log('item.unitPrice', item.unitPrice);

              // Return an object with ltpValue and item.unitPrice added
              return { ...item, ltpValue: parsedLtpValue };
            }
          );

          // //////console.log(updatedResultData);

          function createTable(data) {
            let tableHTML = "";

            let netCost = 0;
            let netPL = 0;

            let shortCount = 0;
            let longCount = 0;

            // Loop through the data to count short and long positions
            for (const item of data) {
              const shortMatches = item.position.match(/Short/gi);
              const longMatches = item.position.match(/Long/gi);

              if (shortMatches) {
                shortCount += shortMatches.length;
              }

              if (longMatches) {
                longCount += longMatches.length;
              }
            }
            let maxStrikePrice = Number.NEGATIVE_INFINITY;
            let minStrikePrice = Number.POSITIVE_INFINITY;
            // Determine the position label based on the majority
            const positionLabel = shortCount > longCount ? "SHORT" : "LONG";
            let totalStrikePrice = 0;
            let itemCount = 0;
            let premiumPain = 0;

            var All_positions = $(".main_position").find(
              ".main_add_position_actions"
            );
            for (let i = 0; i < data.length; i++) {
              const item = data[i];

              // //////console.log(item.ltpValue);
              var All_positions = $(".main_position").find(
                ".main_add_position_actions"
              );
              All_positions.each(function (index) {
                var row = $(this);
                var item = data[index]; // Get the corresponding data item
                var unitPrice = item.unitPrice; // Get the unitPrice from the data
                // row.find(".entryPrice").text(unitPrice);
              });

              // Adjust lotSize based on position
              const adjustedLotSize =
                item.position.toLowerCase() === "short"
                  ? -item.lotSize
                  : item.lotSize;
              const absoluteQuantity = Math.abs(item.quantity);
              const totalCurrentCost =
                item.unitPrice * adjustedLotSize * absoluteQuantity;
              const totalPL =
                item.ltpValue * adjustedLotSize * absoluteQuantity;
              var final_P_L = totalPL - totalCurrentCost;

              maxStrikePrice = Math.max(maxStrikePrice, item.strikePrice);
              minStrikePrice = Math.min(minStrikePrice, item.strikePrice);

              var parsedDate = new Date(item.expiry);
              var day = parsedDate.getDate().toString().padStart(2, "0");
              var month = (parsedDate.getMonth() + 1)
                .toString()
                .padStart(2, "0");
              var year = parsedDate.getFullYear();
              var formattedDate_initial = day + "-" + month + "-" + year;

              function formatDate(inputDate) {
                const dateParts = inputDate.split("-"); // Split the input date by hyphen
                const day = dateParts[0]; // Extract day
                const month = dateParts[1]; // Extract month
                const year = dateParts[2]; // Extract year

                // Create an array of month abbreviations
                const monthAbbreviations = [
                  "JAN",
                  "FEB",
                  "MAR",
                  "APR",
                  "MAY",
                  "JUN",
                  "JUL",
                  "AUG",
                  "SEP",
                  "OCT",
                  "NOV",
                  "DEC",
                ];

                // Get the abbreviated month using the month value as an index
                const abbreviatedMonth =
                  monthAbbreviations[parseInt(month) - 1];

                // Create the formatted date string
                const formattedDate = `${day}${abbreviatedMonth}${year}`;

                return formattedDate;
              }

              const inputDate = formattedDate_initial;
              const formattedDate = formatDate(inputDate);

              // //////console.log(formattedDate); // Output: "14SEP"
              var stockDropdown = $(".stockDropdown").val();

              const legRow = `
                                                                <tr id=${p_l++}>
                                                                    <td>
                                                                    <div class="p_l_position d-flex gap-1">
                                            <div class="main_short_long_lot_size">
                                            <div class="short_long"><span class="long_short_inner">${item.position === "Long"
                  ? "+"
                  : "-"
                }</span></div> <div class="option_lot_size_input">${absoluteQuantity}</div>x
                                        </div>
                                        <div class="symbol_expiry"><span class="symbol">${stockDropdown}</span><span class="expiry">${formattedDate}</span></div>
                                        <div class="strike_price_call_put"> <span class="strikePrice">${parseFloat(
                  item.strikePrice
                )}</span><span class="call_put_entrance">${item.optionType === "Call" ? "CE" : (item.optionType === "Put" ? "PE" : "FUTURE")
                }</span>
</div> </div></td>
                                                                   
                                                                    <td><div class="ltpValue">${item.ltpValue
                }</div></td>
                                                                    <td><div class="unitPrice">${item.unitPrice
                }</div></td>
                                                                    <td><div class="adjsutedLotSize">${adjustedLotSize}</div></td>
                                                                    <td><div class="absoluteQuantity">${absoluteQuantity}</div></td>
                                                                    <td><div class="totalCurrentCost ${totalCurrentCost > 0 ? "text-success" : "text-danger"}">${totalCurrentCost.toFixed(
                  2
                )}</div></td>
                                                                    <td class="text-center"><div class="final_P_L">${final_P_L}</div></td>
                                                                </tr>
                                                            `;
              const $exitPriceElements = $(".exit_price");
              if ($exitPriceElements.length > i) {
                $($exitPriceElements[i]).empty().text(final_P_L);
              }
              tableHTML += legRow;

              netCost += parseFloat(totalCurrentCost.toFixed(2));
              netPL += parseFloat(final_P_L);

              totalStrikePrice += parseFloat(item.strikePrice);
              itemCount++;
              premiumPain += parseFloat(item.unitPrice);
            }

            // //////console.log(totalStrikePrice);
            const averageStrikePrice = totalStrikePrice / itemCount;
            // //////console.log("Average of the :" + averageStrikePrice);
            // //////console.log(positionLabel);
            var min_breakPoints = averageStrikePrice - premiumPain;
            var max_breakPoints = averageStrikePrice + premiumPain;

            var Put_position_label =
              positionLabel == "SHORT"
                ? Math.abs(netCost + -netPL)
                : "Unlimited";
            var long_position_label =
              positionLabel == "LONG"
                ? Math.abs(netCost + -netPL)
                : "Unlimited";
            var Put_position_display =
              positionLabel == "SHORT" ? "d-block" : "d-none";
            var long_position_display =
              positionLabel == "LONG" ? "d-block" : "d-none";

            var strategyBuilder = localStorage.getItem("strategy_builder");

            var previousStrikePrice = null;
            var previousEntryPrice = null;
            var lot_size_value_strategy = parseInt($("#lot_size_value").text());
            var max_profit_strategy = null;

            var strike_price_diff = null;
            var long_short_final = [];
            $(".inner_position").each(function () {
              var strikePrice = parseFloat($(this).find(".strikePrice").text());
              var longShortInner = $(this).find(".long_short_inner").text();

              var entryPrice = parseFloat($(this).find(".entryPrice").text());

              if (longShortInner === "-") {
                long_short_final.push(-Math.abs(entryPrice));
              } else {
                long_short_final.push(Math.abs(entryPrice));
              }
              // //////console.log(long_short_final);
              if (previousStrikePrice !== null) {
                var strikePriceDifference = strikePrice - previousStrikePrice;
                strike_price_diff = strikePriceDifference;
                // //////console.log(
                //   "Difference in Strike Price: " + strikePriceDifference
                // );
              }
              if (previousEntryPrice !== null) {
                var entryPriceDifference = entryPrice + previousEntryPrice;
                max_profit_strategy = entryPriceDifference;
                // //////console.log("max_profit_strategy", max_profit_strategy);

                // //////console.log(
                //   "Difference in Entry Price: " + entryPriceDifference
                // );
              }

              previousStrikePrice = strikePrice;
              previousEntryPrice = entryPrice;
            });

            var sum = long_short_final.reduce((total, num) => total + num, 0);

            // //////console.log("Sum of long_short_final array:", sum);

            var final_max_profit = Math.abs(
              sum * lot_size_value_strategy
            ).toFixed(2);
            var final_max_looss = (
              (strike_price_diff + sum) *
              lot_size_value_strategy
            ).toFixed(2);

            // if (strategyBuilder === "straddle") {
            //   $("#max_profit").text(Put_position_label);
            //   $("#max_loss").text(long_position_label);
            //   $("#ratio").text("No defined");
            // } else if (strategyBuilder === "strangle") {
            //   $("#max_profit").text(Put_position_label);
            //   $("#max_loss").text(long_position_label);
            //   $("#ratio").text("No defined");
            // } else if (strategyBuilder === "spread") {
            //   $("#max_profit").text(final_max_profit);
            //   $("#max_loss").text(final_max_looss);
            //   $("#ratio").text((final_max_profit / final_max_looss).toFixed(2));
            // } else if (strategyBuilder === "iron_fly") {
            //   $("#max_profit").text(final_max_profit);
            //   $("#max_loss").text(final_max_looss);
            //   $("#ratio").text((final_max_profit / final_max_looss).toFixed(2));
            // } else if (strategyBuilder === "iron_condor") {
            //   $("#max_profit").text(final_max_profit);
            //   $("#max_loss").text(final_max_looss);
            //   $("#ratio").text((final_max_profit / final_max_looss).toFixed(2));
            // } else if (strategyBuilder === "jaze_lizard") {
            //   $("#max_profit").text(final_max_profit);
            //   $("#max_loss").text("Unlimited");
            //   $("#ratio").text("No defined");
            // }

            $("#break_evens").text(`${minStrikePrice}~${maxStrikePrice}`);
            tableHTML += `
                                                                <tr>
                                                                    <td colspan="5">NET COST OF STRATEGY :</td>
                                                                    <td class="${netCost < 0 ? "text-danger" : "text-success"}">${netCost}</td>
                                                                    <td colspan="6" class="text-center">${netPL}</td>
                                                                
                                                                </tr>
                                                            
                                                            `;

            return tableHTML;
          }

          const tableBody = document.getElementById("table-PL");
          tableBody.innerHTML = createTable(updatedResultData);
          $("#spinner").hide();
        },
        error: function (xhr, status, error) {
          // console.error("Error sending data to Django:", error);
        },
      });
      $("#spinner").hide();
    }



    var Oi_chart = null;




    function OI_charts(all_callsOI_putsOI) {
      am4core.ready(function () {
        if (Oi_chart) {
          Oi_chart.dispose();
        }

        // Create chart instance
        var chart = am4core.create("oi_charts", am4charts.XYChart);
        Oi_chart = chart; // Store the chart instance

        var referenceStrikePrice = parseInt($("#closest_strike_price").text());

        var chartData = all_callsOI_putsOI.map(function (data, index) {
          return {
            category: data.strikePrice,
            calls_oi: data.calls_oi,
            puts_oi: data.puts_oi,
          };
        });

        // Add data
        chart.data = chartData;

        // Find the index of the closest value
        var closestIndex = chartData.findIndex(function (item) {
          return item.category === referenceStrikePrice;
        });

        // Create axes
        var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
        categoryAxis.dataFields.category = "category";
        categoryAxis.renderer.grid.template.location = 0;
        categoryAxis.renderer.minGridDistance = 80;
        chart.logo.disabled = true;

        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
        valueAxis.renderer.minGridDistance = 30;

        // Create series
        function createSeries(field, name, color) {
          var series = chart.series.push(new am4charts.ColumnSeries());
          series.dataFields.valueY = field;
          series.dataFields.categoryX = "category";
          series.name = name;
          series.columns.template.tooltipText = "{category}: {name}: [bold]{valueY}[/]";
          series.columns.template.width = am4core.percent(80);
          series.columns.template.strokeWidth = 0;

          // Set the color for the series
          if (color === "red") {
            series.columns.template.fill = am4core.color("#F96C92");
          } else if (color === "green") {
            series.columns.template.fill = am4core.color("#2196F3");
          }
        }

        createSeries("calls_oi", "Calls OI", "green");
        createSeries("puts_oi", "Puts OI", "red");

        // Add legend
        chart.legend = new am4charts.Legend();

        // Add cursor for zooming
        var cursor = new am4charts.XYCursor();
        cursor.behavior = "zoomX"; // Enable zooming along the X-axis
        chart.cursor = cursor;

        // Set initial zoom
        chart.events.on("ready", function () {
          chart.xAxes.getIndex(0).zoomToIndexes(Math.max(0, closestIndex - 10), Math.min(chartData.length - 1, closestIndex + 10));
        });

        // ...
        // ...
        // ...
      });
    }





    // Handle stock dropdown change
    $(".stockDropdown").change(function () {
      var selectedOption = $(this).val();
      var selectedExpiry = $("#optionExpiryDropdown").val();

      $(".stockDropdown").val(selectedOption);

      loadSpotData(selectedOption);



      loadExpiryData(selectedOption);
      loadOptionData(selectedOption, "");



      $("#resultTable tbody,#table-PL,.option_oi_charts,#chartdiv,.payoff_table_data").hide()


      $(".main_position,.main_all_profit_loss,.main_bottom_strategy_positions").hide()

      $(".main_build_custom_strategy_empty").css("display", "flex")

      $(".straddle").removeClass("option_strategies_active")
      $("#customRange2").hide()
      $('#taget_date_table').hide()


      $(".main_position").empty();

      $("#resultTable tbody").empty();


      $("#table-PL").empty();
      $("#resultTable tbody").empty();
      $(".strike_price_input").empty();
      $(".expiry_date_input").empty();

    });

    //         setInterval(function() {
    //     loadSpotData($(".stockDropdown").val());
    // }, 5000);

    // Function to load spot data
    function loadSpotData(selectedOption) {
      // //////console.log(selectedOption);

      $.ajax({
        url:
          '{% url "get_option_strategy_optimizer_spot_data" %}?selected_option=' +
          selectedOption,
        type: "GET",
        success: function (response) {
          // Handle the response as needed
          // //////console.log(response.spot_data.resultData);
          $("#max_pain_value").text(response.spot_data.resultData.max_pain);
          $("#lot_size_value").text(response.spot_data.resultData.lot_size);
          $("#open_value").text(response.spot_data.resultData.open);
          $("#low_value").text(response.spot_data.resultData.low);
          $("#high_value").text(response.spot_data.resultData.high);
          $("#high52_value").text(response.spot_data.resultData.high52);
          $("#low52_value").text(response.spot_data.resultData.low52);
          var spot_check_strategies = response.spot_data.resultData.change_per;
          var valid_spot_value_strategies =
            spot_check_strategies > 0 ? "text-success" : "text-danger";
          var arrow_valid = spot_check_strategies > 0 ? "up" : "down";
          $("#last_traded_price").empty().append(`
                        <div class="${valid_spot_value_strategies} d-flex align-items-center gap-1">
                            <p class="last_traded_price">${response.spot_data.resultData.last_trade_price}</p>
                            <i class='bx bxs-${arrow_valid}-arrow' id="spot_arrow"></i>
                            <p>${response.spot_data.resultData.change_value}(${response.spot_data.resultData.change_per})</p>
                            
                            </div>
                        `);
        },
      });
    }


    $("#optionExpiryDropdown").change(function () {
      var selectedOption = $(".stockDropdown").val();
      var selectedExpiry = $("#optionExpiryDropdown").val();

      var selectedOptionExpiry = $(this).val();

      if (selectedOption) {
        loadOptionData(selectedOption, selectedOptionExpiry);
        loadExpiryData(selectedOption);
      }
    });

    function loadOptionData(selectedOption, selectedExpiry) {
      $.ajax({
        url:
          '{% url "get_option_strategy_optimizer_option_data" %}?selected_option=' +
          selectedOption +
          "&selected_expiry=" +
          selectedExpiry,
        type: "GET",
        success: function (response) {
          //////console.log(response.option_data);
          var optionExpiryDropdown = $("#optionExpiryDropdown");
          optionExpiryDropdown.empty();
          $.each(
            response.option_data.resultData.opExpiryDates,
            function (index, expiryDate) {
              // Split the date and format it
              var dateParts = expiryDate.split("T")[0].split("-");
              var formattedDate =
                dateParts[2] + "-" + dateParts[1] + "-" + dateParts[0];

              // Create the option element
              var option = $("<option>")
                .text(formattedDate)
                .val(expiryDate.split("T")[0]);

              // //////console.log(formattedDate);
              // //////console.log(expiryDate.split("T")[0]);

              // Append the option to the dropdown
              optionExpiryDropdown.append(option);
            }
          );

          if (selectedExpiry) {
            $("#optionExpiryDropdown").val(selectedExpiry);





          }


          getDate_on_date()




          var option_chain_data = response.option_data.resultData.opDatas;
          // //////console.log(option_chain_data[0]);
          // //////console.log($("#optionExpiryDropdown").val());
          var option_expiry_date = $("#optionExpiryDropdown").val();
          var lot_size_value_option = $("#lot_size_value").text();
          // //////console.log(lot_size_value_option);
          // //////console.log(selectedOption);

          // //////console.log(selectedExpiry)

          var optionChainTable = $(".strategy_option_chain");
          var strategy_option_chain_oi = $(".strategy_option_chain_oi");
          var strategy_option_chain_greeks = $(".strategy_option_chain_greeks");
          strategy_option_chain_greeks.empty();
          strategy_option_chain_oi.empty();
          optionChainTable.empty();

          var spot_strike_price = $(".last_traded_price").text();

          var closestStrikePrice = null;
          var closestDiff = Number.MAX_VALUE;
          var all_callsOI_putsOI = []
          let maxCallsOI = -Infinity;
          let minCallsOI = Infinity;
          let maxPutsOI = -Infinity;
          let minPutsOI = Infinity;
          const maxCallsOIWidth = 100; // Set your desired maximum width for calls_oi
          const maxPutsOIWidth = 100; // Set your desired maximum width for puts_oi

          $.each(response.option_data.resultData.opDatas, function (index, optionChain) {

            // Update maximum and minimum values for calls_oi
            maxCallsOI = Math.max(maxCallsOI, optionChain.calls_oi);
            minCallsOI = Math.min(minCallsOI, optionChain.calls_oi);
            maxPutsOI = Math.max(maxPutsOI, optionChain.puts_oi);
            minPutsOI = Math.min(minPutsOI, optionChain.puts_oi);

            var strike_price = parseFloat(optionChain.strike_price);
            var diff = Math.abs(spot_strike_price - strike_price);

            if (diff < closestDiff) {
              closestDiff = diff;
              closestStrikePrice = strike_price;
            }

            var strike_price_background_down =
              strike_price < parseFloat(spot_strike_price) ? "bg_option_for" : "";
            var strike_price_background_up =
              strike_price > parseFloat(spot_strike_price) ? "bg_option_for" : "";

            // Check if denominators are not zero to avoid NaN
            const callsOIDenominator = maxCallsOI - minCallsOI !== 0 ? maxCallsOI - minCallsOI : 1;
            const callsOIDynamicWidth = `${Math.max(1, Math.min(100, ((optionChain.calls_oi - minCallsOI) / callsOIDenominator) * 100))}%`;

            // Calculate dynamic width in percentage for puts_oi
            const putsOIDenominator = maxPutsOI - minPutsOI !== 0 ? maxPutsOI - minPutsOI : 1;
            const putsOIDynamicWidth = `${Math.max(1, Math.min(100, ((optionChain.puts_oi - minPutsOI) / putsOIDenominator) * 100))}%`;
            const callsOI = optionChain.calls_oi
            const callsChangeOI = optionChain.calls_change_oi
            const putsOI = optionChain.puts_oi
            const putsChangeOI = optionChain.puts_change_oi
            // Calculate Call OI (Chg%)
            const callOIChangePercentage = ((callsChangeOI / (callsOI === 0 ? 1 : callsOI)) * 100).toFixed(2);

            // Calculate Put OI (Chg%)
            const putOIChangePercentage = ((putsChangeOI / (putsOI === 0 ? 1 : putsOI)) * 100).toFixed(2);

            var rowContent = `
        <tr class="call_put_tr  main_option_chain">
            <td class="text-end ${strike_price_background_down} calls_iv">${optionChain.calls_iv}</td>
            <td class="text-end oi_calls ${strike_price_background_down}">   
              <div class="main_calls_oi_option">
                
                <div style="width:${callsOIDynamicWidth}" class="dynamic-width-bg calls-oi"></div>
                <div style="z-index:9"> ${optionChain.calls_oi}</div>
                </div>

              
              </td>
            <td class="text-end call-ltp cursor-pointer  position-relative ${strike_price_background_down}">
                <div class="d-flex position-absolute top-0 call-pul-ltp-btns d-none call-row">
                    <button id="Auto_calls_short_click" title="Short" data-action="Short" data-side="call" type="button" data-f&o="option" class="px-lg-3 py-lg-1 mx-1 bg-light-green put_call_btns common-border shadow-none fs-13 fw-600 btn btn-primary">S</button>
                    <button id="Auto_calls_long_click" title="Long" data-action="Long" data-side="call" type="button" data-f&o="option" class="px-lg-3 py-lg-1 mx-1 bg-light-red put_call_btns  shadow-none fs-13 fw-600 btn btn-primary">B</button>
                </div>
                <p class="calls_ltp text-start" style="z-index=9999">${optionChain.calls_ltp}</p>
          
            </td>
            <td class="text-center strikePrice_main_bg bg-light text-dark">
                <div class='strike_price'>${optionChain.strike_price}</div>
                <div class=d-none>
                    <div class="expiry_date">${option_expiry_date}</div>
                    <div class="opiton_lot_size">${lot_size_value_option}</div>
                    <div class="opiton_selected">${selectedOption}</div>
                </div>
            </td>
            <td class="text-start put-ltp cursor-pointer  position-relative ${strike_price_background_up}">
                <p class="puts_ltp text-start" style="z-index=9999">${optionChain.puts_ltp}</p>
           
                <div class="d-flex position-absolute top-0 call-pul-ltp-btns  d-none" id="put_call_put">
                    <button id="Auto_puts_short_click" title="Short" type="button" data-action="Short" data-side="put" data-f&o="option" class="px-lg-3 py-lg-1 mx-1 bg-light-green put_call_btns common-border shadow-none fs-13 fw-600 btn btn-primary">S</button>
                    <button id="Auto_puts_long_click" title="Long" data-action="Long" data-side="put" type="button" data-f&o="option" class="px-lg-3 bg-light-red put_call_btns py-lg-1 mx-1  shadow-none fs-13 fw-600 btn btn-primary">B</button>
                </div>
            </td>
            <td class="text-start  oi_puts ${strike_price_background_up}">     <div style="width:${putsOIDynamicWidth}" class="dynamic-width-bg puts-oi">${optionChain.puts_oi}</div></td>
            <td class="text-start ${strike_price_background_up} puts_iv">${optionChain.puts_iv}</td>
        </tr>
    `;

            var oi_content = `
        <tr class="call_put_tr">
            <td class="text-start ${strike_price_background_down}">       <p>${callOIChangePercentage}</p></td>

            <td class="text-end call-ltp cursor-pointer  position-relative ${strike_price_background_down}">
                <div class="d-flex position-absolute top-0 call-pul-ltp-btns d-none call-row" style="z-index:99">
                    <button id="Auto_calls_short_click" title="Short" data-action="Short" data-side="call" type="button" data-f&o="option"  class="px-lg-3 py-lg-1 mx-1 bg-light-green put_call_btns common-border shadow-none fs-13 fw-600 btn btn-primary">S</button>
                    <button id="Auto_calls_long_click" title="Long" data-action="Long" data-side="call" type="button" data-f&o="option" class="px-lg-3 py-lg-1 mx-1 bg-light-red put_call_btns  shadow-none fs-13 fw-600 btn btn-primary">B</button>
                </div>
                <p class="calls_ltp text-start d-none" style="z-index=9999">${optionChain.calls_ltp}</p>
                <div class="main_calls_oi_option">
                
                <div style="width:${callsOIDynamicWidth}" class="dynamic-width-bg calls-oi"></div>
                <div style="z-index:9"> ${optionChain.calls_oi}</div>
                </div>
          
            </td>
            <td class="text-center strikePrice_main_bg bg-light text-dark">
                <div class='strike_price'>${optionChain.strike_price}</div>
                <div class=d-none>
                    <div class="expiry_date">${option_expiry_date}</div>
                    <div class="opiton_lot_size">${lot_size_value_option}</div>
                    <div class="opiton_selected">${selectedOption}</div>
                </div>
            </td>
            <td class="text-start put-ltp cursor-pointer  position-relative ${strike_price_background_up}">
                <p class="puts_ltp text-start d-none" style="z-index=9999">${optionChain.puts_ltp}</p>
                <div style="width:${putsOIDynamicWidth}" class="dynamic-width-bg puts-oi">${optionChain.puts_oi}</div>
        
           
                <div class="d-flex position-absolute top-0 call-pul-ltp-btns  d-none" id="put_call_put">
                    <button id="Auto_puts_short_click" title="Short" type="button" data-action="Short" data-side="put" data-f&o="option" class="px-lg-3 py-lg-1 mx-1 bg-light-green put_call_btns common-border shadow-none fs-13 fw-600 btn btn-primary">S</button>
                    <button id="Auto_puts_long_click" title="Long" data-action="Long" data-side="put" type="button" data-f&o="option" class="px-lg-3 bg-light-red put_call_btns py-lg-1 mx-1  shadow-none fs-13 fw-600 btn btn-primary">B</button>
                </div>
            </td>

       <td class="${strike_price_background_up} text-end">     <p>${putOIChangePercentage}</p></td>
        </tr>
    `;
            var greeks_content = `
        <tr class="call_put_tr">
            <td class="text-start ${strike_price_background_down}">       <p>${optionChain.call_delta}</p></td>

            <td class="text-end call-ltp cursor-pointer  position-relative ${strike_price_background_down}">
                <div class="d-flex position-absolute top-0 call-pul-ltp-btns d-none call-row" style="z-index:99">
                    <button id="Auto_calls_short_click" title="Short" data-action="Short" data-side="call" type="button" data-f&o="option" class="px-lg-3 py-lg-1 mx-1 bg-light-green put_call_btns common-border shadow-none fs-13 fw-600 btn btn-primary">S</button>
                    <button id="Auto_calls_long_click" title="Long" data-action="Long" data-side="call" type="button" data-f&o="option" class="px-lg-3 py-lg-1 mx-1 bg-light-red put_call_btns  shadow-none fs-13 fw-600 btn btn-primary">B</button>
                </div>
                <p class="calls_ltp text-start d-none" style="z-index=9999">${optionChain.calls_ltp}</p>
 
                <div style="z-index:9"> ${optionChain.calls_iv}</div>

          
            </td>
            <td class="text-center strikePrice_main_bg bg-light text-dark">
                <div class='strike_price'>${optionChain.strike_price}</div>
                <div class=d-none>
                    <div class="expiry_date">${option_expiry_date}</div>
                    <div class="opiton_lot_size">${lot_size_value_option}</div>
                    <div class="opiton_selected">${selectedOption}</div>
                </div>
            </td>

            <td class="text-start put-ltp cursor-pointer  position-relative ${strike_price_background_up}">
                <p class="puts_ltp text-start d-none" style="z-index=9999">${optionChain.puts_ltp}</p>
                <div >${optionChain.calls_iv}</div>
        
           
                <div class="d-flex position-absolute top-0 call-pul-ltp-btns  d-none" id="put_call_put">
                    <button id="Auto_puts_short_click" title="Short" type="button" data-action="Short" data-side="put" data-f&o="option" class="px-lg-3 py-lg-1 mx-1 bg-light-green put_call_btns common-border shadow-none fs-13 fw-600 btn btn-primary">S</button>
                    <button id="Auto_puts_long_click" title="Long" data-action="Long" data-side="put" type="button" data-f&o="option" class="px-lg-3 bg-light-red put_call_btns py-lg-1 mx-1  shadow-none fs-13 fw-600 btn btn-primary">B</button>
                </div>
            </td>

       <td class="${strike_price_background_up} text-end">     <p>${optionChain.put_delta}</p></td>
       <td class="${strike_price_background_up} text-end">     <p>${optionChain.put_theta}</p></td>
       <td class="${strike_price_background_up} text-end">     <p>${optionChain.put_vega}</p></td>
       <td class="${strike_price_background_up} text-end">     <p>${optionChain.put_gamma}</p></td>
        </tr>
    `;



            all_callsOI_putsOI.push({ "calls_oi": optionChain.calls_oi, "puts_oi": optionChain.puts_oi, "strikePrice": optionChain.strike_price })
            optionChainTable.append(rowContent);
            strategy_option_chain_oi.append(oi_content);
            strategy_option_chain_greeks.append(greeks_content);
          });

          // //////console.log("Nearest Strike Price:", closestStrikePrice);
          $("#closest_strike_price").text(closestStrikePrice);
          // //////console.log(all_callsOI_putsOI);

          OI_charts(all_callsOI_putsOI)

          $(".call_put_tr").each(function () {
            var $strikePrice = $(this).find(".strike_price");
            var currentStrikePrice = parseInt($strikePrice.text()); // Assuming the text is numeric

            if (currentStrikePrice === closestStrikePrice) {
              $(this).addClass("background_opiton_closest");
              $(this).find("td").removeClass("bg_option_for");
              $(this).find("td").addClass("text-light");
              $(this).find(".strikePrice_main_bg").removeClass('bg-light').addClass("background_opiton_closest");
              $(this).find(".oi_calls").removeClass("text-light")


              // $strikePrice.addClass("closestStrike_bg");
              var container = $(".main_option_chain_table,.main_option_oi,.main_option_greeks");
              var scrollTo =
                $(this).position().top -
                container.height() / 2 +
                $(this).height() / 2;
              // //////console.log("scrollTo",scrollTo);

              // Reset the scroll position first
              $(".main_option_chain_table,.main_option_oi,.main_option_greeks").animate(
                {
                  scrollTop: 0,
                },
                0,
                function () {
                  // Scroll to the desired position after the reset
                  $(".main_option_chain_table,.main_option_oi,.main_option_greeks").animate(
                    {
                      scrollTop: scrollTo,
                    },
                    1000
                  ); // You can adjust the scrolling speed here (in milliseconds)
                }
              );
            }
          });


          $(".right_side_top_strategies ,#buid_custom_strategy_btn").click(
            function () {
              $(".main_option_chain_table").show()
              $(".main_option_oi").hide()
              $(".main_option_greeks").hide()
              $("#buid_custom_strategy_btn").click()
              $(".call_put_tr").each(function () {
                var $strikePrice = $(this).find(".strike_price");
                var currentStrikePrice = parseInt($strikePrice.text()); // Assuming the text is numeric

                if (currentStrikePrice === closestStrikePrice) {
                  $(this).addClass("background_opiton_closest");
                  $(this).find("td").removeClass("bg_option_for");
                  $(this).find("td").addClass("text-light");
                  $(this).find(".strikePrice_main_bg").removeClass('bg-light').addClass("background_opiton_closest");


                  // $strikePrice.addClass("closestStrike_bg");
                  var container = $(".main_option_chain_table,.main_option_oi,.main_option_greeks");
                  var scrollTo =
                    $(this).position().top -
                    container.height() / 2 +
                    $(this).height() / 2;

                  // Reset the scroll position first
                  $(".main_option_chain_table,.main_option_oi,.main_option_greeks").animate(
                    {
                      scrollTop: 0,
                    },
                    0,
                    function () {
                      // Scroll to the desired position after the reset
                      $(".main_option_chain_table,.main_option_oi,.main_option_greeks").animate(
                        {
                          scrollTop: scrollTo,
                        },
                        1000
                      ); // You can adjust the scrolling speed here (in milliseconds)
                    }
                  );
                }
              });
            }
          );

          var strikeSelect_straddle_val = $("#strikeSelect_straddle");

          strikeSelect_straddle_val.on("change", function () {
            var selectedValue = $(this).val();
            $("#closest_strike_price").text(selectedValue);
          });
          var expiryDate_straddle = $("#expiryDate_straddle");
          expiryDate_straddle.on("change", function () {
            var selectedValue = $(this).val();
            $("#closen_expiry_date").text(selectedValue);
          });

          function selectStrategy(filter_arg_strategy) {
            if (filter_arg_strategy === "straddle") {
              var latestStrikePrice = $("#strikeSelect_straddle").val(); // Parse as a float
              // //////console.log(latestStrikePrice);
              $("#closest_strike_price").text(latestStrikePrice);
              var expirySelect = $(".expiry_date_input");
              var strikeSelect = $(".strike_price_input");

              expirySelect.empty();
              strikeSelect.empty();
              var closest_strike_price = $("#closest_strike_price");
              strikeSelect.find("option").each(function () {
                // Log the value of the current option
                // //////console.log($(this).val());
              });

              $("#straddle").addClass("option_strategies_active");
              $("#strangle").removeClass("option_strategies_active");
              $("#iron_fly").removeClass("option_strategies_active");
              $("#spread").removeClass("option_strategies_active");
              $("#iron_condor").removeClass("option_strategies_active");
              $("#jaze_lizard").removeClass("option_strategies_active");
              $("#double_iron_fly").removeClass("option_strategies_active");
              $("#double_iron_condor").removeClass("option_strategies_active");
              $("#call_butter_fly").removeClass("option_strategies_active");

              $("#put_butter_fly").removeClass("option_strategies_active");


              $(".data-display-table").empty();
              $("#table-PL").empty();
              $("#resultTable tbody").empty();
              $(".inner_p_l_greeks").show();
              $(".main_position").empty();

              var counter_input = $("#counter_input").val();
              $(".option_lot_size_input").each(function () {
                $(this).val(counter_input);
              });

              // Delay execution to ensure elements are loaded

              optionChainTable.find(".strike_price").each(function () {
                var rowStrikePrice = parseFloat($(this).text());

                if (rowStrikePrice === parseFloat(latestStrikePrice)) {
                  // Click on buttons with IDs "#Auto_calls_short_click" and "#Auto_puts_short_click"
                  $(this)
                    .closest(".call_put_tr")
                    .find("#Auto_calls_short_click, #Auto_puts_short_click")
                    .data("HI1", "HI1There")
                    .click();

                  // Get the value of "#counter_input"
                  var counterInputValue = $("#counter_input").val();

                  // Set the value of ".option_lot_size_input" elements to "#counter_input" value
                  $(".option_lot_size_input").val(counterInputValue);
                  $(".option_lot_size_input").text(counterInputValue);

                  // Trigger the click event for the element with ID "#calculate"
                  localStorage.setItem("strategy_builder", "straddle");
                  calculate_data();
                }
              });

              // Hide the element with ID "#straddle_modal"
              Table_chart_pyoff()
              // margin_calculations()
              $("#straddle_modal").hide();
            }
            else if (filter_arg_strategy === "strangle") {
              $("#straddle_modal").hide();
              $("#strangle_modal").show();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the previous 5 strike prices
              var prev5 = [];
              for (var i = currentIndex - 1; i >= 0 && prev5.length < 5; i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  prev5.push(rowStrikePrice);
                }
              }


              // Calculate the next 5 strike prices
              var forw5 = [];
              for (
                var j = currentIndex + 1;
                j < strikePrices.length && forw5.length < 5;
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  forw5.push(rowStrikePrice);
                }
              }

              $("#call_strikeSelect_strangle")
                .find("option")
                .each(function () {
                  var optionValue_call = parseFloat($(this).val());
                  var lastPrevValue_call = parseFloat(forw5[forw5.length - 1]);

                  if (optionValue_call === lastPrevValue_call) {
                    // //////console.log(optionValue_call, lastPrevValue_call);
                    $(this).prop("selected", true);
                  }
                });

              $("#put_strikeSelect_strangle")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());
                  var lastPrevValue = parseFloat(prev5[prev5.length - 1]);

                  if (optionValue === lastPrevValue) {
                    // //////console.log(optionValue, lastPrevValue);
                    $(this).prop("selected", true);
                  }
                });


              var expiryDate_strangle = $("#expiryDate_strangle");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_strangle.on("change", function () {
                var selectedValue_straddle = $(this).val();
                // //////console.log(selectedValue_straddle);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_straddle).change();

                // Trigger a click event on the selected option
              });

              // //////console.log("Previous 5 Strike Prices:", prev5);
              // //////console.log("Next 5 Strike Prices:", forw5);

              $("#shortStrangle").click(function () {
                // Empty the specified elements before making any selection

                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").addClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();

                // Delay the rest of the code execution for a brief moment to ensure elements are fully emptied

                var put_strikeSelect_strangle = $(
                  "#put_strikeSelect_strangle"
                ).val();
                var call_strikeSelect_strangle = $(
                  "#call_strikeSelect_strangle"
                ).val();

                if (put_strikeSelect_strangle) {
                  // Find the closest row for lastIndexPrev and click on Auto_puts_short_click


                  // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                  var closestRowForw = optionChainTable
                    .find(
                      ".strike_price:contains(" +
                      call_strikeSelect_strangle +
                      ")"
                    )
                    .closest(".call_put_tr");
                  if (closestRowForw.length) {
                    closestRowForw
                      .find("#Auto_calls_short_click")
                      .data("HI1", "HI1There")
                      .click();
                  }


                  var closestRowPrev = optionChainTable
                    .find(
                      ".strike_price:contains(" +
                      put_strikeSelect_strangle +
                      ")"
                    )
                    .closest(".call_put_tr");
                  if (closestRowPrev.length) {
                    closestRowPrev
                      .find("#Auto_puts_short_click")
                      .data("HI1", "HI1There")
                      .click();
                  }

                  var counterInputValue = $("#counter_input_strangle").val();
                  $(".option_lot_size_input").val(counterInputValue);
                  $(".option_lot_size_input").text(counterInputValue);
                  // Click on #calculate after a longer delay

                  calculate_data();
                  localStorage.setItem("strategy_builder", "strangle");

                  $("#strangle_modal").hide();
                  Table_chart_pyoff()
                  // margin_calculations()
                  localStorage.removeItem('main_row_instances');
                }
              });

            }
            else if (filter_arg_strategy === "spread") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#ironFly_modal").hide();
              $("#spread_modal").show();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();

              var closest_strike_price = $("#closest_strike_price").text();
              $("#put_strikeSelect_spread")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the next 5 strike prices
              var forw3 = [];
              for (
                var j = currentIndex + 1;
                j < strikePrices.length && forw3.length < 3;
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  forw3.push(rowStrikePrice);
                }
              }

              $("#call_strikeSelect_spread")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw3[forw3.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var expiryDate_spread = $("#expiryDate_spread");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_spread.on("change", function () {
                var selectedValue_straddle = $(this).val();
                // //////console.log(selectedValue_straddle);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_straddle).change();

                // Trigger a click event on the selected option
              });

              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              $("#shortSpread").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").addClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".inner_p_l_greeks").show();
                $(".main_position").empty();
                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();

                var put_strikeSelect_spread = parseFloat(
                  $("#put_strikeSelect_spread").val()
                ); // Convert to a number

                var lastIndexForw = $("#call_strikeSelect_spread").val();


                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closestRowForw = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw + ")")
                  .closest(".call_put_tr");
                if (closestRowForw.length) {
                  closestRowForw
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                strikePrices.forEach(function (rowStrikePrice) {
                  if (rowStrikePrice === put_strikeSelect_spread) {
                    // //////console.log(rowStrikePrice, put_strikeSelect_spread);

                    // Find the closest row and click on Auto_calls_short_click
                    var closestRow = optionChainTable
                      .find(".strike_price:contains(" + rowStrikePrice + ")")
                      .closest(".call_put_tr");
                    if (closestRow.length) {
                      closestRow
                        .find("#Auto_calls_short_click")
                        .data("HI1", "HI1There")
                        .click();

                      // Delay before clicking on #calculate (adjust as needed)
                    }
                  }
                });

                // Get the values of lastIndexPrev and lastIndexForw


                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click
                var closestRowPrev = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev.length) {
                  closestRowPrev
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI1There")
                    .click();
                }


                // Click on #calculate after a longer delay
                var counterInputValue = $("#counter_input_spread").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "spread");
                calculate_data();

                $("#spread_modal").hide();
                Table_chart_pyoff()
                // margin_calculations()
                localStorage.removeItem('main_row_instances');
              });
            }
            else if (filter_arg_strategy === "iron_fly") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").show();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the previous 4 and forward 4 strike prices
              var prev4 = [];
              var forw4 = [];

              for (var i = currentIndex - 1; i >= 0 && prev4.length < 4; i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  prev4.push(rowStrikePrice);
                }
              }

              $("#put_strikeSelect_ironFly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });


              var closest_strike_price = $("#closest_strike_price").text();
              $("#put_call_strikeSelect_ironFly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              for (
                var j = currentIndex + 1;
                j < strikePrices.length && forw4.length < 4;
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  forw4.push(rowStrikePrice);
                }
              }

              $("#call_strikeSelect_ironFly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var expiryDate_ironFly = $("#expiryDate_ironFly");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_ironFly.on("change", function () {
                var selectedValue_straddle = $(this).val();
                // //////console.log(selectedValue_straddle);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_straddle).change();

                // Trigger a click event on the selected option
              });

              // //////console.log("Previous 4 Strike Prices:", prev4);
              // //////console.log("Next 4 Strike Prices:", forw4);

              // Keep the existing logic for closestStrikePrice
              $("#shortironFly").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").addClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();
                var put_strikeSelect_ironFly = $(
                  "#put_strikeSelect_ironFly"
                ).val();
                var put_call_strikeSelect_ironFly = $(
                  "#put_call_strikeSelect_ironFly"
                ).val();
                var call_strikeSelect_ironFly = $(
                  "#call_strikeSelect_ironFly"
                ).val();
                // Get the values of lastIndexPrev and lastIndexForw
                var lastIndexPrev = put_strikeSelect_ironFly;
                var lastIndexForw = call_strikeSelect_ironFly;

                var closestRowForw = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw + ")")
                  .closest(".call_put_tr");
                if (closestRowForw.length) {
                  closestRowForw
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }




                optionChainTable.find(".strike_price").each(function () {
                  var rowStrikePrice = parseFloat($(this).text());
                  if (
                    rowStrikePrice === parseFloat(put_call_strikeSelect_ironFly)
                  ) {
                    $(this)
                      .closest(".call_put_tr")
                      .find("#Auto_puts_short_click, #Auto_calls_short_click")
                      .data("HI1", "HI1There")
                      .click();
                  }
                });

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click
                var closestRowPrev = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev.length) {
                  closestRowPrev
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click

                // Click on #calculate after a longer delay
                var counterInputValue = $("#counter_input_ironFly").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "iron_fly");
                calculate_data();
                $("#ironFly_modal").hide();
                Table_chart_pyoff()
                // margin_calculations()
                localStorage.removeItem('main_row_instances');
              });
            }
            else if (filter_arg_strategy === "iron_condor") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").show();
              $("#jaze_lizard_modal").hide();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the previous 4 and forward 4 strike prices
              var prev4 = [];
              var prev3 = [];
              var forw3 = [];
              var forw4 = [];

              for (
                var i = currentIndex - 1;
                i >= 0 && (prev4.length < 4 || prev3.length < 3);
                i--
              ) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev4.length < 4) {
                    prev4.push(rowStrikePrice);
                  }
                  if (prev3.length < 3) {
                    prev3.push(rowStrikePrice);
                  }
                }
              }

              $("#put_strikeSelect_ironCondor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#put_2nd_strikeSelect_ironCondor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev3[prev3.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              for (
                var j = currentIndex + 1;
                j < strikePrices.length &&
                (forw4.length < 4 || forw3.length < 3);
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw4.length < 4) {
                    forw4.push(rowStrikePrice);
                  }
                  if (forw3.length < 3) {
                    forw3.push(rowStrikePrice);
                  }
                }
              }
              $("#call_2nd_strikeSelect_ironCondor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw3[forw3.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_strikeSelect_ironCondor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var expiryDate_ironCondor = $("#expiryDate_ironCondor");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_ironCondor.on("change", function () {
                var selectedValue_ironCondor = $(this).val();
                // //////console.log(selectedValue_ironCondor);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_ironCondor).change();

                // Trigger a click event on the selected option
              });

              // //////console.log("Previous 3 Strike Prices:", prev3);
              // //////console.log("Previous 4 Strike Prices:", prev4);
              // //////console.log("Next 4 Strike Prices:", forw4);
              // //////console.log("Next 3 Strike Prices:", forw3);

              // Get the values of lastIndexPrev and lastIndexForw
              var lastIndexPrev = $("#put_strikeSelect_ironCondor").val();
              var lastIndexForw = $("#put_2nd_strikeSelect_ironCondor").val();
              var lastIndexPrev3 = $("#call_2nd_strikeSelect_ironCondor").val();
              var lastIndexForw3 = $("#call_strikeSelect_ironCondor").val();

              // Find the closest row for lastIndexPrev and click on Auto_puts_short_click
              $("#short_ironCondor").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").addClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var closestRowForw3 = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw3 + ")")
                  .closest(".call_put_tr");
                if (closestRowForw3.length) {
                  closestRowForw3
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                var closestRowPrev3 = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev3 + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev3.length) {
                  closestRowPrev3
                    .find("#Auto_calls_short_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                var closestRowForw = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw + ")")
                  .closest(".call_put_tr");
                if (closestRowForw.length) {
                  closestRowForw
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI1There")
                    .click();
                }


                var closestRowPrev = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev.length) {
                  closestRowPrev
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }



                // Find the closest row for lastIndexForw and click on Auto_calls_short_click

                // Click on #calculate after a longer delay
                var counterInputValue = $("#counter_input_ironCondor").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "iron_condor");
                calculate_data();
                $("#ironCondor_modal").hide();
                Table_chart_pyoff()
                // margin_calculations()
                localStorage.removeItem('main_row_instances');
              });
            }
            else if (filter_arg_strategy === "jaze_lizard") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the previous 4 and forward 4 strike prices
              var prev4 = [];

              var forw2 = [];
              var forw4 = [];

              for (
                var j = currentIndex + 1;
                j < strikePrices.length &&
                (forw4.length < 4 || forw2.length < 2);
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw4.length < 4) {
                    forw4.push(rowStrikePrice);
                  }
                  if (forw2.length < 2) {
                    forw2.push(rowStrikePrice);
                  }
                }
              }
              $("#call_strikeSelect_jaze_lizard")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_2nd_strikeSelect_jaze_lizard")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw2[forw2.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              for (var i = currentIndex - 1; i >= 0 && prev4.length < 4; i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev4.length < 4) {
                    prev4.push(rowStrikePrice);
                  }
                }
              }
              $("#put_strikeSelect_jaze_lizard")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              // //////console.log("Next 4 Strike Prices:", forw4);
              // //////console.log("Next 2 Strike Prices:", forw2);

              // //////console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_jaze_lizard = $("#expiryDate_jaze_lizard");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_jaze_lizard.on("change", function () {
                var selectedValue_jaze_lizard = $(this).val();
                // //////console.log(selectedValue_jaze_lizard);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_jaze_lizard).change();

                // Trigger a click event on the selected option
              });
              $("#shortjaze_lizard").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").addClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();

                var lastIndexForw = $("#call_strikeSelect_jaze_lizard").val();

                var lastIndexForw2 = $(
                  "#call_2nd_strikeSelect_jaze_lizard"
                ).val();
                var lastIndexPrev = $("#put_strikeSelect_jaze_lizard").val();

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click


                var closestRowForw = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw + ")")
                  .closest(".call_put_tr");
                if (closestRowForw.length) {
                  closestRowForw
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI2there")
                    .click();
                }
                var closestRowForw2 = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw2 + ")")
                  .closest(".call_put_tr");
                if (closestRowForw2.length) {
                  closestRowForw2
                    .find("#Auto_calls_short_click")
                    .data("HI1", "HI1There")
                    .click();
                }


                var closestRowPrev = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev.length) {
                  closestRowPrev
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI3there")
                    .click();
                }
                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_jaze_lizard").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "jaze_lizard");
                calculate_data();
                $("#jaze_lizard_modal").hide();
                Table_chart_pyoff()
                // margin_calculations()
                localStorage.removeItem('main_row_instances');
              });
            }

            else if (filter_arg_strategy === "double_iron_fly") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();
              $("#double_iron_fly_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice

              var closest_strike_price = $("#closest_strike_price").text();
              $("#call_spot_strikeSelect_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              var prev8 = [];
              var prev4 = [];

              for (var i = currentIndex - 1; i >= 0 && (prev8.length < 8 || prev4.length < 4); i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev8.length < 8) {
                    prev8.push(rowStrikePrice);
                  }
                  if (prev4.length < 4) {
                    prev4.push(rowStrikePrice);
                  }
                }
              }


              $("#put_strike_eight_hundred_Select_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev8[prev8.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_put_four_hundred_Select_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });










              var forw4 = [];
              var forw8 = [];
              var forw12 = [];

              for (var j = currentIndex + 1; j < strikePrices.length && (forw4.length < 4 || forw8.length < 8 || forw12.length < 12); j++) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw4.length < 4) {
                    forw4.push(rowStrikePrice);
                  }
                  if (forw8.length < 8) {
                    forw8.push(rowStrikePrice);
                  }
                  if (forw12.length < 12) {
                    forw12.push(rowStrikePrice);
                  }
                }
              }


              $("#put_positive_four_hundred_strikeSelect_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_put_positive_eight_hundred_strikeSelect_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw8[forw8.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_twelve_hundred_positive_strikeSelect_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw12[forw12.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });



              $("#put_strikeSelect_jaze_lizard")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              // //////console.log("Next 4 Strike Prices:", forw4);
              // //////console.log("Next 2 Strike Prices:", forw2);

              // //////console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_jaze_lizard = $("#expiryDate_double_iron_fly");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_jaze_lizard.on("change", function () {
                var selectedValue_jaze_lizard = $(this).val();
                // //////console.log(selectedValue_jaze_lizard);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_jaze_lizard).change();

                // Trigger a click event on the selected option
              });
              $("#shortdouble_iron_fly").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").addClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");


                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var put_strike_eight_hundred_Select_double_iron_fly = $("#put_strike_eight_hundred_Select_double_iron_fly").val();
                var call_put_four_hundred_Select_double_iron_fly = $("#call_put_four_hundred_Select_double_iron_fly").val();
                var call_spot_strikeSelect_double_iron_fly = $("#call_spot_strikeSelect_double_iron_fly").val();
                var put_positive_four_hundred_strikeSelect_double_iron_fly = $("#put_positive_four_hundred_strikeSelect_double_iron_fly").val();
                var call_put_positive_eight_hundred_strikeSelect_double_iron_fly = $("#call_put_positive_eight_hundred_strikeSelect_double_iron_fly").val();
                var call_twelve_hundred_positive_strikeSelect_double_iron_fly = $("#call_twelve_hundred_positive_strikeSelect_double_iron_fly").val();





                var closest_call_twelve_hundred_positive_strikeSelect_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + call_twelve_hundred_positive_strikeSelect_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_call_twelve_hundred_positive_strikeSelect_double_iron_fly.length) {
                  closest_call_twelve_hundred_positive_strikeSelect_double_iron_fly
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI6there")
                    .click();
                }


                var closest_call_put_positive_eight_hundred_strikeSelect_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + call_put_positive_eight_hundred_strikeSelect_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_call_put_positive_eight_hundred_strikeSelect_double_iron_fly.length) {
                  closest_call_put_positive_eight_hundred_strikeSelect_double_iron_fly
                    .find("#Auto_puts_short_click , #Auto_calls_short_click")
                    .data("HI1", "HI5there")
                    .click();
                }

                var closest_put_positive_four_hundred_strikeSelect_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + put_positive_four_hundred_strikeSelect_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_put_positive_four_hundred_strikeSelect_double_iron_fly.length) {
                  closest_put_positive_four_hundred_strikeSelect_double_iron_fly
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI4there")
                    .click();
                }


                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closest_call_spot_strikeSelect_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + call_spot_strikeSelect_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_call_spot_strikeSelect_double_iron_fly.length) {
                  closest_call_spot_strikeSelect_double_iron_fly
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI3There")
                    .click();
                }



                var closest_call_put_four_hundred_Select_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + call_put_four_hundred_Select_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_call_put_four_hundred_Select_double_iron_fly.length) {
                  closest_call_put_four_hundred_Select_double_iron_fly
                    .find("#Auto_puts_short_click , #Auto_calls_short_click")
                    .data("HI1", "HI2there")
                    .click();
                }



                var closest_put_strike_eight_hundred_Select_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + put_strike_eight_hundred_Select_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_put_strike_eight_hundred_Select_double_iron_fly.length) {
                  closest_put_strike_eight_hundred_Select_double_iron_fly
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1there")
                    .click();
                }

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click










                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_double_iron_fly").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "double_iron_fly");
                calculate_data();
                $("#double_iron_fly_modal").hide();
                Table_chart_pyoff()
                // margin_calculations()
                localStorage.removeItem('main_row_instances');
              });
            }
            else if (filter_arg_strategy === "double_iron_condor") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();
              $("#double_iron_fly_modal").hide();
              $("#double_iron_condor_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice

              var closest_strike_price = $("#closest_strike_price").text();
              $("#spot_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              var prev4 = [];
              var prev8 = [];
              var prev12 = [];
              var prev16 = [];

              for (var i = currentIndex - 1; i >= 0 && (prev4.length < 4 || prev8.length < 8 || prev12.length < 12 || prev16.length < 16); i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev4.length < 4) {
                    prev4.push(rowStrikePrice);
                  }
                  if (prev8.length < 8) {
                    prev8.push(rowStrikePrice);
                  }
                  if (prev12.length < 12) {
                    prev12.push(rowStrikePrice);
                  }
                  if (prev16.length < 16) {
                    prev16.push(rowStrikePrice);
                  }
                }
              }


              $("#spot_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              $("#put_negative_fifty_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev8[prev8.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });


              $("#put_negative_two_hundred_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev12[prev12.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#negative_three_hundred_fifty_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev16[prev16.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });







              var forw4 = [];
              var forw8 = [];
              var forw12 = [];
              var forw16 = [];

              for (var j = currentIndex + 1; j < strikePrices.length && (forw4.length < 4 || forw8.length < 8 || forw12.length < 12 || forw16.length < 16); j++) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw4.length < 4) {
                    forw4.push(rowStrikePrice);
                  }
                  if (forw8.length < 8) {
                    forw8.push(rowStrikePrice);
                  }
                  if (forw12.length < 12) {
                    forw12.push(rowStrikePrice);
                  }
                  if (forw16.length < 16) {
                    forw16.push(rowStrikePrice);
                  }
                }
              }


              $("#call_positive_three_hundred_fifty_strikeSelect_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_positive_five_hundred_strikeSelect_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw8[forw8.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_positive_six_hundred_fifty_strikeSelect_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw12[forw12.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_positive_eight_hundred_strikeSelect_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw16[forw16.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });




              // //////console.log("Next 4 Strike Prices:", forw4);
              // //////console.log("Next 2 Strike Prices:", forw2);

              // //////console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_jaze_lizard = $("#expiryDate_double_iron_condor");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_jaze_lizard.on("change", function () {
                var selectedValue_jaze_lizard = $(this).val();
                // //////console.log(selectedValue_jaze_lizard);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_jaze_lizard).change();

                // Trigger a click event on the selected option
              });
              $("#shortdouble_iron_condor").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").addClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");


                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var spot_Select_double_iron_condor = $("#spot_Select_double_iron_condor").val();
                var put_negative_fifty_Select_double_iron_condor = $("#put_negative_fifty_Select_double_iron_condor").val();
                var put_negative_two_hundred_Select_double_iron_condor = $("#put_negative_two_hundred_Select_double_iron_condor").val();
                var negative_three_hundred_fifty_Select_double_iron_condor = $("#negative_three_hundred_fifty_Select_double_iron_condor").val();

                var call_positive_three_hundred_fifty_strikeSelect_double_iron_condor = $("#call_positive_three_hundred_fifty_strikeSelect_double_iron_condor").val();
                var call_positive_five_hundred_strikeSelect_double_iron_condor = $("#call_positive_five_hundred_strikeSelect_double_iron_condor").val();
                var call_positive_six_hundred_fifty_strikeSelect_double_iron_condor = $("#call_positive_six_hundred_fifty_strikeSelect_double_iron_condor").val();
                var call_positive_eight_hundred_strikeSelect_double_iron_condor = $("#call_positive_eight_hundred_strikeSelect_double_iron_condor").val();


                var closest_spot_Select_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + spot_Select_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_spot_Select_double_iron_condor.length) {
                  closest_spot_Select_double_iron_condor
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1there")
                    .click();
                }

                var closest_put_negative_fifty_Select_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + put_negative_fifty_Select_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_put_negative_fifty_Select_double_iron_condor.length) {
                  closest_put_negative_fifty_Select_double_iron_condor
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI2there")
                    .click();
                }

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closest_put_negative_two_hundred_Select_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + put_negative_two_hundred_Select_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_put_negative_two_hundred_Select_double_iron_condor.length) {
                  closest_put_negative_two_hundred_Select_double_iron_condor
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI3There")
                    .click();
                }

                var closest_negative_three_hundred_fifty_Select_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + negative_three_hundred_fifty_Select_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_negative_three_hundred_fifty_Select_double_iron_condor.length) {
                  closest_negative_three_hundred_fifty_Select_double_iron_condor
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI4there")
                    .click();
                }

                var closest_call_positive_three_hundred_fifty_strikeSelect_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + call_positive_three_hundred_fifty_strikeSelect_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_call_positive_three_hundred_fifty_strikeSelect_double_iron_condor.length) {
                  closest_call_positive_three_hundred_fifty_strikeSelect_double_iron_condor
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI5there")
                    .click();
                }


                var closest_call_positive_five_hundred_strikeSelect_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + call_positive_five_hundred_strikeSelect_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_call_positive_five_hundred_strikeSelect_double_iron_condor.length) {
                  closest_call_positive_five_hundred_strikeSelect_double_iron_condor
                    .find("#Auto_calls_short_click")
                    .data("HI1", "HI6there")
                    .click();
                }
                var closest_call_positive_six_hundred_fifty_strikeSelect_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + call_positive_six_hundred_fifty_strikeSelect_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_call_positive_six_hundred_fifty_strikeSelect_double_iron_condor.length) {
                  closest_call_positive_six_hundred_fifty_strikeSelect_double_iron_condor
                    .find("#Auto_calls_short_click")
                    .data("HI1", "HI7there")
                    .click();
                }
                var closest_call_positive_eight_hundred_strikeSelect_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + call_positive_eight_hundred_strikeSelect_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_call_positive_eight_hundred_strikeSelect_double_iron_condor.length) {
                  closest_call_positive_eight_hundred_strikeSelect_double_iron_condor
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI8there")
                    .click();
                }








                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_double_iron_condor").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "double_iron_condor");
                calculate_data();
                $("#double_iron_condor_modal").hide();
                Table_chart_pyoff()
                // margin_calculations()
                localStorage.removeItem('main_row_instances');
              });
            }


            else if (filter_arg_strategy === "put_butter_fly") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();
              $("#double_iron_fly_modal").hide();
              $("#double_iron_condor_modal").hide();
              $("#call_butter_fly_modal").hide();
              $("#put_butterfly_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice

              var closest_strike_price = $("#closest_strike_price").text();
              $("#spot_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              var prev19 = [];
              var prev10 = [];
              var prev1 = [];


              for (var i = currentIndex - 1; i >= 0 && (prev19.length < 19 || prev10.length < 10 || prev1.length < 1); i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev19.length < 19) {
                    prev19.push(rowStrikePrice);
                  }
                  if (prev10.length < 10) {
                    prev10.push(rowStrikePrice);
                  }
                  if (prev1.length < 1) {
                    prev1.push(rowStrikePrice);
                  }

                }
              }


              $("#put_negative_nine_hundred_fifty_Select_put_butterfly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev19[prev19.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              $("#five_hundred_put_call_Select_put_butterfly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev10[prev10.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });


              $("#put_negative_fifty_Select_put_butterfly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev1[prev1.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });





              // //////console.log("Next 4 Strike Prices:", forw4);
              // //////console.log("Next 2 Strike Prices:", forw2);

              // //////console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_put_butterfly = $("#expiryDate_put_butterfly");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_put_butterfly.on("change", function () {
                var selectedValue_put_butterfly = $(this).val();
                // //////console.log(selectedValue_put_butterfly);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_put_butterfly).change();

                // Trigger a click event on the selected option
              });
              $("#shortput_butterfly").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").addClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var put_negative_nine_hundred_fifty_Select_put_butterfly = $("#put_negative_nine_hundred_fifty_Select_put_butterfly").val();
                var five_hundred_put_call_Select_put_butterfly = $("#five_hundred_put_call_Select_put_butterfly").val();
                var put_negative_fifty_Select_put_butterfly = $("#put_negative_fifty_Select_put_butterfly").val();



                var closest_put_negative_nine_hundred_fifty_Select_put_butterfly = optionChainTable
                  .find(".strike_price:contains(" + put_negative_nine_hundred_fifty_Select_put_butterfly + ")")
                  .closest(".call_put_tr");
                if (closest_put_negative_nine_hundred_fifty_Select_put_butterfly.length) {
                  closest_put_negative_nine_hundred_fifty_Select_put_butterfly
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1there")
                    .click();
                }

                var closest_five_hundred_put_call_Select_put_butterfly = optionChainTable
                  .find(".strike_price:contains(" + five_hundred_put_call_Select_put_butterfly + ")")
                  .closest(".call_put_tr");
                if (closest_five_hundred_put_call_Select_put_butterfly.length) {
                  closest_five_hundred_put_call_Select_put_butterfly
                    .find("#Auto_puts_short_click ,#Auto_calls_short_click")
                    .data("HI1", "HI2there")
                    .click();
                }

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closest_put_negative_fifty_Select_put_butterfly = optionChainTable
                  .find(".strike_price:contains(" + put_negative_fifty_Select_put_butterfly + ")")
                  .closest(".call_put_tr");
                if (closest_put_negative_fifty_Select_put_butterfly.length) {
                  closest_put_negative_fifty_Select_put_butterfly
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI3There")
                    .click();
                }








                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_put_butterfly").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "double_put_butterfly");
                calculate_data();
                $("#put_butterfly_modal").hide();
                Table_chart_pyoff()
                // margin_calculations()
                localStorage.removeItem('main_row_instances');
              });
            }


            else if (filter_arg_strategy === "call_butter_fly") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();
              $("#double_iron_fly_modal").hide();
              $("#double_iron_condor_modal").hide();
              $("#put_butterfly_modal").hide();
              $("#call_butter_fly_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice

              var closest_strike_price = $("#closest_strike_price").text();

              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              var forw10 = [];
              var forw19 = [];
              var forw1 = [];

              for (var j = currentIndex + 1; j < strikePrices.length && (forw10.length < 10 || forw19.length < 19 || forw1.length < 1); j++) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw10.length < 10) {
                    forw10.push(rowStrikePrice);
                  }
                  if (forw19.length < 19) {
                    forw19.push(rowStrikePrice);
                  }
                  if (forw1.length < 1) {
                    forw1.push(rowStrikePrice);
                  }

                }
              }



              $("#put_positive_fifty_Select_call_butter_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw1[forw1.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              $("#four_hundred_put_call_Select_call_butter_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw10[forw10.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });


              $("#positive_seven_hundred_fifty_Select_call_butter_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw19[forw19.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });





              // //////console.log("Next 4 Strike Prices:", forw4);
              // //////console.log("Next 2 Strike Prices:", forw2);

              // //////console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_call_butter_fly = $("#expiryDate_call_butter_fly");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_call_butter_fly.on("change", function () {
                var selectedValue_put_butterfly = $(this).val();
                // //////console.log(selectedValue_put_butterfly);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_put_butterfly).change();

                // Trigger a click event on the selected option
              });
              $("#shortcall_butter_fly").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#put_butter_fly").removeClass("option_strategies_active");
                $("#call_butter_fly").addClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var put_positive_fifty_Select_call_butter_fly = $("#put_positive_fifty_Select_call_butter_fly").val();
                var four_hundred_put_call_Select_call_butter_fly = $("#four_hundred_put_call_Select_call_butter_fly").val();
                var positive_seven_hundred_fifty_Select_call_butter_fly = $("#positive_seven_hundred_fifty_Select_call_butter_fly").val();



                var closest_put_positive_fifty_Select_call_butter_fly = optionChainTable
                  .find(".strike_price:contains(" + put_positive_fifty_Select_call_butter_fly + ")")
                  .closest(".call_put_tr");
                if (closest_put_positive_fifty_Select_call_butter_fly.length) {
                  closest_put_positive_fifty_Select_call_butter_fly
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1there")
                    .click();
                }

                var closest_four_hundred_put_call_Select_call_butter_fly = optionChainTable
                  .find(".strike_price:contains(" + four_hundred_put_call_Select_call_butter_fly + ")")
                  .closest(".call_put_tr");
                if (closest_four_hundred_put_call_Select_call_butter_fly.length) {
                  closest_four_hundred_put_call_Select_call_butter_fly
                    .find("#Auto_puts_short_click ,#Auto_calls_short_click")
                    .data("HI1", "HI2there")
                    .click();
                }

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closest_positive_seven_hundred_fifty_Select_call_butter_fly = optionChainTable
                  .find(".strike_price:contains(" + positive_seven_hundred_fifty_Select_call_butter_fly + ")")
                  .closest(".call_put_tr");
                if (closest_positive_seven_hundred_fifty_Select_call_butter_fly.length) {
                  closest_positive_seven_hundred_fifty_Select_call_butter_fly
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI3There")
                    .click();
                }








                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_call_butter_fly").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "call_butterfly");
                calculate_data();
                $("#call_butter_fly_modal").hide();
                Table_chart_pyoff()
                // margin_calculations()
                localStorage.removeItem('main_row_instances');
              });
            }






            else if (filter_arg_strategy === "custom_strategy") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();
              $("#double_iron_fly_modal").hide();
              $("#double_iron_condor_modal").hide();
              $("#put_butterfly_modal").hide();
              $("#call_butter_fly_modal").hide();
              $("#custom_strategy_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice

              var closest_strike_price = $("#closest_strike_price").text();

              var currentIndex = strikePrices.indexOf(closestStrikePrice);
              $("#put_call_spot_sell_Select_custom_strategy")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var forw4 = [];
              var forw1 = [];
              var forw2 = [];

              for (var j = currentIndex + 1; j < strikePrices.length && (forw4.length < 4 || forw1.length < 1 || forw2.length < 2); j++) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw4.length < 4) {
                    forw4.push(rowStrikePrice);
                  }
                  if (forw1.length < 1) {
                    forw1.push(rowStrikePrice);
                  }
                  if (forw2.length < 2) {
                    forw2.push(rowStrikePrice);
                  }

                }
              }




              $("#call_two_hundered_buy_Select_custom_strategy")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#put_call_positive_one_hundred_Select_custom_strategy")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw2[forw2.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });


              $("#put_call_positive_fifty_sell_Select_custom_strategy")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw1[forw1.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var prev4 = [];
              var prev2 = [];
              var prev1 = [];


              for (var i = currentIndex - 1; i >= 0 && (prev4.length < 4 || prev2.length < 2 || prev1.length < 1); i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev4.length < 4) {
                    prev4.push(rowStrikePrice);
                  }
                  if (prev2.length < 2) {
                    prev2.push(rowStrikePrice);
                  }
                  if (prev1.length < 1) {
                    prev1.push(rowStrikePrice);
                  }

                }
              }


              $("#call_negative_two_hundred_buy_Select_custom_strategy")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              $("#put_call_negative_one_hundred_sell_Select_custom_strategy")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev2[prev2.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#put_call_negative_fifty_hundred_sell_Select_custom_strategy")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev1[prev1.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });



              $("#call_two_hundered_buy_Select_custom_strategy")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // //////console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });






              // //////console.log("Next 4 Strike Prices:", forw4);
              // //////console.log("Next 2 Strike Prices:", forw2);

              // //////console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_custom_strategy = $("#expiryDate_custom_strategy");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_custom_strategy.on("change", function () {
                var selectedValue_custom_strategy = $(this).val();
                // //////console.log(selectedValue_custom_strategy);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_custom_strategy).change();

                // Trigger a click event on the selected option
              });
              $("#shortcustom_strategy").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#put_butter_fly").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");
                $("#custom_strategy").addClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var call_two_hundered_buy_Select_custom_strategy = $("#call_two_hundered_buy_Select_custom_strategy").val();
                var call_negative_two_hundred_buy_Select_custom_strategy = $("#call_negative_two_hundred_buy_Select_custom_strategy").val();
                var put_call_negative_one_hundred_sell_Select_custom_strategy = $("#put_call_negative_one_hundred_sell_Select_custom_strategy").val();
                var put_call_negative_fifty_hundred_sell_Select_custom_strategy = $("#put_call_negative_fifty_hundred_sell_Select_custom_strategy").val();
                var put_call_spot_sell_Select_custom_strategy = $("#put_call_spot_sell_Select_custom_strategy").val();
                var put_call_positive_fifty_sell_Select_custom_strategy = $("#put_call_positive_fifty_sell_Select_custom_strategy").val();
                var put_call_positive_one_hundred_Select_custom_strategy = $("#put_call_positive_one_hundred_Select_custom_strategy").val();





                var closest_call_two_hundered_buy_Select_custom_strategy = optionChainTable
                  .find(".strike_price:contains(" + call_two_hundered_buy_Select_custom_strategy + ")")
                  .closest(".call_put_tr");
                if (closest_call_two_hundered_buy_Select_custom_strategy.length) {
                  closest_call_two_hundered_buy_Select_custom_strategy
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI7there")
                    .click();
                  $(".option_lot_size_input").text("5")
                }


                var closest_call_negative_two_hundred_buy_Select_custom_strategy = optionChainTable
                  .find(".strike_price:contains(" + call_negative_two_hundred_buy_Select_custom_strategy + ")")
                  .closest(".call_put_tr");
                if (closest_call_negative_two_hundred_buy_Select_custom_strategy.length) {
                  closest_call_negative_two_hundred_buy_Select_custom_strategy
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1there")
                    .click();
                  $(".option_lot_size_input").text("5")
                }



                var closest_put_call_negative_one_hundred_sell_Select_custom_strategy = optionChainTable
                  .find(".strike_price:contains(" + put_call_negative_one_hundred_sell_Select_custom_strategy + ")")
                  .closest(".call_put_tr");
                if (closest_put_call_negative_one_hundred_sell_Select_custom_strategy.length) {
                  closest_put_call_negative_one_hundred_sell_Select_custom_strategy
                    .find("#Auto_puts_short_click ,#Auto_calls_short_click")
                    .data("HI1", "HI2there")
                    .click();
                }




                var closest_put_call_negative_fifty_hundred_sell_Select_custom_strategy = optionChainTable
                  .find(".strike_price:contains(" + put_call_negative_fifty_hundred_sell_Select_custom_strategy + ")")
                  .closest(".call_put_tr");
                if (closest_put_call_negative_fifty_hundred_sell_Select_custom_strategy.length) {
                  closest_put_call_negative_fifty_hundred_sell_Select_custom_strategy
                    .find("#Auto_puts_short_click ,#Auto_calls_short_click")
                    .data("HI1", "HI3there")
                    .click();
                }





                var closest_put_call_spot_sell_Select_custom_strategy = optionChainTable
                  .find(".strike_price:contains(" + put_call_spot_sell_Select_custom_strategy + ")")
                  .closest(".call_put_tr");
                if (closest_put_call_spot_sell_Select_custom_strategy.length) {
                  closest_put_call_spot_sell_Select_custom_strategy
                    .find("#Auto_puts_short_click ,#Auto_calls_short_click")
                    .data("HI1", "HI4there")
                    .click();
                }



                var closest_put_call_positive_fifty_sell_Select_custom_strategy = optionChainTable
                  .find(".strike_price:contains(" + put_call_positive_fifty_sell_Select_custom_strategy + ")")
                  .closest(".call_put_tr");
                if (closest_put_call_positive_fifty_sell_Select_custom_strategy.length) {
                  closest_put_call_positive_fifty_sell_Select_custom_strategy
                    .find("#Auto_puts_short_click ,#Auto_calls_short_click")
                    .data("HI1", "HI5there")
                    .click();
                }




                var closest_put_call_positive_one_hundred_Select_custom_strategy = optionChainTable
                  .find(".strike_price:contains(" + put_call_positive_one_hundred_Select_custom_strategy + ")")
                  .closest(".call_put_tr");
                if (closest_put_call_positive_one_hundred_Select_custom_strategy.length) {
                  closest_put_call_positive_one_hundred_Select_custom_strategy
                    .find("#Auto_puts_short_click ,#Auto_calls_short_click")
                    .data("HI1", "HI6there")
                    .click();
                }


                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click








                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_custom_strategy").val();
                // $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "nifty_custom_strategy");
                calculate_data();
                $("#custom_strategy_modal").hide();
                Table_chart_pyoff()
                // margin_calculations()
                localStorage.removeItem('main_row_instances');
              });
            }






          }

          // Common function to handle strategy button click
          function attachButtonClickEvent($button, strategy) {
            $button.off("click").on("click", function () {
              localStorage.removeItem('main_row_instances');
              selectStrategy(strategy);
            });
          }

          // Attach click event handlers to strategy buttons
          attachButtonClickEvent($("#shortStraddle"), "straddle");
          attachButtonClickEvent($("#strangle"), "strangle");
          attachButtonClickEvent($("#iron_fly"), "iron_fly");
          attachButtonClickEvent($("#spread"), "spread");
          attachButtonClickEvent($("#iron_condor"), "iron_condor");
          attachButtonClickEvent($("#jaze_lizard"), "jaze_lizard");
          attachButtonClickEvent($("#double_iron_fly"), "double_iron_fly");
          attachButtonClickEvent($("#double_iron_condor"), "double_iron_condor");
          attachButtonClickEvent($("#put_butter_fly"), "put_butter_fly");
          attachButtonClickEvent($("#call_butter_fly"), "call_butter_fly");
          attachButtonClickEvent($("#custom_strategy"), "custom_strategy");





          var isTableEmpty = true;

          $(".actions_future_buy_sell").click(function () {
            var future_tr = $(this).closest("tr")

            var action_buy_sell_futures = $(this).data("future_action")
            ////console.log(action_buy_sell_futures);

            var futures_strikePrice = future_tr.find(".future_close").text()
            ////console.log(futures_strikePrice);
            var future_expiry_main = future_tr.find(".future_expiry_main").text()
            ////console.log(future_expiry_main);

          })

          $(".put_call_btns").click(function () {

            if ($(this).data("f&o") === "option") {
              var row = $(this).closest("tr"); // Find the closest table row
              var action = $(this).attr("data-action"); // Get the action (Short/Long) from the button's data attribute
              var side = $(this).attr("data-side"); // Get the side (Call/Put) from the button's data attribute

              var ltpValue =
                side === "call"
                  ? row.find(".calls_ltp").text()
                  : row.find(".puts_ltp").text();

              // Now you can access the data from the row and log it as needed
              if (side === "call") {
                var calls_iv = row.find(".text-end").eq(0).text();
                var calls_oi = row.find(".text-end").eq(1).text();
                var expiry_date = row.find(".expiry_date").text();
                var strike_price = row.find(".strike_price").text();
                var opiton_lot_size = row.find(".opiton_lot_size").text();
                var opiton_selected = row.find(".opiton_selected").text();
                var option_side = "Call";

                // ////console.log(option_side);
                // ////console.log("Call Side - Action:", action);
                // // ////console.log("Call Side - calls_iv:", calls_iv);
                // // ////console.log("Call Side - calls_oi:", calls_oi);
                // ////console.log("Call Side - calls_ltp:", ltpValue);
                // ////console.log("Call Side - strike_price:", strike_price);
                // ////console.log("opiton_selected:", opiton_selected);
                // ////console.log(expiry_date);
                // ////console.log(opiton_lot_size);

                var lot_size_inner = 1
                populateInputTable(
                  option_side,
                  expiry_date,
                  strike_price,
                  action,
                  opiton_lot_size,
                  ltpValue,
                  opiton_selected, lot_size_inner
                );
                Table_chart_pyoff()
                margin_calculations()
                $(".main_position,.main_all_profit_loss,.main_bottom_strategy_positions").show()
                $(".main_build_custom_strategy_empty").css("display", "none")
                $("#customRange2").show()
                $('#taget_date_table').show()

                $("#resultTable tbody,#table-PL,.option_oi_charts,#chartdiv,.payoff_table_data").show()


              } else {
                var option_side = "Put";
                var puts_oi = row.find(".text-start").eq(1).text();
                var puts_iv = row.find(".text-start").eq(2).text();
                var expiry_date = row.find(".expiry_date").text();
                var strike_price = row.find(".strike_price").text();
                var opiton_lot_size = row.find(".opiton_lot_size").text();
                var opiton_selected = row.find(".opiton_selected").text();
                // //////console.log(option_side);
                // //////console.log("Put Side - Action:", action);
                // //////console.log("Put Side - puts_ltp:", ltpValue);
                // //////console.log("Put Side - puts_oi:", puts_oi);
                // //////console.log("Put Side - puts_iv:", puts_iv);
                // //////console.log(expiry_date);
                // //////console.log(opiton_lot_size);
                // //////console.log(strike_price);

                var lot_size_inner = 1
                populateInputTable(
                  option_side,
                  expiry_date,
                  strike_price,
                  action,
                  opiton_lot_size,
                  ltpValue,
                  opiton_selected, lot_size_inner
                );
                Table_chart_pyoff()
                $(".main_position,.main_all_profit_loss,.main_bottom_strategy_positions").show()
                $(".main_build_custom_strategy_empty").css("display", "none")
                $("#customRange2").show()
                $('#taget_date_table').show()
                $("#resultTable tbody,#table-PL,.option_oi_charts,#chartdiv,.payoff_table_data").show()
                margin_calculations()

              }


            } else if ($(this).data("f&o") === "future") {


              var option_side = "FUTURE";
              ////console.log("Option Side: " + option_side);

              var opiton_selected = $(".stockDropdown").val();
              ////console.log("Option Selected: " + opiton_selected);

              var expiry_date = $(".futures_expiry").val();
              ////console.log("Expiry Date: " + expiry_date);

              var opiton_lot_size = $("#lot_size_value").text();
              ////console.log("Option Lot Size: " + opiton_lot_size);

              var lot_size_inner = $("#futures_counter_input").val();
              ////console.log("Lot Size Inner: " + lot_size_inner);

              var strike_price = $(".futures_ltp").text();
              ////console.log("Strike Price: " + strike_price);

              var ltpValue = $(".futures_ltp").text();
              ////console.log("LTP Value: " + ltpValue);

              var action = $("input[name='callAction']:checked").val();
              ////console.log("Action: " + action);


              populateInputTable(
                option_side,
                expiry_date,
                strike_price,
                action,
                opiton_lot_size,
                ltpValue,
                opiton_selected, lot_size_inner
              );

              Table_chart_pyoff()
              $(".main_position,.main_all_profit_loss,.main_bottom_strategy_positions").show()
              $(".main_build_custom_strategy_empty").css("display", "none")
              $("#customRange2").show()
              $('#taget_date_table').show()
              $("#resultTable tbody,#table-PL,.option_oi_charts,#chartdiv,.payoff_table_data").show()
              margin_calculations()
            }


            if (isTableEmpty) {
              $(".data-display-table").empty();
              isTableEmpty = false;
            }





            $(".inner_p_l_greeks").show();
            if ($(this).data("HI1") === undefined) {
              // //////console.log("Yes");
              // Remove the "HI1" data attribute

              calculate_data();
            } else {
              // //////console.log("No");
              $(this).removeData("HI1");
            }
            checkMainPositionContent();

          });

          var positions = 1;
          var positions_input = 1;
          $(".add-btn").off("click");
          $(".add-btn").click(function (event) {
            event.preventDefault(); // Prevent default behavior

            var selectedOption = $(".stockDropdown").val();
            loadExpiryData(selectedOption);

            var newRow = $("<tr>").addClass("strategy_table_input");

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="optionSide">Option Side</label>
                    <select class="option_side_input form-select">
                     
                        <option value="Call">Call</option>
                        <option value="Put">Put</option>
                       
                    </select>
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="expiryDate">Expiry Date</label>
                    <select class="expiry_date_input form-select">
                    
                        <option value=""></option>
                    </select>
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="strikePrice">Strike Price</label>
                    <select class="strike_price_input form-select">
                     
                        <option value=""></option>
                    </select>
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="action">Position</label>
                    <select class="action_input form-select">
                     
                        <option value="Short">Short</option>
                        <option value="Long">Long</option>
                    </select>
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="optionLots">Option Lot Size</label>
                    <input type="number" class="option_lot_size_input form-control">
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="ltpValue">LTP Value</label>
                    <input type="number" class="ltpValue_input form-control" value="">
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`   <i class="delete-btn bi bi-trash-fill"></i>`)
            );

            $(".data-display-table").append(newRow);
          });


          var main_margin_calculations = []

          var calc_id = 1



          function populateInputTable(
            option_side,
            expiry_date,
            strike_price,
            action,
            option_lot_size,
            ltpValue,
            opiton_selected, lot_size_inner
          ) {


            // //////console.log("Option Side:", option_side);
            // //////console.log("Expiry Date:", expiry_date);
            // //////console.log("Strike Price:", strike_price);
            // //////console.log("Action:", action);

            // //////console.log("Option Lot Size:", option_lot_size);
            // //////console.log("LTP Value:", ltpValue);
            // //////console.log("opiton_selected:", opiton_selected);



            let dateParts = expiry_date.split("-");
            var optionyear = dateParts[0].slice(-2);
            // //////console.log(optionyear);

            // Converting month number to month name
            let monthNames = ["", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            var opitonmonth = monthNames[parseInt(dateParts[1], 10)];

            let dayOfYear = dateParts[2]
            let result = dayOfYear + opitonmonth.slice(0, 3).toLocaleUpperCase() + optionyear;

            // //////console.log(result);
            // NIFTY23N0919250CE
            // NIFTY23N0919250PE

            var main_ce_pe;
            if (option_side === "Put") {
              main_ce_pe = "PUT";
            } else if (option_side === "Call") {
              main_ce_pe = "CALL";
            } else {
              main_ce_pe = "FUTURE";
            }

            opiton_selected = opiton_selected.replace(/\s/g, "");
            result = result.replace(/\s/g, "");
            strike_price = strike_price.replace(/\s/g, "");
            main_ce_pe = main_ce_pe.replace(/\s/g, "");
            option_lot_size = option_lot_size.replace(/\s/g, "");
            ltpValue = ltpValue.replace(/\s/g, "");
            // //////console.log("main_result", result);

            var main_nfo_trading_sytmbol = opiton_selected + result + strike_price + main_ce_pe

            var transaction_type = action === "Short" ? "SELL" : "BUY"

            // //////console.log('MainNFO:' + main_nfo_trading_sytmbol);

            var margin_calculation = {
              "id": calc_id++,
              "contract": `${opiton_selected}-${result}`,
              "exchange": "NFO",
              "product": "OPTION",
              "qty": option_lot_size,
              "strikePrice": strike_price,
              "price": ltpValue,
              "tradeType": transaction_type,
              "optionType": main_ce_pe
            }

            main_margin_calculations.push(margin_calculation)

            // //////console.log(margin_calculations)
            var main_row_instances = JSON.parse(localStorage.getItem('main_row_instances')) || [];

            main_row_instances.push(margin_calculation);


            localStorage.setItem('main_row_instances', JSON.stringify(main_row_instances));












            var parsedDate = new Date(expiry_date);









            var day = parsedDate.getDate().toString().padStart(2, "0");
            var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
            var year = parsedDate.getFullYear();
            var formattedDate_initial = day + "-" + month + "-" + year;

            function formatDate(inputDate) {
              const dateParts = inputDate.split("-"); // Split the input date by hyphen
              const day = dateParts[0]; // Extract day
              const month = dateParts[1]; // Extract month
              const year = dateParts[2]; // Extract year

              // Create an array of month abbreviations
              const monthAbbreviations = [
                "JAN",
                "FEB",
                "MAR",
                "APR",
                "MAY",
                "JUN",
                "JUL",
                "AUG",
                "SEP",
                "OCT",
                "NOV",
                "DEC",
              ];

              // Get the abbreviated month using the month value as an index
              const abbreviatedMonth = monthAbbreviations[parseInt(month) - 1];

              // Create the formatted date string
              const formattedDate = `${day}${abbreviatedMonth}${year}`;

              return formattedDate;
            }

            const inputDate = formattedDate_initial;
            const formattedDate = formatDate(inputDate);

            // //////console.log(formattedDate); // Output: "14SEP"
            var stockDropdown = $(".stockDropdown").val();
            // +1x NIFTY07SEP 19350CE - â¹ 125.3 (0.00)
            var add_position = $(`
                                    <div class="main_add_position_actions d-flex justify-content-between" id="">
                                        <div class="inner_position d-flex gap-1">
                                          <div class="buy_sell_indicator_options_futures ${action === "Long" ? "bg_indicator_buy" : "bg_indicator_sell"}" > ${action === "Long" ? "B" : "S"}</div>
                                            <div class="main_short_long_lot_size">
                                            <div class="short_long"><span class="long_short_inner">${action === "Long" ? "+" : "-"
              }</span></div> <div class="option_lot_size_input">${lot_size_inner}</div>x
                                        </div>
                                        <div class="symbol_expiry"><span class="symbol">${stockDropdown}</span><span class="expiry">${formattedDate}</span><span class="expiry_initial" style="display:none">${expiry_date}</span></div>
                                        <div class="strike_price_call_put"> <span class="strikePrice">${parseFloat(
                strike_price
              )}</span><span class="call_put_entrance">${option_side === "Call" ? "CE" : (option_side === "Put" ? "PE" : "FUTURE")}</span></div>
                                        <div class="ltp_main">-â¹<span class="entryPrice">${parseFloat(
                ltpValue
              )}</span>(<span class="exit_price">0</span>) <span class="current_price">0</span></div></div>

                                        <div class="action_option_strategy d-flex justify-content-center align-items-center gap-1">
                                                    <i class="bi bi-pencil-square edit-button" data-bs-toggle="modal" data-bs-target="#editPositionModal"></i>
                                                    <i class="bi bi-trash-fill delete-button dlt-btn" id="delete-btn"></i>
                                                    <i class='green-option-indicator exit_indicator'></i>
                                                </div>
                                            
                                            
                                            </div>

                                    `);

            $(".main_position").append(add_position);

            $(".dlt-btn").click(function () {

              // Find the closest parent element with class main_add_position_actions
              var main_add_position_actions = $(this).closest(
                ".main_add_position_actions"
              );

              // Get the id attribute from the found element
              var idValue = main_add_position_actions.attr("id");

              // Remove the clicked element
              main_add_position_actions.remove();
              $("#table-PL")
                .find("tr#" + idValue)
                .remove();
              $("#resultTable tbody")
                .find("tr#" + idValue)
                .remove();
              $(".data-display-table")
                .find("tr#" + idValue)
                .remove();

              var childrenLength = $(".main_position").children().length;
              ////////console.log("Children length in #myTable:", childrenLength);

              // Check if #myTable has no child elements
              if (childrenLength < 1) {
                // If it has no children, hide .main_table_instruments_data
                $(".main_position,.main_all_profit_loss,.main_bottom_strategy_positions").hide()
                $(".main_build_custom_strategy_empty").css("display", "flex")
                $("#customRange2").hide()
                $('#taget_date_table').hide()


                $("#resultTable tbody,#table-PL,.option_oi_charts,#chartdiv,.payoff_table_data").hide()





                $(".straddle").removeClass("option_strategies_active");
              } else {
                calculate_data();
                Table_chart_pyoff()
                margin_calculations()
              }

              // Output the id value to the console
              // //////console.log(idValue);
            });

            $(".edit-button").on("click", function (event) {
              event.stopPropagation();
              // //////console.log('Hii there');

              var position = $(this).closest(".main_add_position_actions");
              var option_lot_size_input = position
                .find(".option_lot_size_input")
                .text();
              var expiry_initial = position.find(".expiry_initial").text();
              var strikePrice = position.find(".strikePrice").text();
              var call_put_entrance = position
                .find(".call_put_entrance")
                .text();
              // Use a more specific selector for entryPrice
              var entryPrice = position.find(".entryPrice").first().text();
              $(".edit_entry").val(entryPrice);

              // // Check the value of call_put_entrance
              if (call_put_entrance === "CE" || call_put_entrance === "PE") {
                // Do not render HTML for .futures_edit when call_put_entrance is "CE" or "PE"
                $("#options_futures_uniques").val("OPT")
                $(".futures_edit").hide();
                $(".options_edit").show();

                var selectStrikePrice = $("#selectStrikePrice");

                selectStrikePrice.find("option").each(function () {
                  // Get the value of the current option
                  var optionValue = $(this).val();

                  // Check if the option value matches the value of closest_strike_price
                  if (optionValue === strikePrice) {
                    // Add the 'selected' attribute to the matching option
                    $(this).prop("selected", true);
                  }
                });

                // //////console.log(expiry_initial);
                var selectExpiry = $("#selectExpiry");

                selectExpiry.find("option").each(function () {
                  // Get the value of the current option
                  var expiryDate = $(this).val();
                  // //////console.log(expiryDate);

                  // Check if the option value matches the value of closest_strike_price
                  if (expiryDate === expiry_initial) {
                    // Add the 'selected' attribute to the matching option
                    $(this).prop("selected", true);
                  }
                });


              } else if (call_put_entrance === "FUTURE") {
                // Do not render HTML for .options_edit when call_put_entrance is "FUTURE"
                $(".options_edit").hide();
                $(".futures_edit").show();
                $("#options_futures_uniques").val("FUT")
                var selectExpiry = $(".futures_expiry");

                selectExpiry.find("option").each(function () {
                  // Get the value of the current option
                  var expiryDate = $(this).val();
                  // //////console.log(expiryDate);

                  // Check if the option value matches the value of closest_strike_price
                  if (expiryDate === expiry_initial) {
                    // Add the 'selected' attribute to the matching option
                    $(this).prop("selected", true);
                  }
                });

              }

              $(".futures_expiry").change(function () {
                var newValue = $(this).val(); // Get the new value from the changed element
                $(".futures_expiry").val(newValue); // Set the new value for all elements with the class

                // Set a delay of 0.5 seconds before updating ".edit_entry"
                setTimeout(function () {
                  $(".edit_entry").val($(".futures_ltp").text());
                }, 1000); // 500 milliseconds (0.5 seconds)
              });

              var long_short_inner = position.find(".long_short_inner").text();

              // Check the appropriate radio button based on long_short_inner
              if (long_short_inner === "+") {
                $(".long_radio").prop("checked", true);
              } else if (long_short_inner === "-") {
                $(".short_radio").prop("checked", true);
              }



              var optionType = $("#optionType");

              optionType.find("option").each(function () {
                // Get the value of the current option
                var optionValue = $(this).val();

                // Check if the option value matches the value of closest_strike_price
                if (optionValue === call_put_entrance) {
                  // Add the 'selected' attribute to the matching option
                  $(this).prop("selected", true);
                }
              });


              var exit_price = position.find(".current_price").first().text();
              $(".exit_price").val(exit_price);

              $(".counter_input_edit").val(option_lot_size_input);

              // //////console.log(entryPrice);

              function Edit_counter() {
                var counterValue = position
                  .find(".option_lot_size_input")
                  .text();

                // Function to update the input field with the current value
                function updateCounterInput() {
                  $(".counter_input_edit").val(counterValue);
                }

                // Initialize the input field
                updateCounterInput();

                // Increment button click handler
                $(".increment_edit").click(function () {
                  counterValue++;
                  updateCounterInput();
                });

                // Decrement button click handler
                $(".decrement_edit").click(function () {
                  if (counterValue > 1) {
                    counterValue--;
                    updateCounterInput();
                  }
                });
              }

              $("#editPositionModal").data("position", position);
              // //////console.log($('#editPositionModal').data('position', position));

              Edit_counter();

            });
            var elements = $(".main_add_position_actions");

            // Iterate through each element and update its id
            elements.each(function (index) {
              var newId = index + 1;
              $(this).attr("id", newId);
            });
          }

          // //////console.log(main_margin_calculations);
          // Add a click event handler to the delete-button

        },
      });
    }

    function getDate_on_date() {
      var todayDate = new Date();
      var todayDateString = formatDate(todayDate);

      // Generate options for the dropdown
      for (var i = 0; i <= 7; i++) {
        var optionDate = new Date();
        optionDate.setDate(todayDate.getDate() + i);
        var optionDateString = formatDate(optionDate);
        // $("#optionExpiryDropdown").append("<option value='" + optionDateString + "'>" + optionDateString + "</option>");
      }

      // Set the range min value as today's date
      logDateInfo("customRange2");

      // Event listener for dropdown change
      // $("#optionExpiryDropdown").change(function () {
      //   updateRangeLimits();
      //   logDateInfo("customRange2");
      // });

      // // Event listener for range input change
      // $("#customRange2").on("input", function () {
      //   logDateInfo("customRange2");
      // });

      // Function to format date as 'YYYY-MM-DD'
      function formatDate(date) {
        var year = date.getFullYear();
        var month = (date.getMonth() + 1).toString().padStart(2, '0');
        var day = date.getDate().toString().padStart(2, '0');
        return year + '-' + month + '-' + day;
      }

      // Function to update the range max value based on dropdown selection
      function updateRangeLimits() {
        var selectedDate = new Date($("#optionExpiryDropdown").val());
        var daysLeft = Math.ceil((selectedDate - todayDate) / (1000 * 60 * 60 * 24));

        // Set the range max to the maximum possible value (0) and min to the minimum days left
        $("#customRange2").attr("max", daysLeft);
        $("#customRange2").attr("min", 0);

        logDateInfo("customRange2");
      }

      // Function to log current date, days left, and current value of the range input
      function logDateInfo(rangeId) {
        var selectedDate = new Date($("#optionExpiryDropdown").val());
        var currentValue = $("#customRange2").val();
        var difference = parseFloat($("#customRange2").attr("max"));

        // Calculate the current date based on the difference in minutes
        var currentDate = new Date(selectedDate.getTime() - difference * (60 * 1000)); // Adjusted for minutes

        //////console.log("Current Date: " + formatDate(currentDate));
        //////console.log("Days Left to Selected Date for " + rangeId + ": " + difference);
        //////console.log("Current Value of " + rangeId + ": " + currentValue);
        //////console.log("Difference between Max and Current Value for " + rangeId + ": " + (difference - currentValue));

        var result = difference - currentValue;

        // Convert the result to a string if needed
        var resultAsString = String(currentValue);

        // Set the value into localstorage
        localStorage.setItem(rangeId, result);
      }

      updateRangeLimits();

    }



    function margin_calculations() {


      var main_margin_positions = [];
      var totalMargin = 0;
      var hasSellPosition = false; // Add global variable to check if there is any SELL position

      var lot_size_value = parseFloat($("#lot_size_value").text());

      $(".main_add_position_actions").each(function () {
        var $this = $(this);
        var symbol_name_margin = $this.find(".symbol").text();
        var expiry_margin = $this.find(".expiry").text();
        var option_lot_size_input = $this.find(".option_lot_size_input").text();
        var strikePrice_edit = $this.find(".strikePrice").text();
        var long_shorts = $this.find(".long_short_inner").text();
        var requiredStringValue = $this.find(".call_put_entrance").text();
        var entryPrice = $this.find(".entryPrice").text();

        var parts = expiry_margin.split('20');
        var formatted_expiry_margin = parts[0] + parts[1].slice(-2);

        // var main_margin_position = {
        //   "contract": `${symbol_name_margin}-${formatted_expiry_margin}`,
        //   "exchange": "NFO",
        //   "product": "OPTION",
        //   "qty": lot_size_value * parseInt(option_lot_size_input),
        //   "strikePrice": parseInt(strikePrice_edit),
        //   "tradeType": long_shorts === "+" ? "BUY" : "SELL",
        //   "optionType": requiredStringValue === "CE" ? "CALL" : "PUT",
        //   "entryPrice": parseFloat(entryPrice)
        // };

        // // {"contract":"NIFTY-28DEC23","exchange":"NFO","product":"FUTURE","qty":50,"strikePrice":0,"tradeType":"SELL"}

        // main_margin_positions.push(main_margin_position);



        if (requiredStringValue === "CE" || requiredStringValue === "PE") {
          var main_margin_position = {
            "contract": `${symbol_name_margin}-${formatted_expiry_margin}`,
            "exchange": "NFO",
            "product": "OPTION",
            "qty": lot_size_value * parseInt(option_lot_size_input),
            "strikePrice": parseInt(strikePrice_edit),
            "tradeType": long_shorts === "+" ? "BUY" : "SELL",
            "optionType": requiredStringValue === "CE" ? "CALL" : "PUT",
            "entryPrice": parseFloat(entryPrice)
          };

          main_margin_positions.push(main_margin_position);
        } else if (requiredStringValue === "FUTURE") {
          // For FUTURE product
          var main_margin_position = {
            "contract": `${symbol_name_margin}-${formatted_expiry_margin}`,
            "exchange": "NFO",
            "product": "FUTURE",
            "qty": lot_size_value * parseInt(option_lot_size_input),
            "strikePrice": 0,
            "tradeType": long_shorts === "+" ? "BUY" : "SELL",

          };

          main_margin_positions.push(main_margin_position);
        }














        // Check if tradeType is SELL and set hasSellPosition to true
        if (main_margin_position.tradeType === "SELL" || requiredStringValue === "FUTURE") {
          hasSellPosition = true;
          //////console.log('sell');

        } else {
          //////console.log('buy');

          // Multiply entryPrice by qty and add to totalMargin for BUY positions
          totalMargin += main_margin_position.entryPrice * main_margin_position.qty;
        }
      });
      console.log(main_margin_positions);
      // Display totalMargin in $("#margin_required") only if there are no SELL positions
      if (!hasSellPosition) {
        //////console.log(hasSellPosition);

        $("#margin_required").text(totalMargin.toFixed(2));
      } else {
        //////console.log(hasSellPosition);
        // Call AJAX if there are SELL positions
        $.ajax({
          type: "POST",
          url: "/angel_one_margin_calculations",
          data: JSON.stringify(main_margin_positions),
          contentType: "application/json; charset=utf-8",
          dataType: "json",
          success: function (data) {
            // Handle success response if needed
            //////console.log(data.margin.totalMargin);
            $("#margin_required").text(data.margin.totalMargin.toFixed(2));
          },
          error: function (error) {
            console.error("Error sending data:", error);
          }
        });
      }
    }



    loadStocks();

    loadExpiryData("NIFTY");

    loadOptionData("NIFTY", "");
    loadOptionData(selectedOption, selectedExpiry);
    function loadExpiryData(selectedOption) {
      // //////console.log("Hi there" + selectedOption);
      $.ajax({
        url: "/option_strategies_expiry",
        method: "GET",
        data: {
          selected_option: selectedOption,
        },
        success: function (response) {
          // Process the response from the server here

          var expiryDates = response.option_date.optionExpiryDate;
          var expiryStrikes = response.option_strike;
          populateExpiry_Strike(expiryDates, expiryStrikes);
        },
        error: function (error) {
          console.error("Error loading expiry data:", error);
        },
      });
    }

    function populateExpiry_Strike(expiryDates, expiryStrikes) {
      // Get the existing selected values before appending new options
      // //////console.log('Log Expiry');

      // Add each expiry date as an option without duplicates
      var addedExpiryDates = [];
      $(".expiry_date_input option").each(function () {
        addedExpiryDates.push(this.value);
      });

      expiryDates.forEach((expiry) => {
        var inputDate = expiry.expiry_date.split("T")[0];
        if (!addedExpiryDates.includes(inputDate)) {
          addedExpiryDates.push(inputDate);
          var parsedDate = new Date(inputDate);
          var day = parsedDate.getDate().toString().padStart(2, "0");
          var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
          var year = parsedDate.getFullYear();
          var formattedDate = day + "-" + month + "-" + year;

          $(".expiry_date_input").append(
            $("<option>", {
              value: inputDate, // You can keep the original value or use formattedDate if needed
              text: formattedDate,
            })
          );
        }
      });

      // Add each strike as an option without duplicates
      var addedStrikes = [];
      $(".strike_price_input option").each(function () {
        addedStrikes.push(parseInt(this.value));
      });
      // //////console.log(addedStrikes);
      expiryStrikes.forEach((strike) => {
        if (!addedStrikes.includes(strike)) {
          addedStrikes.push(strike);
          $(".strike_price_input").append(
            $("<option>", {
              value: strike,
              text: strike,
            })
          );
        }
      });
    }

    function loadStocks(selectedOption) {
      $.ajax({
        url: '{% url "get_stock_symbol" %}',
        type: "GET",
        success: function (data) {
          var stocksOptgroup = $(".stockDropdown optgroup[label='Stocks']");
          stocksOptgroup.empty();
          $.each(data, function (index, stock) {
            var option = $("<option>").text(stock.symbol_name);
            stocksOptgroup.append(option);
          });

          // If a selectedOption is provided, set it as selected
          if (selectedOption) {
            $(".stockDropdown").val(selectedOption);
          }
        },
      });
    }



    function Table_chart_pyoff() {


      var main_strike_price_dynamic = []

      var all_premium_sum = 0;
      $(".main_add_position_actions").each(function () {

        var lot_size_value = $("#lot_size_value").text()


        var long_shorts = $(this).find(".long_short_inner").text()
        var strikePrice_edit = $(this).find(".strikePrice").text()
        var premiums = $(this).find(".entryPrice").text()
        var option_lot_size_input = $(this).find(".option_lot_size_input").text()



        var requiredStringValue = $(this).find(".call_put_entrance").text()
        var final_strikePrice_edit = parseFloat(strikePrice_edit)
        var final_premiums = parseFloat(premiums)
        var final_lot_size = parseFloat(option_lot_size_input)
        var final_lot_premium = parseFloat(premiums)


        main_strike_price_dynamic.push({ final_strikePrice_edit, long_shorts, final_lot_premium, requiredStringValue })




        var lot_size_value = $("#lot_size_value").text()

        if (long_shorts === "+") {

          all_premium_sum += premiums * parseFloat(lot_size_value);
        } else if (long_shorts === "-") {
          all_premium_sum += -premiums * parseFloat(lot_size_value);

        }



      });

      // ////console.log(main_strike_price_dynamic);

      if (all_premium_sum > 0) {
        $("#net_credit").text("0");
      } else {
        $("#net_credit").text((Math.abs(all_premium_sum)).toFixed(2));
      }
      //////console.log("Net Credit ", (all_premium_sum).toFixed(2));
      // //////console.log("main_strike_price_dynamic", main_strike_price_dynamic);



      // final_long_call_new.push(MAX(0, strike_price -spot_strike ) - long_call);
      //     final_long_put_new.push( MAX(0, spot_strike -strike_price )-long_put );


      var resultArray = []; // Array to hold arrays

      var lot_size = parseInt($("#lot_size_value").text())

      var option_simulator_body = $(".strategy_option_chain");

      function ULTRAMAX(a, b) {
        return a > b ? a : b;
      }


      option_simulator_body.find(".strike_price").each(function () {
        var ultra_strike_price = parseInt($(this).text());

        // //////console.log("ultra_strike_price         "  + ultra_strike_price);


        var tempArray = []; // Temporary array to store values
        main_strike_price_dynamic.forEach(function (item) {
          //////console.log("item", item);
          if (item.requiredStringValue === 'CE' && item.long_shorts === '+') {
            // //////console.log('Inside CE and + condition');
            // //////console.log(parseFloat(item.final_strikePrice_edit));
            // //////console.log(parseFloat(item.final_lot_premium));
            //////console.log(ultra_strike_price);


            tempArray.push(ULTRAMAX(0, ultra_strike_price - parseFloat(item.final_strikePrice_edit)) - parseFloat(item.final_lot_premium));

            // //////console.log(ULTRAMAX(0, ultra_strike_price - parseFloat(item.final_strikePrice_edit)) - parseFloat(item.final_lot_premium));
          }
          if (item.requiredStringValue === 'CE' && item.long_shorts === '-') {
            // //////console.log('Inside CE and - condition');
            tempArray.push(parseFloat(item.final_lot_premium) - ULTRAMAX(0, ultra_strike_price - parseFloat(item.final_strikePrice_edit)));
          }
          if (item.requiredStringValue === 'PE' && item.long_shorts === '+') {
            // //////console.log('Inside PE and + condition');
            tempArray.push(ULTRAMAX(0, parseFloat(item.final_strikePrice_edit) - ultra_strike_price) - parseFloat(item.final_lot_premium));
          }
          if (item.requiredStringValue === 'PE' && item.long_shorts === '-') {
            // //////console.log('Inside PE and - condition');
            tempArray.push(parseFloat(item.final_lot_premium) - ULTRAMAX(0, parseFloat(item.final_strikePrice_edit) - ultra_strike_price));
          }

          if (item.requiredStringValue === "FUTURE" && item.long_shorts === "-") {
            tempArray.push(parseFloat(item.final_strikePrice_edit) - ultra_strike_price);
          }
          if (item.requiredStringValue === "FUTURE" && item.long_shorts === "+") {
            tempArray.push(ultra_strike_price - parseFloat(item.final_strikePrice_edit));
          }

        });
        //////console.log(tempArray);
        resultArray.push(tempArray); // Push the tempArray into the resultArray
      });

      ////console.log("resultArray", resultArray);


      // Sample array of arrays
      var arrayOfArrays = resultArray

      // Get all elements with the class 'option_lot_size_input'
      var lotSizeElements = document.querySelectorAll('.main_add_position_actions .option_lot_size_input');

      // Convert the text content of each element to an integer and store in an array
      var lotSizeValues = Array.from(lotSizeElements).map(element => parseInt(element.textContent));
      //////console.log("lotSizeValues", lotSizeValues);

      // Loop through the array of arrays and perform index-wise multiplication
      for (var i = 0; i < arrayOfArrays.length; i++) {
        for (var j = 0; j < arrayOfArrays[i].length; j++) {
          arrayOfArrays[i][j] *= lotSizeValues[j] || 1; // Default to 1 if lotSizeValues is not defined
        }
      }

      // Print the modified array of arrays
      // //////console.log(arrayOfArrays);
























      var sumArray = resultArray.map(function (array) {
        var sum = array.reduce(function (acc, value) {
          return acc + value;
        }, 0);
        return sum * lot_size;
      });



      var positiveValues = sumArray.filter(value => value > 0);
      var negativeValues = sumArray.filter(value => value < 0);

      //////console.log("Positive Values:", positiveValues);
      //////console.log("Negative Values:", negativeValues);

      // Find the maximum value in positiveValues
      var maxPositive = Math.max(...positiveValues);

      // Find the minimum value in negativeValues
      var minNegative = Math.min(...negativeValues);
      var maxProfit = Math.max(...positiveValues);

      // Find the minimum value in negativeValues
      var maxLoss = Math.min(...negativeValues);

      //////console.log("Maximum Value in Positive Values:", maxPositive);
      //////console.log("Minimum Value in Negative Values:", minNegative);

      // Check if maxPositive has duplicates in positiveValues
      var positiveDuplicates = positiveValues.filter(value => value === maxPositive);
      if (positiveDuplicates.length > 1) {
        //////console.log("Max Positive Value has Duplicates in Positive Values:", positiveDuplicates);
      } else {
        //////console.log("Max Positive Value does not have Duplicates in Positive Values");
      }

      // Check if minNegative has duplicates in negativeValues
      var negativeDuplicates = negativeValues.filter(value => value === minNegative);
      if (negativeDuplicates.length > 1) {
        //////console.log("Min Negative Value has Duplicates in Negative Values:", negativeDuplicates);
      } else {
        //////console.log("Min Negative Value does not have Duplicates in Negative Values");
      }






      //////console.log('main_strike_price_dynamic', main_strike_price_dynamic);

      var plusCount = main_strike_price_dynamic.filter(obj => obj.long_shorts === '+').length;
      var minusCount = main_strike_price_dynamic.filter(obj => obj.long_shorts === '-').length;

      if (plusCount > minusCount) {
        //////console.log("'+' appears more");
        // Check if sumArray contains only positive values

        $("#max_profit").text("Unlimited");
        $("#max_loss").text((maxLoss).toFixed(2));


        var positiveDuplicates = positiveValues.filter(value => value === maxPositive);
        if (positiveDuplicates.length > 1) {
          //////console.log("Max Positive Value has Duplicates in Positive Values:", positiveDuplicates);
          $("#max_profit").text((maxProfit).toFixed(2));
        } else {
          //////console.log("Max Positive Value does not have Duplicates in Positive Values");
          $("#max_profit").text("Unlimited");
        }

      } else if (minusCount > plusCount) {
        //////console.log("'-' appears more");

        $("#max_profit").text((maxProfit).toFixed(2));
        $("#max_loss").text("Unlimited");

        var negativeDuplicates = negativeValues.filter(value => value === minNegative);
        if (negativeDuplicates.length > 1) {
          //////console.log("Min Negative Value has Duplicates in Negative Values:", negativeDuplicates);
          $("#max_loss").text((maxLoss).toFixed(2));
        } else {
          //////console.log("Min Negative Value does not have Duplicates in Negative Values");
          $("#max_loss").text("Unlimited");
        }

      } else {
        //////console.log("'+' and '-' appear the same number of times");

        $("#max_profit").text((maxProfit).toFixed(2));
        $("#max_loss").text((maxLoss).toFixed(2));
      }































      // Calculate and set the ratio
      var ratio = Math.max(...sumArray) / Math.min(...sumArray);
      $("#ratio").text(ratio.toFixed(2));







      var all_premium_chart = []
      $(".main_logic").each(function () {
        var premium_condition = $(this).find(".short_long").text()
        var premuim_values = parseFloat($(this).find(".ltp_edit").text())
        // //////console.log(premium_condition);
        if (premium_condition === "-") {
          all_premium_chart.push(-Math.abs(premuim_values))
        } else {
          all_premium_chart.push(Math.abs(premuim_values))

        }
      })
      // //////console.log(all_premium_chart);

      var sum_all_premium_chart = all_premium_chart.reduce(function (a, b) {
        return a + b;
      }, 0);

      // //////console.log("Sum of all elements in all_premium_chart array: ", sum_all_premium_chart);
      // Your existing code to generate chart data goes here
      var option_simulator_body = $(".strategy_option_chain");
      // //////console.log(option_simulator_body);
      const closest_value = parseInt($(".closest_value").text()); // Parse closest_value as an integer
      // Create a new array to store strike prices
      var strikePrices = [];
      var main_calls_ltp = 0;
      var main_puts_ltp = 0;

      // Use the .each() method to iterate through elements with the class .simulator_strike
      option_simulator_body.find(".strike_price").each(function () {
        var strike_price = $(this).text(); // Get the text value of the current element
        strikePrices.push(strike_price); // Push it into the array
        // //////console.log(strike_price);

        if (parseInt(strike_price) === closest_value) {
          var calls_ltp = $(this).closest('.call_put_tr').find(".calls_ltp").text();
          var puts_ltp = $(this).closest('.call_put_tr').find(".puts_ltp").text();
          main_calls_ltp = calls_ltp;
          main_puts_ltp = puts_ltp;
        }
      });














      // Define the MAX function
      function MAX(a, b) {
        return a > b ? a : b;
      }

      // Initialize arrays
      var final_long_call_new = [];
      var final_long_put_new = [];
      var addition_result = [];

      // Add the arrays








      // Loop through each element
      option_simulator_body.find(".simulator_strike").each(function () {








        var strike_price = parseInt($(this).text()); // Get the text value of the current element
        var spot_strike = 19800;
        var long_call = 113;
        var long_put = 111.3;
        // MAX(0,13650-14700)-136.8)
        // Calculate and push the values
        final_long_call_new.push(MAX(0, strike_price - spot_strike) - long_call);
        final_long_put_new.push(MAX(0, spot_strike - strike_price) - long_put);

        // Perform addition between the elements
        var index = final_long_call_new.length - 1;
        addition_result.push((final_long_call_new[index] + final_long_put_new[index]) * 50);
      });

      // Display the results
      // //////console.log("Final Long Call New: ", final_long_call_new);
      // //////console.log("Final Long Put New: ", final_long_put_new);
      // //////console.log("Addition Result: ", addition_result);







      // //////console.log(strikePrices);
      // //////console.log("Main calls_ltp: " + main_calls_ltp);
      // //////console.log("Main puts_ltp: " + main_puts_ltp);

      var final_p_l = []
      const priceDifferences = strikePrices.map((strikePrice) => Math.abs(closest_value - strikePrice));
      // //////console.log(priceDifferences);
      priceDifferences.forEach((p_l) => {
        final_p_l.push(-(sum_all_premium_chart - p_l) * parseInt(lot_size))
      });
      // //////console.log(final_p_l)

      var spot_price = $(".last_traded_price").text()

      // Add the following code to your Table_chart_pyoff function after the final_p_l array is populated
      var chart = am4core.create("chartdiv", am4charts.XYChart);

      // Add data
      var chartData = [];
      var tableData = []
      for (var i = 0; i < strikePrices.length; i++) {
        var cleanCategory = strikePrices[i].trim();
        tableData.push({ category: cleanCategory, value: sumArray[i] });
        chartData.push({ category: strikePrices[i], value: sumArray[i] });
      }
      // //console.log("@",tableData);




      chart.data = chartData;

      // Create axes
      var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
      categoryAxis.dataFields.category = "category";
      categoryAxis.renderer.grid.template.location = 0;
      categoryAxis.renderer.minGridDistance = 100;
      chart.logo.disabled = true;
      var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

      // Draw a horizontal line at y-axis 0
      var zeroLine = valueAxis.axisRanges.create();
      zeroLine.value = 0;
      zeroLine.grid.stroke = am4core.color("#000"); // Color of the line
      zeroLine.grid.strokeWidth = 2; // Line width
      zeroLine.grid.strokeOpacity = 0.5; // Line opacity

      // Create series
      var series = chart.series.push(new am4charts.LineSeries());
      series.dataFields.valueY = "value";
      series.dataFields.categoryX = "category";
      series.strokeWidth = 2;
      series.minBulletDistance = 10;
      series.tooltipText = " StrikePrice:{category}   \n  P&L:{value}";

      series.strokeDasharray = "5,5"; // This sets the line as dashed with 5px dashes and 5px gaps
      series.tooltip.getFillFromObject = false;
      series.tooltip.background.fill = am4core.color("white"); // Set the tooltip background color to gray
      series.tooltip.background.stroke = am4core.color("#000000"); // Set the tooltip border color to black
      series.tooltip.background.strokeWidth = 1; // Set the tooltip border width
      series.tooltip.background.strokeOpacity = 0.4; // Set the tooltip border opacity
      series.tooltip.background.filters.push(new am4core.DropShadowFilter());
      series.tooltip.label.fill = am4core.color("#000000"); // Set the font color to black


      // Remove chart watermark


      var spot_price = parseFloat($(".last_traded_price").text()); // Get the spot price value as a float

      // Find the index of the spot price in the strikePrices array
      var spotIndex = strikePrices.indexOf(spot_price.toString());

      // Highlight the spot price on the chart
      if (spotIndex !== -1) {
        var range = categoryAxis.axisRanges.create();
        range.category = strikePrices[spotIndex];
        range.endCategory = strikePrices[spotIndex];
        range.axisFill.fill = am4core.color("#ff0000"); // Set the fill color to red
        range.axisFill.fillOpacity = 0.2; // Adjust the opacity of the fill
      }



      var range = valueAxis.createSeriesRange(series);
      range.value = 0;
      range.endValue = Infinity;

      range.contents.fill = am4core.color("rgba(0, 255, 0, 1.0)"); // Set the fill color above 0 to green with opacity

      range.contents.fillOpacity = 0.2; // Adjust the opacity of the fill

      var range2 = valueAxis.createSeriesRange(series);
      range2.value = -Infinity;
      range2.endValue = 0;

      range2.contents.fill = am4core.color("rgba(255, 0, 0, 1.0)"); // Set the fill color below 0 to red with opacity
      range2.contents.fillOpacity = 0.2; // Adjust the opacity of the fill



      // Set the tooltip appearance
      chart.tooltip.getFillFromObject = false;
      chart.tooltip.background.fill = am4core.color("#888888"); // Set the tooltip background color to gray
      chart.tooltip.background.stroke = am4core.color("#000000"); // Set the tooltip border color to black
      chart.tooltip.background.strokeWidth = 2; // Set the tooltip border width
      chart.tooltip.background.strokeOpacity = 0.8; // Set the tooltip border opacity
      chart.tooltip.background.filters.push(new am4core.DropShadowFilter()); // Add a slight shadow to the tooltip

      // Add scrollbar
      chart.scrollbarX = new am4core.Scrollbar();
      chart.scrollbarX.minHeight = 5;
      chart.scrollbarX.marginBottom = 15;
      chart.scrollbarX.thumbMinHeight = 100; // Adjust the value as per your requirement

      function customizeGrip(grip) {
        // This is empty for now
        grip.icon.disabled = true;

        grip.width = 10;
        grip.height = 20;
      }

      customizeGrip(chart.scrollbarX.startGrip);
      customizeGrip(chart.scrollbarX.endGrip);




      var bullet = series.bullets.push(new am4charts.CircleBullet());
      bullet.circle.stroke = am4core.color("#fff");
      bullet.circle.strokeWidth = 2;
      bullet.fillOpacity = 0;
      bullet.strokeOpacity = 0;
      bullet.circle.radius = 6; // Adjust this value to change the size of the bullet


      var bulletState = bullet.states.create("hover");
      bulletState.properties.fillOpacity = 1;
      bulletState.properties.strokeOpacity = 1;







      var cursor = new am4charts.XYCursor();
      cursor.lineX.stroke = am4core.color("black"); // set color for the X-axis cursor line
      cursor.lineY.stroke = am4core.color("#000"); // set color for the Y-axis cursor line
      cursor.lineX.strokeWidth = 2; // set width of the X-axis cursor line
      cursor.lineY.strokeWidth = 0; // set width of the Y-axis cursor line
      chart.cursor = cursor;

      // chart.scrollbarX = new am4core.Scrollbar();
      // chart.scrollbarX.position = "bottom"; // set the position of the scrollbar at the bottom of the chart


      // Make chart take up the entire space of its container
      chart.width = am4core.percent(100);
      chart.height = am4core.percent(100);





      // //////console.log('Hi');

      var todayDate = new Date();
      var todayDateString = formatDate(todayDate);

      // Generate options for the dropdown
      for (var i = 0; i <= 7; i++) {
        var optionDate = new Date();
        optionDate.setDate(todayDate.getDate() + i);
        var optionDateString = formatDate(optionDate);
        // $("#optionExpiryDropdown").append("<option value='" + optionDateString + "'>" + optionDateString + "</option>");
      }

      // Set the range min value as today's date
      logDateInfo("customRange2");

      // Event listener for dropdown change
      $("#optionExpiryDropdown").change(function () {
        updateRangeLimits();
        logDateInfo("customRange2");
        black_scholes_table(tableData)
      });

      // Event listener for range input change
      $("#customRange2").on("input", function () {
        logDateInfo("customRange2");
        black_scholes_table(tableData)
      });


      // Function to format date as 'YYYY-MM-DD'
      function formatDate(date) {
        var year = date.getFullYear();
        var month = (date.getMonth() + 1).toString().padStart(2, '0');
        var day = date.getDate().toString().padStart(2, '0');
        var hours = date.getHours().toString().padStart(2, '0');
        var minutes = date.getMinutes().toString().padStart(2, '0');
        return year + '-' + month + '-' + day
      }
      // Function to update the range max value based on dropdown selection
      function updateRangeLimits() {

        // Select all elements with the class "expiry_initial"
        var expiryElements = $(".expiry_initial");

        // Check if there are any elements with the class
        if (expiryElements.length > 0) {

          // Initialize the variable to store the minimum date
          var minDate = null;

          // Loop through each element with the class "expiry_initial"
          expiryElements.each(function () {

            // Get the text content of the current element
            var currentDateText = $(this).text().trim();

            // Parse the date string into a JavaScript Date object
            var currentDate = new Date(currentDateText);

            // Check if the date is valid
            if (!isNaN(currentDate.getTime())) {

              // If minDate is null or the current date is earlier than minDate, update minDate
              if (minDate === null || currentDate < minDate) {
                minDate = currentDate;
              }
            }
          });

          // Check if a valid minimum date was found
          if (minDate !== null) {

            // Convert the minimum date to a string in the desired format (e.g., "YYYY-MM-DD")
            var minDateString = minDate.toISOString().split('T')[0];

            // Log the minimum date
            // //////console.log(minDateString);


            var selectedDate = new Date(minDateString);
            var daysLeft = Math.ceil((selectedDate - todayDate) / (1000 * 60 * 60 * 24));

            // Set the range max to the maximum possible value (0) and min to the minimum days left
            $("#customRange2").attr("max", daysLeft);
            $("#customRange2").attr("min", 0);

            logDateInfo("customRange2");
          } else {
            // Log a message if no valid dates were found
            //////console.log("No valid dates found.");
          }

        } else {
          // Log a message if no elements with the class "expiry_initial" were found
          //////console.log("No elements with the class 'expiry_initial' found.");
        }

      }

      // Function to log current date, days left, and current value of the range input
      function logDateInfo(rangeId) {
        var selectedDate = new Date($("#optionExpiryDropdown").val());
        var currentValue = $("#customRange2").val();
        var difference = parseFloat($("#customRange2").attr("max"));

        // Calculate the current date based on the difference in minutes
        var currentDate = new Date(selectedDate.getTime() - difference * (60 * 1000)); // Adjusted for minutes

        // //////console.log("Current Date: " + formatDate(currentDate));
        // //////console.log("Days Left to Selected Date for " + rangeId + ": " + difference);
        // //////console.log("Current Value of " + rangeId + ": " + currentValue);
        // //////console.log("Difference between Max and Current Value for " + rangeId + ": " + (difference - currentValue));

        var result = difference - currentValue;

        // Convert the result to a string if needed
        var resultAsString = String(currentValue);

        // Set the value into localstorage
        localStorage.setItem(rangeId, result);

        var targetDate = new Date(currentDate.getTime() - result * 24 * 60 * 60 * 1000);

        $("#target_date_full").empty().append("On Date : " + formatDate(targetDate));
        $(".on_date_expiry").empty().append("On Date " + formatDate(targetDate));
        $("#target_date").empty().append(`Target Date: ${result}D to expiry`);
      }

      updateRangeLimits();

      black_scholes_table(tableData)
    }


    function black_scholes_table(tableData) {

      //console.log("tableData", tableData);
      var option_simulator_body = $(".main_option_chain");
      var optionExpiryDropdown = $("#optionExpiryDropdown").val();
      var last_traded_price = $(".last_traded_price").text();
      var futures_ltp = $(".futures_ltp").text();

      var optionsData = []; // Array to store option data as objects

      option_simulator_body.each(function () {
        var strike_price = $(this).find(".strike_price").text();
        var calls_iv = $(this).find(".calls_iv").text();
        var puts_iv = $(this).find(".puts_iv").text();

        var optionObject = {
          strike_price: parseFloat(strike_price),
          calls_iv: parseFloat(calls_iv),
          puts_iv: parseFloat(puts_iv)
        };

        optionsData.push(optionObject);
      });

      //console.log("optionsData", optionsData);

      var retrievedValue = localStorage.getItem("customRange2");
      //console.log("Retrieved value from localstorage for " + "customRange2" + ": " + retrievedValue);

      // Use jQuery AJAX to send the data to Django

      if (parseInt(retrievedValue) !== 0) {

        //console.log("Options more than one day");
        $.ajax({
          type: 'POST',
          url: '/black_scholes_option_price',
          data: {
            'options_data': JSON.stringify(optionsData),
            'option_expiry': optionExpiryDropdown,
            'last_traded_price': last_traded_price,
            'onDate': retrievedValue,
            'futures_ltp': futures_ltp,
            csrfmiddlewaretoken: '{{ csrf_token }}' // Add CSRF token for security
          },

          dataType: 'json', // Expect JSON response from Django
          success: function (data) {
            // Print the response from Django (you can handle it as needed)
            // //////console.log(data);


            var premiumsData = data.main_premiums;
            var main_all_data = [];

            var single_premiumData = premiumsData[0]

            //////console.log(single_premiumData);

            var All_futures = data.All_futures;

            //console.log("All_futures", All_futures);




            $(".main_add_position_actions").each(function () {
              var lot_size_value = parseFloat($("#lot_size_value").text());
              var long_shorts = $(this).find(".long_short_inner").text();
              var strikePrice_edit = parseFloat($(this).find(".strikePrice").text());
              var requiredStringValue = $(this).find(".call_put_entrance").text();
              var option_lot_size_input = parseFloat($(this).find(".option_lot_size_input").text()); // Assuming this should be a number

              // Your existing code
              var matchingPremiumsArray = [];

              $.each(premiumsData, function (index, dayData) {
                var dayDiv = $('<div>').appendTo('#premiums-container');
                dayDiv.append('<h3>Day ' + dayData.day + '</h3');

                // New array to store matching premiums for the current day
                var matchingPremiumsForDay = [];

                // Check if dayData.premiums is defined
                if (dayData.premiums) {
                  // Loop through daily premiums
                  $.each(dayData.premiums, function (i, optionData) {
                    var optionDiv = $('<div>').appendTo(dayDiv);
                    optionDiv.append('<p>Strike Price: ' + optionData.strikePrice + '</p>');
                    optionDiv.append('<p>Call Price: ' + optionData.call_price + '</p>');
                    optionDiv.append('<p>Put Price: ' + optionData.put_price + '</p>');

                    // Check if optionData is defined and compare strikePrice
                    if (optionData && optionData.strikePrice === strikePrice_edit) {
                      // If the strikePrice matches, push the premium to the array
                      matchingPremiumsForDay.push(optionData);
                      // //console.log("optionData",optionData);
                    }
                  });
                }

                // Log the matching premiums for the current day
                //console.log('Matching Premiums for Day ' + dayData.day, matchingPremiumsForDay);

                // Add key-value pair to the matchingPremiumsArray
                matchingPremiumsArray.push({ day: dayData.day, premiums: matchingPremiumsForDay });

                // Your existing code
                $.each(matchingPremiumsForDay, function (i, matchingPremium) {
                  var main_premiums_black_scholes = {
                    "StrikePrice": parseFloat(matchingPremium.strikePrice),
                    "long_shorts": long_shorts,
                    "requiredStringValue": requiredStringValue,
                    "option_lot_size_input": option_lot_size_input,
                    "day": dayData.day, // Include the day information here
                  };

                  if (requiredStringValue === "CE") {
                    //console.log("CE");
                    main_premiums_black_scholes["ltp"] = parseFloat(matchingPremium.call_price);
                  } else if (requiredStringValue === "PE") {
                    //console.log("PE");
                    main_premiums_black_scholes["ltp"] = parseFloat(matchingPremium.put_price);
                  } else if (requiredStringValue === "FUTURE") {
                    //console.log("FUTURE");
                    main_premiums_black_scholes["ltp"] = parseFloat(matchingPremium.future_price);

                  }
                  // //console.log("main_premiums_black_scholes",main_premiums_black_scholes);
                  main_all_data.push(main_premiums_black_scholes);
                });
              });

              //console.log('All Matching Premiums:', matchingPremiumsArray);
            });


            // Sort main_all_data based on the "day" property
            main_all_data.sort((a, b) => a.day - b.day);

            // Create an object to store grouped data
            var groupedData = {};

            // Group data by day
            main_all_data.forEach(function (item) {
              var day = item.day;

              // Convert day to a string
              var dayString = 'Day ' + day;

              // Create an array for the day if it doesn't exist
              if (!groupedData[dayString]) {
                groupedData[dayString] = [];
              }

              // Push the item to the array for the corresponding day
              groupedData[dayString].push(item);
            });

            // Now groupedData contains the data grouped by day
            //console.log('Grouped Data:', groupedData);

            var resultArray = [];
            var lot_size = parseInt($("#lot_size_value").text());
            var option_simulator_body = $(".strategy_option_chain");

            function ULTRAMAX(a, b) {
              return a > b ? a : b;
            }

            if (single_premiumData.premiums) {
              single_premiumData.premiums.forEach(function (premium, index) {
                var ultra_strike_price = premium.strikePrice;

                Object.values(groupedData).forEach(function (items, dayIndex) {
                  var tempArray = []; // Move tempArray initialization inside the day loop

                  items.forEach(function (item) {
                    if (item.requiredStringValue === 'CE' && item.long_shorts === '+') {

                      //console.log('CE+');

                      tempArray.push(ULTRAMAX(0, ultra_strike_price - parseFloat(item.StrikePrice)) - parseFloat(item.ltp));
                    }
                    if (item.requiredStringValue === 'CE' && item.long_shorts === '-') {

                      //console.log('CE-');
                      tempArray.push(parseFloat(item.ltp) - ULTRAMAX(0, ultra_strike_price - parseFloat(item.StrikePrice)));
                    }
                    if (item.requiredStringValue === 'PE' && item.long_shorts === '+') {


                      //console.log('PE+');
                      tempArray.push(ULTRAMAX(0, parseFloat(item.StrikePrice) - ultra_strike_price) - parseFloat(item.ltp));
                    }
                    if (item.requiredStringValue === 'PE' && item.long_shorts === '-') {
                      //console.log('PE-');
                      tempArray.push(parseFloat(item.ltp) - ULTRAMAX(0, parseFloat(item.StrikePrice) - ultra_strike_price));
                    }
                    if (item.requiredStringValue === "FUTURE" && item.long_shorts === "-") {
                      //console.log('FUTURE-');
                      tempArray.push(parseFloat(item.StrikePrice) - ultra_strike_price);
                    }
                    if (item.requiredStringValue === "FUTURE" && item.long_shorts === "+") {
                      //console.log('FUTURE+');
                      tempArray.push(ultra_strike_price - parseFloat(item.StrikePrice));
                    }
                  });


                  // Push each day's data individually
                  resultArray.push({ day: dayIndex + 1, values: tempArray });
                });
              });
            }

            resultArray.sort((a, b) => a.day - b.day);

            // Group the sorted resultArray by day
            var groupedResultArray = resultArray.reduce((acc, obj) => {
              var key = obj.day;
              (acc[key] || (acc[key] = [])).push(obj);
              return acc;
            }, {});

            //console.log("groupedResultArray", groupedResultArray);


            // var arrayOfArrays = groupedResultArray;

            // var lotSizeValues = premiumsData.map(element => parseInt(element.option_lot_size_input));

            // for (var i = 0; i < arrayOfArrays.length; i++) {
            //   for (var j = 0; j < arrayOfArrays[i].length; j++) {
            //     arrayOfArrays[i][j] *= lotSizeValues[j] || 1;
            //   }
            // }

            // //////console.log(arrayOfArrays);
            var groupedLotSizes = {};

            Object.values(groupedData).forEach(function (items, dayIndex) {
              var lotSizesForDay = [];

              items.forEach(function (item) {
                // //////console.log(item.option_lot_size_input);

                // Push the option_lot_size_input into lotSizesForDay
                lotSizesForDay.push(item.option_lot_size_input);
              });

              // Assign the array of lot sizes to the corresponding day in groupedLotSizes
              groupedLotSizes[dayIndex + 1] = lotSizesForDay;
            });

            // //////console.log(groupedLotSizes);


            // groupedResultArray.forEach((group)=>{
            //   //////console.log(group);
            // })

            // Assuming groupedResultArray is your inner_group
            const multipliedValuesArray = [];

            Object.values(groupedResultArray).forEach(function (group, dayIndex) {
              const dayMultipliedValues = [];

              group.forEach((inner_group) => {
                const matchingLotSizeValues = groupedLotSizes[inner_group.day];

                if (matchingLotSizeValues) {
                  const multipliedValues = inner_group.values.map((value, valueIndex) => {
                    const matchingLotSizeValue = matchingLotSizeValues[valueIndex] || 1;
                    return value * matchingLotSizeValue * lot_size;
                  });

                  dayMultipliedValues.push({
                    day: inner_group.day,
                    values: multipliedValues
                  });
                } else {
                  // //////console.log("No matching lot sizes found for day", inner_group.day);
                }
              });

              multipliedValuesArray.push({
                day: dayIndex + 1,
                multipliedValues: dayMultipliedValues
              });
            });

            // //////console.log("Multiplied Values Array:", multipliedValuesArray);
            // //////console.log(tableData);


            const allValuesDayWise = [];

            // Iterate through the data and push all values day-wise
            multipliedValuesArray.forEach(dayData => {
              dayData.multipliedValues.forEach(innerData => {
                allValuesDayWise.push({
                  day: dayData.day,
                  values: innerData.values
                });
              });
            });

            // //////console.log(allValuesDayWise);


            const result = {};

            allValuesDayWise.forEach((individual) => {
              const day = individual.day;
              const sum = individual.values.reduce((acc, value) => acc + value, 0);

              if (!result[day]) {
                result[day] = [];
              }

              result[day].push(sum);
            });

            // Create a new array of objects
            const All_day_data = Object.keys(result).map(day => ({ day: Number(day), sums: result[day] || [] }));

            // Display the new array
            // //////console.log(All_day_data);
            // //////console.log(tableData);




            var dynamicDayKey = "Day-";

            var mergedData = [];

            // Iterate over each day data
            All_day_data.forEach((dayData) => {
              // Check if the dayData has sums for the current day
              if (dayData.sums.length > 0) {
                // Iterate over each category in dayData
                dayData.sums.forEach((sum) => {
                  // Create a new merged item for each category
                  var mergedItem = {
                    category: "", // Set the category dynamically based on your logic
                    value: 0,      // Set the value dynamically based on your logic
                  };

                  // Set the dynamic day key
                  var dayKey = dynamicDayKey + dayData.day;
                  mergedItem[dayKey] = sum;

                  // Push the merged item into mergedData
                  mergedData.push(mergedItem);
                });
              }
            });

            // Iterate over each item in tableData
            tableData.forEach((data, dataIndex) => {
              // Find the corresponding entry in mergedData based on the index
              var mergedItem = mergedData[dataIndex];

              // If a corresponding entry is found, set category and value
              if (mergedItem) {
                mergedItem.category = data.category; // Set the category based on your logic
                mergedItem.value = data.value;       // Set the value based on your logic
              }
            });

            // Print the final merged array
            var all_day_merged_data = [];

            mergedData.forEach((day_data) => {
              let dayObject = {};

              for (let i = 1; i <= 7; i++) {
                const dayKey = "Day-" + i;

                if (day_data.hasOwnProperty(dayKey)) {
                  dayObject[dayKey] = day_data[dayKey];
                }
              }

              all_day_merged_data.push(dayObject);
            });

            //  //console.log(all_day_merged_data);


            var grouped_data = {};

            all_day_merged_data.forEach(function (data_point) {
              for (var day in data_point) {
                if (!grouped_data[day]) {
                  grouped_data[day] = [];
                }
                grouped_data[day].push(data_point[day]);
              }
            });

            var _result = Object.entries(grouped_data).map(([day, values]) => ({ [day]: values }));

            // //////console.log(_result);
            // var sumArray = resultArray.map(function (array) {
            //   var sum = array.reduce(function (acc, value) {
            //     return acc + value;
            //   }, 0);
            //   return sum * lot_size;
            // });

            // //////console.log(sumArray);
            var categories = tableData.map(data => parseInt(data.category));
            var values = tableData.map(data => data.value);

            // Structure _result with category and value arrays
            _result = [
              { "Strikes": categories },
              ..._result,
              { "ON-Expiry": values }
            ];

            // Print the merged _result

            // Print the merged _result
            //console.log("_result", _result);


            var table = $(".payoff_table_main_table");

            // Clear any existing content
            table.empty();

            // Find the maximum number of values among all days
            var maxValuesCount = Math.max(..._result.map(dayData => dayData[Object.keys(dayData)[0]].length));

            // Create the table header dynamically
            var thead = $("<thead>");
            var headerRow = $("<tr>");

            // Add header cells for each day
            _result.forEach(function (dayData) {
              var day = Object.keys(dayData)[0];
              headerRow.append($("<th>").text(day));
            });

            thead.append(headerRow);
            table.append(thead);

            // Loop through values row-wise and create table rows and cells
            for (var i = 0; i < maxValuesCount; i++) {
              var row = $("<tr>")

              // Loop through each day's values
              _result.forEach(function (dayData) {
                var dayKey = Object.keys(dayData)[0]; // Extract day key outside the loop
                var values = dayData[dayKey];

                var values_con = values[i] < 0 ? "text-danger" : "text-success";
                var cell = $("<td>").addClass("cell-container border_collapsed"); // Create a td element and add a class for styling

                // Add a div element inside the td
                var div = $("<div>").text(values[i] ? values[i].toFixed(0) : "").addClass(values_con).css("font-ize", "12px");

                cell.append(div); // Append the div to the td
                row.append(cell); // Append the td to the row
              });

              table.append(row);
            }

            $('table.payoff_table_main_table tr').each(function () {
              // Find the first <td> in each <tr> and remove the specified class
              $(this).find('td div:first').removeClass("text-success");
            });

            var table = $('.payoff_table_main_table');
            var firstRow = table.find('thead tr');

            // Select all th elements
            var thElements = firstRow.find('th').slice(1, -1);

            // Select the last th element
            var thLastElement = firstRow.find('th:last');


            var expiryElements = $(".expiry_initial");

            // Initialize an array to store parsed dates
            var dates = [];

            // Loop through each element
            expiryElements.each(function () {
              // Get the text content of the element
              var dateString = $(this).text();

              // Parse the date string into a JavaScript Date object
              var dateObject = new Date(dateString);

              // Add the date object to the array
              dates.push(dateObject);
            });

            // Find the minimum date in the array
            var minDate = new Date(Math.min.apply(null, dates));

            // Log the minimum date
            //console.log("Minimum Expiry Date: " + minDate.toDateString());

            // Assume #optionExpiryDropdown is an input field
            var dropdownValue = minDate.toDateString()

            // Set the last th element text to the formatted dropdown value
            thLastElement.text(`${formatDropdownDate(dropdownValue)}`);

            // Get the current date
            var currentDate = new Date();


            // Display dates based on the number of th elements
            thElements.each(function (index) {
              // Calculate the date for each th
              var dateForTH = new Date(currentDate);
              dateForTH.setDate(currentDate.getDate() + index);

              // Format the date as "On Target Date Mon DD MMM"
              var formattedDate = getDayOfWeek(dateForTH) + ", " + formatDate(dateForTH);

              // Display the formatted date
              $(this).text(formattedDate);


            });



            // Function to get the day of the week
            function getDayOfWeek(date) {
              var daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
              return daysOfWeek[date.getDay()];
            }

            // Function to format the date as "DDth MMM"
            function formatDate(date) {
              var day = date.getDate();
              var suffix = getDaySuffix(day);
              var options = { day: 'numeric', month: 'short' };
              return date.toLocaleDateString('en-US', options).replace(/\b\d{1,2}\b/, day + suffix);
            }

            // Function to format the dropdown value as "Thu 21th Dec"
            function formatDropdownDate(value) {
              var date = new Date(value);
              var options = { weekday: 'short', day: 'numeric', month: 'short' };
              return date.toLocaleDateString('en-US', options);
            }

            // Function to get the day suffix (st, nd, rd, th)
            function getDaySuffix(day) {
              if (day >= 11 && day <= 13) {
                return 'th';
              }
              var lastDigit = day % 10;
              switch (lastDigit) {
                case 1: return 'st';
                case 2: return 'nd';
                case 3: return 'rd';
                default: return 'th';
              }
            }
            // Get the value of closest_strike_price


            // // Find the corresponding row in the "payoff_table_main_table"
            // var correspondingRow = $(".payoff_table_main_table tr").filter(function() {
            //     // Extract the value from the first TD in the row
            //     var rowValue = parseInt($(this).find("td:first").text());
            //     return rowValue === closestStrikePrice;
            // });

            // // Check if a corresponding row was found
            // if (correspondingRow.length > 0) {


            //     // Scroll to the corresponding row
            //     var container = $(".payoff_table_main_table");

            //     var scrollTo =
            //                 1200 -
            //                 container.height() / 2 +
            //                 1200/ 2;
            //                 //////console.log("scrollTo",scrollTo);


            //     // Reset the scroll position first
            //     container.animate(
            //         {
            //             scrollTop: 0,
            //         },
            //         0,
            //         function () {
            //             // Scroll to the desired position after the reset
            //             container.animate(
            //                 {
            //                     scrollTop: scrollTo,
            //                 },
            //                 1000
            //             ); // You can adjust the scrolling speed here (in milliseconds)
            //         }
            //     );
            // } else {
            //     //////console.log("No corresponding row found.");
            // }



            var isScrolling = false; // Flag to check if scrolling is in progress

  if (!isScrolling) { // Check if scrolling is not in progress
    isScrolling = true; // Set the flag to true

    var closestStrikePriceText = $("#closest_strike_price").text();
    var closestStrikePrice = parseInt(closestStrikePriceText);

    $(".payoff_table_main_table tr").each(function () {
      var $strikePrice = $(this).find("td:first");
      var currentStrikePrice = parseInt($strikePrice.text());

      if (currentStrikePrice === closestStrikePrice) {
        $(this).addClass("background_opiton_closest_payoff_table");

        var container = $("#payoff_table");
        var scrollTo =
          $(this).position().top -
          container.height() / 2 +
          $(this).height() / 2;

        console.log("ScrollTo:", scrollTo);

        container.animate(
          {
            scrollTop: scrollTo,
          },
          1000,
          function () {
            // Animation complete
            console.log("Scroll animation complete");
            isScrolling = false; // Reset the flag after scrolling is complete
          }
        );

        return false;
      }
    });
  }









  var isScrolling = false; // Flag to check if scrolling is in progress

$(".payoff_table").click(function () {
  if (!isScrolling) { // Check if scrolling is not in progress
    isScrolling = true; // Set the flag to true

    var closestStrikePriceText = $("#closest_strike_price").text();
    var closestStrikePrice = parseInt(closestStrikePriceText);

    $(".payoff_table_main_table tr").each(function () {
      var $strikePrice = $(this).find("td:first");
      var currentStrikePrice = parseInt($strikePrice.text());

      if (currentStrikePrice === closestStrikePrice) {
        $(this).addClass("background_opiton_closest_payoff_table");

        var container = $("#payoff_table");
        var scrollTo =
          $(this).position().top -
          container.height() / 2 +
          $(this).height() / 2;

        console.log("ScrollTo:", scrollTo);

        container.animate(
          {
            scrollTop: scrollTo,
          },
          1000,
          function () {
            // Animation complete
            console.log("Scroll animation complete");
            isScrolling = false; // Reset the flag after scrolling is complete
          }
        );

        return false;
      }
    });
  }
});






























            // var sumArray = resultArray.map(function (array) {
            //   var sum = array.reduce(function (acc, value) {
            //     return acc + value;
            //   }, 0);
            //   return sum * lot_size;
            // });







            // for (var i = 0; i < tableData.length; i++) {
            //   // Assuming that each object in tableData has a property named 'black_scholes_val'
            //   var sumValue = sumArray[i] || 0;
            //   // Use isFinite to check if sumValue is a valid finite number
            //   tableData[i].black_scholes_val = isFinite(sumValue) ? sumValue : 0;
            // }

            // //////console.log(tableData);





            // // //////console.log(tableData);
            // var tableBody = $(".payoff_table_data");

            // // Clear any existing rows
            // tableBody.empty();

            // // Loop through the tableData array and create table rows and cells
            // tableData.forEach(function (item) {
            //   var main_payoff_table_condition = item.value < 0 ? "text-danger" : "text-success"
            //   var main_payoff_table_condition_black_scholes_val = item.black_scholes_val < 0 ? "text-danger" : "text-success"
            //   var row = $("<tr>");

            //   var categoryCell = $("<td>").text(item.category);
            //   var black_scholes_val_cell = $("<td>").text(item.black_scholes_val.toFixed(2)).addClass(main_payoff_table_condition_black_scholes_val);
            //   var valueCell = $("<td>").text(item.value.toFixed(2)).addClass(main_payoff_table_condition);

            //   row.append(categoryCell);
            //   row.append(black_scholes_val_cell);
            //   row.append(valueCell);

            //   tableBody.append(row);
            // });

            // $(".payoff_expiry").text($("#optionExpiryDropdown").val())



          },
          error: function (error) {
            //////console.log('Error:', error);
          }
        });


      }
      else {

        //console.log("LESS");
        var table = $(".payoff_table_main_table");

        // Clear any existing content, including the body
        table.empty();

        // Add the new headers
        var newHeaders = $("<thead><tr><th>Strikes</th><th >On expiry</th></tr></thead>");
        table.append(newHeaders);

        // Create an empty tbody
        var newBody = $("<tbody>");
        table.append(newBody);

        // Loop through the tableData array and create table rows and cells
        tableData.forEach(function (item) {
          var main_payoff_table_condition = item.value < 0 ? "text-danger" : "text-success";
          var row = $("<tr>");

          var categoryCell = $("<td>").text(item.category);
          var valueCell = $("<td>").text(item.value.toFixed(2)).addClass(main_payoff_table_condition);

          row.append(categoryCell);
          row.append(valueCell);

          newBody.append(row);
        });


        var firstRow = table.find('thead tr');

        // Select the last th element
        var thLastElement = firstRow.find('th:last');


        var expiryElements = $(".expiry_initial");

        // Initialize an array to store parsed dates
        var dates = [];

        // Loop through each element
        expiryElements.each(function () {
          // Get the text content of the element
          var dateString = $(this).text();

          // Parse the date string into a JavaScript Date object
          var dateObject = new Date(dateString);

          // Add the date object to the array
          dates.push(dateObject);
        });

        // Find the minimum date in the array
        var minDate = new Date(Math.min.apply(null, dates));

        // Log the minimum date
        //console.log("Minimum Expiry Date: " + minDate.toDateString());

        // Assume #optionExpiryDropdown is an input field
        var dropdownValue = minDate.toDateString()

        // Set the last th element text to the formatted dropdown value
        thLastElement.text(`${formatDropdownDate(dropdownValue)}`);

        // Get the current date
        var currentDate = new Date();
        var thElements = firstRow.find('th').slice(1, -1);
        // Display dates based on the number of th elements
        thElements.each(function (index) {
          // Calculate the date for each th
          var dateForTH = new Date(currentDate);
          dateForTH.setDate(currentDate.getDate() + index);

          // Format the date as "On Target Date Mon DD MMM"
          var formattedDate = getDayOfWeek(dateForTH) + ", " + formatDate(dateForTH);

          // Display the formatted date
          $(this).text(formattedDate);


        });



        // Function to get the day of the week
        function getDayOfWeek(date) {
          var daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
          return daysOfWeek[date.getDay()];
        }

        // Function to format the date as "DDth MMM"
        function formatDate(date) {
          var day = date.getDate();
          var suffix = getDaySuffix(day);
          var options = { day: 'numeric', month: 'short' };
          return date.toLocaleDateString('en-US', options).replace(/\b\d{1,2}\b/, day + suffix);
        }

        // Function to format the dropdown value as "Thu 21th Dec"
        function formatDropdownDate(value) {
          var date = new Date(value);
          var options = { weekday: 'short', day: 'numeric', month: 'short' };
          return date.toLocaleDateString('en-US', options);
        }

        // Function to get the day suffix (st, nd, rd, th)
        function getDaySuffix(day) {
          if (day >= 11 && day <= 13) {
            return 'th';
          }
          var lastDigit = day % 10;
          switch (lastDigit) {
            case 1: return 'st';
            case 2: return 'nd';
            case 3: return 'rd';
            default: return 'th';
          }
        }


      }

    }



    // Select the elements
  });
</script>
<script>
  $(document).ready(function () {
    // Select the table and the first row inside the thead

  });
</script>

{% endblock dashboard_body %}