{% extends "base_dashboard.html" %} {% load static %} {% block dashboard_body %}

<style>
  .day_1 {
    border-radius: 4px;
    color: white;
    background: cornflowerblue;
    width: fit-content;
    height: 28px;
    padding: 0 6px 0 5px;
    transition: 0.3s;
    cursor: pointer;
    display: flex;
    align-items: center;
  }

  .day_1:hover {
    color: cornflowerblue;
    border: 1px solid cornflowerblue;
    background: transparent;
  }

  .button_left_simu,
  .button_right_simu {
    display: flex;
    gap: 1rem;
  }

  .main_all_button_filter {
    display: flex;
    justify-content: space-between;
  }

  .pre_built_simu {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0.5rem 0;
    gap: 0.5rem;
    padding: 17px 14px;
  }

  .straddle {
    color: #4399eb;
    border: 1px solid #4399eb;
    background-color: #fff;
    -webkit-box-shadow: none;
    box-shadow: none;
    -webkit-transition: 0.3s;
    -moz-transition: 0.3s;
    transition: 0.3s;
    outline: 0;
    font-size: 13px;
    padding: 7px 11px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 5px;
  }

  .straddle:hover {
    background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
    color: #fff !important;
  }

  .option_strategies_active {
    background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
    color: #fff !important;
  }

  .success_cvr {
    background: #90eeae65 !important;
    color: rgb(13, 162, 0);
  }

  .danger_cvr {
    background: #ff000054 !important;
    color: red;
  }
</style>
<style>
  p {
    margin-bottom: auto !important;
  }

  .main_option_chain_table {
    height: 400px;
    overflow: auto;
    margin: 1rem 0;
  }

  .bg-light-green {
    background-color: #c9ffed !important;
  }

  .bg-light-red {
    background-color: #ffd2cf !important;
  }

  #put_call_put {
    right: 0;
  }

  .put_call_btns {
    outline: none;
    border: none !important;
    height: 30px !important;
    margin: 2px 0 0 0 !important;
    color: black !important;
    transition: 0.3s;
  }

  .call-pul-ltp-btns {
    gap: 0.5rem !important;
    display: none;
  }

  .main_option_chain_table table thead tr th {
    font-size: 14px !important;
    color: #000000a3 !important;
    font-family: system-ui !important;
  }

  .strategy_option_chain tr td {
    font-size: 13px;
    font-weight: 700;
    color: #0000009e;
    font-family: system-ui;
  }

  .call_put_tr:hover .call-pul-ltp-btns {
    display: flex !important;
  }

  .strategy_table_input {
    padding-bottom: 1rem !important;
    display: flex;
    row-gap: 0.5rem;
    column-gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    align-items: center;
  }

  .background_opiton_closest {
    background-color: #004597f7 !important;
    color: white !important;
  }

  .add-btn {
    font-size: 22px;
    position: relative;
    /* background: linear-gradient(180deg,#4399eb,#5cadfb)!important;  */
    color: #4399eb;
    height: auto;
    width: auto;
  }

  .delete-btn {
    margin-left: 9px;
    font-size: 22px;
    color: #7f7e7ed6;
    transition: 0.2s;
    cursor: pointer;
  }

  .delete-btn:hover {
    color: rgb(210, 0, 0);
  }
</style>
<style>
  .option_chain_strategies,
  .main_max_pain_strategies,
  .lot_size_strategies,
  .open_strategies,
  .low_strategies,
  .high_strategies,
  .high52_strategies,
  .low52_strategies,
  .spot_strategies {
    font-size: 16px;
    font-weight: 700;
    color: #00000099;
  }

  .option_chain_strategies:hover {
    color: #5cadfb;
    cursor: pointer;
  }

  .main_top_all_left_right {
    flex-wrap: wrap;
    row-gap: 1rem;
  }

  .main_top_strategies {
    flex-wrap: wrap;
  }

  .strategy_simu {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .right_side_top_strategies {
    display: flex;
    flex-wrap: wrap;
    row-gap: 0.5rem;
    justify-content: flex-end;
    column-gap: 0.5rem;
  }

  #spot_arrow {
    font-family: boxicons !important;
    font-weight: 600;
    font-style: normal;
    font-variant: normal;
    line-height: 1;
    text-rendering: auto;
    display: inline-block;
    font-size: 10px !important;
    text-transform: none;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  .btn_outline_primary,
  .bi-arrow-clockwise {
    background: linear-gradient(180deg, #4399eb, #5cadfb);
    color: #fff;
    border: 1px solid #4399eb;
    transition: 0.3s;
    border-radius: 6px;
    height: 33px;
    font-size: 14px;
    font-weight: 500;
  }

  .btn_outline_primary:hover,
  i.bi.bi-arrow-clockwise:hover {
    color: #4399eb !important;
    background: white !important;
    border: 1px solid #4399eb !important;
  }

  i.bi.bi-arrow-clockwise {
    width: 36px;
    border: 1px solid;
    padding: 10px;
    border-radius: 6px;
    height: 34px !important;
    transition: 0.3s;
  }
</style>
<style>
  .textOnInput {
    position: relative;
    width: 11rem;
  }

  .textOnInput label {
    position: absolute;
    top: -9px;
    font-weight: 700;
    left: 10px;
    padding: 2px;
    color: rgb(56, 56, 56);
    z-index: 1;
    font-size: 12px;
    white-space: nowrap;
  }

  .textOnInput label:after {
    content: " ";
    background-color: #fff;
    width: 100%;
    height: 13px;
    position: absolute;
    left: 0;
    bottom: 0;
    z-index: -1;
  }

  label {
    font-size: 16px;
    font-weight: 500;
    display: inline-block;
    margin-bottom: 0.5rem;
  }

  .form-control {
    box-shadow: none !important;
  }

  .data-display-table {
    display: flex;
    justify-content: center;
    flex-direction: column;
  }

  .put_call_btns:hover {
    background-color: white !important;
    color: #4399eb !important;
  }

  .put_max_profit {
    font-weight: 600;
    font-size: 13px !important;
    color: #21d052 !important;
  }

  .long_max_loss,
  .breakever_probaility_profit {
    font-weight: 600;
    font-size: 13px !important;
  }

  .strategy_cost_table,
  .payoff_charts,
  .payoff_table,
  .oi_chart,
  .adjustment,
  .targets,
  .stoploss,
  .alerts,
  .history,
  .greek_table {
    font-family: system-ui;
    color: #767f88;

    font-weight: 600;

    font-size: 15px;
    padding: 7px;
    font-family: system-ui;
    cursor: pointer;
  }

  #resultTable thead tr th,
  .PL-table thead tr th,
  .payoff_table_main_table thead tr th,
  .targets_table thead tr th,
  .stoploss_table thead tr th,
  .adjsuments_table_thead {
    background: #4399eb;
    color: white;
    font-size: 12px;
    font-weight: 600;
    font-family: system-ui;
  }

  .bg_option_for {
    background: #fffee5 !important;
  }

  .closestStrike_bg {
    background: #0055978f !important;
    color: white !important;
  }

  #resultTable tbody tr td,
  .PL-table tbody tr td,
  .payoff_table_main_table tbody tr td {
    font-size: 14px;
  }

  #resultTable tbody tr td,
  .PL-table tbody tr td,
  .payoff_table_main_table tbody tr td {
    border-color: inherit !important;
    border: none;
    border-bottom-style: inherit !important;

    border-width: 1 !important;
  }

  .table-striped-custom>tbody>tr:nth-child(2n)>td,
  .table-striped-custom>tbody>tr:nth-child(2n)>th {
    background-color: rgb(240, 247, 253) !important;
  }
</style>
<style>
  .inner_greek_p_l {
    margin-bottom: 0.5rem;
  }

  .greek_strategy_active {
    color: #2196f3 !important;
    border-bottom: 2px solid #2196f3 !important;
  }
</style>
<style>
  .strategy_inputs,
  .textOnInput_edit {
    position: relative;
    width: 259px;
    display: flex;
    gap: 0.5rem;
    height: 2.5rem !important;
    margin-bottom: 0.5rem;
  }

  .order_place_input {
    position: relative;
    width: 115px;
    display: flex;
    gap: 0.5rem;
    height: 2.5rem !important;
    margin-bottom: 0.5rem;
  }

  .strategy_inputs label,
  .textOnInput_edit label,
  .order_place_input label {
    position: absolute;
    top: -9px;
    font-weight: 700;
    left: 10px;
    padding: 2px;
    color: rgb(56, 56, 56);
    z-index: 1;
    font-size: 12px;
    white-space: nowrap;
  }

  .strategy_inputs select:focus,
  .textOnInput_edit select:focus {
    box-shadow: none !important;
  }

  .strategy_inputs label:after,
  .textOnInput_edit label:after,
  .order_place_input label:after {
    content: " ";
    background-color: transparent;
    width: 100%;
    height: 13px;
    position: absolute;
    left: 0;
    bottom: 0;
    z-index: -1;
  }

  .textOnInput_edit select {
    outline: none;
    height: 40px;
    width: 300px;
    padding: 0 15px;
    box-shadow: none;
    border-radius: 6px;
    border: 1px solid hsla(0, 0%, 72.5%, 0.3);
    background-color: #fff;
  }

  #modal_title_edit {
    font-size: 18px;
  }

  #modal_header_edit {
    border-bottom: 1px solid lightgray !important;
    padding: 7px 10px !important;
    margin-bottom: 1rem !important;
  }

  .Long_short {
    display: flex;
    gap: 1rem;
  }

  label {
    font-size: 16px;
    font-weight: 500;
    display: inline-block;
    margin-bottom: 0.5rem;
  }

  p {
    margin-bottom: auto;
  }

  .form-control:disabled {
    background-color: white !important;
  }

  .main_body_fields_strangle,
  .main_body_fields_spread,
  .main_body_fields_ironFly,
  .main_body_fields_ironCondor,
  .main_body_fields_jaze_lizard,
  .main_body_fields_double_iron_fly {
    display: flex;
    flex-direction: column;
    /* align-items: center; */
  }

  .main_body_fields_straddle {
    display: flex;
    flex-direction: column;
  }

  .straddle_filter {
    display: flex;
    justify-content: center;
  }

  .straddle_active {
    border-bottom: 2px solid#4399eb !important;
    background: #4399eb12 !important;
    color: #4399eb !important;
  }

  .long_straddle,
  .short_straddle {
    padding: 4px 40px;
    cursor: pointer;
    font-size: 15px;
    transition: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    font-weight: 500;
    color: gray;
  }

  .strike_price,
  .expiry_straddle {
    display: flex;
    justify-content: center;
    align-items: baseline;
    gap: 1rem;
  }

  #strikePrice,
  #expiry_date {
    border: none !important;
    border-bottom: 3px solid gray !important;
    border-radius: inherit !important;
  }

  #strikePrice:focus,
  #expiry_date:focus {
    box-shadow: none !important;
    border-bottom: 3px solid #4399eb !important;
  }

  #strikePrice option:hover {
    background-color: transparent !important;
    color: #4399eb !important;
  }

  #strikePrice:active {
    background-color: white !important;
    color: #4399eb !important;
  }

  #strikePrice option {
    border: 1px solid gray !important;
  }

  .Strike_dropdown,
  .expiry_dropdown {
    width: 186px;
  }

  .Strike_price_label,
  .Expiry_date_label {
    font-size: 10px;
  }

  #counter_input,
  #counter_input_edit,
  #counter_input_strangle,
  #counter_input_ironFly,
  #counter_input_spread,
  #counter_input_ironCondor,
  #counter_input_jaze_lizard,
  #counter_input_double_iron_fly,
  #counter_input_double_iron_condor,
  #counter_input_put_butterfly,
  #counter_input_call_butter_fly {
    width: 38px;
    text-align: center;
  }

  .modal-header {
    border-bottom: none !important;
  }

  #edit_modal {
    width: fit-content !important;
  }

  .main_strikePrice {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  #decrement,
  #increment,
  #decrement_edit,
  #increment_edit,
  #decrement_strangle,
  #increment_strangle,
  #decrement_spread,
  #increment_spread,
  #decrement_ironFly,
  #increment_ironFly,
  #decrement_ironCondor,
  #increment_ironCondor,
  #decrement_double_iron_fly,
  #increment_double_iron_fly,
  #decrement_double_iron_condor,
  #increment_double_iron_condor,
  #decrement_jaze_lizard,
  #increment_jaze_lizard,
  #decrement_put_butterfly,
  #increment_put_butterfly,
  #decrement_call_butter_fly,
  #increment_call_butter_fly {
    background: #4399eb;
    border: 1px solid #4399eb;
    width: 36px;
    height: 36px;
    border-radius: 0;
    font-size: 22px;
    color: white;
    transition: ease-out 0.3s;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #decrement:hover,
  #increment:hover,
  #decrement_strangle:hover,
  #increment_strangle:hover,
  #decrement_spread:hover,
  #increment_spread:hover,
  #decrement_ironFly:hover,
  #increment_ironFly:hover,
  #decrement_ironCondor:hover,
  #increment_ironCondor:hover,
  #decrement_jaze_lizard:hover,
  #increment_jaze_lizard:hover,
  #decrement_double_iron_fly:hover,
  #increment_double_iron_fly:hover,
  #decrement_double_iron_condor:hover,
  #increment_double_iron_condor:hover,
  #decrement_put_butterfly:hover,
  #increment_put_butterfly:hover {
    background: white;
    color: #4399eb;
  }

  .pe_ce,
  .strangle_lot_size {
    font-size: 15px;
    padding: 6px 0 0 0;
    white-space: nowrap;
  }

  #modal_body {
    padding: 0 17px 27px 17px;
  }

  #straddle_modal {
    width: 22rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    border-radius: 8px;
    background-color: white;
    display: none;
    margin: 14px 0 0 0;
  }

  .option_simulator_strategy,
  .saveChanges,
  #saveStrategies {

    /* height: 34px; */

    background: -webkit-gradient(linear, left top, left bottom, from(#4399eb), to(#5cadfb));
    background: -moz-linear-gradient(top, #4399eb, #5cadfb);
    background: linear-gradient(180deg, #4399eb, #5cadfb);
    color: #fff;

    border: 1px solid #4399eb;

    -webkit-box-shadow: none !important;
    box-shadow: none !important;
    -webkit-transition: .3s !important;
    -moz-transition: .3s !important;
    transition: .3s !important;
    outline: 0 !important;
    text-align: center;
    padding: 6px 10px;
    font-size: 14px;
    border-radius: 5px;
    font-weight: 500;
    white-space: nowrap;
    cursor: pointer;
  }

  .option_simulator_strategy:hover,
  .saveChanges:hover,
  #saveStrategies:hover {
    color: #4399eb;
    border: 1px solid #4399eb;
    background: #fff;
  }

  #strangle_modal {
    width: 22rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #spread_modal {
    width: 22rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #ironFly_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #ironCondor_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #jaze_lizard_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #double_iron_fly_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #double_iron_condor_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #put_butterfly_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 14px 0 0 0;
    display: none;
    border-radius: 8px;
    background-color: white;
  }

  #call_butter_fly_modal {
    width: 24rem;
    box-shadow: 0px 0px 1px 2px #4399eb3b;
    position: absolute;
    z-index: 99;
    margin: 15px 0px 1px 0;
    display: none;
    left: -61px;
    border-radius: 8px;
    background-color: white;

  }

  .dismiss {
    display: flex;
    flex-direction: row-reverse;
    padding: 5px 10px;

    position: relative;
  }

  .dismiss_icon {
    font-size: 18px;
    transform: rotate(45deg);
    cursor: pointer;
  }

  .lot_title {
    font-size: 1rem !important;
    padding-top: 7px;
  }

  #shortStraddle,
  #shortStrangle,
  #shortSpread,
  #shortironFly,
  #short_ironCondor,
  #shortjaze_lizard,
  #shortdouble_iron_fly,
  #shortdouble_iron_condor,
  #shortput_butterfly,
  #shortcall_butter_fly {
    width: 68px;
    text-align: center;
    font-size: 12px;
    height: 37px;
    font-weight: 700;
    background: #dd0000;
    color: white;
    border: 1px solid;
    border-radius: 5px;
    transition: 0.3s;
  }

  #shortStraddle:hover,
  #shortStrangle:hover,
  #shortSpread:hover,
  #shortironFly:hover,
  #short_ironCondor:hover,
  #short_jaze_lizard:hover,
  #shortdouble_iron_condor:hover,
  #shortput_butterfly:hover {
    background: white;
    border: 1px solid #dd0000;
    color: #dd0000;
  }

  .innerStraddle_lot_size {
    display: flex;
    gap: 0.5rem;
  }

  input[type="text"]:disabled {
    background: #ccc0 !important;
  }

  .triangle-up {
    width: 0;
    height: 0;
    left: 54px;

    position: absolute;
  }

  .triangle-up-call_butterfly {
    width: 0;
    height: 0;
    left: 54px;

    position: absolute;
  }

  .triangle-up::before {
    content: "";
    position: absolute;
    width: 0;
    height: 0;
    top: -2px;
    margin-left: -0.5em;

    box-sizing: border-box;
    border: 11px solid #ffecec00;
    border-color: transparent transparent #ffffff #ffffff;
    transform-origin: 0 0;
    box-shadow: -3px 3px 3px 0 #4399eb3b;
    transform: rotate(135deg);
  }

  .triangle-up-call_butterfly::before {
    content: "";
    position: absolute;
    width: 0;
    height: 0;
    top: -2px;
    margin-left: -0.5em;
    box-sizing: border-box;
    border: 11px solid #ffecec00;
    border-color: transparent transparent #ffffff #ffffff;
    transform-origin: 0 0;
    box-shadow: -3px 3px 3px 0 #4399eb3b;
    transform: rotate(135deg);
    left: 54px;
  }

  .main_counter {
    align-items: center;
  }

  #put_call_select {
    /* margin-left: 24px; */
  }
</style>

<style>
  .main_option_strategy_optimizer {
    box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
    padding: 10px 15px;
    padding-bottom: 8rem;
  }

  .left_main_strategy_position {
    box-shadow: #4399eb29 0px 1px 4px;
    padding: 18px 18px;
  }

  .right_p_l_greeks {
    box-shadow: #4399eb29 0px 1px 4px;
    padding: 0 18px 18px 18px;
  }

  .inner_p_l_greeks {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }

  .inner_position,
  .ltpValue,
  .unitPrice,
  .adjsutedLotSize,
  .absoluteQuantity,
  .totalCurrentCost,
  .final_P_L,
  .greeks_iv,
  .greeks_delta,
  .greeks_theta,
  .greeks_gamma,
  .greeks_vega,
  .greeks_rho,
  .greeks_position,
  .p_l_position {
    font-size: 14px;
    font-weight: 600;
    font-family: system-ui;
    color: #666;

    padding: 9px 0;
    align-items: center;
  }

  .main_add_position_actions {
    border-bottom: 1px solid #8080803b;
    transition: 0.3s;

  }

  .main_add_position_actions:hover {
    box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;

  }

  .green-option-indicator {
    color: #00b865;
    width: 6px;
    background: #00b865;
    height: 28px;
    /* border-radius: 8px 0px 0px 9px; */
  }

  .red-option-indicator {



    width: 6px;
    background: #e6191e;
    height: 28px;
    /* border-radius: 8px 0px 0px 9px; */
  }


  .history_table {
    display: flex;
    justify-content: center;
    height: 400px;
    align-items: center;

  }

  /* 
    .table-striped-custom>tbody>tr:nth-child(2n)>td,
    .table-striped-custom>tbody>tr:nth-child(2n)>th {
        background-color: rgb(240, 247, 253) ;
    } */
  .max_pain_strategies p,
  .spot_title,
  .lot_size_strategies p,
  .low52_strategies p,
  .high52_strategies p,
  .open_strategies p,
  .low_strategies p,
  .high_strategies p,
  .option_chain_strategies p {
    font-weight: 700 !important;
    font-size: 16px;
    color: #353535;
  }

  .savedStrategies {
    border-bottom: 1px solid rgba(128, 128, 128, 0.229);
    padding: 6px 10px;
  }

  .savedStrategies:hover {
    background-color: rgba(128, 128, 128, 0.103);

  }

  .savedStrategies:hover .left_strategy_name {
    color: #4399EB;
  }
</style>
<div class="title my-2 d-flex">
  <h5>Option Strategy Tester</h5>

</div>
<!-- <div class="main_all_indices d-flex" style="    justify-content: center;
  gap: 1rem;">


</div> -->

<script>
  function fetchData() {
    $.ajax({
      url: "/fetch_indices_data",
      dataType: "json",
      success: function (data) {
        // Handle the data here as per your requirements
        console.log(data);

        // Clear existing data
        $(".main_all_indices").empty();

        // Iterate over the data and create the HTML elements
        data.forEach(function (item) {
          var priceClass = item.change_value > 0 ? "text-success" : "text-danger";
          var progress_caret = item.change_value > 0 ? "up" : "down";
          var background_color_global_indicator = item.change_value > 0 ? "#32cd4c2e" : "#cd32322e";
          var background_color_global_indicator_minus_plus = item.change_value > 0 ? "+" : "";

          var countryTable = `
          <div class="child_table">
            <div class="main_global_card" style="width: 19rem; display: flex; align-items: flex-end; column-gap: 1rem; margin-bottom: 1rem; border-radius: 10px; padding: 7px 11px; box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 1px 3px 1px; justify-content: space-between;">
              <div class="left_global_content" style="display: flex; align-items: flex-end; gap: 1rem;">
                <div class="gain_loss_icon">
                  <i class="bx bx-${progress_caret}-arrow-alt ${priceClass}" style="font-size: 34px; padding: 13px; font-weight: 300 !important; background-color: ${background_color_global_indicator}; border-radius: 20px;"></i>
                </div>
                <div class="stock_name_price">
                  <h5 style="font-size: 16px;">${item.symbol_name}</h5>
                  <h5 style="font-weight: 600 !important; font-size: 14px; color: darkslategray;">${item.last_trade_price}</h5>
                </div>
              </div>
              <div class="left_global_content">
                <div class="gain_loss_price">
                  <h5 class="${priceClass} percent_gain_loss_global" style="font-size: 16px;">${background_color_global_indicator_minus_plus}${item.change_per}%</h5>
                  <h5 class="${priceClass} percent_gain_loss_globla" style="font-weight: 600 !important; font-size: 14px; color: darkslategray;">${background_color_global_indicator_minus_plus}${item.change_value}</h5>
                </div>
              </div>
            </div>
          </div>`;

          $(".main_all_indices").append(countryTable);
        });
      }
    });
  }

  // Call initially
  fetchData();

  // Call at intervals of 10 seconds
  // setInterval(fetchData, 10000);




</script>


<div class="main_option_strategy_optimizer">
  <div class="top_content_option_chain p-3">
    <div class="main_top_all_left_right d-flex align-items-center justify-content-between">
      <div class="left_side_top_strategies">
        <div class="main_top_strategies d-flex align-items-center gap-4">
          <select id="stockDropdown" class="form-select w-auto">
            <optgroup label="Indices">
              <option value="NIFTY">NIFTY</option>
              <option value="BANKNIFTY">BANKNIFTY</option>
              <option value="FINNIFTY">FINNIFTY</option>
            </optgroup>
            {% comment %} <optgroup label="Stocks"></optgroup> {% endcomment %}
          </select>
          <div class="spot_strategies">
            <p class="spot_title">Spot</p>

            <div id="last_traded_price"></div>
            <div id="closest_strike_price" style="display: none"></div>
            <div id="closen_expiry_date"></div>
          </div>

          <div class="main_max_pain_strategies d-block">
            <div class="max_pain_strategies d-flex align-items-center gap-1">
              <p>Max Pain</p>
              <i class="bx bx-link-external"></i>
            </div>
            <div id="max_pain_value"></div>
          </div>
          <div class="lot_size_strategies d-block">
            <p>Lot Size</p>
            <div id="lot_size_value"></div>
          </div>
          <div class="low52_strategies">
            <p>Low 52 Wk</p>

            <div id="low52_value"></div>
          </div>

          <div class="high52_strategies">
            <p>High 52 Wk</p>

            <div id="high52_value"></div>
          </div>
          <div class="open_strategies">
            <p>Open</p>

            <div id="open_value"></div>
          </div>

          <div class="low_strategies">
            <p>Low</p>

            <div id="low_value"></div>
          </div>
          <div class="high_strategies">
            <p>High</p>

            <div id="high_value"></div>
          </div>
          <div class="option_chain_strategies d-flex align-items-center gap-1">
            <p>Option Chain</p>
            <i class="bx bx-link-external"></i>
          </div>

        </div>
      </div>
      <div class="modal fade" id="saved_startegyModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Saved Strategies</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">

              <div class="all_strategies">

              </div>

            </div>

          </div>
        </div>
      </div>

    </div>


    <div class="right_side_top_strategies mt-2">
      <style>
        .zerodha_add_api {
          display: flex;
          width: 11rem;
          flex-direction: column;
          align-items: center;
          background: white;
          row-gap: 0.5rem;
          box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
          padding: 20px;
        }

        .zerodha_add_api img {
          width: 9rem;
        }

        .offcanvas-body input {
          margin-bottom: 1rem;
        }

        #zerodha_data_display {
          margin-top: 1rem;
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
        }

        .main_api_card {
          border-bottom: 1px solid #8080804f;
          display: flex;
          column-gap: 1rem;
          align-items: flex-end;
          padding: 1rem;
          /* box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px; */
          flex-direction: column;
        }

        .btn_add_broker {
          background-color: red;
          color: white;
          transition: 0.3s;
          border: 1px solid red;
          border-radius: 5px;
        }

        .btn_add_broker:hover {
          background-color: white;
          color: red;
          border: 1px solid red;
        }
      </style>
      <button class="d-flex align-items-center" id="saveStrategies"><i class='bx bxs-bookmark'></i>
        <p style="margin-bottom: 0;">Saved Strategies</p>
      </button>
      <button class="btn_outline_primary" type="button" data-bs-toggle="collapse" id="option_chain_button"
        data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
        Option Chain
        <i class="bx bx-chevron-down"></i>
      </button>

      <button class="btn_add_broker" data-bs-toggle="offcanvas" data-bs-target="#add_api" aria-controls="add_api">
        Add Broker
      </button>

      <div class="activate_broker_toggle_main_btn">



        <button class="btn_outline_primary" class="all_api_details" data-bs-toggle="collapse" id="Activate_broker_btn">
          Activate Broker <i class="bx bx-chevron-down"></i>
        </button>

        <style>
          .dismiss_active_modal {
            display: flex;
            padding: 5px 10px;
            position: relative;
          }

          .dismiss_icon_active_modal {
            font-size: 18px;
            transform: rotate(45deg);
            cursor: pointer;
          }

          .triangle-up-active-modal {
            width: 0;
            right: 12px;
            height: 0;
            position: absolute;
          }

          .triangle-up-active-modal::before {
            content: "";
            position: absolute;
            width: 0;
            height: 0;
            top: -2px;
            margin-left: -0.5em;

            box-sizing: border-box;
            border: 11px solid #ffecec00;
            border-color: transparent transparent #ffffff #ffffff;
            transform-origin: 0 0;
            box-shadow: -3px 3px 3px 0 #4399eb3b;
            transform: rotate(135deg);
          }

          #active_broker_modal {
            width: max-content;
            box-shadow: 0px 0px 1px 2px #4399eb3b;
            position: absolute;
            right: 70px;
            z-index: 99;
            border-radius: 8px;
            background-color: white;
            margin: 12px 0 0 0;
            padding: 0 0 31px 0;
          }
        </style>

        <div class="" id="active_broker_modal" style="display: none;">
          <div class="dismiss_active_modal">
            <!-- <i class="bx bx-plus dismiss_icon_active_modal"></i> -->
            <div class="triangle-up-active-modal"></div>
          </div>
          <div class="modal_dialog">
            <div class="modal_content">


              <div class="all_broker">
                <div id="zerodha_data_display"></div>
              </div>





            </div>
          </div>
        </div>

      </div>


      <i class="bi bi-arrow-clockwise" id="option_strategy_reset"></i>
    </div>






    <div class="offcanvas offcanvas-end" tabindex="-1" id="add_api" aria-labelledby="offcanvasRightLabel"
      style="z-index: 9999999999999999">
      <div class="offcanvas-header">



        <h5 class="offcanvas-title" id="offcanvasRightLabel">
          Add broker API details
        </h5>





        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">


        <form>
          <select name="All_brokers" id="all_brokers" class="form-select mb-3">

            <option value="zerodha">Zerodha</option>
            <option value="upstocks">Upstocks</option>
            <option value="angelone">Angel One</option>
            <option value="fyers">Fyers</option>
            <option value="icicidirectbreeze">ICICI Direct Breeze</option>
          </select>
          <input type="text" class="form-control" id="app_name" placeholder="Enter app names" required />
          <input type="text" class="form-control" id="api_key" placeholder="Enter zerodha api key " required />
          <input type="text" class="form-control" id="secret_key" placeholder="Enter zerodha secret key" required />
          <button class="btn btn-primary save_zerodha_btn">
            Add Broker
          </button>
        </form>
      </div>

    </div>

    <div class="collapse my-3" id="collapseExample">
      <div class="main_option_inner d-flex justify-content-between align-items-center">
        <p class="text-secondary">*Note: OI IN QUANTITY</p>
        <select id="optionExpiryDropdown" class="form-select w-auto">
          <!-- Options will be populated dynamically from AJAX response -->
        </select>
      </div>

      <div class="main_option_chain_table">
        <table class="table table-hover">
          <thead>
            <th class="text-end bg-light-green">CALL IV</th>
            <th class="text-end bg-light-green">CALL OI</th>
            <th class="text-end bg-light-green">CALL LTP</th>
            <th class="text-center bg-light">STRIKE PRICE</th>
            <th class="text-start bg-light-red">PUT LTP</th>
            <th class="text-start bg-light-red">PUT OI</th>
            <th class="text-start bg-light-red">PUT IV</th>
          </thead>

          <tbody class="strategy_option_chain"></tbody>
        </table>
      </div>
    </div>
  </div>
  <script>
    $(document).ready(function () {
      const optionChainButton = $("#option_chain_button");
      const allApiButton = $("#all_api_button");
      const optionChainCollapse = $("#collapseExample");
      const allApiCollapse = $("#all_api_collapse");

      function toggleChevron($element) {
        if ($element.hasClass("bx-chevron-down")) {
          $element.removeClass("bx-chevron-down").addClass("bx-chevron-up");
        } else {
          $element.removeClass("bx-chevron-up").addClass("bx-chevron-down");
        }
      }

      optionChainButton.click(function () {
        allApiCollapse.collapse("hide");
        optionChainCollapse.collapse("toggle");
        toggleChevron(optionChainButton.find(".bx"));
      });

      allApiButton.click(function () {
        optionChainCollapse.collapse("hide");
        allApiCollapse.collapse("toggle");
        toggleChevron(allApiButton.find(".bx"));
      });



      // $("#Activate_broker_btn").click(function () {
      //   $("#active_broker_modal").slideToggle();
      // });

      function checkUserLoggedIn() {
        $.ajax({
          type: 'GET',
          url: '/check_user_logged_in', // Update the URL to the appropriate endpoint
          success: function (response) {
            // If the user is logged in, toggle the broker activation modal

            if (response.user_logged_in) {
              $("#signinModal").modal("show");
            } else {

              $("#active_broker_modal").slideToggle();
            }
          },
          error: function (xhr, status, error) {
            // Handle the error, for example, display an error message
            console.error("Error:", error);
            alert("Error checking user login status.");
          }
        });
      }

      $("#Activate_broker_btn").click(function (e) {
        e.stopPropagation(); // Prevent the click event from propagating to the document
        checkUserLoggedIn(); // Call the function to check if the user is logged in
      });

      // Close the modal when a click occurs anywhere outside of the modal
      $(document).on("click", function (e) {
        if (!$("#active_broker_modal").is(e.target) && $("#active_broker_modal").has(e.target).length === 0) {
          $("#active_broker_modal").slideUp();
        }
      });





    });



  </script>

  <style>
    #reset_icon {
      all: unset !important;
    }

    .reset_button,
    .setTarget,
    .adjust {
      display: flex !important;
      align-items: center !important;
      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
      padding: 0px 7px;
      text-align: center;
      height: 29px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all 0.2s ease-in-out !important;
      -moz-transition: all 0.2s ease-in-out !important;
      transition: all 0.2s ease-in-out !important;
      cursor: pointer;

      font-weight: 600;
    }

    .reset_button:hover,
    .setTarget:hover,
    .adjust:hover {
      background: #fff !important;
      color: #4399eb !important;
    }

    .main_short_long_lot_size {
      display: flex;
    }

    .edit-button,
    .delete-button {
      color: #767f88;
      transition: 0.3s;
    }

    .edit-button:hover {
      color: #4399eb !important;
    }

    .delete-button:hover {
      color: #c70000 !important;
    }

    .action_option_strategy {
      font-size: 19px !important;
      gap: 0.5rem !important;
    }

    .main_position {
      margin-top: 0.5rem;
    }

    .inner_greek_p_l {
      background-color: #f1f5fa;
      margin-bottom: 0.5rem;
    }

    .main_all_profit_loss {
      display: flex;
      flex-direction: column;
      row-gap: 0.8rem;
    }

    .exit_price {
      font-size: 11px;
      font-weight: 700;
    }

    .strike_symbols_per_main_order {
      font-size: 12px;
    }
  </style>

  <div class="All_option_startegies_builder">
    <div class="pre_built_simu">
      <p style="margin-bottom: auto">Pre Built :</p>
      <div class="strategy_simu">
        <div class="main_straddle">
          <p class="straddle" id="straddle">STRADDLE</p>

          <div class="" id="straddle_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_straddle">
                    <h5 class="text-center">Straddle</h5>

                    <div class="main_body_fields_straddle">
                      <div class="main_strikePrice mb-3">
                        <div class="strategy_inputs">
                          <label for="strikePrice">Strike Price</label>
                          <select class="strike_price_input form-select" id="strikeSelect_straddle"></select>
                        </div>
                        <p class="pe_ce">PE / CE</p>
                      </div>
                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_straddle"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="innerStraddle_lot_size">
                          <p class="fs-6 lot_title">Lot Qty:</p>
                          <div class="counter_straddle d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input" min="1" disabled />
                            <button class="btn" id="increment">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>
                        </div>
                        <button class="" id="shortStraddle">SELL</button>
                      </div>
                    </div>
                  </div>

                  <div class="buy_sell_buttons d-flex gap-2 justify-content-center"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="main-stranggle">
          <p class="straddle" id="strangle">STRANGLE</p>
          <div class="" id="strangle_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_strangle">
                    <h5 class="text-center">Strangle</h5>

                    <div class="main_body_fields_strangle">
                      <div class="main_strikePrice mb-3">
                        <div class="strangle_lot_size">
                          <span id="put_stangle_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_strangle"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="strangle_lot_size">
                          <span id="call_stangle_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_strangle"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_strangle"></select>
                      </div>

                      <div class="main_counter d-flex gap-2 mb-3">
                        <div class="innerStraddle_lot_size d-flex gap-2">
                          <p class="fs-5 lot_title">Lot Qty:</p>
                          <div class="counter_strangle d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_strangle">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_strangle" min="1" disabled />
                            <button class="btn" id="increment_strangle">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>
                        </div>
                        <button class="" id="shortStrangle">SELL</button>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                                  

                                </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="main-spread">
          <p class="straddle" id="spread">SPREAD</p>
          <div class="" id="spread_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_spread">
                    <h5 class="text-center">Spread</h5>

                    <div class="main_body_fields_spread">
                      <div class="main_strikePrice mb-3">
                        <div class="spread_lot_size">
                          <span id="put_spread_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_spread"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="spread_lot_size">
                          <span id="call_spread_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_spread"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_spread"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_spread_lot_size d-flex gap-2">
                          <p class="fs-5 lot_title">Lot Qty:</p>
                          <div class="counter_spread d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_spread">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_spread" min="1" disabled />
                            <button class="btn" id="increment_spread">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>
                        </div>
                        <button class="" id="shortSpread">SELL</button>
                      </div>
                    </div>
                  </div>

                  <div class="buy_sell_buttons d-flex gap-2 justify-content-center"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="main-ironfly">
          <p class="straddle" id="iron_fly">IRON FLY</p>
          <div class="" id="ironFly_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_ironFly">
                    <h5 class="text-center">Iron Fly</h5>

                    <div class="main_body_fields_ironFly">
                      <div class="main_strikePrice mb-3">
                        <div class="ironFly_lot_size">
                          <span id="put_ironFly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_ironFly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>
                      <div class="main_strikePrice mb-3" id="put_call_select">
                        <div class="ironFly_lot_size">
                          <span id="put_call_ironFly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select" id="put_call_strikeSelect_ironFly"></select>
                        </div>
                        <p class="pe_ce">PE/CE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="ironFly_lot_size">
                          <span id="call_ironFly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_ironFly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_ironFly"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Lot Qty:</p>
                          <div class="counter_ironFly d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_ironFly">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_ironFly" min="1" disabled />
                            <button class="btn" id="increment_ironFly">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortironFly">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                          

                            </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <style>
          @media (min-width: 992px) {
            .col-lg-4 {
              flex: 0 0 auto !important;
              width: 30.333333% !important;
            }

            .col-lg-7 {
              flex: 0 0 auto !important;
              width: 68.333333% !important;
            }
          }
        </style>

        <div class="main-ironCondor">
          <p class="straddle" id="iron_condor">IRON CONDOR</p>
          <div class="" id="ironCondor_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_ironCondor">
                    <h5 class="text-center">Iron Condor</h5>

                    <div class="main_body_fields_ironCondor">
                      <div class="main_strikePrice mb-3">
                        <div class="ironCondor_lot_size">
                          <span id="put_ironCondor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_ironCondor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>
                      <div class="main_strikePrice mb-3">
                        <div class="ironCondor_lot_size">
                          <span id="put_2nd_ironCondor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select" id="put_2nd_strikeSelect_ironCondor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>
                      <div class="main_strikePrice mb-3">
                        <div class="ironCondor_lot_size">
                          <span id="call_2nd_ironCondor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_2nd_strikeSelect_ironCondor"></select>
                        </div>
                        <p class="pe_middla">CE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="ironCondor_lot_size">
                          <span id="call_ironCondor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_ironCondor"></select>
                        </div>
                        <p class="pe_middle">CE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_ironCondor"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Lot Qty:</p>
                          <div class="counter_ironCondor d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_ironCondor">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_ironCondor" min="1" disabled />
                            <button class="btn" id="increment_ironCondor">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="short_ironCondor">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="main-jaze_lizard">
          <p class="straddle" id="jaze_lizard">JAZE LIZARD</p>
          <div class="" id="jaze_lizard_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_jaze_lizard">
                    <h5 class="text-center">Jaze Lizard</h5>

                    <div class="main_body_fields_jaze_lizard">
                      <div class="main_strikePrice mb-3">
                        <div class="jaze_lizard_lot_size">
                          <span id="call_jaze_lizard_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="call_strikeSelect_jaze_lizard"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>
                      <div class="main_strikePrice mb-3">
                        <div class="jaze_lizard_lot_size">
                          <span id="call_2nd_jaze_lizard_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_2nd_strikeSelect_jaze_lizard"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <div class="main_strikePrice mb-3">
                        <div class="jaze_lizard_lot_size">
                          <span id="put_jaze_lizard_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select" id="put_strikeSelect_jaze_lizard"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_jaze_lizard"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Lot Qty:</p>
                          <div class="counter_jaze_lizard d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_jaze_lizard">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_jaze_lizard" min="1" disabled />
                            <button class="btn" id="increment_jaze_lizard">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortjaze_lizard">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="main-double-iron-fly">
          <p class="straddle" id="double_iron_fly">DOUBLE IRON FLY</p>



          <div class="" id="double_iron_fly_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_double_iron_fly">
                    <h5 class="text-center">Double Fly</h5>

                    <div class="main_body_fields_double_iron_fly">


                      <!-- first_position_double_fly -->







                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="put_strike_eight_hundred_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_strike_eight_hundred_Select_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- second_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="call_2nd_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put/Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_put_four_hundred_Select_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">PE/CE</p>
                      </div>


                      <!-- third_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="call_spot_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_spot_strikeSelect_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <!-- four_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="put_positive_four_hundred_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_positive_four_hundred_strikeSelect_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- five_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="call_put_positive_eight_hundred_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_put_positive_eight_hundred_strikeSelect_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>
                      <!-- six_position_double_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_fly_lot_size">
                          <span id="call_twelve_hundred_positive_double_iron_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_twelve_hundred_positive_strikeSelect_double_iron_fly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>












                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_double_iron_fly"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Lot Qty:</p>
                          <div class="counter_double_iron_fly d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_double_iron_fly">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_double_iron_fly" min="1" disabled />
                            <button class="btn" id="increment_double_iron_fly">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortdouble_iron_fly">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>





        </div>
        <div class="main-double-candor">
          <p class="straddle" id="double_iron_condor">DOUBLE CONDOR</p>

          <div class="" id="double_iron_condor_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_double_iron_condor">
                    <h5 class="text-center">Double Condor</h5>

                    <div class="main_body_fields_double_iron_condor">


                      <!-- first_position_double_condor -->


                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="put_spot_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select" id="spot_Select_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- second_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="put_negative_fifty_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_negative_fifty_Select_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>


                      <!-- third_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="put_negative_two_hundred_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_negative_two_hundred_Select_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- four_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="negative_three_hundred_fifty_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="negative_three_hundred_fifty_Select_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>

                      <!-- five_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="call_positive_three_hundred_fifty_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_positive_three_hundred_fifty_strikeSelect_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>



                      <!-- six_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="call_positive_five_hundred_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_positive_five_hundred_strikeSelect_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>



                      <!-- seven_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="call_positive_six_hundred_fifty_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_positive_six_hundred_fifty_strikeSelect_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>

                      <!-- eight_position_double_condor -->

                      <div class="main_strikePrice mb-3">
                        <div class="double_iron_condor_lot_size">
                          <span id="call_positive_eight_hundred_double_iron_condor_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="call_positive_eight_hundred_strikeSelect_double_iron_condor"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>












                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_double_iron_condor"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Lot Qty:</p>
                          <div class="counter_double_iron_condor d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_double_iron_condor">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_double_iron_condor" min="1" disabled />
                            <button class="btn" id="increment_double_iron_condor">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortdouble_iron_condor">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>


        </div>

        <div class="main-put-butterfly">
          <p class="straddle" id="put_butter_fly">BEAR BUTTERFLY</p>

          <div class="" id="put_butterfly_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_put_butterfly">
                    <h5 class="text-center">Bear Butterfly</h5>

                    <div class="main_body_fields_put_butterfly">


                      <!-- first_position_put_butterfly -->
                      <div class="main_strikePrice mb-3">
                        <div class="put_butterfly_lot_size">
                          <span id="put_negative_nine_hundred_fifty_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_negative_nine_hundred_fifty_Select_put_butterfly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>




                      <!-- second_position_put_butterfly -->



                      <div class="main_strikePrice mb-3">
                        <div class="put_butterfly_lot_size">
                          <span id="five_hundred_put_call_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="five_hundred_put_call_Select_put_butterfly"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>


                      <!-- third_position_put_butterfly -->

                      <div class="main_strikePrice mb-3">
                        <div class="put_butterfly_lot_size">
                          <span id="put_negative_fifty_put_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_negative_fifty_Select_put_butterfly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>









                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_put_butterfly"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Lot Qty:</p>
                          <div class="counter_put_butterfly d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_put_butterfly">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_put_butterfly" min="1" disabled />
                            <button class="btn" id="increment_put_butterfly">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortput_butterfly">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>




        </div>

        <div class="main-call-butterfly">
          <p class="straddle" id="call_butter_fly">BULL BUTTERFLY</p>


          <div class="" id="call_butter_fly_modal">
            <div class="dismiss">
              <i class="bx bx-plus dismiss_icon"></i>
              <div class="triangle-up-call_butterfly"></div>
            </div>
            <div class="modal_dialog">
              <div class="modal_content">
                <div class="modal_body" id="modal_body">
                  <div class="main_call_butter_fly">
                    <h5 class="text-center">Bull Butterfly</h5>

                    <div class="main_body_fields_call_butter_fly">


                      <!-- first_position_call_butter_fly -->
                      <div class="main_strikePrice mb-3">
                        <div class="call_butter_fly_lot_size">
                          <span id="put_positive_fifty_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="put_positive_fifty_Select_call_butter_fly"></select>
                        </div>
                        <p class="pe_ce">PE</p>
                      </div>




                      <!-- second_position_call_butter_fly -->



                      <div class="main_strikePrice mb-3">
                        <div class="call_butter_fly_lot_size">
                          <span id="four_hundred_put_call_butterfly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call/Put Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="four_hundred_put_call_Select_call_butter_fly"></select>
                        </div>
                        <p class="pe_ce">CE/PE</p>
                      </div>


                      <!-- third_position_call_butter_fly -->

                      <div class="main_strikePrice mb-3">
                        <div class="call_butter_fly_lot_size">
                          <span id="positive_seven_hundred_fifty_call_butter_fly_lot_size"></span><span>x</span>
                        </div>
                        <div class="strategy_inputs">
                          <label for="strikePrice">Call Strike Price</label>
                          <select class="strike_price_input form-select"
                            id="positive_seven_hundred_fifty_Select_call_butter_fly"></select>
                        </div>
                        <p class="pe_ce">CE</p>
                      </div>









                      <div class="strategy_inputs mb-3">
                        <label for="expirydate">Expiry Date</label>
                        <select class="expiry_date_input form-select" id="expiryDate_call_butter_fly"></select>
                      </div>

                      <div class="main_counter d-flex gap-3 mb-3">
                        <div class="inner_inroFly_counter d-flex gap-2">
                          <p class="fs-5 lot_title">Lot Qty:</p>
                          <div class="counter_call_butter_fly d-flex justify-content-center gap-1">
                            <button class="btn" id="decrement_call_butter_fly">
                              <i class="bx bx-minus"></i>
                            </button>
                            <input type="text" name="" id="counter_input_call_butter_fly" min="1" disabled />
                            <button class="btn" id="increment_call_butter_fly">
                              <i class="bx bx-plus"></i>
                            </button>
                          </div>

                          <button class="" id="shortcall_butter_fly">SELL</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="buy_sell_buttons d-flex gap-2 justify-content-center">

                      

                        </div> -->
                </div>
              </div>
            </div>
          </div>



        </div>

        <div class="custom-strategy">
          <p class="straddle" id="strangle">CUSTOM STRATEGY</p>
        </div>

      </div>
    </div>
  </div>
  <style>
    .strategy_notes {
      display: flex !important;
      align-items: center !important;
      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
      padding: 0px 7px;
      text-align: center;
      font-size: 13px;
      height: 29px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all .2s ease-in-out !important;
      -moz-transition: all .2s ease-in-out !important;
      transition: all .2s ease-in-out !important;
      cursor: pointer;

      font-weight: 600;
    }

    .reset_button {

      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
      padding: 0px 57px;
      text-align: center;
      font-size: 13px;
      height: 34px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all .2s ease-in-out !important;
      -moz-transition: all .2s ease-in-out !important;
      transition: all .2s ease-in-out !important;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;

    }

    .save_strategy {
      background: #fff;
      color: #4399eb;
      padding: 0px 57px;
      text-align: center;
      font-size: 13px;
      height: 34px;
      font-weight: 500;
      border-radius: 4px;
      border: 1px solid #4399eb !important;
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      outline: 0 !important;
      -webkit-transition: all .2s ease-in-out !important;
      -moz-transition: all .2s ease-in-out !important;
      transition: all .2s ease-in-out !important;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;
    }

    .save_strategy:hover {
      background: linear-gradient(180deg, #4399eb, #5cadfb);
      color: #fff;
    }

    .strategy_notes:hover {
      background: #fff !important;
      color: #4399eb !important;
    }

    .main_bottom_strategy_positions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .strategy_position_reset {
      white-space: nowrap;
      column-gap: 0.2rem;
      overflow: auto;
    }

    .left_main_strategy_position {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
  </style>

  <div class="main_option_p_l_greeks_charts">
    <div class="inner_p_l_greeks row">
      <div class="left_main_strategy_position col-md-4 col-lg-4 col-sm-12">

        <div class="main_top_startegy_positions">
          <div class="strategy_position_reset d-flex justify-content-between">
            <p class="fw-bold">Strategy Positions</p>



            <button data-bs-toggle="modal" data-bs-target="#notesModal" class="strategy_notes">Notes</button>



            <!-- Button trigger modal -->
            <style>
              .user_details {
                display: flex;
                gap: 0.6rem;
                align-items: center;
              }

              .zerodha_icon {
                width: 40px;
              }

              .names_user_details h5 {
                font-size: 15px;
                font-weight: 700 !important;
                margin-bottom: auto !important;
              }

              .names_user_details p {
                font-size: 11px;
              }

              .strike_symbols_per_main_order {
                gap: 0.2rem;
                display: flex;
                align-items: center;
              }

              .symbol_name_order p {
                color: #454242;
                font-weight: 100 !important;
              }

              .change_per_order p {
                font-size: 12px;
              }

              .main_header_order {
                display: flex;
                gap: 1rem;
                align-items: center;
              }

              .main_right_order_header {
                display: flex;

                align-items: center;
                gap: 0.8rem;
              }

              .main_limit_select,
              .main_mis_select,
              .main_updates_price_btn {
                display: flex;
                align-items: center;
                gap: 0.3rem;
              }

              .margin_footer {
                display: flex;
                gap: 1rem;
              }

              .margin_needed {
                width: 134px !important;
              }

              .order_place_input {
                width: 134px !important;
              }

              @media (min-width: 992px) {

                .modal-lg,
                .modal-xl {
                  --bs-modal-width: 806px !important;
                }
              }


              .left_positions_reset_notes button,
              .saveNotes,
              .editNotes,
              .updateStrategy,
              .saveStrategy {
                display: flex !important;
                align-items: center !important;
                background: linear-gradient(180deg, #4399eb, #5cadfb);
                color: #fff;
                padding: 0px 7px;
                text-align: center;
                height: 29px;
                font-weight: 500;
                border-radius: 4px;
                border: 1px solid #4399eb !important;
                -webkit-box-shadow: none !important;
                box-shadow: none !important;
                outline: 0 !important;
                -webkit-transition: all .2s ease-in-out !important;
                -moz-transition: all .2s ease-in-out !important;
                transition: all .2s ease-in-out !important;
                cursor: pointer;

                font-weight: 600;
              }

              .reset_button:hover,
              .left_positions_reset_notes button:hover,
              .saveNotes:hover,
              .editNotes:hover,
              .updateStrategy:hover,
              .saveStrategy:hover {
                background: #fff !important;
                color: #4399eb !important;
              }

              .main_filter_greek_P_L {
                overflow: auto;
                white-space: nowrap;

              }

              .main-call-butterfly {
                position: relative;
              }

              .table_pl_greek {
                padding: 0 0.5rem 0.5rem 0.5rem;
              }

              .maximize {
                font-size: 19px !important;
                display: flex;
                justify-content: flex-end;
                cursor: pointer;
              }
            </style>

            <!-- Modal -->
            <div class="modal fade" id="execute" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"
              style="z-index: 99999999999999 !important">
              <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <div class="user_details">
                      <div class="zerodha_icon">
                        <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 60">
                          <defs>
                            <style>
                              .cls-1 {
                                fill: #f6461a;
                              }

                              .cls-2 {
                                fill: #db342c;
                              }
                            </style>
                          </defs>
                          <title>Kite logo trimmed</title>
                          <polygon class="cls-1" points="30 0 0 30 30 60 60 30 90 0 30 0" />
                          <polygon class="cls-2" points="30 60 60 30 90 60 30 60" />
                        </svg>
                      </div>
                      <div class="names_user_details">
                        <h5>Biswajit Panda</h5>
                        <p>Client ID: TWB026</p>
                      </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="main_header_order">
                      <div class="main_left_order_header">
                        <div class="strike_symbols_per_main_order">
                          <div class="symbol_name_order">
                            <p></p>
                          </div>
                          <div class="strike_price_order">
                            <p></p>
                          </div>
                          <div class="change_per_order">
                            <p></p>
                          </div>
                        </div>
                      </div>
                      <div class="main_right_order_header">
                        <div class="main_mis_select d-flex gap-1">
                          <select name="mis_select" id="mis_select" class="form-select mis_select">
                            <option value="overnight">Overnight</option>
                            <option value="intraday">Intraday</option>
                          </select>
                          <i class="bx bx-info-circle"></i>
                        </div>
                        <div class="main_limit_select">
                          <select name="limit_select" id="limit_select" class="form-select limit_select">
                            <option value="limit">Limit</option>
                            <option value="market">Market</option>
                          </select>
                          <i class="bx bx-info-circle"></i>
                        </div>
                        <div class="main_updates_price_btn">
                          <button class="btn btn-outline-primary">
                            <i class="bx bx-sync"></i>Updates Price
                          </button>
                          <i class="bx bx-info-circle"></i>
                        </div>
                        <style>
                          .settings_modal {
                            display: flex;
                            gap: 0.5rem;
                            justify-content: center;
                          }
                        </style>
                        <div class="main_settings_order dropdown">
                          <button class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <i class="bx bx-cog"></i>Settings
                          </button>
                          <div class="dropdown-menu" style="width: 200px !important">
                            <div class="form-check settings_modal">
                              <input class="form-check-input" type="checkbox" id="in_depth_check_box" checked />
                              <label class="form-check-label" for="in_depth_check_box">
                                Show Depth & Info
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="order_modal"></div>
                  </div>
                  <div class="modal-footer justify-content-between">
                    <div class="margin_footer">
                      <div class="form-group order_place_input">
                        <label for="expiryEdit">Margin Needed</label>
                        <input type="number" value="4.1" class="margin_needed form-control" disabled />
                      </div>
                      <div class="form-group order_place_input">
                        <label for="expiryEdit">Margin Available</label>
                        <input type="number" value="4.1" class="margin_available form-control" disabled />
                      </div>
                    </div>
                    <button type="button" class="btn btn-primary place_order_btn">
                      Place All Order
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal fade" id="save_startegyModal" tabindex="-1" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Update Strategy</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3">

                      <input type="text" class="form-control" id="strategy_input" placeholder="Enter strategy name">
                    </div>
                  </div>
                  <div class="modal-footer">


                    <button type="button" class="saveStrategy">Save</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal fade" id="notesModal" tabindex="-1" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Strategy Notes</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3">
                      <textarea class="form-control" id="editInput" rows="3" placeholder="Write your note here..."
                        disabled></textarea>
                    </div>
                  </div>
                  <div class="modal-footer">

                    <button type="button" class="editNotes">Edit</button>
                    <button type="button" class="saveNotes">Save</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal fade edit_Strategy_modal" id="editStrategyModal" tabindex="-1"
              aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Update Strategy</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <input type="text" class="form-control" id="updateStrategyname">
                  </div>
                  <div class="modal-footer">

                    <button type="button" class="updateStrategy" id="updateStrategy_btn">Update
                      Strategy</button>
                  </div>
                </div>
              </div>
            </div>

            <script>
              $(document).ready(function () {



                $(".saveStrategy").click(function () {
                  var strategy_input = $("#strategy_input").val();
                  var tempTradingPositions = localStorage.getItem('Temp_TradingPositions');

                  $.ajax({
                    type: "POST",
                    url: "/save_strategy",
                    data: {

                      'strategy_input': strategy_input,
                      'trading_positions': tempTradingPositions,  // Add the retrieved value here

                      'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                      // handle success

                      if (response.user_not_logged_in) {
                        $("#signinModal").modal("show");
                      } else {
                        alert(response.message);
                        getStrategies_data()
                        $("#strategy_input").val('')
                      }


                    },
                    error: function (response) {
                      // handle error
                      alert(response.message);
                    }
                  });

                })


                $("#saveStrategies").click(function () {

                  getStrategies_data()
                })
                function getStrategies_data() {
                  $.ajax({
                    type: "GET",
                    url: "/get_all_strategies",
                    success: function (response) {
                      if (response.user_not_logged_in) {
                        console.log("not logged");
                        $("#signinModal").modal("show");
                      } else {
                        // handle success
                        $("#saved_startegyModal").modal("show");
                        var strategyData = response.strategy_data;
                        $(".all_strategies").empty()
                        // Do something with the strategy data

                        if (strategyData.length === 0) {
                          $(".all_strategies").append(`
                                              <div class="d-flex  justify-content-center p-2"> <p>No Strategies Found...</p></div>
                                              `);
                        } else {
                          strategyData.forEach((strategy) => {

                            var tradingPositions = `
                                                      <div class="savedStrategies d-flex justify-content-between">
                                                          <div class="left_strategy_name">
                                                              ${strategy.strategy_name}
                                                          </div>
                                                          <div class="right_strategy_action">
                                                              <i class='bx bx-edit fs-4 text-success cursor-pointer edit_strategy'  data-bs-toggle="modal" data-bs-target="#editStrategyModal" data-edit="${strategy.id}"></i>
                                                              <i class='bx bxs-trash-alt fs-4 text-danger cursor-pointer delete_strategy' data-delete="${strategy.id}"></i>
                                                          </div>
                                                      </div>
                                                  `;
                            $(".all_strategies").append(tradingPositions);
                          });
                        }



                        console.log(strategyData);

                        $(".delete_strategy").click(function () {
                          var strategyId = $(this).data('delete');
                          console.log(strategyId);

                          if (confirm("Are you sure you want to delete this strategy?")) {
                            // Perform delete operation with strategyId
                            $.ajax({
                              type: "POST",
                              url: "/delete_strategy",
                              data: {
                                'strategy_id': strategyId,
                                'csrfmiddlewaretoken': '{{ csrf_token }}'
                              }
                            })
                              .done(function (response) {
                                // handle success
                                console.log(response.message);
                                getStrategies_data();
                                // Refresh the strategies list or remove the deleted strategy from the DOM
                              })
                              .fail(function (xhr, status, error) {
                                // handle error
                                console.error('Error deleting strategy:', error);
                              });
                          }
                        });

                        // Open the modal on clicking the edit icon
                        $(".edit_strategy").click(function () {
                          var strategyId = $(this).data('edit');
                          console.log(strategyId);

                          $.ajax({
                            type: "POST",
                            url: "/get_unique_strategy",
                            data: {
                              'strategy_id': strategyId,

                            },
                            success: function (response) {
                              // handle success
                              console.log(response.strategy_data);

                              $("#updateStrategyname").val(response.strategy_data.strategy_name).attr('data-id-update', strategyId);

                            },
                            error: function (response) {
                              // handle error
                              console.log('Error updating strategy:', response);
                            }
                          });

                        });



                        // Update the strategy on clicking the update button
                        $("#updateStrategy_btn").click(function () {
                          var updatedStrategyName = $("#updateStrategyname").val();
                          var strategyId = $("#updateStrategyname").attr('data-id-update');

                          // Send AJAX request to update the strategy name
                          $.ajax({
                            type: "POST",
                            url: "/update_strategy",
                            data: {
                              'strategy_id': strategyId,
                              'updated_strategy_name': updatedStrategyName,
                              'csrfmiddlewaretoken': '{{ csrf_token }}'
                            },
                            success: function (response) {
                              // handle success
                              console.log(response.message);
                              getStrategies_data(); // Refresh the strategies list

                            },
                            error: function (response) {
                              // handle error
                              console.log('Error updating strategy:', response);
                            }
                          });
                        });


                      }






                    },
                    error: function (response) {
                      // handle error
                      console.log('Error fetching strategies:', response);
                    }
                  });

                }











                $(".saveNotes").click(function () {
                  var noteText = $("#editInput").val();
                  $.ajax({
                    type: "POST",
                    url: "/save_note",
                    data: {
                      'id': 1,
                      'text': noteText,
                      'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                      // handle success

                      if (response.not_logged_in) {
                        $("#signinModal").modal("show");

                      } else {
                        alert(response.message);
                        displayNotes();
                        disableNote();
                      }


                    },
                    error: function (response) {
                      // handle error
                      if (response.status === 401) {

                      } else {
                        alert(response.message);
                      }
                    }
                  });
                });


                // Add code to open the sign-in modal here
                // You can use Bootstrap modal or any other modal library for this purpose
                // Example code for opening Bootstrap modal:







                function displayNotes() {
                  $.ajax({
                    type: 'GET',
                    url: '/get_notes',  // Replace with your URL to fetch notes
                    success: function (notes) {
                      if (notes.length > 0) {
                        var latestNote = notes[notes.length - 1];
                        $("#editInput").val(latestNote.text);
                      }
                    },
                    error: function (error) {
                      console.log('Error fetching notes:', error);
                    }
                  });
                }
                displayNotes();

                $(".editNotes").click(function () {
                  editNote()
                })

                function disableNote() {
                  $("#editInput").prop('disabled', true); // Enable the textarea when editing
                  // Revert CSS properties to their defaults

                }
                function editNote() {
                  $("#editInput").prop('disabled', false); // Enable the textarea when editing
                  // Revert CSS properties to their defaults
                  $("#editInput").focus()
                }
              });


            </script>


          </div>

          <div class="main_position"></div>

          <div class="main_all_profit_loss">
            <div class="d-flex align-items-center justify-content-between mt-2">
              <p class="fs-14 fw-500 label-color-6">Max. Profit</p>
              <p class="fs-14 fw-500 text-green" id="max_profit">Null</p>
            </div>
            <div class="d-flex align-items-center justify-content-between">
              <p class="fs-14 fw-500 label-color-6">Max. Loss</p>
              <p class="fs-14 fw-500 text-danger" id="max_loss">Null</p>
            </div>

            <div class="d-flex align-items-center justify-content-between">
              <p class="fs-14 fw-500 label-color-6">Breakevens</p>
              <p class="fs-14 fw-500 label-color-6" id="break_evens">
                Null
              </p>
            </div>

            <div class="d-flex align-items-center justify-content-between">
              <p class="fs-14 fw-500 label-color-6">Reward Risk:</p>
              <p class="fs-14 fw-500 label-color-6" id="ratio">No Defined</p>
            </div>
          </div>
        </div>
        <div class="main_bottom_strategy_positions">
          <button data-bs-toggle="modal" data-bs-target="#save_startegyModal" class="save_strategy">Save
            Strategy</button>
          <button class="reset_button d-flex gap-1 align-items-center" disabled
            title="Please Activate your API for placing order">
            <p style="margin-bottom: auto; margin-top: auto; font-size: 12px" data-bs-toggle="modal"
              data-bs-target="#execute" class="execute_all_strategies">
              Execute Order
            </p>
          </button>

        </div>
      </div>

      <div class="right_p_l_greeks col-md-7 col-lg-7 col-sm-12">

        <i class='bx bx-fullscreen maximize'></i>
        <div class="table_pl_greek">
          <div class="main_filter_greek_P_L">
            <div class="inner_greek_p_l d-flex">
              <p class="payoff_charts greek_strategy_active">
                PAYOFF DIAGRAM

              </p>
              <p class="payoff_table">
                PAYOFF TABLE

              </p>
              <p class="strategy_cost_table">
                STRATEGY COST
              </p>
              <p class="greek_table">GREEKS</p>
              <p class="oi_chart">OI CHART</p>
              <p class="adjustment">ADJUSTMENT</p>
              <p class="targets">TARGET</p>
              <p class="stoploss">STOPLOSS</p>
              <p class="alerts">ALERT</p>
              <p class="history">HISTORY</p>
            </div>
          </div>

          <div id="payoff_charts">
            <div id="chartdiv" style="width: 100%; height: 400px;"></div>
          </div>
          <div id="payoff_table" style="width: 100%; height: 400px;     overflow: auto;">

            <table class="payoff_table_main_table table table-striped-custom">
              <thead>
                <tr>
                  <th>

                    <div class="strikePrice_payoff_table">

                      Strike Price
                    </div>
                  </th>
                  <th class="d-flex gap-2 align-items-center">

                    <div class="on_expiry_profits">
                      On Expiry
                    </div>
                    <div class="payoff_expiry">

                    </div>
                  </th>
                </tr>
              </thead>

              <tbody class="payoff_table_data">

              </tbody>
            </table>

          </div>

          <div id="table-Greeks" class="table-responsive">
            <table id="resultTable" class="table table-striped-custom">
              <thead class="bg-light">
                <tr>
                  <th>POSITION</th>
                  <th>IV</th>
                  <th>DELTA</th>
                  <th>THETA</th>
                  <th>GAMMA</th>
                  <th>VEGA</th>
                  <th>RHO</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>


          <div id="table-PL_main" class="table-responsive">
            <table class="PL-table table table-striped-custom">
              <thead class="bg-light">
                <tr>
                  <th>POSITION</th>
                  <th>TRADED PRICE</th>
                  <th>CURRENT PRICE</th>
                  <th>LOTS</th>
                  <th>QTY.</th>
                  <th>TOTAL CUR. COST</th>
                  <th class="text-center">P/L</th>
                </tr>
              </thead>
              <tbody id="table-PL"></tbody>
            </table>
          </div>

          <div id="oi-charts">
            <div class="option_oi_charts">
              <div id="oi_charts" style="width: 100%; height: 400px;"></div>
            </div>

          </div>

          <div id="real_adjustment_table">
            <table class="table table-striped-custom">
              <thead class="adjsuments_table_thead">

                <tr>

                  <td>STRATEGY</td>
                  <td>BREAKEVENS</td>
                  <td>STRIKE PRICE</td>
                  <td>OPTION PRICE</td>
                  <td>ACTION</td>

                </tr>
              </thead>
              <tbody class="real_adjustment_table_body">
                <tr>
                  <td>
                    <div>ADJUSTMENTS 1</div>
                  </td>
                  <td>
                    <div>19318.75</div>
                  </td>
                  <td>
                    <div>19200</div>
                  </td>
                  <td>
                    <div>65.2</div>
                  </td>
                  <td>
                    <div><button class="adjust">Adjust</button></div>
                  </td>

                </tr>
                <tr>
                  <td>
                    <div>ADJUSTMENTS 1</div>
                  </td>
                  <td>
                    <div> 19781.25</div>
                  </td>
                  <td>
                    <div>19200</div>
                  </td>
                  <td>
                    <div>65.2</div>
                  </td>
                  <td>
                    <div><button class="adjust">Adjust</button></div>
                  </td>

                </tr>

              </tbody>

            </table>

          </div>

          <div class="targets_table">

            <table class="table table-striped-custom">
              <thead>
                <tr>

                  <th>STRATEGY</th>
                  <th> STRIKE PRICE</th>
                  <th>TARGET PRICE</th>
                  <th>TARGET PERCENTAGE</th>
                  <th>VARIANCE</th>
                  <th>ACTION</th>
                </tr>
              </thead>

              <tbody>
              <tbody>


                <tr>

                  <td>
                    Strategy 1
                  </td>

                  <td>19100</td>
                  <td>
                    <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                      <div class="" style="display: flex;align-items: center;">
                        <label for="exampleInputEmail1" class="form-label"></label>
                        <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                          aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                        <div id="emailHelp" class="form-text"></div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                      <div class="" style="display: flex;align-items: center;">
                        <label for="exampleInputEmail1" class="form-label"></label>
                        <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                          aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                        <div id="emailHelp" class="form-text">%</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="" style="display: flex;align-items: center;">
                      <label for="exampleInputEmail1" class="form-label"></label>
                      <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                        aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                      <div id="emailHelp" class="form-text"></div>
                    </div>
          </div>
          </td>
          <td><button class="setTarget">Set Target</button></td>




          </tr>

          <tr>

            <td>
              Strategy 2
            </td>

            <td>19100</td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text">%</div>
                </div>
              </div>
            </td>
            <td>
              <div class="" style="display: flex;align-items: center;">
                <label for="exampleInputEmail1" class="form-label"></label>
                <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                  aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                <div id="emailHelp" class="form-text"></div>
              </div>
        </div>
        </td>
        <td><button class="setTarget">Set Target</button></td>




        </tr>

        <tr>

          <td>
            Strategy 3
          </td>

          <td>19100</td>
          <td>
            <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

              <div class="" style="display: flex;align-items: center;">
                <label for="exampleInputEmail1" class="form-label"></label>
                <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                  aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                <div id="emailHelp" class="form-text"></div>
              </div>
            </div>
          </td>
          <td>
            <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

              <div class="" style="display: flex;align-items: center;">
                <label for="exampleInputEmail1" class="form-label"></label>
                <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                  aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                <div id="emailHelp" class="form-text">%</div>
              </div>
            </div>
          </td>
          <td>
            <div class="" style="display: flex;align-items: center;">
              <label for="exampleInputEmail1" class="form-label"></label>
              <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
              <div id="emailHelp" class="form-text"></div>
            </div>
      </div>
      </td>

      <td><button class="setTarget">Set Target</button></td>




      </tr>




      </tbody>
      </table>





    </div>











    <div class="stoploss_table">

      <table class="table table-striped-custom">
        <thead>
          <tr>

            <th>STRATEGY</th>
            <th> STRIKE PRICE</th>
            <th>STOPLOSS PRICE</th>
            <th>STOPLOSS PERCENTAGE</th>
            <th> VARIANCE</th>
            <th>ACTION</th>
          </tr>
        </thead>

        <tbody>
        <tbody>


          <tr>

            <td>
              Strategy 1
            </td>

            <td>19100</td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>


            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text">%</div>
                </div>
              </div>
            </td>


            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>

            <td><button class="setTarget">Set Stoploss</button></td>




          </tr>

          <tr>

            <td>
              Strategy 2
            </td>

            <td>19100</td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text">%</div>
                </div>
              </div>
            </td>

            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>

            <td><button class="setTarget">Set Stoploss</button></td>




          </tr>

          <tr>

            <td>
              Strategy 3
            </td>

            <td>19100</td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="5" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text">%</div>
                </div>
              </div>
            </td>
            <td>
              <div class="main_tagets_check_input" style="display: flex;align-items: flex-start;gap: 0.5rem;">

                <div class="" style="display: flex;align-items: center;">
                  <label for="exampleInputEmail1" class="form-label"></label>
                  <input type="number" class="form-control form-control-sm" id="exampleInputEmail1"
                    aria-describedby="emailHelp" value="19200" fdprocessedid="n1q6hn" style="width: 85px;">
                  <div id="emailHelp" class="form-text"></div>
                </div>
              </div>
            </td>

            <td><button class="setTarget">Set Stoploss</button></td>




          </tr>




        </tbody>
      </table>


    </div>
    <div class="alerts_table">


      <table class="table table-striped-custom">
        <thead class="adjsuments_table_thead">

          <tr>

            <td>STRATEGY</td>
            <td>BREAKEVENS</td>
            <td>STRIKE PRICE</td>
            <td>OPTION PRICE</td>
            <td>ACTION</td>

          </tr>
        </thead>
        <tbody class="real_adjustment_table_body">
          <tr>
            <td>
              <div>ALerts 1</div>
            </td>
            <td>
              <div>19318.75</div>
            </td>
            <td>
              <div>19200</div>
            </td>
            <td>
              <div>65.2</div>
            </td>
            <td>
              <div><button class="adjust">Set Alert</button></div>
            </td>

          </tr>
          <tr>
            <td>
              <div>Alerts 1</div>
            </td>
            <td>
              <div> 19781.25</div>
            </td>
            <td>
              <div>19200</div>
            </td>
            <td>
              <div>65.2</div>
            </td>
            <td>
              <div><button class="adjust">Set Alert</button></div>
            </td>

          </tr>

        </tbody>

      </table>




    </div>
    <div class="history_table">
      <p>History is under developements</p>
    </div>

  </div>
</div>
</div>
</div>


<script>
  $(".maximize").click(function () {
    var elem = document.querySelector('.right_p_l_greeks');
    var chartDiv = document.getElementById('chartdiv');
    var payoffTable = document.getElementById('payoff_table'); // Add this line to select the element by its ID
    var oi_charts = document.getElementById('oi_charts'); // Add this line to select the element by its ID
    var maximizeIcon = document.querySelector('.maximize');

    if (!document.fullscreenElement) {
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '90vh';
        payoffTable.style.height = '90vh'; // Set the height of the payoff_table to 90vh
        oi_charts.style.height = '90vh'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-fullscreen');
        maximizeIcon.classList.add('bx-exit-fullscreen');
      } else if (elem.webkitRequestFullscreen) { /* Safari */
        elem.webkitRequestFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '90vh';
        payoffTable.style.height = '90vh';
        oi_charts.style.height = '90vh'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-fullscreen');
        maximizeIcon.classList.add('bx-exit-fullscreen');
      } else if (elem.msRequestFullscreen) { /* IE11 */
        elem.msRequestFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '90vh';
        payoffTable.style.height = '90vh';
        oi_charts.style.height = '90vh'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-fullscreen');
        maximizeIcon.classList.add('bx-exit-fullscreen');
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '400px'; // Change back to initial height
        payoffTable.style.height = '400px'; // Revert to default height
        oi_charts.style.height = '400px'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-exit-fullscreen');
        maximizeIcon.classList.add('bx-fullscreen');
      } else if (document.webkitExitFullscreen) { /* Safari */
        document.webkitExitFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '400px'; // Change back to initial height
        payoffTable.style.height = '400px';
        oi_charts.style.height = '400px'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-exit-fullscreen');
        maximizeIcon.classList.add('bx-fullscreen');

      } else if (document.msExitFullscreen) { /* IE11 */
        document.msExitFullscreen();
        $('.right_p_l_greeks').css('background-color', 'white');
        chartDiv.style.height = '400px'; // Change back to initial height
        payoffTable.style.height = '400px';
        oi_charts.style.height = '400px'; // Set the height of the payoff_table to 90vh
        maximizeIcon.classList.remove('bx-exit-fullscreen');
        maximizeIcon.classList.add('bx-fullscreen');

      }
    }
  });

  document.onkeydown = function (evt) {
    evt = evt || window.event;
    var isEscape = false;
    if ("key" in evt) {
      isEscape = (evt.key === "Escape" || evt.key === "Esc");
    } else {
      isEscape = (evt.keyCode === 27);
    }
    if (isEscape) {
      alert("hi")
      minimizeFunction();
    }
  };

  function minimizeFunction() {
    var maximizeIcon = document.querySelector('.maximize');

    if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) { /* Safari */
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) { /* IE11 */
        document.msExitFullscreen();
      } else if (document.mozCancelFullScreen) { /* Firefox */
        document.mozCancelFullScreen();
      }
      $('.right_p_l_greeks').css('background-color', 'red');
      document.getElementById('chartdiv').style.height = '400px'; // Change back to initial height
      document.getElementById('payoff_table').style.height = '400px'; // Revert to default height
      document.getElementById('oi_charts').style.height = '400px'; // Set the height of the oi_charts to 400px
      maximizeIcon.classList.remove('bx-exit-fullscreen');
      maximizeIcon.classList.add('bx-fullscreen');
    }
  }



</script>



<style>
  .main_action_btn_api {
    display: flex;
    /* align-items: center; */
  }

  @supports (-webkit-appearance: none) or (-moz-appearance: none) {
    .checkbox-wrapper-14 input[type="checkbox"] {
      --active: #275efe;
      --active-inner: #fff;
      --focus: 2px rgba(39, 94, 254, 0.3);
      --border: #bbc1e1;
      --border-hover: #275efe;
      --background: #fff;
      --disabled: #f6f8ff;
      --disabled-inner: #e1e6f9;
      -webkit-appearance: none;
      -moz-appearance: none;
      height: 21px;
      outline: none;
      display: inline-block;
      vertical-align: top;
      position: relative;
      margin: 0;
      cursor: pointer;
      border: 1px solid var(--bc, var(--border));
      background: var(--b, var(--background));
      transition: background 0.3s, border-color 0.3s, box-shadow 0.2s;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:after {
      content: "";
      display: block;
      left: 0;
      top: 0;
      position: absolute;
      transition: transform var(--d-t, 0.3s) var(--d-t-e, ease),
        opacity var(--d-o, 0.2s);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:checked {
      --b: var(--active);
      --bc: var(--active);
      --d-o: 0.3s;
      --d-t: 0.6s;
      --d-t-e: cubic-bezier(0.2, 0.85, 0.32, 1.2);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:disabled {
      --b: var(--disabled);
      cursor: not-allowed;
      opacity: 0.9;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:disabled:checked {
      --b: var(--disabled-inner);
      --bc: var(--border);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:disabled+label {
      cursor: not-allowed;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:hover:not(:checked):not(:disabled) {
      --bc: var(--border-hover);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:focus {
      box-shadow: 0 0 0 var(--focus);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch) {
      width: 21px;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch):after {
      opacity: var(--o, 0);
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch):checked {
      --o: 1;
    }

    .checkbox-wrapper-14 input[type="checkbox"]+label {
      display: inline-block;
      vertical-align: middle;
      cursor: pointer;
      margin-left: 4px;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch) {
      border-radius: 7px;
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch):after {
      width: 5px;
      height: 9px;
      border: 2px solid var(--active-inner);
      border-top: 0;
      border-left: 0;
      left: 7px;
      top: 4px;
      transform: rotate(var(--r, 20deg));
    }

    .checkbox-wrapper-14 input[type="checkbox"]:not(.switch):checked {
      --r: 43deg;
    }

    .checkbox-wrapper-14 input[type="checkbox"].switch {
      width: 38px;
      border-radius: 11px;
    }

    .checkbox-wrapper-14 input[type="checkbox"].switch:after {
      left: 2px;
      top: 2px;
      border-radius: 50%;
      width: 17px;
      height: 17px;
      background: var(--ab, var(--border));
      transform: translateX(var(--x, 0));
    }

    .checkbox-wrapper-14 input[type="checkbox"].switch:checked {
      --ab: var(--active-inner);
      --x: 17px;
    }

    .checkbox-wrapper-14 input[type="checkbox"].switch:disabled:not(:checked):after {
      opacity: 0.6;
    }
  }

  .checkbox-wrapper-14 * {
    box-sizing: inherit;
  }

  .checkbox-wrapper-14 *:before,
  .checkbox-wrapper-14 *:after {
    box-sizing: inherit;
  }
</style>

<style>
  .main_symbol_sell_buy {
    display: flex;
    gap: 0.2rem;
  }

  .sellTrade {
    background: #ff000029;
    color: #a20000;
    padding: 4px 8px 3px 8px;
    font-size: 11px;
    border-radius: 4px;
  }

  .buyTrade {
    background: #0daa0029;
    color: #02833e;
    padding: 4px 8px 3px 8px;
    font-size: 11px;
    border-radius: 4px;
  }

  .inner_order_modal {
    padding: 11px;
  }

  .ultra_main_order {
    box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;

    margin-top: 1.3rem;
    border-radius: 8px;
  }

  .main_bottom_card_order {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .left_bottom_card_order {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .main_price_qty {
    display: flex;
    gap: 0.3rem;
    align-items: center;
  }

  .api_actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 1rem;
    gap: 0.5rem;
  }

  .delete_api_btn {
    /* color: #d90000; */
    color: white;
    border: 1px solid red;
    background-color: red;
    border-radius: 5px;
    cursor: pointer;
    transition: 0.3s;
  }

  .delete_api_btn:hover {
    color: red;
    ;
    border: 1px solid red;
    background-color: white;
  }

  .btn_success {
    border: 1px solid green;
    color: green;
    padding: 2px 8px;
    background-color: white;
    border-radius: 5px;
    transition: 0.3s;
  }

  .btn_success:hover {
    background-color: green;
    color: white;
  }

  .btn_danger {
    border: 1px solid #d90000;
    color: #d90000;
    padding: 2px 8px;
    background-color: white;
    border-radius: 5px;
    text-decoration: none !important;
    transition: 0.3s;
  }

  .btn_danger:hover {
    background-color: #d90000;
    color: white !important;
  }

  .btn_danger a {
    text-decoration: none;
    color: #d90000;
  }

  .btn_danger:hover.btn_danger a {
    text-decoration: none;
    background-color: #d90000;
    color: white !important;
  }

  .bg_indicator_sell {
    background-color: #ffcdd2 !important;
    border-color: #ffcdd2 !important;
    color: #e53935 !important;
    caret-color: #e53935 !important;
    padding: 1px 10px;
    border-radius: 2px;

  }

  .bg_indicator_buy {
    color: #43a047 !important;
    caret-color: #43a047 !important;
    background-color: #c8e6c9 !important;
    border-color: #c8e6c9 !important;
    padding: 1px 10px;
    border-radius: 2px;

  }
</style>
</div>
<div class="modal fade" id="editPositionModal">
  <div class="modal-dialog modal-dialog-centered" id="edit_modal">
    <div class="modal-content">
      <div class="modal-header" id="modal_header_edit">
        <h5 class="modal-title" id="modal_title_edit">Edit Position</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modal_body">
        <div class="form-group textOnInput_edit">
          <label for="expiryEdit">Select Expiry</label>
          <select name="selectExpiry" class="expiry_date_input" id="selectExpiry"></select>
        </div>
        <div class="form-group textOnInput_edit">
          <label for="strikeEdit">Select Strike Price</label>
          <select name="selectStrikePrice" class="strike_price_input" id="selectStrikePrice"></select>
        </div>
        <div class="form-group textOnInput_edit">
          <label for="optionType">Select Option Type</label>
          <select name="optionType" id="optionType">
            <option value="CE">CE</option>
            <option value="PE">PE</option>
          </select>
        </div>

        <div class="Long_short">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="long_short" id="long_radio" value="Long" checked />
            <label class="form-check-label" for="long_radio"> Buy </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="long_short" id="short_radio" value="Short" />
            <label class="form-check-label" for="short_radio"> Short </label>
          </div>
        </div>
        <div class="main_counter d-flex gap-3 mb-3">
          <div class="innerStraddle_lot_size">
            <p class="fs-6 lot_title">Lot Qty:</p>
            <div class="counter_straddle d-flex justify-content-center gap-1">
              <button class="btn" id="decrement_edit">
                <i class="bx bx-minus"></i>
              </button>
              <input type="text" name="" id="counter_input_edit" min="1" disabled />
              <button class="btn" id="increment_edit">
                <i class="bx bx-plus"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="form-group textOnInput_edit">
          <label for="entryEdit">Entry Price</label>
          <input type="text" class="edit_entry form-control" />
        </div>
        <div class="form-group textOnInput_edit">
          <label for="exitPrice">Exit Price</label>
          <input type="number" class="exit_price form-control" />
        </div>
      </div>
      <div class="modal-footer" id="modal_footer_edit">
        <button type="button" class="saveChanges" data-bs-dismiss="modal" id="saveChangesButton">
          Save
        </button>
      </div>
    </div>
  </div>
</div>
<style>
  .main_spot_order {
    display: flex;
    align-items: center;
  }

  .spot_main_table {
    display: flex;
    gap: 0.7rem;
  }

  .left_spot,
  .right_spot {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .left_spot {
    width: 7rem;
  }

  .right_spot {
    width: 12rem;
  }

  .main_indepth {
    display: flex;
    justify-content: center;
    gap: 3rem !important;
    align-items: flex-start;
  }

  .indepth_details table,
  .indepth_details_offer table {
    font-size: 10px;
  }

  .indepth_details table thead tr th,
  .indepth_details table tbody tr td,
  .indepth_details_offer table thead tr th,
  .indepth_details_offer table tbody tr td {
    border-style: none !important;
  }

  .main_spot_order {
    font-size: 12px;
  }

  .main_api_info {
    display: flex;
    gap: 1rem;
    flex-direction: column;
  }

  /* Styling for the title attribute */
  .bx-help-circle::after {
    content: attr(data-title);
    display: none;
    background-color: black;
    color: white;
    border-radius: 5px;
    padding: 5px;
    position: absolute;
    white-space: nowrap;
    z-index: 1;

    font-size: 12px;
    /* Additional styling as needed */
  }

  .bx-help-circle:hover::after {
    display: block;
  }
</style>
<script>
  $(document).ready(function () {

    loadSpotData("NIFTY");
    function checkMainPositionContent() {
      var mainPositionElements = $('.main_position');
      var resetButton = $('.reset_button');
      var isEmpty = true;

      mainPositionElements.each(function () {
        if ($(this).html().trim() !== "") {
          isEmpty = false;
          return false; // exit the loop if a non-empty element is found
        }
      });

      if (isEmpty) {
        resetButton.prop('disabled', true);
      } else {
        resetButton.prop('disabled', false);
      }
    }

    $(".dismiss_icon_active_modal").click(function () {
      $("#active_broker_modal").slideUp();
    });

    $("#in_depth_check_box").change(function () {
      if (this.checked) {
        // If the checkbox is checked, hide the .main_indepth element
        $(".main_indepth").show();
      } else {
        // If the checkbox is unchecked, show the .ultra_main_indepth element
        $(".main_indepth").hide();
      }
    });

    // ACess_TOKEN

    $(".save_zerodha_btn").click(function (event) {
      event.preventDefault();
      var app_name = $("#app_name").val();
      var api_key = $("#api_key").val();
      var secret_key = $("#secret_key").val();
      var all_brokers = $("#all_brokers").val();
      if (!app_name || !api_key || !secret_key) {
        alert("Please fill in all fields.");
        return; // Don't proceed with the AJAX request if any field is empty
      }

      $.ajax({
        url: "/save_zerodha_config", // URL of your Django view
        type: "POST",
        data: {
          app_name: app_name,
          api_key: api_key,
          secret_key: secret_key,
          all_brokers: all_brokers,
          csrfmiddlewaretoken: "{{ csrf_token }}", // Include CSRF token for security
        },
        success: function (response) {
          console.log(response.message);
          get_api_data();

          $("#app_name").val("");
          $("#api_key").val("");
          $("#secret_key").val("");
          $(".btn-close[data-bs-dismiss='offcanvas']").click(); // Simulate a click event on the button with the specific data-bs-dismiss attribute


        },
        error: function (xhr, status, error) {
          console.error(xhr.responseText);
        },
      });
    });
    var hasRunOnPageLoad = false; // Initialize a flag to track whether the code has run on page load

    function get_api_data() {
      $.ajax({
        url: "/get_zerodha_config", // URL of your Django view for data retrieval
        type: "GET",
        success: function (data) {
          // Handle the retrieved data
          console.log(data);

          var all_data = "";

          if (data.length === 0) {
            // If data is empty, display "NO API available"
            all_data = "<p style='padding: 0 85px;''>No API available </p>";
          } else {
            $.each(data, function (index, item) {
              // Your existing code to format each API configuration item
              var connected_varifications =
                item.connected !== "Connected"
                  ? `<a href="https://kite.zerodha.com/connect/login?api_key=${item.api_key}&v=3">${item.connected}</a>`
                  : "Connected";
              var connected_btn_class =
                item.connected !== "Connected"
                  ? `btn_danger edit_access_token`
                  : "btn_success";
              var switch_btn_visibility =
                item.connected !== "Connected" ? `d-none` : "d-block";

              all_data += `
        <div class='main_api_card'>
            <div class="active_inactive_btn d-flex align-items-baseline gap-3"> 

                
                <div class="checkbox-wrapper-14 ${switch_btn_visibility}">
                    <input id="s1-14" type="checkbox" class="switch" style="padding: 7px 21px 14px 17px;">
                    <label for="s1-14">Inactive</label>
                </div>
            </div>

            <div class="main_api_info">
                <div class="app_name_main">
                    <p class="text-primary">App Name: </p>
                    <p>${item.app_name}</p>
                </div>
               
                <div class="api_key_main">
                    <p class=text-primary>Api Key:</p>
                    <p>${item.api_key}</p>
                </div>

                <div class="secret_key_main">
                    <p class=text-primary>Secret Key: </p>
                    <p>${item.secret_key}</p>
                </div>

                <div class="last_api_token_main" style="display:none;">
                    <p>last token updated:</p>
                    <p> ${item.api_added_at}</p>
                </div>
                
                <div class="access_teken">
                    <p class="text-primary" style="display: flex;
    align-items: flex-end;"> Access Token <sup><i class='bx bx-help-circle ms-1' data-title="${item.api_added_at}"></i></sup>:</p>
                    <p>${item.access_token}</p>
                </div>
                <div class="api_actions">
                    <div class="main_action_btn_api d-flex gap-1">
                        <button class="${connected_btn_class}" data-id="${item.id}">${connected_varifications}</button>
                        <button class="delete_api_btn  cursor-pointer" data-id="${item.id}">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    `;
            });

            $('.help-icon').hover(function () {
              var index = $(this).data('data-added-at');
              $('#hover-info-' + index).css('display', 'block');
            }, function () {
              var index = $(this).data('data-added-at');
              $('#hover-info-' + index).css('display', 'none');
            });
          }

          $("#zerodha_data_display").empty().append(all_data);

          var $checkbox = $("#s1-14");
          var $label = $("label[for='s1-14']");
          var $button = $(".reset_button");

          // Add a change event handler to the checkbox
          $checkbox.on("change", function () {
            // Check if the checkbox is checked
            if ($checkbox.is(":checked")) {
              // If checked, change the label text and enable the button
              $label.text("Activated");
              checkMainPositionContent()
              $button.attr("title", ""); // Remove the title attribute
            } else {
              // If not checked, change the label text, disable the button, and set the title
              $label.text("Inactive");
              checkMainPositionContent()
              $button.attr(
                "title",
                "Please Activate your API for placing order"
              );
            }
          });

          // Attach a click event handler for the delete buttons
          $(".delete_api_btn").click(function () {
            var itemId = $(this).data("id");
            if (confirm("Are you sure you want to delete this Api?")) {
              deleteItem(itemId);
            }
          });


          $(".edit_access_token").click(function () {
            // Get the data-id attribute value
            var data_Id_access_token = $(this).data("id");

            // Check if the browser supports local storage
            if (typeof Storage !== "undefined") {
              // Use localStorage to store the data-id value
              localStorage.setItem(
                "data_Id_access_token",
                data_Id_access_token
              );

              // Optionally, you can also retrieve the stored value like this:
              // var storedData_Id_access_token = localStorage.getItem("data_Id_access_token");
            } else {
              // If the browser does not support local storage, you can handle it here
              console.log("Local storage is not supported in this browser.");
            }
          });

          if (!hasRunOnPageLoad) {
            // Check if the code has not run on page load

            var uniqueId = localStorage.getItem("data_Id_access_token");

            // Function to extract query parameters from a URL
            function getQueryParam(url, name) {
              name = name.replace(/[\[\]]/g, "\\$&");
              var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
              var results = regex.exec(url);
              if (!results) return null;
              if (!results[2]) return "";
              return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            // Get the current URL
            var currentUrl = window.location.href;

            // Extract the 'request_token' parameter from the URL
            var requestToken = getQueryParam(currentUrl, "request_token");

            // Check if 'requestToken' has a value and do something with it
            if (requestToken) {
              console.log("request_token:", requestToken);
              editAccessToken(uniqueId, requestToken);
              var urlWithoutParams = currentUrl.split("?")[0];
              window.history.replaceState({}, document.title, urlWithoutParams);
              // Now you can use 'requestToken' in your JavaScript code as needed.
            } else {
              console.log("Hii king");
            }

            hasRunOnPageLoad = true; // Set the flag to true after running the code on page load
          }

          // This code will run on subsequent AJAX requests as well as on page load.
        },
        error: function (xhr, status, error) {
          console.error(xhr.responseText);
        },
      });
    }
    function deleteItem(itemId) {
      console.log(itemId);
      $.ajax({
        url: `/delete_zerodha_config/${itemId}/`, // URL of your Django delete view
        type: "POST",
        success: function (response) {
          console.log(response.message);
          // Refresh the data display after successful deletion
          get_api_data();
        },
        error: function (xhr, status, error) {
          console.error(xhr.responseText);
        },
      });
    }

    function editAccessToken(uniqueId, newAccessToken) {

      console.log(newAccessToken);

      $.ajax({
        url: "/edit_access_token",
        type: "POST",
        data: {
          unique_id: uniqueId,
          access_token: newAccessToken,
        },
        success: function (data) {
          console.log(data.message); // Print the response message
          get_api_data();
        },
        error: function (xhr, status, error) {
          console.error(xhr.responseText);
        },
      });
    }

    get_api_data();
    //END ACess_TOKEN

    //PLACE ZERODHA ORDER

    var intervalId = null; // Initialize the interval ID variable
    $(".execute_all_strategies").click(function () {
      $(".order_modal").empty();

      var trading_quote = [];
      var zerodha_trading_symbol = [];
      var zerodha_lotSize = []

      $(".inner_position").each(function (index) {
        // Get values from the current card
        var card = $(this);
        var symbol = card.find(".symbol").text();
        var expiry = card.find(".expiry").text();
        console.log(expiry);
        var strikePrice = card.find(".strikePrice").text();
        var callPutEntrance = card.find(".call_put_entrance").text();
        var entryPrice = card.find(".entryPrice").text();
        var exitPrice = card.find(".exit_price").text();
        var currentPrice = card.find(".current_price").text();
        var long_short_inner = card.find(".long_short_inner").text();


        var option_lot_size_input = card.find(".option_lot_size_input").text();
        var lot_size_value = $("#lot_size_value").text();

        console.log('option_lot_size_input', option_lot_size_input);
        console.log('lot_size_value', lot_size_value);

        var final_lot_size_along_with_qty = parseFloat(option_lot_size_input) * parseFloat(lot_size_value)

        console.log('final_lot_size_along_with_qty', final_lot_size_along_with_qty);


        if (symbol === "NIFTY") {
          zerodha_trading_symbol.push({
            tradingsymbol: "NSE:NIFTY 50",
          });
        } else if (symbol === "BANKNIFTY") {
          zerodha_trading_symbol.push({
            tradingsymbol: "NSE:NIFTY BANK",
          });
        } else if (symbol === "FINNIFTY") {
          zerodha_trading_symbol.push({
            tradingsymbol: "NSE:NIFTY FIN SERVICE",
          });
        } else {
          zerodha_trading_symbol.push({
            tradingsymbol: `NSE:${symbol}`,
          });
        }
        // Create the HTML content to append
        const dayPart = expiry.slice(0, 2);
        const monthPart = expiry.slice(2, 5).charAt(0); // Get the first letter of the month
        const yearPart = expiry.slice(7);
        const combinedString = `${symbol}${yearPart}${monthPart}${dayPart}${strikePrice}${callPutEntrance}`;
        console.log(combinedString);
        trading_quote.push({
          combinedString: combinedString,
        });



        var sell_buy_indicator = long_short_inner === "-" ? "SELL" : "BUY";

        zerodha_lotSize.push({
          combinedString,
          final_lot_size_along_with_qty,
          sell_buy_indicator,
          entryPrice
        })
        var buy_sale_bg = long_short_inner === "-" ? "sellTrade" : "buyTrade";
        var orderContent = `
             
            <div class="inner_order_modal">
                <div class="main_symbol_sell_buy">
                    <div class='sell_buy_indicator ${buy_sale_bg}'>${sell_buy_indicator}</div>
                <div class="tradingsymbol">${combinedString}</div>
                    
                    </div>
                  
<div class="gap-1 main_indepth">
                    <div class="indepth_details"></div>
                    <div class="indepth_details_offer"></div>
                    <div class="main_spot_order"> </div>
                </div>
               <hr>

               <div class="main_bottom_card_order">

            <div class="left_bottom_card_order">
    <div class="form-check">
        <input class="form-check-input" type="radio" name="orderTypeLimit${index}" id="limitOrder${index}" value="limit">
        <label class="form-check-label" for="limitOrder${index}">
            Limit
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="orderTypeLimit${index}" id="marketOrder${index}" checked value="market">
        <label class="form-check-label" for="marketOrder${index}">
            Market
        </label>
    </div>




                  
              <div class="main_price_qty">
                    <div class="form-group order_place_input">
                    <label for="expiryEdit">Price</label>
                    <input type="number" value=${entryPrice}  class="priceTrade form-control">
                </div>
                    <div class="form-group order_place_input">
                    <label for="expiryEdit">Quantity</label>
                    <input type="number" class="quantityTrade form-control" value=${parseInt(option_lot_size_input) * parseInt(lot_size_value)
          } >
                </div>

            </div>
            </div>
            <div class='right_bottom_card_order'>
            <button class="btn btn-outline-secondary">Cancel</button>
            <button class="btn btn-primary">Place order</button> 
                
                </div>
            </div>
           
            </div>
            </div>
              
   
            </div>
        `;

        // Append the content to the ".order_modal" element
        $(".order_modal").append(orderContent);
      });

      console.log(trading_quote);
      console.log(zerodha_trading_symbol);
      console.log(zerodha_lotSize);

      send_quote_data(trading_quote, zerodha_trading_symbol[0], zerodha_lotSize);
      // if (intervalId === null) { // Start the interval only if it's not already running
      //     console.log('Show');

      //     // Run the function every 1000 milliseconds (1 second)
      //     intervalId = setInterval(function () {
      //         send_quote_data(trading_quote,zerodha_trading_symbol[0],zerodha_lotSize);
      //     }, 1000);
      // }
    });

    $("#execute").on("hidden.bs.modal", function () {
      if (intervalId !== null) {
        // Clear the interval only if it's running
        clearInterval(intervalId);
        intervalId = null; // Reset the interval ID variable
      }
    });

    function send_quote_data(trading_quote, zerodha_trading_symbol, zerodha_lotSize) {

      console.log('trading_quote' + JSON.stringify(trading_quote));
      console.log('zerodha_trading_symbol' + JSON.stringify(zerodha_trading_symbol));
      console.log('zerodha_lotSize' + JSON.stringify(zerodha_lotSize));

      // Save trading_quote data to local storage
      localStorage.setItem("trading_quote", JSON.stringify(trading_quote));

      $.ajax({
        type: "POST",
        url: "/quote_data_zerodha", // Replace with your Django endpoint
        data: JSON.stringify({
          trading_quote: trading_quote,
          zerodha_trading_symbol: zerodha_trading_symbol,
          zerodha_lotSize, zerodha_lotSize
        }),
        contentType: "application/json",
        success: function (response) {
          console.log(response);

          if (
            response &&
            response.length > 0 &&
            response[response.length - 1].hasOwnProperty("combined_data")
          ) {
            var combinedData = response[response.length - 1]["combined_data"];

            // Now you can access the properties of 'combined_data'
            var symbolSpot = combinedData["symbol_spot"];
            // Remove 'NSE:' if it exists at the beginning of the string
            if (symbolSpot.startsWith("NSE:")) {
              symbolSpot = symbolSpot.substring(4);
            }
            var niftyLtp = combinedData["nifty_ltp"];
            var percentageChange = combinedData["percentage_change"];
            var profile = combinedData["profile"];
            var available_cash = combinedData["available_cash"];
            var userId = combinedData["user_id"];
            var total_sum = combinedData["total_sum"];
            var formattedPercentageChange;
            var precent_color = "";
            if (percentageChange > 0) {
              formattedPercentageChange = "+" + percentageChange.toFixed(2);
              precent_color = "text-success";
            } else if (percentageChange < 0) {
              formattedPercentageChange =
                "-" + Math.abs(percentageChange).toFixed(2);
              precent_color = "text-danger";
            } else {
              formattedPercentageChange = percentageChange.toFixed(2);
            }
            $(".names_user_details h5").text(profile);
            $(".names_user_details p").text(`Client ID:${userId}`);

            $(".margin_needed").val(total_sum.toFixed(2));
            $(".symbol_name_order p").text(symbolSpot);
            $(".strike_price_order p").text(niftyLtp);
            $(".change_per_order p")
              .text(formattedPercentageChange)
              .addClass(precent_color);
            $(".margin_available").val(available_cash);
            // Use these values as needed in your JavaScript code
            console.log("Symbol Spot:", symbolSpot);
            console.log("Nifty LTP:", niftyLtp);
            console.log("Percentage Change:", percentageChange);
            console.log("Profile:", profile);
            console.log("User ID:", userId);
          }

          // Assuming response is an array of objects
          for (let i = 0; i < response.length; i++) {
            const trading_symbol = Object.keys(response[i])[0];
            const trading_data = response[i][trading_symbol];
            console.log(trading_symbol);
            console.log(trading_data);
            // Generate the table HTML

            $(".indepth_details").eq(i).empty();
            $(".indepth_details_offer").eq(i).empty();
            $(".main_spot_order").eq(i).empty();

            // Generate the table HTML
            const table = generateBidTable(trading_data.depth.buy);
            const tableOffer = generateOfferTable(trading_data.depth.sell);

            const spot_data_order = generateSpotData(trading_data);
            // const Offer_table = generateOfferTable(trading_data.depth.buy);

            // Append the table to the element with the class 'indepth_details' at the corresponding index
            $(".indepth_details").eq(i).append(table);
            $(".indepth_details_offer").eq(i).append(tableOffer);
            $(".main_spot_order").eq(i).append(spot_data_order);

            // Append the table to the element with the class 'indepth_details' at the corresponding index
          }
        },
        error: function (error) {
          console.error(error);
        },
      });
    }

    $(".main_updates_price_btn button").click(function () {
      // Select the second <p> tag inside .main_last_price_order

      var priceElements = $(".last_price_order_zerodha");

      // Select all .priceTrade inputs
      var priceTradeInputs = $(".priceTrade");

      // Loop through the .last_price_order_zerodha elements
      priceElements.each(function (index) {
        // Get the text of the current .last_price_order_zerodha element
        var priceText = $(this).text();

        // Set the value of the corresponding .priceTrade input
        priceTradeInputs.eq(index).val(priceText);
      });
    });

    $("#limit_select").change(function () {
      var selectedOption = $(this).val(); // Get the selected option value
      console.log(selectedOption);
      // Loop through each .inner_position element
      $(".left_bottom_card_order").each(function (index) {
        var card = $(this);

        // Find the radio buttons inside this .inner_position
        var limitRadio = card.find(`#limitOrder${index}`);
        var marketRadio = card.find(`#marketOrder${index}`);
        console.log(limitRadio);
        console.log(marketRadio);

        // Depending on the selected option, check/uncheck the radio buttons
        if (selectedOption === "limit") {
          limitRadio.prop("checked", true);
          marketRadio.prop("checked", false);
        } else if (selectedOption === "market") {
          limitRadio.prop("checked", false);
          marketRadio.prop("checked", true);
        }
      });
    });

    // Function to generate the BIDS table HTML
    function generateBidTable(bids) {
      let table = '<table class="table">';
      table +=
        "<thead><tr><th>BIDS</th><th>ORDERS</th><th>QTY</th></tr></thead>";
      table += "<tbody>";

      // Loop through the response array for BIDS
      bids.forEach(function (bid) {
        table += `<tr><td>${bid.price}</td><td class="text-primary">${bid.orders}</td><td class="text-primary">${bid.quantity}</td></tr>`;
      });

      // Calculate and add the total bid quantity row
      const totalBidQuantity = bids.reduce(
        (total, bid) => total + bid.quantity,
        0
      );
      table += `<tr class="text-primary"><td colspan="2">TOTAL</td><td>${totalBidQuantity}</td></tr>`;

      // Close the table body and table
      table += "</tbody></table>";

      return table;
    }
    function generateOfferTable(offers) {
      let table = '<table class="table">';
      table +=
        "<thead><tr><th>OFFERS</th><th>ORDERS</th><th>QTY</th></tr></thead>";
      table += "<tbody>";

      // Loop through the response array for offers
      offers.forEach(function (Offer) {
        table += `<tr><td>${Offer.price}</td><td class="text-danger">${Offer.orders}</td><td class="text-danger">${Offer.quantity}</td></tr>`;
      });

      // Calculate and add the total Offer quantity row
      const totalOfferQuantity = offers.reduce(
        (total, Offer) => total + Offer.quantity,
        0
      );
      table += `<tr class="text-danger"><td colspan="2">TOTAL</td><td>${totalOfferQuantity}</td></tr>`;

      // Close the table body and table
      table += "</tbody></table>";

      return table;
    }

    function generateSpotData(trading_data) {
      // Extract the data for the first instrument
      const firstInstrument = trading_data;
      const {
        last_price,
        ohlc: { open, high, low, close },
        volume,
        last_quantity,
        average_price,
        timestamp,
        oi,
      } = firstInstrument;

      // Convert the timestamp to a more readable format
      const ltt = new Date(timestamp).toLocaleString();

      // Create the HTML structure with the extracted data
      let main_spot_data = '<div class="inner_main_spot_order">';
      main_spot_data += `
   <div class="spot_main_table">
    <div class='left_spot'>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding: 8px 0;">
            <p>Last Price:</p>
            <p class="last_price_order_zerodha">${last_price}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>Open:</p>
            <p>${open}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>High:</p>
            <p>${high}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>Low:</p>
            <p>${low}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>Close:</p>
            <p>${close}</p>
        </div>
    </div>
    <div class='right_spot'>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding: 8px 0;">
            <p>Volume:</p>
            <p>${volume}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>LTQ:</p>
            <p>${last_quantity}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>Avg. Price:</p>
            <p>${average_price}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>LTT:</p>
            <p>${ltt}</p>
        </div>
        <div class="main_last_price_order d-flex justify-content-between" style="border-bottom: 1px solid #ccc; padding-bottom: 8px;">
            <p>OI:</p>
            <p>${oi}</p>
        </div>
    </div>
</div>


   `;
      main_spot_data += "</div>";

      return main_spot_data;
    }

    var OrderId = 1;
    $(".place_order_btn").click(function () {
      var All_positionTrade = [];
      var inner_order_modal = $(".inner_order_modal");
      inner_order_modal.each(function (index_order) {
        var order_level = $(this);
        var sell_buy_indicator = order_level.find(".sell_buy_indicator").text();
        var tradingsymbol = order_level.find(".tradingsymbol").text();
        var priceTrade = order_level.find(".priceTrade").val();
        var quantityTrade = order_level.find(".quantityTrade").val();

        // Check if the radio button is checked
        var isRadioChecked = $(
          `input[name='orderTypeLimit${index_order}']:checked`
        ).val();

        console.log(isRadioChecked);

        All_positionTrade.push({
          orderNumber: OrderId++,
          sell_buy_indicator: sell_buy_indicator,
          tradingsymbol: tradingsymbol,
          Quantity: quantityTrade,
          price: priceTrade,
          isRadioChecked: isRadioChecked, // Add this property to the object
        });
      });

      sendPosition_to_kite(All_positionTrade);
    });

    function sendPosition_to_kite(All_positionTrade) {
      console.log(All_positionTrade);

      // Send the data to the Django view using AJAX
      $.ajax({
        url: "/kiteOrder", // Replace with the actual URL of your Django view
        type: "POST",
        data: JSON.stringify(All_positionTrade),
        contentType: "application/json",
        success: function (response) {
          // Handle the response from the Django view if needed
          console.log(response);

          // Check if there's a success message in the response
          if (response.message) {
            displayAlert(response.message, "success");
          } else if (response.error) {
            // Check if there's an error message in the response
            displayAlert(response.error, "error");
          }

          All_positionTrade = [];
        },
        error: function (error) {
          console.error(error);

          // Display a generic error alert
          displayAlert(
            "An error occurred while processing your request.",
            "error"
          );
        },
      });
    }

    function displayAlert(message, type) {
      var alertElement = $(".alert-dismissible");
      alertElement
        .removeClass(type === "error" ? "success_alert" : "error_alert")
        .addClass(type === "error" ? "error_alert" : "success_alert")
        .text(message)
        .css({
          "max-width": "50%", // Set the maximum width
          width: "100%", // Set the width to 100%
          height: "fit-content", // Set the height to auto
          padding: "15px",
          position: "fixed",

          "z-index": "99999999999 !important",
          "border-radius": "5px",
        })
        .fadeIn();

      setTimeout(function () {
        alertElement.fadeOut();
      }, 3000);
    }

    var stockDropdown_edit = $("#stockDropdown").val();
    $("#selectExpiry").change(function () {
      // console.log($(this).val());
      get_edit_entry_price(stockDropdown_edit, $(this).val());
    });
    $("#selectStrikePrice").change(function () {
      get_edit_entry_price(stockDropdown_edit, $("#selectExpiry").val());
    });
    $("#optionType").change(function () {
      get_edit_entry_price(stockDropdown_edit, $("#selectExpiry").val());
    });

    function get_edit_entry_price(selectedOption, selectedExpiry) {
      $("#spinner").show();
      $.ajax({
        url:
          '{% url "get_option_strategy_optimizer_option_data" %}?selected_option=' +
          selectedOption +
          "&selected_expiry=" +
          selectedExpiry,
        type: "GET",
        success: function (response) {
          // console.log(response.option_data.resultData.opDatas);

          var option_Date = response.option_data.resultData.opDatas;
          Entry_edit(option_Date);

          $("#spinner").hide();
        },
      });
    }

    function Entry_edit(option_Date) {
      var selectStrikePrice = $("#selectStrikePrice").val();
      var optionType = $("#optionType").val();

      for (var i = 0; i < option_Date.length; i++) {
        var strikePrice = option_Date[i].strike_price; // Assuming strike_price is a property of each object in option_Date

        // Compare the current option's strike_price with selectStrikePrice
        if (strikePrice == selectStrikePrice) {
          // Do something when a matching strike_price is found
          if (optionType === "CE") {
            $(".edit_entry ").val(option_Date[i].calls_ltp);
            // console.log("Matching strike_price:", option_Date[i].calls_ltp);
          } else {
            // console.log("Matching strike_price:", option_Date[i].puts_ltp);
            $(".edit_entry ").val(option_Date[i].puts_ltp);
          }
        }
      }
    }

    $("#future_data").on("click", function () {
      // Set the value in local storage
      var selectedOption = $("#stockDropdown").val();
      localStorage.setItem("future_symbol", selectedOption);

      // Open a new tab and navigate to "stock_future"
      window.open("stock_future", "_blank");
    });
    $(".option_chain_strategies").on("click", function () {
      // Set the value in local storage
      var selectedOption = $("#stockDropdown").val();
      localStorage.setItem("symbol_Option_chain", selectedOption);

      // Open a new tab and navigate to "stock_future"
      window.open("stock_option_chain", "_blank");
    });

    $("#option_strategy_reset").click(function () {
      $(".straddle ").removeClass("option_strategies_active");
      $(
        ".data-display-table"
      ).empty().append(`     <tr class="strategy_table_input">
                <td>
                    <div class="textOnInput">
                        <label for="optionSide">Instruments</label>
                        <select class="option_side_input form-select">
                         
                            <option value="">Long</option>
                            <option value="">Put</option>

                        </select>
                    </div>
                </td>
                <td>
                    <div class="textOnInput">
                        <label for="expiryDate">Expiry Date</label>
                        <select class="expiry_date_input form-select">
                         
                        </select>
                    </div>
                </td>
                <td>
                    <div class="textOnInput">
                        <label for="strikePrice">Strike Price</label>
                        <select class="strike_price_input form-select">
                         
                        </select>
                    </div>
                </td>
                <td>
                    <div class="textOnInput">
                        <label for="action">Position</label>
                        <select class="action_input form-select">
                         
                            <option value="Short">Short</option>
                            <option value="Long">Long</option>
                        </select>
                    </div>
                </td>
                <td>
                    <div class="textOnInput">
                        <label for="action">No. of Lots</label>
                        <input type="number" class="option_lot_size_input form-control" value="1" />
                    </div>
                </td>
                <td>
                    <div class="textOnInput">
                        <label for="action">Traded Price</label>
                        <input type="number" class="ltpValue_input form-control" value="0" />
                    </div>
                </td>
                <td>
                    <i class="delete-btn bi bi-trash-fill"></i>
                </td>
            </tr>`);

      var selectedOption = $("#stockDropdown").val();

      $("#table-PL").empty();
      $(".main_position").empty();
      $("#resultTable tbody").empty();

      loadOptionData(selectedOption, "");
      loadExpiryData(selectedOption);
      checkMainPositionContent();
    });

    function hideIronFlyModal() {
      $("#ironFly_modal").hide();
    }

    // Function to hide the Straddle modal
    function hideStraddleModal() {
      $("#straddle_modal").hide();
    }

    // Function to hide the Strangle modal
    function hideStrangleModal() {
      $("#strangle_modal").hide();
    }

    // Function to hide the Spread modal
    function hideSpreadModal() {
      $("#spread_modal").hide();
    }
    function hideironCondorModal() {
      $("#ironCondor_modal").hide();
    }
    function hidejaze_lizardModal() {
      $("#jaze_lizard_modal").hide();
    }
    function hide_double_iron_fly_Modal() {
      $("#double_iron_fly_modal").hide();
    }
    function hide_double_iron_condor_Modal() {
      $("#double_iron_condor_modal").hide();
    }
    function hide_iron_butterfly() {
      $("#put_butterfly_modal").hide();
    }
    function hide_call_butterfly() {
      $("#call_butter_fly_modal").hide();
    }

    // Click event on the document body
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#call_butter_fly_modal").length &&
        !$(e.target).is("#call_butter_fly")
      ) {
        hide_call_butterfly();
      }
    });

    // Click event on the document body
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#put_butterfly_modal").length &&
        !$(e.target).is("#put_butter_fly")
      ) {
        hide_iron_butterfly();
      }
    });



    // Click event on the document body
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#double_iron_condor_modal").length &&
        !$(e.target).is("#double_iron_condor")
      ) {
        hide_double_iron_condor_Modal();
      }
    });



    // Click event on the document body
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#double_iron_fly_modal").length &&
        !$(e.target).is("#double_iron_fly")
      ) {
        hide_double_iron_fly_Modal();
      }
    });




    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#jaze_lizard_modal").length &&
        !$(e.target).is("#jaze_lizard")
      ) {
        hidejaze_lizardModal();
      }
    });



    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#ironCondor_modal").length &&
        !$(e.target).is("#iron_condor")
      ) {
        hideironCondorModal();
      }
    });
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#ironFly_modal").length &&
        !$(e.target).is("#iron_fly")
      ) {
        hideIronFlyModal();
      }
    });
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#straddle_modal").length &&
        !$(e.target).is("#straddle")
      ) {
        hideStraddleModal();
      }
    });
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#strangle_modal").length &&
        !$(e.target).is("#strangle")
      ) {
        hideStrangleModal();
      }
    });
    $(document).on("click", function (e) {
      // Check which modal to hide based on the click target
      if (
        !$(e.target).closest("#spread_modal").length &&
        !$(e.target).is("#spread")
      ) {
        hideSpreadModal();
      }
    });



    var expiryDateStraddle = $("#expiryDate_straddle");
    var optionExpiryDropdown = $("#optionExpiryDropdown");

    expiryDateStraddle.on("change", function () {
      var selectedValue_straddle = $(this).val();
      // console.log(selectedValue_straddle);

      // Set the value of optionExpiryDropdown to match the selected value
      optionExpiryDropdown.val(selectedValue_straddle).change();

      // Trigger a click event on the selected option
    });

    $("#straddle").click(function () {
      $("#straddle_modal").show();
      $("#strangle_modal").hide();
      $("#spread_modal").hide();
      $("#ironFly_modal").hide();
      $("#ironCondor_modal").hide();

      var closest_strike_price = $("#closest_strike_price");
      var strikeSelect_straddle = $("#strikeSelect_straddle");

      strikeSelect_straddle.find("option").each(function () {
        // Get the value of the current option
        var optionValue = $(this).val();

        // Check if the option value matches the value of closest_strike_price
        if (optionValue === closest_strike_price.text()) {
          // Add the 'selected' attribute to the matching option
          $(this).prop("selected", true);
        }
      });

      var closen_expiry_date = $("#closen_expiry_date");
      var expiryDate_straddle = $("#expiryDate_straddle");
      expiryDate_straddle.find("option").each(function () {
        var expiryvalue = $(this).val();

        if (expiryvalue === closen_expiry_date.text()) {
          $(this).prop("selected", true);
        }
      });

      var latestStrikePrice = $("#strikeSelect_straddle").val(); // Parse as a float


      // console.log(latestStrikePrice);
    });

    $(".dismiss_icon").click(function () {
      $("#straddle_modal").hide();
      $("#strangle_modal").hide();
      $("#spread_modal").hide();
      $("#ironFly_modal").hide();
      $("#ironCondor_modal").hide();
      $("#jaze_lizard_modal").hide();
      $("#double_iron_fly_modal").hide();
      $("#double_iron_condor_modal").hide();
      $("#put_butterfly_modal").hide();
      $("#call_butter_fly_modal").hide();
    });
    $(".long_straddle").addClass("straddle_active");
    $(".long_straddle").click(function () {
      $(this).addClass("straddle_active");
      $(".short_straddle").removeClass("straddle_active");
    });
    $(".short_straddle").click(function () {
      $(this).addClass("straddle_active");
      $(".long_straddle").removeClass("straddle_active");
    });

    // Set the initial value

    var counterValue = 1;

    // Function to update the input field with the current value
    function updateCounterInput() {
      $("#counter_input").val(counterValue);
    }

    // Initialize the input field
    updateCounterInput();

    // Increment button click handler
    $("#increment").click(function () {
      counterValue++;
      updateCounterInput();
    });

    // Decrement button click handler
    $("#decrement").click(function () {
      if (counterValue > 1) {
        counterValue--;
        updateCounterInput();
      }
    });

    // -----Strangle Counter----

    var counterValue_strangle = 1;

    // Function to update the input field with the current value
    function updateCounterInput_strangle() {
      $("#counter_input_strangle").val(counterValue_strangle);
      $("#put_stangle_lot_size").text(counterValue_strangle);
      $("#call_stangle_lot_size").text(counterValue_strangle);
    }

    // Initialize the input field
    updateCounterInput_strangle();

    // Increment button click handler
    $("#increment_strangle").click(function () {
      counterValue_strangle++;
      updateCounterInput_strangle();
    });

    // Decrement button click handler
    $("#decrement_strangle").click(function () {
      if (counterValue_strangle > 1) {
        counterValue_strangle--;
        updateCounterInput_strangle();
      }
    });

    // -----End Strangle Counter----

    //----------Spread Counter-------------

    var counterValue_spread = 1;

    // Function to update the input field with the current value
    function updateCounterInput_spread() {
      $("#counter_input_spread").val(counterValue_spread);
      $("#put_spread_lot_size").text(counterValue_spread);
      $("#call_spread_lot_size").text(counterValue_spread);
    }

    // Initialize the input field
    updateCounterInput_spread();

    // Increment button click handler
    $("#increment_spread").click(function () {
      counterValue_spread++;
      updateCounterInput_spread();
    });

    // Decrement button click handler
    $("#decrement_spread").click(function () {
      if (counterValue_spread > 1) {
        counterValue_spread--;
        updateCounterInput_spread();
      }
    });

    //----------End Spread Counter-------------

    //---------Iron Fly------------------------

    var counterValue_iron_fly = 1;

    // Function to update the input field with the current value
    function updateCounterInput_iron_fly() {
      $("#counter_input_ironFly").val(counterValue_iron_fly);
      $("#put_ironFly_lot_size").text(counterValue_iron_fly);
      $("#put_call_ironFly_lot_size").text(counterValue_iron_fly);
      $("#call_ironFly_lot_size").text(counterValue_iron_fly);
    }

    // Initialize the input field
    updateCounterInput_iron_fly();

    // Increment button click handler
    $("#increment_ironFly").click(function () {
      counterValue_iron_fly++;
      updateCounterInput_iron_fly();
    });

    // Decrement button click handler
    $("#decrement_ironFly").click(function () {
      if (counterValue_iron_fly > 1) {
        counterValue_iron_fly--;
        updateCounterInput_iron_fly();
      }
    });

    //---------End Iron Fly------------------------

    //----------Iron Condor----------------

    var counterValue_ironCondor = 1;

    // Function to update the input field with the current value
    function updateCounterInput_ironCondor() {
      $("#counter_input_ironCondor").val(counterValue_ironCondor);
      $("#put_ironCondor_lot_size").text(counterValue_ironCondor);
      $("#put_2nd_ironCondor_lot_size").text(counterValue_ironCondor);
      $("#call_ironCondor_lot_size").text(counterValue_ironCondor);
      $("#call_2nd_ironCondor_lot_size").text(counterValue_ironCondor);
    }

    // Initialize the input field
    updateCounterInput_ironCondor();

    // Increment button click handler
    $("#increment_ironCondor").click(function () {
      counterValue_ironCondor++;
      updateCounterInput_ironCondor();
    });

    // Decrement button click handler
    $("#decrement_ironCondor").click(function () {
      if (counterValue_ironCondor > 1) {
        counterValue_ironCondor--;
        updateCounterInput_ironCondor();
      }
    });
    //----------End Iron Condor----------------



    //---------Jaz Lizard---------------

    var counterValue_jaze_lizard = 1;

    // Function to update the input field with the current value
    function updateCounterInput_jaze_lizard() {
      $("#counter_input_jaze_lizard").val(counterValue_jaze_lizard);
      $("#put_jaze_lizard_lot_size").text(counterValue_jaze_lizard);
      $("#call_2nd_jaze_lizard_lot_size").text(counterValue_jaze_lizard);
      $("#call_jaze_lizard_lot_size").text(counterValue_jaze_lizard);
    }

    // Initialize the input field
    updateCounterInput_jaze_lizard();

    // Increment button click handler
    $("#increment_jaze_lizard").click(function () {
      counterValue_jaze_lizard++;
      updateCounterInput_jaze_lizard();
    });

    // Decrement button click handler
    $("#decrement_jaze_lizard").click(function () {
      if (counterValue_jaze_lizard > 1) {
        counterValue_jaze_lizard--;
        updateCounterInput_jaze_lizard();
      }
    });
    //----------End Jaze Lizard----------------






    //---------Double IronFly--------------

    var counterValue_double_iron_fly = 1;

    // Function to update the input field with the current value


    function updateCounterInput_double_iron_fly() {
      $("#counter_input_double_iron_fly").val(counterValue_double_iron_fly);
      $("#put_strike_eight_hundred_iron_fly_lot_size").text(counterValue_double_iron_fly);
      $("#call_2nd_double_iron_fly_lot_size").text(counterValue_double_iron_fly);
      $("#call_spot_double_iron_fly_lot_size").text(counterValue_double_iron_fly);

      $("#put_positive_four_hundred_double_iron_fly_lot_size").text(counterValue_double_iron_fly);
      $("#call_put_positive_eight_hundred_double_iron_fly_lot_size").text(counterValue_double_iron_fly);
      $("#call_twelve_hundred_positive_double_iron_fly_lot_size").text(counterValue_double_iron_fly);
    }

    // Initialize the input field
    updateCounterInput_double_iron_fly();

    // Increment button click handler
    $("#increment_double_iron_fly").click(function () {
      counterValue_double_iron_fly++;
      updateCounterInput_double_iron_fly();
    });

    // Decrement button click handler
    $("#decrement_double_iron_fly").click(function () {
      if (counterValue_double_iron_fly > 1) {
        counterValue_double_iron_fly--;
        updateCounterInput_double_iron_fly();
      }
    });
    //----------End Double IronFly----------------








    //---------Double IronCondor-------------

    var counterValue_double_iron_condor = 1;

    // Function to update the input field with the current value


    function updateCounterInput_double_iron_condor() {
      $("#counter_input_double_iron_condor").val(counterValue_double_iron_condor);

      $("#put_spot_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#put_negative_fifty_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#put_negative_two_hundred_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#negative_three_hundred_fifty_double_iron_condor_lot_size").text(counterValue_double_iron_condor);

      $("#call_positive_three_hundred_fifty_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#call_positive_five_hundred_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#call_positive_six_hundred_fifty_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
      $("#call_positive_eight_hundred_double_iron_condor_lot_size").text(counterValue_double_iron_condor);
    }

    // Initialize the input field
    updateCounterInput_double_iron_condor();

    // Increment button click handler
    $("#increment_double_iron_condor").click(function () {
      counterValue_double_iron_condor++;
      updateCounterInput_double_iron_condor();
    });

    // Decrement button click handler
    $("#decrement_double_iron_condor").click(function () {
      if (counterValue_double_iron_condor > 1) {
        counterValue_double_iron_condor--;
        updateCounterInput_double_iron_condor();
      }
    });
    //----------End Double IronCondor---------------




    //---------Put butterfly-------------

    var counterValue_put_buttterfly = 1;

    // Function to update the input field with the current value


    function updateCounterInput_put_buttterfly() {
      $("#counter_input_put_butterfly").val(counterValue_put_buttterfly);

      $("#put_negative_nine_hundred_fifty_butterfly_lot_size").text(counterValue_put_buttterfly);
      $("#five_hundred_put_call_butterfly_lot_size").text(counterValue_put_buttterfly);
      $("#put_negative_fifty_put_butterfly_lot_size").text(counterValue_put_buttterfly);



    }

    // Initialize the input field
    updateCounterInput_put_buttterfly();

    // Increment button click handler
    $("#increment_put_butterfly").click(function () {
      counterValue_put_buttterfly++;
      updateCounterInput_put_buttterfly();
    });

    // Decrement button click handler
    $("#decrement_put_butterfly").click(function () {
      if (counterValue_put_buttterfly > 1) {
        counterValue_put_buttterfly--;
        updateCounterInput_put_buttterfly();
      }
    });
    //----------End Put butterfly---------------



    //---------Put butterfly-------------

    var counterValue_call_butterfly = 1;

    // Function to update the input field with the current value


    function updateCounterInput_call_butterfly() {
      $("#counter_input_call_butter_fly").val(counterValue_call_butterfly);

      $("#put_positive_fifty_butterfly_lot_size").text(counterValue_call_butterfly);
      $("#four_hundred_put_call_butterfly_lot_size").text(counterValue_call_butterfly);
      $("#positive_seven_hundred_fifty_call_butter_fly_lot_size").text(counterValue_call_butterfly);



    }

    // Initialize the input field
    updateCounterInput_call_butterfly();

    // Increment button click handler
    $("#increment_call_butter_fly").click(function () {
      counterValue_call_butterfly++;
      updateCounterInput_call_butterfly();
    });

    // Decrement button click handler
    $("#decrement_call_butter_fly").click(function () {
      if (counterValue_call_butterfly > 1) {
        counterValue_call_butterfly--;
        updateCounterInput_call_butterfly();
      }
    });
    //----------End Put butterfly---------------





















    $("#table-PL_main").hide();
    $("#resultTable").hide();
    $("#oi-charts").hide();
    $("#real_adjustment_table").hide();
    $(".targets_table").hide();
    $(".stoploss_table").hide();
    $(".alerts_table").hide();
    $(".history_table").hide();
    $("#payoff_table").hide();

    $("#payoff_charts").show();

    $(".strategy_cost_table").click(function () {
      $("#table-PL_main").show();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".greek_table,.oi_chart,.payoff_charts,.adjustment,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });

    $(".payoff_table").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").show();
      $(this).addClass("greek_strategy_active");
      $(".greek_table,.oi_chart,.payoff_charts,.adjustment,.targets,.stoploss,.alerts,.history,.strategy_cost_table").removeClass("greek_strategy_active");
    });







    $(".greek_table").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").show();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".strategy_cost_table, .oi_chart,.payoff_charts,.adjustment,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });


    $(".oi_chart").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").show();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".strategy_cost_table, .greek_table,.payoff_charts,.adjustment,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });
    $(".adjustment").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#oi-charts").hide();
      $("#real_adjustment_table").show();
      $("#payoff_charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".strategy_cost_table, .greek_table,.payoff_charts, .oi_chart,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });


    $(".payoff_charts").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#oi-charts").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").show();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".strategy_cost_table, .greek_table, .oi_chart, .adjustment,.targets,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });


    $(".targets").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").show();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".greek_table, .oi_chart, .payoff_charts, .adjustment,.stoploss,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });

    $(".stoploss").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").show();
      $(".alerts_table").hide();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".greek_table, .oi_chart, .payoff_charts, .adjustment,.targets,.alerts,.history,.payoff_table").removeClass("greek_strategy_active");
    });

    $(".alerts").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").show();
      $(".history_table").hide();
      $("#payoff_table").hide();
      $(this).addClass("greek_strategy_active");
      $(".greek_table, .oi_chart, .payoff_charts, .adjustment,.targets,.stoploss,.history,.payoff_table").removeClass("greek_strategy_active");
    });

    $(".history").click(function () {
      $("#table-PL_main").hide();
      $("#resultTable").hide();
      $("#real_adjustment_table").hide();
      $("#payoff_charts").hide();
      $("#oi-charts").hide();
      $(".targets_table").hide();
      $(".stoploss_table").hide();
      $(".alerts_table").hide();
      $("#payoff_table").hide();
      $(".history_table").show();
      $(this).addClass("greek_strategy_active");
      $(".greek_table, .oi_chart, .payoff_charts, .adjustment,.targets,.stoploss,.alerts,.payoff_table").removeClass("greek_strategy_active");
    });













    // After adding data row
    // Function to update empty message visibility based on data rows
    function updateEmptyMessageVisibility() {
      var numRows = $(".data-display-table tr.data-row").length;
      if (numRows === 0) {
        $(".empty_message").show();
      } else {
        $(".empty_message").hide();
      }
    }

    // After removing a data row, update the empty message visibility
    updateEmptyMessageVisibility();

    $("#saveChangesButton").click(function () {
      // Find the parent element containing the .edit_entry input
      var closest_edit_data = $(this).closest(".modal-content");

      // Navigate to .edit_entry input within the parent element
      var selectExpiry = closest_edit_data.find("#selectExpiry").val();
      var selectStrikePrice = closest_edit_data
        .find("#selectStrikePrice")
        .val();
      var optionType = closest_edit_data.find("#optionType").val();

      // Navigate to the checked radio button within the parent element
      var checkedRadio = closest_edit_data.find(
        ".Long_short input[type='radio']:checked"
      );

      // Get the value of the checked radio button
      var selectedLongShort = checkedRadio.val();

      // Get the value of the counter_input_edit
      var counter_input_edit = closest_edit_data
        .find("#counter_input_edit")
        .val();

      // Get the value of the .edit_entry input
      var editEntryValue = closest_edit_data.find(".edit_entry").val();

      // Get the value of the .exit_price input
      var exit_price = closest_edit_data.find(".exit_price").val();

      // Log all the values
      console.log("selectExpiry:", selectExpiry);
      console.log("selectStrikePrice:", selectStrikePrice);
      console.log("optionType:", optionType);
      console.log("selectedLongShort:", selectedLongShort);
      console.log("counter_input_edit:", counter_input_edit);
      console.log("editEntryValue:", editEntryValue);
      console.log("exit_price:", exit_price);
      var modal = $("#editPositionModal");
      var position = modal.data("position");

      var parsedDate = new Date(selectExpiry);
      var day = parsedDate.getDate().toString().padStart(2, "0");
      var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
      var year = parsedDate.getFullYear();
      var formattedDate_initial = day + "-" + month + "-" + year;

      function formatDate(inputDate) {
        const dateParts = inputDate.split("-"); // Split the input date by hyphen
        const day = dateParts[0]; // Extract day
        const month = dateParts[1]; // Extract month
        const year = dateParts[2]; // Extract year

        // Create an array of month abbreviations
        const monthAbbreviations = [
          "JAN",
          "FEB",
          "MAR",
          "APR",
          "MAY",
          "JUN",
          "JUL",
          "AUG",
          "SEP",
          "OCT",
          "NOV",
          "DEC",
        ];

        // Get the abbreviated month using the month value as an index
        const abbreviatedMonth = monthAbbreviations[parseInt(month) - 1];

        // Create the formatted date string
        const formattedDate = `${day}${abbreviatedMonth}${year}`;

        return formattedDate;
      }

      const inputDate = formattedDate_initial;
      const formattedDate = formatDate(inputDate);

      position.find(".expiry_initial").text(selectExpiry);
      position.find(".expiry").text(formattedDate);
      position.find(".option_lot_size_input").text(counter_input_edit);

      var long_short_val = "";
      if (selectedLongShort === "Short") {
        long_short_val = "-";
      } else {
        long_short_val = "+";
      }
      position.find(".long_short_inner").text(long_short_val);
      position.find(".strikePrice").text(selectStrikePrice);

      position.find(".call_put_entrance").text(optionType);
      position.find(".entryPrice").text(editEntryValue);
      if (exit_price > 0) {
        position
          .find(".exit_indicator")
          .removeClass("green-option-indicator")
          .addClass("red-option-indicator");
      } else {
        position
          .find(".exit_indicator")
          .removeClass("red-option-indicator")
          .addClass("green-option-indicator");
      }
      position.find(".current_price").text(exit_price);

      calculate_data();
    });
    // Load spot data for "NIFTY" initially

    var greeks = 1;
    var p_l = 1;

    function calculate_data() {
      var selectedOption = $("#stockDropdown").val();
      $("#spinner").show();
      // console.log("ca=" + selectedOption);
      loadExpiryData(selectedOption);

      var All_positions = $(".main_position").find(
        ".main_add_position_actions"
      );
      var allData = [];
      var conditionOrder = 1;
      All_positions.each(function () {
        var row = $(this);
        var optionSide = row.find(".call_put_entrance").text();

        var expiryDate = row.find(".expiry_initial").text();

        var strikePrice = row.find(".strikePrice").text();

        var long_short_inner = row.find(".long_short_inner").text();

        var action = "";

        if (long_short_inner === "-") {
          action = "Short";
        } else {
          action = "Long";
        }

        var optionSide_main = "";
        if (optionSide == "CE") {
          optionSide_main = "Call";
        } else {
          optionSide_main = "Put";
        }

        var quantity = row.find(".option_lot_size_input").text();
        var ltpValue = row.find(".entryPrice").text();

        var option_lot_size = $("#lot_size_value").text();
        var main_conditionOrder = conditionOrder++;

        var childrenLength = $(".main_position").children().length;
        // console.log('childrenLength', childrenLength);

        if (parseInt(childrenLength) < 1) {
          // console.log("hii there zero");
          $("#spinner").hide();
          return false;
        } else {
          allData.push({
            selectedOption: selectedOption,
            optionSide: optionSide_main,
            option_lot_size: option_lot_size,
            expiryDate: expiryDate,
            strikePrice: strikePrice,
            action: action,
            quantity: parseInt(quantity),
            conditionOrder: main_conditionOrder,
            ltpValue: ltpValue,
          });
        }
      });

      get_position_data_from_django(allData);
      // console.log("AllData", allData);
      $("#spinner").show();
    }

    function get_position_data_from_django(allData) {
      $("#spinner").show();
      $.ajax({
        type: "POST",
        url: "/filter_iv_data",
        data: JSON.stringify(allData),
        contentType: "application/json",
        success: function (response) {
          // console.log("Data sent to Django:", response);
          // console.log(response.stock_data.resultData);

          // Clear previous table data
          $("#table-PL").empty();

          $("#resultTable tbody").empty();

          // Process response data and populate the table
          const resultData = response.iv_data.resultData;
          let totalDelta = 0;
          let totalTheta = 0;
          let totalGamma = 0;
          let totalVega = 0;
          let totalRho = 0;
          let leg = 1;

          for (const item of resultData) {
            const optionType = item.optiontype;
            const symbol = item.symbol;
            const strikePrice = item.strikeprice;
            const expiry = item.expiry;
            const position = item.position;
            const iv = item.calls_iv || item.puts_iv;

            // console.log('optionType' + optionType);

            const delta =
              optionType === "CE" ? item.call_delta : item.put_delta;
            const theta =
              optionType === "CE" ? item.call_theta : item.put_theta;
            const gamma =
              optionType === "CE" ? item.call_gamma : item.put_gamma;
            const vega = optionType === "CE" ? item.call_vega : item.put_vega;
            const rho = optionType === "CE" ? item.call_rho : item.put_rho;
            var parsedDate = new Date(expiry);
            var day = parsedDate.getDate().toString().padStart(2, "0");
            var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
            var year = parsedDate.getFullYear();
            var formattedDate_initial = day + "-" + month + "-" + year;

            function formatDate(inputDate) {
              const dateParts = inputDate.split("-"); // Split the input date by hyphen
              const day = dateParts[0]; // Extract day
              const month = dateParts[1]; // Extract month
              const year = dateParts[2]; // Extract year

              // Create an array of month abbreviations
              const monthAbbreviations = [
                "JAN",
                "FEB",
                "MAR",
                "APR",
                "MAY",
                "JUN",
                "JUL",
                "AUG",
                "SEP",
                "OCT",
                "NOV",
                "DEC",
              ];

              // Get the abbreviated month using the month value as an index
              const abbreviatedMonth = monthAbbreviations[parseInt(month) - 1];

              // Create the formatted date string
              const formattedDate = `${day}${abbreviatedMonth}${year}`;

              return formattedDate;
            }

            const inputDate = formattedDate_initial;
            const formattedDate = formatDate(inputDate);
            const absoluteQuantity = Math.abs(item.quantity);
            // console.log(formattedDate); // Output: "14SEP"
            var stockDropdown = $("#stockDropdown").val();
            // Create the table row for each option

            const tableRow = `
                                        <tr id=${greeks++}>
                                            <td>
                                                                    <div class="greeks_position d-flex gap-1">
                                            <div class="main_short_long_lot_size">
                                            <div class="short_long"><span class="long_short_inner">${position === "Long" ? "+" : "-"
              }</span></div> <div class="option_lot_size_input">${absoluteQuantity}</div>x
                                        </div>
                                        <div class="symbol_expiry"><span class="symbol">${stockDropdown}</span><span class="expiry">${formattedDate}</span></div>
                                        <div class="strike_price_call_put"> <span class="strikePrice">${parseFloat(
                strikePrice
              )}</span><span class="call_put_entrance">${optionType === "Call" ? "CE" : "PE"
              }</span></div> </div></td>
                                        
                                            <td><div class="greeks_iv">${iv !== null ? iv.toFixed(2) : 0
              }</div></td>
                                            <td><div class="greeks_delta">${delta !== null
                ? delta.toFixed(2)
                : 0
              }</div></td>
                                            <td><div class="greeks_theta">${theta !== null
                ? theta.toFixed(4)
                : 0
              }</div></td>
                                            <td><div class="greeks_gamma">${gamma !== null
                ? gamma.toFixed(4)
                : 0
              } </div></td>
                                            <td ><div class="greeks_vega">${vega !== null
                ? vega.toFixed(2)
                : 0
              }</div></td>
                                            <td><div class="greeks_rho">${rho !== null ? rho.toFixed(2) : 0
              }</div></td>
                                        </tr>
                

                        `;

            $("#resultTable tbody").append(tableRow);

            // Calculate positional Greeks
            totalDelta += parseFloat(delta);
            totalTheta += parseFloat(theta);
            totalGamma += parseFloat(gamma);
            totalVega += parseFloat(vega);
            totalRho += parseFloat(rho);
          }

          // Add the row for positional Greeks
          const totalRow = `
                                                                    <tr>
                                                                        <td>POSITIONAL GREEKS</td>
                                                                    
                                                                        <td></td>
                                                                        <td>${totalDelta !==
              null
              ? totalDelta.toFixed(
                2
              )
              : 0
            }</td>
                                                                        <td>${totalTheta !==
              null
              ? totalTheta.toFixed(
                4
              )
              : 0
            }</td>
                                                                        <td>${totalGamma !==
              null
              ? totalGamma.toFixed(
                4
              )
              : 0
            }</td>
                                                                        <td>${totalVega !==
              null
              ? totalVega.toFixed(
                2
              )
              : 0
            }</td>
                                                                        <td>${totalRho !==
              null
              ? totalRho.toFixed(
                2
              )
              : 0
            }</td>
                                                                    </tr>
                                                                `;

          $("#resultTable tbody").append(totalRow);

          const updatedResultData = response.stock_data.resultData.map(
            (item, index) => {
              // Find the current_price element within the corresponding .main_add_position_actions
              const ltpValue = $(".main_add_position_actions")
                .eq(index)
                .find(".current_price")
                .text();

              // Initialize parsedLtpValue to ltpValue (assuming it contains a numeric value)
              let parsedLtpValue = parseFloat(ltpValue);

              // Check if parsedLtpValue is 0 and if item.unitPrice is available
              if (parsedLtpValue === 0 && item.unitPrice) {
                // If ltpValue is 0, set parsedLtpValue to item.unitPrice
                parsedLtpValue = item.unitPrice;
              }

              // Log the values for debugging
              // console.log('ltpValue', ltpValue);
              // console.log('parsedLtpValue', parsedLtpValue);
              // console.log('item.unitPrice', item.unitPrice);

              // Return an object with ltpValue and item.unitPrice added
              return { ...item, ltpValue: parsedLtpValue };
            }
          );

          // console.log(updatedResultData);

          function createTable(data) {
            let tableHTML = "";

            let netCost = 0;
            let netPL = 0;

            let shortCount = 0;
            let longCount = 0;

            // Loop through the data to count short and long positions
            for (const item of data) {
              const shortMatches = item.position.match(/Short/gi);
              const longMatches = item.position.match(/Long/gi);

              if (shortMatches) {
                shortCount += shortMatches.length;
              }

              if (longMatches) {
                longCount += longMatches.length;
              }
            }
            let maxStrikePrice = Number.NEGATIVE_INFINITY;
            let minStrikePrice = Number.POSITIVE_INFINITY;
            // Determine the position label based on the majority
            const positionLabel = shortCount > longCount ? "SHORT" : "LONG";
            let totalStrikePrice = 0;
            let itemCount = 0;
            let premiumPain = 0;

            var All_positions = $(".main_position").find(
              ".main_add_position_actions"
            );
            for (let i = 0; i < data.length; i++) {
              const item = data[i];

              console.log(item.ltpValue);
              var All_positions = $(".main_position").find(
                ".main_add_position_actions"
              );
              All_positions.each(function (index) {
                var row = $(this);
                var item = data[index]; // Get the corresponding data item
                var unitPrice = item.unitPrice; // Get the unitPrice from the data
                row.find(".entryPrice").text(unitPrice);
              });

              // Adjust lotSize based on position
              const adjustedLotSize =
                item.position.toLowerCase() === "short"
                  ? -item.lotSize
                  : item.lotSize;
              const absoluteQuantity = Math.abs(item.quantity);
              const totalCurrentCost =
                item.unitPrice * adjustedLotSize * absoluteQuantity;
              const totalPL =
                item.ltpValue * adjustedLotSize * absoluteQuantity;
              var final_P_L = totalPL - totalCurrentCost;

              maxStrikePrice = Math.max(maxStrikePrice, item.strikePrice);
              minStrikePrice = Math.min(minStrikePrice, item.strikePrice);

              var parsedDate = new Date(item.expiry);
              var day = parsedDate.getDate().toString().padStart(2, "0");
              var month = (parsedDate.getMonth() + 1)
                .toString()
                .padStart(2, "0");
              var year = parsedDate.getFullYear();
              var formattedDate_initial = day + "-" + month + "-" + year;

              function formatDate(inputDate) {
                const dateParts = inputDate.split("-"); // Split the input date by hyphen
                const day = dateParts[0]; // Extract day
                const month = dateParts[1]; // Extract month
                const year = dateParts[2]; // Extract year

                // Create an array of month abbreviations
                const monthAbbreviations = [
                  "JAN",
                  "FEB",
                  "MAR",
                  "APR",
                  "MAY",
                  "JUN",
                  "JUL",
                  "AUG",
                  "SEP",
                  "OCT",
                  "NOV",
                  "DEC",
                ];

                // Get the abbreviated month using the month value as an index
                const abbreviatedMonth =
                  monthAbbreviations[parseInt(month) - 1];

                // Create the formatted date string
                const formattedDate = `${day}${abbreviatedMonth}${year}`;

                return formattedDate;
              }

              const inputDate = formattedDate_initial;
              const formattedDate = formatDate(inputDate);

              // console.log(formattedDate); // Output: "14SEP"
              var stockDropdown = $("#stockDropdown").val();

              const legRow = `
                                                                <tr id=${p_l++}>
                                                                    <td>
                                                                    <div class="p_l_position d-flex gap-1">
                                            <div class="main_short_long_lot_size">
                                            <div class="short_long"><span class="long_short_inner">${item.position === "Long"
                  ? "+"
                  : "-"
                }</span></div> <div class="option_lot_size_input">${absoluteQuantity}</div>x
                                        </div>
                                        <div class="symbol_expiry"><span class="symbol">${stockDropdown}</span><span class="expiry">${formattedDate}</span></div>
                                        <div class="strike_price_call_put"> <span class="strikePrice">${parseFloat(
                  item.strikePrice
                )}</span><span class="call_put_entrance">${item.optionType === "Call" ? "CE" : "PE"
                }</span></div> </div></td>
                                                                   
                                                                    <td><div class="ltpValue">${item.ltpValue
                }</div></td>
                                                                    <td><div class="unitPrice">${item.unitPrice
                }</div></td>
                                                                    <td><div class="adjsutedLotSize">${adjustedLotSize}</div></td>
                                                                    <td><div class="absoluteQuantity">${absoluteQuantity}</div></td>
                                                                    <td><div class="totalCurrentCost ${totalCurrentCost > 0 ? "text-success" : "text-danger"}">${totalCurrentCost.toFixed(
                  2
                )}</div></td>
                                                                    <td class="text-center"><div class="final_P_L">${final_P_L}</div></td>
                                                                </tr>
                                                            `;
              const $exitPriceElements = $(".exit_price");
              if ($exitPriceElements.length > i) {
                $($exitPriceElements[i]).empty().text(final_P_L);
              }
              tableHTML += legRow;

              netCost += parseFloat(totalCurrentCost.toFixed(2));
              netPL += parseFloat(final_P_L);

              totalStrikePrice += parseFloat(item.strikePrice);
              itemCount++;
              premiumPain += parseFloat(item.unitPrice);
            }

            // console.log(totalStrikePrice);
            const averageStrikePrice = totalStrikePrice / itemCount;
            // console.log("Average of the :" + averageStrikePrice);
            // console.log(positionLabel);
            var min_breakPoints = averageStrikePrice - premiumPain;
            var max_breakPoints = averageStrikePrice + premiumPain;

            var Put_position_label =
              positionLabel == "SHORT"
                ? Math.abs(netCost + -netPL)
                : "Unlimited";
            var long_position_label =
              positionLabel == "LONG"
                ? Math.abs(netCost + -netPL)
                : "Unlimited";
            var Put_position_display =
              positionLabel == "SHORT" ? "d-block" : "d-none";
            var long_position_display =
              positionLabel == "LONG" ? "d-block" : "d-none";

            var strategyBuilder = localStorage.getItem("strategy_builder");

            var previousStrikePrice = null;
            var previousEntryPrice = null;
            var lot_size_value_strategy = parseInt($("#lot_size_value").text());
            var max_profit_strategy = null;

            var strike_price_diff = null;
            var long_short_final = [];
            $(".inner_position").each(function () {
              var strikePrice = parseFloat($(this).find(".strikePrice").text());
              var longShortInner = $(this).find(".long_short_inner").text();

              var entryPrice = parseFloat($(this).find(".entryPrice").text());

              if (longShortInner === "-") {
                long_short_final.push(-Math.abs(entryPrice));
              } else {
                long_short_final.push(Math.abs(entryPrice));
              }
              console.log(long_short_final);
              if (previousStrikePrice !== null) {
                var strikePriceDifference = strikePrice - previousStrikePrice;
                strike_price_diff = strikePriceDifference;
                console.log(
                  "Difference in Strike Price: " + strikePriceDifference
                );
              }
              if (previousEntryPrice !== null) {
                var entryPriceDifference = entryPrice + previousEntryPrice;
                max_profit_strategy = entryPriceDifference;
                console.log("max_profit_strategy", max_profit_strategy);

                console.log(
                  "Difference in Entry Price: " + entryPriceDifference
                );
              }

              previousStrikePrice = strikePrice;
              previousEntryPrice = entryPrice;
            });

            var sum = long_short_final.reduce((total, num) => total + num, 0);

            console.log("Sum of long_short_final array:", sum);

            var final_max_profit = Math.abs(
              sum * lot_size_value_strategy
            ).toFixed(2);
            var final_max_looss = (
              (strike_price_diff + sum) *
              lot_size_value_strategy
            ).toFixed(2);

            if (strategyBuilder === "straddle") {
              $("#max_profit").text(Put_position_label);
              $("#max_loss").text(long_position_label);
              $("#ratio").text("No defined");
            } else if (strategyBuilder === "strangle") {
              $("#max_profit").text(Put_position_label);
              $("#max_loss").text(long_position_label);
              $("#ratio").text("No defined");
            } else if (strategyBuilder === "spread") {
              $("#max_profit").text(final_max_profit);
              $("#max_loss").text(final_max_looss);
              $("#ratio").text((final_max_profit / final_max_looss).toFixed(2));
            } else if (strategyBuilder === "iron_fly") {
              $("#max_profit").text(final_max_profit);
              $("#max_loss").text(final_max_looss);
              $("#ratio").text((final_max_profit / final_max_looss).toFixed(2));
            } else if (strategyBuilder === "iron_condor") {
              $("#max_profit").text(final_max_profit);
              $("#max_loss").text(final_max_looss);
              $("#ratio").text((final_max_profit / final_max_looss).toFixed(2));
            } else if (strategyBuilder === "jaze_lizard") {
              $("#max_profit").text(final_max_profit);
              $("#max_loss").text("Unlimited");
              $("#ratio").text("No defined");
            }

            $("#break_evens").text(`${minStrikePrice}~${maxStrikePrice}`);
            tableHTML += `
                                                                <tr>
                                                                    <td colspan="5">NET COST OF STRATEGY :</td>
                                                                    <td class="${netCost < 0 ? "text-danger" : "text-success"}">${netCost}</td>
                                                                    <td colspan="6" class="text-center">${netPL}</td>
                                                                
                                                                </tr>
                                                            
                                                            `;

            return tableHTML;
          }

          const tableBody = document.getElementById("table-PL");
          tableBody.innerHTML = createTable(updatedResultData);
          $("#spinner").hide();
        },
        error: function (xhr, status, error) {
          // console.error("Error sending data to Django:", error);
        },
      });
      $("#spinner").hide();
    }



    var Oi_chart = null;

    function OI_charts(all_callsOI_putsOI) {
      console.log("inside:", all_callsOI_putsOI);

      am4core.ready(function () {
        if (Oi_chart) {
          Oi_chart.dispose();
        }

        // Create chart instance
        var chart = am4core.create("oi_charts", am4charts.XYChart);
        Oi_chart = chart; // Store the chart instance

        var chartData = all_callsOI_putsOI.map(function (data, index) {
          return {
            category: data.strikePrice,
            calls_oi: data.calls_oi,
            puts_oi: data.puts_oi,
          };
        });
        console.log(chartData);

        // Add data
        chart.data = chartData;

        // Create axes
        var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
        categoryAxis.dataFields.category = "category";
        categoryAxis.renderer.grid.template.location = 0;
        categoryAxis.renderer.minGridDistance = 80;
        chart.logo.disabled = true;

        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
        valueAxis.renderer.minGridDistance = 30; // Adjust the grid distance according to your requirement

        // Create series
        function createSeries(field, name, color) {
          var series = chart.series.push(new am4charts.ColumnSeries());
          series.dataFields.valueY = field;
          series.dataFields.categoryX = "category";
          series.name = name;
          series.columns.template.tooltipText = "{category}: {name}: [bold]{valueY}[/]";
          series.columns.template.width = am4core.percent(80); // Adjust the width of the columns
          series.columns.template.strokeWidth = 0; // Set stroke width to 0 for the columns to add gaps

          // Set the color for the series
          if (color === "red") {
            series.columns.template.fill = am4core.color("#F96C92");
          } else if (color === "green") {
            series.columns.template.fill = am4core.color("#2196F3");
          }



        }

        createSeries("calls_oi", "Calls OI", "green");
        createSeries("puts_oi", "Puts OI", "red");

        // Add legend
        chart.legend = new am4charts.Legend();
        var cursor = new am4charts.XYCursor();
        cursor.lineX.stroke = am4core.color("black"); // set color for the X-axis cursor line
        cursor.lineY.stroke = am4core.color("#000"); // set color for the Y-axis cursor line
        cursor.lineX.strokeWidth = 2; // set width of the X-axis cursor line
        cursor.lineY.strokeWidth = 0; // set width of the Y-axis cursor line
        chart.cursor = cursor;


        // ...
        // ...
        // ...
      });
    }

    // Handle stock dropdown change
    $("#stockDropdown").change(function () {
      var selectedOption = $(this).val();
      var selectedExpiry = $("#optionExpiryDropdown").val();

      $("#table-PL").empty();
      $("#resultTable tbody").empty();
      $(".strike_price_input").empty();
      $(".expiry_date_input").empty();


      loadSpotData(selectedOption);



      loadExpiryData(selectedOption);
      loadOptionData(selectedOption, "");

    });

    //         setInterval(function() {
    //     loadSpotData($("#stockDropdown").val());
    // }, 5000);

    // Function to load spot data
    function loadSpotData(selectedOption) {
      // console.log(selectedOption);

      $.ajax({
        url:
          '{% url "get_option_strategy_optimizer_spot_data" %}?selected_option=' +
          selectedOption,
        type: "GET",
        success: function (response) {
          // Handle the response as needed
          // console.log(response.spot_data.resultData);
          $("#max_pain_value").text(response.spot_data.resultData.max_pain);
          $("#lot_size_value").text(response.spot_data.resultData.lot_size);
          $("#open_value").text(response.spot_data.resultData.open);
          $("#low_value").text(response.spot_data.resultData.low);
          $("#high_value").text(response.spot_data.resultData.high);
          $("#high52_value").text(response.spot_data.resultData.high52);
          $("#low52_value").text(response.spot_data.resultData.low52);
          var spot_check_strategies = response.spot_data.resultData.change_per;
          var valid_spot_value_strategies =
            spot_check_strategies > 0 ? "text-success" : "text-danger";
          var arrow_valid = spot_check_strategies > 0 ? "up" : "down";
          $("#last_traded_price").empty().append(`
                        <div class="${valid_spot_value_strategies} d-flex align-items-center gap-1">
                            <p class="last_traded_price">${response.spot_data.resultData.last_trade_price}</p>
                            <i class='bx bxs-${arrow_valid}-arrow' id="spot_arrow"></i>
                            <p>${response.spot_data.resultData.change_value}(${response.spot_data.resultData.change_per})</p>
                            
                            </div>
                        `);
        },
      });
    }


    $("#optionExpiryDropdown").change(function () {
      var selectedOption = $("#stockDropdown").val();
      var selectedExpiry = $("#optionExpiryDropdown").val();

      var selectedOptionExpiry = $(this).val();

      if (selectedOption) {
        loadOptionData(selectedOption, selectedOptionExpiry);
        loadExpiryData(selectedOption);
      }
    });

    function loadOptionData(selectedOption, selectedExpiry) {
      $.ajax({
        url:
          '{% url "get_option_strategy_optimizer_option_data" %}?selected_option=' +
          selectedOption +
          "&selected_expiry=" +
          selectedExpiry,
        type: "GET",
        success: function (response) {
          // console.log(response.option_data.resultData.opExpiryDates);
          var optionExpiryDropdown = $("#optionExpiryDropdown");
          optionExpiryDropdown.empty();
          $.each(
            response.option_data.resultData.opExpiryDates,
            function (index, expiryDate) {
              // Split the date and format it
              var dateParts = expiryDate.split("T")[0].split("-");
              var formattedDate =
                dateParts[2] + "-" + dateParts[1] + "-" + dateParts[0];

              // Create the option element
              var option = $("<option>")
                .text(formattedDate)
                .val(expiryDate.split("T")[0]);

              console.log(formattedDate);
              console.log(expiryDate.split("T")[0]);

              // Append the option to the dropdown
              optionExpiryDropdown.append(option);
            }
          );

          if (selectedExpiry) {
            $("#optionExpiryDropdown").val(selectedExpiry);
          }
          var option_chain_data = response.option_data.resultData.opDatas;
          // console.log(option_chain_data[0]);
          // console.log($("#optionExpiryDropdown").val());
          var option_expiry_date = $("#optionExpiryDropdown").val();
          var lot_size_value_option = $("#lot_size_value").text();
          // console.log(lot_size_value_option);
          // console.log(selectedOption);

          // console.log(selectedExpiry)

          var optionChainTable = $(".strategy_option_chain");
          optionChainTable.empty();

          var spot_strike_price = $(".last_traded_price").text();

          var closestStrikePrice = null;
          var closestDiff = Number.MAX_VALUE;
          var all_callsOI_putsOI = []

          $.each(
            response.option_data.resultData.opDatas,
            function (index, optionChain) {
              // console.log(optionChain);

              var strike_price = parseFloat(optionChain.strike_price);
              var diff = Math.abs(spot_strike_price - strike_price);

              if (diff < closestDiff) {
                closestDiff = diff;
                closestStrikePrice = strike_price;

              }

              var strike_price_background_down =
                strike_price < parseFloat(spot_strike_price)
                  ? "bg_option_for"
                  : "";
              var strike_price_background_up =
                strike_price > parseFloat(spot_strike_price)
                  ? "bg_option_for"
                  : "";
              console.log(strike_price);
              console.log(parseFloat(spot_strike_price));
              var rowContent = `
                                <tr class="call_put_tr">
                                    <td class="text-end ${strike_price_background_down}">${optionChain.calls_iv}</td>
                                    <td class="text-end ${strike_price_background_down}"">${optionChain.calls_oi}</td>
                                    <td class="text-end call-ltp cursor-pointer  position-relative ${strike_price_background_down}"">
                                        <div class="d-flex position-absolute top-0 call-pul-ltp-btns d-none call-row">
                                            <button id="Auto_calls_short_click" title="Short" data-action="Short" data-side="call" type="button" class="px-lg-3 py-lg-1 mx-1 bg-light-green put_call_btns common-border shadow-none fs-13 fw-600 btn btn-primary">S</button>
                                            <button id="Auto_calls_long_click" title="Long" data-action="Long" data-side="call" type="button" class="px-lg-3 py-lg-1 mx-1 bg-light-red put_call_btns  shadow-none fs-13 fw-600 btn btn-primary">B</button>
                                            </div>
                                        <p class="calls_ltp">
                                        ${optionChain.calls_ltp} </p></td>
                                    <td class="text-center  strikePrice_main_bg bg-light text-dark" >
                        <div class='strike_price'> 
                            ${optionChain.strike_price}
                            </div>
                                        
                                        <div class=d-none>
                                            
                                            <div class="expiry_date">${option_expiry_date}</div>
                                            <div class="opiton_lot_size">${lot_size_value_option}</div>
                                            <div class="opiton_selected">${selectedOption}</div>

                                                </div>
                                  
                                       
                                        </td>
                          
                                    <td class="text-start put-ltp cursor-pointer  position-relative ${strike_price_background_up}">
                                        <p class="puts_ltp">${optionChain.puts_ltp}</p>
                                        <div class="d-flex position-absolute top-0 call-pul-ltp-btns  d-none" id="put_call_put">
                                            <button id="Auto_puts_short_click" title="Short" type="button" data-action="Short" data-side="put" class="px-lg-3 py-lg-1 mx-1 bg-light-green put_call_btns common-border shadow-none fs-13 fw-600 btn btn-primary">S</button>
                                            <button id="Auto_puts_long_click" title="Long" data-action="Long" data-side="put" type="button" class="px-lg-3 bg-light-red put_call_btns py-lg-1 mx-1  shadow-none fs-13 fw-600 btn btn-primary">B</button>
                                            </div>
                                        </td>
                                    <td class="text-start ${strike_price_background_up}">${optionChain.puts_oi}</td>
                                    <td class="text-start ${strike_price_background_up}">${optionChain.puts_iv}</td>
                                </tr>
                            `;
              all_callsOI_putsOI.push({ "calls_oi": optionChain.calls_oi, "puts_oi": optionChain.puts_oi, "strikePrice": optionChain.strike_price })
              optionChainTable.append(rowContent);
            }
          );
          console.log("Nearest Strike Price:", closestStrikePrice);
          $("#closest_strike_price").text(closestStrikePrice);
          console.log(all_callsOI_putsOI);

          OI_charts(all_callsOI_putsOI)

          $(".call_put_tr").each(function () {
            var $strikePrice = $(this).find(".strike_price");
            var currentStrikePrice = parseInt($strikePrice.text()); // Assuming the text is numeric

            if (currentStrikePrice === closestStrikePrice) {
              $(this).addClass("background_opiton_closest");
              $(this).find("td").removeClass("bg_option_for");
              $(this).find("td").addClass("text-light");
              $(this).find(".strikePrice_main_bg").removeClass('bg-light').addClass("background_opiton_closest");


              // $strikePrice.addClass("closestStrike_bg");
              var container = $(".main_option_chain_table");
              var scrollTo =
                $(this).position().top -
                container.height() / 2 +
                $(this).height() / 2;

              // Reset the scroll position first
              $(".main_option_chain_table").animate(
                {
                  scrollTop: 0,
                },
                0,
                function () {
                  // Scroll to the desired position after the reset
                  $(".main_option_chain_table").animate(
                    {
                      scrollTop: scrollTo,
                    },
                    1000
                  ); // You can adjust the scrolling speed here (in milliseconds)
                }
              );
            }
          });

          $(".right_side_top_strategies #option_chain_button").click(
            function () {
              $(".call_put_tr").each(function () {
                var $strikePrice = $(this).find(".strike_price");
                var currentStrikePrice = parseInt($strikePrice.text()); // Assuming the text is numeric

                if (currentStrikePrice === closestStrikePrice) {
                  $(this).addClass("background_opiton_closest");
                  $(this).find("td").removeClass("bg_option_for");
                  $(this).find("td").addClass("text-light");
                  $(this).find(".strikePrice_main_bg").removeClass('bg-light').addClass("background_opiton_closest");


                  // $strikePrice.addClass("closestStrike_bg");
                  var container = $(".main_option_chain_table");
                  var scrollTo =
                    $(this).position().top -
                    container.height() / 2 +
                    $(this).height() / 2;

                  // Reset the scroll position first
                  $(".main_option_chain_table").animate(
                    {
                      scrollTop: 0,
                    },
                    0,
                    function () {
                      // Scroll to the desired position after the reset
                      $(".main_option_chain_table").animate(
                        {
                          scrollTop: scrollTo,
                        },
                        1000
                      ); // You can adjust the scrolling speed here (in milliseconds)
                    }
                  );
                }
              });
            }
          );

          var strikeSelect_straddle_val = $("#strikeSelect_straddle");

          strikeSelect_straddle_val.on("change", function () {
            var selectedValue = $(this).val();
            $("#closest_strike_price").text(selectedValue);
          });
          var expiryDate_straddle = $("#expiryDate_straddle");
          expiryDate_straddle.on("change", function () {
            var selectedValue = $(this).val();
            $("#closen_expiry_date").text(selectedValue);
          });

          function selectStrategy(filter_arg_strategy) {
            if (filter_arg_strategy === "straddle") {
              var latestStrikePrice = $("#strikeSelect_straddle").val(); // Parse as a float
              // console.log(latestStrikePrice);
              $("#closest_strike_price").text(latestStrikePrice);
              var expirySelect = $(".expiry_date_input");
              var strikeSelect = $(".strike_price_input");

              expirySelect.empty();
              strikeSelect.empty();
              var closest_strike_price = $("#closest_strike_price");
              strikeSelect.find("option").each(function () {
                // Log the value of the current option
                // console.log($(this).val());
              });

              $("#straddle").addClass("option_strategies_active");
              $("#strangle").removeClass("option_strategies_active");
              $("#iron_fly").removeClass("option_strategies_active");
              $("#spread").removeClass("option_strategies_active");
              $("#iron_condor").removeClass("option_strategies_active");
              $("#jaze_lizard").removeClass("option_strategies_active");
              $("#double_iron_fly").removeClass("option_strategies_active");
              $("#double_iron_condor").removeClass("option_strategies_active");
              $("#call_butter_fly").removeClass("option_strategies_active");

              $("#put_butter_fly").removeClass("option_strategies_active");


              $(".data-display-table").empty();
              $("#table-PL").empty();
              $("#resultTable tbody").empty();
              $(".inner_p_l_greeks").show();
              $(".main_position").empty();

              var counter_input = $("#counter_input").val();
              $(".option_lot_size_input").each(function () {
                $(this).val(counter_input);
              });

              // Delay execution to ensure elements are loaded

              optionChainTable.find(".strike_price").each(function () {
                var rowStrikePrice = parseFloat($(this).text());

                if (rowStrikePrice === parseFloat(latestStrikePrice)) {
                  // Click on buttons with IDs "#Auto_calls_short_click" and "#Auto_puts_short_click"
                  $(this)
                    .closest(".call_put_tr")
                    .find("#Auto_calls_short_click, #Auto_puts_short_click")
                    .data("HI1", "HI1There")
                    .click();

                  // Get the value of "#counter_input"
                  var counterInputValue = $("#counter_input").val();

                  // Set the value of ".option_lot_size_input" elements to "#counter_input" value
                  $(".option_lot_size_input").val(counterInputValue);
                  $(".option_lot_size_input").text(counterInputValue);

                  // Trigger the click event for the element with ID "#calculate"
                  localStorage.setItem("strategy_builder", "straddle");
                  calculate_data();
                }
              });

              // Hide the element with ID "#straddle_modal"
              Table_chart_pyoff()
              $("#straddle_modal").hide();
            }
            else if (filter_arg_strategy === "strangle") {
              $("#straddle_modal").hide();
              $("#strangle_modal").show();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the previous 5 strike prices
              var prev5 = [];
              for (var i = currentIndex - 1; i >= 0 && prev5.length < 5; i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  prev5.push(rowStrikePrice);
                }
              }

              $("#put_strikeSelect_strangle")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());
                  var lastPrevValue = parseFloat(prev5[prev5.length - 1]);

                  if (optionValue === lastPrevValue) {
                    // console.log(optionValue, lastPrevValue);
                    $(this).prop("selected", true);
                  }
                });

              // Calculate the next 5 strike prices
              var forw5 = [];
              for (
                var j = currentIndex + 1;
                j < strikePrices.length && forw5.length < 5;
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  forw5.push(rowStrikePrice);
                }
              }

              $("#call_strikeSelect_strangle")
                .find("option")
                .each(function () {
                  var optionValue_call = parseFloat($(this).val());
                  var lastPrevValue_call = parseFloat(forw5[forw5.length - 1]);

                  if (optionValue_call === lastPrevValue_call) {
                    // console.log(optionValue_call, lastPrevValue_call);
                    $(this).prop("selected", true);
                  }
                });

              var expiryDate_strangle = $("#expiryDate_strangle");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_strangle.on("change", function () {
                var selectedValue_straddle = $(this).val();
                // console.log(selectedValue_straddle);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_straddle).change();

                // Trigger a click event on the selected option
              });

              // console.log("Previous 5 Strike Prices:", prev5);
              // console.log("Next 5 Strike Prices:", forw5);

              $("#shortStrangle").click(function () {
                // Empty the specified elements before making any selection

                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").addClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();

                // Delay the rest of the code execution for a brief moment to ensure elements are fully emptied

                var put_strikeSelect_strangle = $(
                  "#put_strikeSelect_strangle"
                ).val();
                var call_strikeSelect_strangle = $(
                  "#call_strikeSelect_strangle"
                ).val();

                if (put_strikeSelect_strangle) {
                  // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                  var closestRowPrev = optionChainTable
                    .find(
                      ".strike_price:contains(" +
                      put_strikeSelect_strangle +
                      ")"
                    )
                    .closest(".call_put_tr");
                  if (closestRowPrev.length) {
                    closestRowPrev
                      .find("#Auto_puts_short_click")
                      .data("HI1", "HI1There")
                      .click();
                  }

                  // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                  var closestRowForw = optionChainTable
                    .find(
                      ".strike_price:contains(" +
                      call_strikeSelect_strangle +
                      ")"
                    )
                    .closest(".call_put_tr");
                  if (closestRowForw.length) {
                    closestRowForw
                      .find("#Auto_calls_short_click")
                      .data("HI1", "HI1There")
                      .click();
                  }
                  var counterInputValue = $("#counter_input_strangle").val();
                  $(".option_lot_size_input").val(counterInputValue);
                  $(".option_lot_size_input").text(counterInputValue);
                  // Click on #calculate after a longer delay

                  calculate_data();
                  localStorage.setItem("strategy_builder", "strangle");

                  $("#strangle_modal").hide();
                  Table_chart_pyoff()

                }
              });

            }
            else if (filter_arg_strategy === "spread") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#ironFly_modal").hide();
              $("#spread_modal").show();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();

              var closest_strike_price = $("#closest_strike_price").text();
              $("#put_strikeSelect_spread")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the next 5 strike prices
              var forw3 = [];
              for (
                var j = currentIndex + 1;
                j < strikePrices.length && forw3.length < 3;
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  forw3.push(rowStrikePrice);
                }
              }

              $("#call_strikeSelect_spread")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw3[forw3.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var expiryDate_spread = $("#expiryDate_spread");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_spread.on("change", function () {
                var selectedValue_straddle = $(this).val();
                // console.log(selectedValue_straddle);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_straddle).change();

                // Trigger a click event on the selected option
              });

              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              $("#shortSpread").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").addClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".inner_p_l_greeks").show();
                $(".main_position").empty();
                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();

                var put_strikeSelect_spread = parseFloat(
                  $("#put_strikeSelect_spread").val()
                ); // Convert to a number

                strikePrices.forEach(function (rowStrikePrice) {
                  if (rowStrikePrice === put_strikeSelect_spread) {
                    // console.log(rowStrikePrice, put_strikeSelect_spread);

                    // Find the closest row and click on Auto_calls_short_click
                    var closestRow = optionChainTable
                      .find(".strike_price:contains(" + rowStrikePrice + ")")
                      .closest(".call_put_tr");
                    if (closestRow.length) {
                      closestRow
                        .find("#Auto_calls_short_click")
                        .data("HI1", "HI1There")
                        .click();

                      // Delay before clicking on #calculate (adjust as needed)
                    }
                  }
                });

                // Get the values of lastIndexPrev and lastIndexForw

                var lastIndexForw = $("#call_strikeSelect_spread").val();

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click
                var closestRowPrev = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev.length) {
                  closestRowPrev
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closestRowForw = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw + ")")
                  .closest(".call_put_tr");
                if (closestRowForw.length) {
                  closestRowForw
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                // Click on #calculate after a longer delay
                var counterInputValue = $("#counter_input_spread").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "spread");
                calculate_data();

                $("#spread_modal").hide();
                Table_chart_pyoff()
              });
            }
            else if (filter_arg_strategy === "iron_fly") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").show();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the previous 4 and forward 4 strike prices
              var prev4 = [];
              var forw4 = [];

              for (var i = currentIndex - 1; i >= 0 && prev4.length < 4; i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  prev4.push(rowStrikePrice);
                }
              }

              $("#put_strikeSelect_ironFly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });


              var closest_strike_price = $("#closest_strike_price").text();
              $("#put_call_strikeSelect_ironFly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              for (
                var j = currentIndex + 1;
                j < strikePrices.length && forw4.length < 4;
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  forw4.push(rowStrikePrice);
                }
              }

              $("#call_strikeSelect_ironFly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var expiryDate_ironFly = $("#expiryDate_ironFly");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_ironFly.on("change", function () {
                var selectedValue_straddle = $(this).val();
                // console.log(selectedValue_straddle);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_straddle).change();

                // Trigger a click event on the selected option
              });

              // console.log("Previous 4 Strike Prices:", prev4);
              // console.log("Next 4 Strike Prices:", forw4);

              // Keep the existing logic for closestStrikePrice
              $("#shortironFly").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").addClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();
                var put_strikeSelect_ironFly = $(
                  "#put_strikeSelect_ironFly"
                ).val();
                var put_call_strikeSelect_ironFly = $(
                  "#put_call_strikeSelect_ironFly"
                ).val();
                var call_strikeSelect_ironFly = $(
                  "#call_strikeSelect_ironFly"
                ).val();
                // Get the values of lastIndexPrev and lastIndexForw
                var lastIndexPrev = put_strikeSelect_ironFly;
                var lastIndexForw = call_strikeSelect_ironFly;

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click
                var closestRowPrev = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev.length) {
                  closestRowPrev
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                optionChainTable.find(".strike_price").each(function () {
                  var rowStrikePrice = parseFloat($(this).text());
                  if (
                    rowStrikePrice === parseFloat(put_call_strikeSelect_ironFly)
                  ) {
                    $(this)
                      .closest(".call_put_tr")
                      .find("#Auto_calls_short_click, #Auto_puts_short_click")
                      .data("HI1", "HI1There")
                      .click();
                  }
                });

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closestRowForw = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw + ")")
                  .closest(".call_put_tr");
                if (closestRowForw.length) {
                  closestRowForw
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                // Click on #calculate after a longer delay
                var counterInputValue = $("#counter_input_ironFly").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "iron_fly");
                calculate_data();
                $("#ironFly_modal").hide();
                Table_chart_pyoff()
              });
            }
            else if (filter_arg_strategy === "iron_condor") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").show();
              $("#jaze_lizard_modal").hide();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the previous 4 and forward 4 strike prices
              var prev4 = [];
              var prev3 = [];
              var forw3 = [];
              var forw4 = [];

              for (
                var i = currentIndex - 1;
                i >= 0 && (prev4.length < 4 || prev3.length < 3);
                i--
              ) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev4.length < 4) {
                    prev4.push(rowStrikePrice);
                  }
                  if (prev3.length < 3) {
                    prev3.push(rowStrikePrice);
                  }
                }
              }

              $("#put_strikeSelect_ironCondor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#put_2nd_strikeSelect_ironCondor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev3[prev3.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              for (
                var j = currentIndex + 1;
                j < strikePrices.length &&
                (forw4.length < 4 || forw3.length < 3);
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw4.length < 4) {
                    forw4.push(rowStrikePrice);
                  }
                  if (forw3.length < 3) {
                    forw3.push(rowStrikePrice);
                  }
                }
              }
              $("#call_2nd_strikeSelect_ironCondor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw3[forw3.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_strikeSelect_ironCondor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var expiryDate_ironCondor = $("#expiryDate_ironCondor");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_ironCondor.on("change", function () {
                var selectedValue_ironCondor = $(this).val();
                // console.log(selectedValue_ironCondor);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_ironCondor).change();

                // Trigger a click event on the selected option
              });

              // console.log("Previous 3 Strike Prices:", prev3);
              // console.log("Previous 4 Strike Prices:", prev4);
              // console.log("Next 4 Strike Prices:", forw4);
              // console.log("Next 3 Strike Prices:", forw3);

              // Get the values of lastIndexPrev and lastIndexForw
              var lastIndexPrev = $("#put_strikeSelect_ironCondor").val();
              var lastIndexForw = $("#put_2nd_strikeSelect_ironCondor").val();
              var lastIndexPrev3 = $("#call_2nd_strikeSelect_ironCondor").val();
              var lastIndexForw3 = $("#call_strikeSelect_ironCondor").val();

              // Find the closest row for lastIndexPrev and click on Auto_puts_short_click
              $("#short_ironCondor").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").addClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();

                var closestRowPrev = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev.length) {
                  closestRowPrev
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                var closestRowForw = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw + ")")
                  .closest(".call_put_tr");
                if (closestRowForw.length) {
                  closestRowForw
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI1There")
                    .click();
                }
                var closestRowPrev3 = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev3 + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev3.length) {
                  closestRowPrev3
                    .find("#Auto_calls_short_click")
                    .data("HI1", "HI1There")
                    .click();
                }
                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closestRowForw3 = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw3 + ")")
                  .closest(".call_put_tr");
                if (closestRowForw3.length) {
                  closestRowForw3
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                // Click on #calculate after a longer delay
                var counterInputValue = $("#counter_input_ironCondor").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "iron_condor");
                calculate_data();
                $("#ironCondor_modal").hide();
                Table_chart_pyoff()
              });
            }
            else if (filter_arg_strategy === "jaze_lizard") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice
              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              // Calculate the previous 4 and forward 4 strike prices
              var prev4 = [];

              var forw2 = [];
              var forw4 = [];

              for (
                var j = currentIndex + 1;
                j < strikePrices.length &&
                (forw4.length < 4 || forw2.length < 2);
                j++
              ) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw4.length < 4) {
                    forw4.push(rowStrikePrice);
                  }
                  if (forw2.length < 2) {
                    forw2.push(rowStrikePrice);
                  }
                }
              }
              $("#call_strikeSelect_jaze_lizard")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_2nd_strikeSelect_jaze_lizard")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw2[forw2.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              for (var i = currentIndex - 1; i >= 0 && prev4.length < 4; i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev4.length < 4) {
                    prev4.push(rowStrikePrice);
                  }
                }
              }
              $("#put_strikeSelect_jaze_lizard")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              // console.log("Next 4 Strike Prices:", forw4);
              // console.log("Next 2 Strike Prices:", forw2);

              // console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_jaze_lizard = $("#expiryDate_jaze_lizard");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_jaze_lizard.on("change", function () {
                var selectedValue_jaze_lizard = $(this).val();
                // console.log(selectedValue_jaze_lizard);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_jaze_lizard).change();

                // Trigger a click event on the selected option
              });
              $("#shortjaze_lizard").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").addClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();

                var lastIndexForw = $("#call_strikeSelect_jaze_lizard").val();

                var lastIndexForw2 = $(
                  "#call_2nd_strikeSelect_jaze_lizard"
                ).val();
                var lastIndexPrev = $("#put_strikeSelect_jaze_lizard").val();

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closestRowForw2 = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw2 + ")")
                  .closest(".call_put_tr");
                if (closestRowForw2.length) {
                  closestRowForw2
                    .find("#Auto_calls_short_click")
                    .data("HI1", "HI1There")
                    .click();
                }

                var closestRowForw = optionChainTable
                  .find(".strike_price:contains(" + lastIndexForw + ")")
                  .closest(".call_put_tr");
                if (closestRowForw.length) {
                  closestRowForw
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI2there")
                    .click();
                }

                var closestRowPrev = optionChainTable
                  .find(".strike_price:contains(" + lastIndexPrev + ")")
                  .closest(".call_put_tr");
                if (closestRowPrev.length) {
                  closestRowPrev
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI3there")
                    .click();
                }
                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_jaze_lizard").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "jaze_lizard");
                calculate_data();
                $("#jaze_lizard_modal").hide();
                Table_chart_pyoff()
              });
            }

            else if (filter_arg_strategy === "double_iron_fly") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();
              $("#double_iron_fly_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice

              var closest_strike_price = $("#closest_strike_price").text();
              $("#call_spot_strikeSelect_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              var prev8 = [];
              var prev4 = [];

              for (var i = currentIndex - 1; i >= 0 && (prev8.length < 8 || prev4.length < 4); i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev8.length < 8) {
                    prev8.push(rowStrikePrice);
                  }
                  if (prev4.length < 4) {
                    prev4.push(rowStrikePrice);
                  }
                }
              }


              $("#put_strike_eight_hundred_Select_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev8[prev8.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_put_four_hundred_Select_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });










              var forw4 = [];
              var forw8 = [];
              var forw12 = [];

              for (var j = currentIndex + 1; j < strikePrices.length && (forw4.length < 4 || forw8.length < 8 || forw12.length < 12); j++) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw4.length < 4) {
                    forw4.push(rowStrikePrice);
                  }
                  if (forw8.length < 8) {
                    forw8.push(rowStrikePrice);
                  }
                  if (forw12.length < 12) {
                    forw12.push(rowStrikePrice);
                  }
                }
              }


              $("#put_positive_four_hundred_strikeSelect_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_put_positive_eight_hundred_strikeSelect_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw8[forw8.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_twelve_hundred_positive_strikeSelect_double_iron_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw12[forw12.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });



              $("#put_strikeSelect_jaze_lizard")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              // console.log("Next 4 Strike Prices:", forw4);
              // console.log("Next 2 Strike Prices:", forw2);

              // console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_jaze_lizard = $("#expiryDate_double_iron_fly");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_jaze_lizard.on("change", function () {
                var selectedValue_jaze_lizard = $(this).val();
                // console.log(selectedValue_jaze_lizard);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_jaze_lizard).change();

                // Trigger a click event on the selected option
              });
              $("#shortdouble_iron_fly").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").addClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");


                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var put_strike_eight_hundred_Select_double_iron_fly = $("#put_strike_eight_hundred_Select_double_iron_fly").val();
                var call_put_four_hundred_Select_double_iron_fly = $("#call_put_four_hundred_Select_double_iron_fly").val();
                var call_spot_strikeSelect_double_iron_fly = $("#call_spot_strikeSelect_double_iron_fly").val();
                var put_positive_four_hundred_strikeSelect_double_iron_fly = $("#put_positive_four_hundred_strikeSelect_double_iron_fly").val();
                var call_put_positive_eight_hundred_strikeSelect_double_iron_fly = $("#call_put_positive_eight_hundred_strikeSelect_double_iron_fly").val();
                var call_twelve_hundred_positive_strikeSelect_double_iron_fly = $("#call_twelve_hundred_positive_strikeSelect_double_iron_fly").val();


                var closest_put_strike_eight_hundred_Select_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + put_strike_eight_hundred_Select_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_put_strike_eight_hundred_Select_double_iron_fly.length) {
                  closest_put_strike_eight_hundred_Select_double_iron_fly
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1there")
                    .click();
                }

                var closest_call_put_four_hundred_Select_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + call_put_four_hundred_Select_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_call_put_four_hundred_Select_double_iron_fly.length) {
                  closest_call_put_four_hundred_Select_double_iron_fly
                    .find("#Auto_puts_short_click , #Auto_calls_short_click")
                    .data("HI1", "HI2there")
                    .click();
                }

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closest_call_spot_strikeSelect_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + call_spot_strikeSelect_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_call_spot_strikeSelect_double_iron_fly.length) {
                  closest_call_spot_strikeSelect_double_iron_fly
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI3There")
                    .click();
                }

                var closest_put_positive_four_hundred_strikeSelect_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + put_positive_four_hundred_strikeSelect_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_put_positive_four_hundred_strikeSelect_double_iron_fly.length) {
                  closest_put_positive_four_hundred_strikeSelect_double_iron_fly
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI4there")
                    .click();
                }

                var closest_call_put_positive_eight_hundred_strikeSelect_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + call_put_positive_eight_hundred_strikeSelect_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_call_put_positive_eight_hundred_strikeSelect_double_iron_fly.length) {
                  closest_call_put_positive_eight_hundred_strikeSelect_double_iron_fly
                    .find("#Auto_puts_short_click , #Auto_calls_short_click")
                    .data("HI1", "HI5there")
                    .click();
                }


                var closest_call_twelve_hundred_positive_strikeSelect_double_iron_fly = optionChainTable
                  .find(".strike_price:contains(" + call_twelve_hundred_positive_strikeSelect_double_iron_fly + ")")
                  .closest(".call_put_tr");
                if (closest_call_twelve_hundred_positive_strikeSelect_double_iron_fly.length) {
                  closest_call_twelve_hundred_positive_strikeSelect_double_iron_fly
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI6there")
                    .click();
                }








                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_double_iron_fly").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "double_iron_fly");
                calculate_data();
                $("#double_iron_fly_modal").hide();
                Table_chart_pyoff()
              });
            }
            else if (filter_arg_strategy === "double_iron_condor") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();
              $("#double_iron_fly_modal").hide();
              $("#double_iron_condor_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice

              var closest_strike_price = $("#closest_strike_price").text();
              $("#spot_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              var prev4 = [];
              var prev8 = [];
              var prev12 = [];
              var prev16 = [];

              for (var i = currentIndex - 1; i >= 0 && (prev4.length < 4 || prev8.length < 8 || prev12.length < 12 || prev16.length < 16); i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev4.length < 4) {
                    prev4.push(rowStrikePrice);
                  }
                  if (prev8.length < 8) {
                    prev8.push(rowStrikePrice);
                  }
                  if (prev12.length < 12) {
                    prev12.push(rowStrikePrice);
                  }
                  if (prev16.length < 16) {
                    prev16.push(rowStrikePrice);
                  }
                }
              }


              $("#spot_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev4[prev4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              $("#put_negative_fifty_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev8[prev8.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });


              $("#put_negative_two_hundred_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev12[prev12.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#negative_three_hundred_fifty_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev16[prev16.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });







              var forw4 = [];
              var forw8 = [];
              var forw12 = [];
              var forw16 = [];

              for (var j = currentIndex + 1; j < strikePrices.length && (forw4.length < 4 || forw8.length < 8 || forw12.length < 12 || forw16.length < 16); j++) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw4.length < 4) {
                    forw4.push(rowStrikePrice);
                  }
                  if (forw8.length < 8) {
                    forw8.push(rowStrikePrice);
                  }
                  if (forw12.length < 12) {
                    forw12.push(rowStrikePrice);
                  }
                  if (forw16.length < 16) {
                    forw16.push(rowStrikePrice);
                  }
                }
              }


              $("#call_positive_three_hundred_fifty_strikeSelect_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw4[forw4.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_positive_five_hundred_strikeSelect_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw8[forw8.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_positive_six_hundred_fifty_strikeSelect_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw12[forw12.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });
              $("#call_positive_eight_hundred_strikeSelect_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw16[forw16.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });




              // console.log("Next 4 Strike Prices:", forw4);
              // console.log("Next 2 Strike Prices:", forw2);

              // console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_jaze_lizard = $("#expiryDate_double_iron_condor");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_jaze_lizard.on("change", function () {
                var selectedValue_jaze_lizard = $(this).val();
                // console.log(selectedValue_jaze_lizard);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_jaze_lizard).change();

                // Trigger a click event on the selected option
              });
              $("#shortdouble_iron_condor").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").addClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").removeClass("option_strategies_active");


                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var spot_Select_double_iron_condor = $("#spot_Select_double_iron_condor").val();
                var put_negative_fifty_Select_double_iron_condor = $("#put_negative_fifty_Select_double_iron_condor").val();
                var put_negative_two_hundred_Select_double_iron_condor = $("#put_negative_two_hundred_Select_double_iron_condor").val();
                var negative_three_hundred_fifty_Select_double_iron_condor = $("#negative_three_hundred_fifty_Select_double_iron_condor").val();

                var call_positive_three_hundred_fifty_strikeSelect_double_iron_condor = $("#call_positive_three_hundred_fifty_strikeSelect_double_iron_condor").val();
                var call_positive_five_hundred_strikeSelect_double_iron_condor = $("#call_positive_five_hundred_strikeSelect_double_iron_condor").val();
                var call_positive_six_hundred_fifty_strikeSelect_double_iron_condor = $("#call_positive_six_hundred_fifty_strikeSelect_double_iron_condor").val();
                var call_positive_eight_hundred_strikeSelect_double_iron_condor = $("#call_positive_eight_hundred_strikeSelect_double_iron_condor").val();


                var closest_spot_Select_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + spot_Select_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_spot_Select_double_iron_condor.length) {
                  closest_spot_Select_double_iron_condor
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1there")
                    .click();
                }

                var closest_put_negative_fifty_Select_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + put_negative_fifty_Select_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_put_negative_fifty_Select_double_iron_condor.length) {
                  closest_put_negative_fifty_Select_double_iron_condor
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI2there")
                    .click();
                }

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closest_put_negative_two_hundred_Select_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + put_negative_two_hundred_Select_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_put_negative_two_hundred_Select_double_iron_condor.length) {
                  closest_put_negative_two_hundred_Select_double_iron_condor
                    .find("#Auto_puts_short_click")
                    .data("HI1", "HI3There")
                    .click();
                }

                var closest_negative_three_hundred_fifty_Select_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + negative_three_hundred_fifty_Select_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_negative_three_hundred_fifty_Select_double_iron_condor.length) {
                  closest_negative_three_hundred_fifty_Select_double_iron_condor
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI4there")
                    .click();
                }

                var closest_call_positive_three_hundred_fifty_strikeSelect_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + call_positive_three_hundred_fifty_strikeSelect_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_call_positive_three_hundred_fifty_strikeSelect_double_iron_condor.length) {
                  closest_call_positive_three_hundred_fifty_strikeSelect_double_iron_condor
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI5there")
                    .click();
                }


                var closest_call_positive_five_hundred_strikeSelect_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + call_positive_five_hundred_strikeSelect_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_call_positive_five_hundred_strikeSelect_double_iron_condor.length) {
                  closest_call_positive_five_hundred_strikeSelect_double_iron_condor
                    .find("#Auto_calls_short_click")
                    .data("HI1", "HI6there")
                    .click();
                }
                var closest_call_positive_six_hundred_fifty_strikeSelect_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + call_positive_six_hundred_fifty_strikeSelect_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_call_positive_six_hundred_fifty_strikeSelect_double_iron_condor.length) {
                  closest_call_positive_six_hundred_fifty_strikeSelect_double_iron_condor
                    .find("#Auto_calls_short_click")
                    .data("HI1", "HI7there")
                    .click();
                }
                var closest_call_positive_eight_hundred_strikeSelect_double_iron_condor = optionChainTable
                  .find(".strike_price:contains(" + call_positive_eight_hundred_strikeSelect_double_iron_condor + ")")
                  .closest(".call_put_tr");
                if (closest_call_positive_eight_hundred_strikeSelect_double_iron_condor.length) {
                  closest_call_positive_eight_hundred_strikeSelect_double_iron_condor
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI8there")
                    .click();
                }








                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_double_iron_condor").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "double_iron_condor");
                calculate_data();
                $("#double_iron_condor_modal").hide();
                Table_chart_pyoff()
              });
            }


            else if (filter_arg_strategy === "put_butter_fly") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();
              $("#double_iron_fly_modal").hide();
              $("#double_iron_condor_modal").hide();
              $("#call_butter_fly_modal").hide();
              $("#put_butterfly_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice

              var closest_strike_price = $("#closest_strike_price").text();
              $("#spot_Select_double_iron_condor")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(closest_strike_price)) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              var prev19 = [];
              var prev10 = [];
              var prev1 = [];


              for (var i = currentIndex - 1; i >= 0 && (prev19.length < 19 || prev10.length < 10 || prev1.length < 1); i--) {
                var rowStrikePrice = strikePrices[i];
                if (!isNaN(rowStrikePrice)) {
                  if (prev19.length < 19) {
                    prev19.push(rowStrikePrice);
                  }
                  if (prev10.length < 10) {
                    prev10.push(rowStrikePrice);
                  }
                  if (prev1.length < 1) {
                    prev1.push(rowStrikePrice);
                  }

                }
              }


              $("#put_negative_nine_hundred_fifty_Select_put_butterfly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev19[prev19.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              $("#five_hundred_put_call_Select_put_butterfly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev10[prev10.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });


              $("#put_negative_fifty_Select_put_butterfly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(prev1[prev1.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });





              // console.log("Next 4 Strike Prices:", forw4);
              // console.log("Next 2 Strike Prices:", forw2);

              // console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_put_butterfly = $("#expiryDate_put_butterfly");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_put_butterfly.on("change", function () {
                var selectedValue_put_butterfly = $(this).val();
                // console.log(selectedValue_put_butterfly);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_put_butterfly).change();

                // Trigger a click event on the selected option
              });
              $("#shortput_butterfly").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#call_butter_fly").removeClass("option_strategies_active");

                $("#put_butter_fly").addClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var put_negative_nine_hundred_fifty_Select_put_butterfly = $("#put_negative_nine_hundred_fifty_Select_put_butterfly").val();
                var five_hundred_put_call_Select_put_butterfly = $("#five_hundred_put_call_Select_put_butterfly").val();
                var put_negative_fifty_Select_put_butterfly = $("#put_negative_fifty_Select_put_butterfly").val();



                var closest_put_negative_nine_hundred_fifty_Select_put_butterfly = optionChainTable
                  .find(".strike_price:contains(" + put_negative_nine_hundred_fifty_Select_put_butterfly + ")")
                  .closest(".call_put_tr");
                if (closest_put_negative_nine_hundred_fifty_Select_put_butterfly.length) {
                  closest_put_negative_nine_hundred_fifty_Select_put_butterfly
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1there")
                    .click();
                }

                var closest_five_hundred_put_call_Select_put_butterfly = optionChainTable
                  .find(".strike_price:contains(" + five_hundred_put_call_Select_put_butterfly + ")")
                  .closest(".call_put_tr");
                if (closest_five_hundred_put_call_Select_put_butterfly.length) {
                  closest_five_hundred_put_call_Select_put_butterfly
                    .find("#Auto_puts_short_click ,#Auto_calls_short_click")
                    .data("HI1", "HI2there")
                    .click();
                }

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closest_put_negative_fifty_Select_put_butterfly = optionChainTable
                  .find(".strike_price:contains(" + put_negative_fifty_Select_put_butterfly + ")")
                  .closest(".call_put_tr");
                if (closest_put_negative_fifty_Select_put_butterfly.length) {
                  closest_put_negative_fifty_Select_put_butterfly
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI3There")
                    .click();
                }








                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_put_butterfly").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "double_put_butterfly");
                calculate_data();
                $("#put_butterfly_modal").hide();
                Table_chart_pyoff()
              });
            }
            else if (filter_arg_strategy === "call_butter_fly") {
              $("#straddle_modal").hide();
              $("#strangle_modal").hide();
              $("#spread_modal").hide();
              $("#ironFly_modal").hide();
              $("#ironCondor_modal").hide();
              $("#jaze_lizard_modal").hide();
              $("#double_iron_fly_modal").hide();
              $("#double_iron_condor_modal").hide();
              $("#put_butterfly_modal").hide();
              $("#call_butter_fly_modal").show();

              // Ensure you are selecting the correct elements with .strike_price
              var strikePrices = optionChainTable
                .find(".strike_price")
                .map(function () {
                  return parseFloat($(this).text());
                })
                .get();

              // Find the index of the row where strikePrice is closestStrikePrice

              var closest_strike_price = $("#closest_strike_price").text();

              var currentIndex = strikePrices.indexOf(closestStrikePrice);

              var forw10 = [];
              var forw19 = [];
              var forw1 = [];

              for (var j = currentIndex + 1; j < strikePrices.length && (forw10.length < 10 || forw19.length < 19 || forw1.length < 1); j++) {
                var rowStrikePrice = strikePrices[j];
                if (!isNaN(rowStrikePrice)) {
                  if (forw10.length < 10) {
                    forw10.push(rowStrikePrice);
                  }
                  if (forw19.length < 19) {
                    forw19.push(rowStrikePrice);
                  }
                  if (forw1.length < 1) {
                    forw1.push(rowStrikePrice);
                  }

                }
              }



              $("#put_positive_fifty_Select_call_butter_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw1[forw1.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });

              $("#four_hundred_put_call_Select_call_butter_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw10[forw10.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });


              $("#positive_seven_hundred_fifty_Select_call_butter_fly")
                .find("option")
                .each(function () {
                  var optionValue = parseFloat($(this).val());

                  if (optionValue === parseFloat(forw19[forw19.length - 1])) {
                    // console.log(optionValue, closest_strike_price);
                    $(this).prop("selected", true);
                  }
                });





              // console.log("Next 4 Strike Prices:", forw4);
              // console.log("Next 2 Strike Prices:", forw2);

              // console.log("Previous 4 Strike Prices:", prev4);
              // Get the values of lastIndexPrev and lastIndexForw

              var expiryDate_call_butter_fly = $("#expiryDate_call_butter_fly");
              var optionExpiryDropdown = $("#optionExpiryDropdown");

              expiryDate_call_butter_fly.on("change", function () {
                var selectedValue_put_butterfly = $(this).val();
                // console.log(selectedValue_put_butterfly);

                // Set the value of optionExpiryDropdown to match the selected value
                optionExpiryDropdown.val(selectedValue_put_butterfly).change();

                // Trigger a click event on the selected option
              });
              $("#shortcall_butter_fly").click(function () {
                $("#straddle").removeClass("option_strategies_active");
                $("#strangle").removeClass("option_strategies_active");
                $("#iron_fly").removeClass("option_strategies_active");
                $("#spread").removeClass("option_strategies_active");
                $("#iron_condor").removeClass("option_strategies_active");
                $("#jaze_lizard").removeClass("option_strategies_active");
                $("#double_iron_fly").removeClass("option_strategies_active");
                $("#double_iron_condor").removeClass("option_strategies_active");
                $("#put_butter_fly").removeClass("option_strategies_active");
                $("#call_butter_fly").addClass("option_strategies_active");

                $(".data-display-table").empty();
                $("#table-PL").empty();
                $("#resultTable tbody").empty();
                $(".inner_p_l_greeks").show();
                $(".main_position").empty();


                var put_positive_fifty_Select_call_butter_fly = $("#put_positive_fifty_Select_call_butter_fly").val();
                var four_hundred_put_call_Select_call_butter_fly = $("#four_hundred_put_call_Select_call_butter_fly").val();
                var positive_seven_hundred_fifty_Select_call_butter_fly = $("#positive_seven_hundred_fifty_Select_call_butter_fly").val();



                var closest_put_positive_fifty_Select_call_butter_fly = optionChainTable
                  .find(".strike_price:contains(" + put_positive_fifty_Select_call_butter_fly + ")")
                  .closest(".call_put_tr");
                if (closest_put_positive_fifty_Select_call_butter_fly.length) {
                  closest_put_positive_fifty_Select_call_butter_fly
                    .find("#Auto_puts_long_click")
                    .data("HI1", "HI1there")
                    .click();
                }

                var closest_four_hundred_put_call_Select_call_butter_fly = optionChainTable
                  .find(".strike_price:contains(" + four_hundred_put_call_Select_call_butter_fly + ")")
                  .closest(".call_put_tr");
                if (closest_four_hundred_put_call_Select_call_butter_fly.length) {
                  closest_four_hundred_put_call_Select_call_butter_fly
                    .find("#Auto_puts_short_click ,#Auto_calls_short_click")
                    .data("HI1", "HI2there")
                    .click();
                }

                // Find the closest row for lastIndexPrev and click on Auto_puts_short_click

                // Find the closest row for lastIndexForw and click on Auto_calls_short_click
                var closest_positive_seven_hundred_fifty_Select_call_butter_fly = optionChainTable
                  .find(".strike_price:contains(" + positive_seven_hundred_fifty_Select_call_butter_fly + ")")
                  .closest(".call_put_tr");
                if (closest_positive_seven_hundred_fifty_Select_call_butter_fly.length) {
                  closest_positive_seven_hundred_fifty_Select_call_butter_fly
                    .find("#Auto_calls_long_click")
                    .data("HI1", "HI3There")
                    .click();
                }








                // Click on #calculate after a longer delay

                var counterInputValue = $("#counter_input_call_butter_fly").val();
                $(".option_lot_size_input").text(counterInputValue);
                localStorage.setItem("strategy_builder", "call_butterfly");
                calculate_data();
                $("#call_butter_fly_modal").hide();
                Table_chart_pyoff()
              });
            }






          }

          // Common function to handle strategy button click
          function attachButtonClickEvent($button, strategy) {
            $button.off("click").on("click", function () {
              selectStrategy(strategy);
            });
          }

          // Attach click event handlers to strategy buttons
          attachButtonClickEvent($("#shortStraddle"), "straddle");
          attachButtonClickEvent($("#strangle"), "strangle");
          attachButtonClickEvent($("#iron_fly"), "iron_fly");
          attachButtonClickEvent($("#spread"), "spread");
          attachButtonClickEvent($("#iron_condor"), "iron_condor");
          attachButtonClickEvent($("#jaze_lizard"), "jaze_lizard");
          attachButtonClickEvent($("#double_iron_fly"), "double_iron_fly");
          attachButtonClickEvent($("#double_iron_condor"), "double_iron_condor");
          attachButtonClickEvent($("#put_butter_fly"), "put_butter_fly");
          attachButtonClickEvent($("#call_butter_fly"), "call_butter_fly");

          var isTableEmpty = true;

          $(".put_call_btns").click(function () {
            if (isTableEmpty) {
              $(".data-display-table").empty();
              isTableEmpty = false;
            }
            var row = $(this).closest("tr"); // Find the closest table row
            var action = $(this).attr("data-action"); // Get the action (Short/Long) from the button's data attribute
            var side = $(this).attr("data-side"); // Get the side (Call/Put) from the button's data attribute

            var ltpValue =
              side === "call"
                ? row.find(".calls_ltp").text()
                : row.find(".puts_ltp").text();

            // Now you can access the data from the row and log it as needed
            if (side === "call") {
              var calls_iv = row.find(".text-end").eq(0).text();
              var calls_oi = row.find(".text-end").eq(1).text();
              var expiry_date = row.find(".expiry_date").text();
              var strike_price = row.find(".strike_price").text();
              var opiton_lot_size = row.find(".opiton_lot_size").text();
              var opiton_selected = row.find(".opiton_selected").text();
              var option_side = "Call";

              // console.log(option_side);
              // console.log("Call Side - Action:", action);
              // console.log("Call Side - calls_iv:", calls_iv);
              // console.log("Call Side - calls_oi:", calls_oi);
              // console.log("Call Side - calls_ltp:", ltpValue);
              // console.log("Call Side - strike_price:", strike_price);
              // console.log(expiry_date);
              // console.log(opiton_lot_size);
              populateInputTable(
                option_side,
                expiry_date,
                strike_price,
                action,
                opiton_lot_size,
                ltpValue,
                opiton_selected
              );
            } else {
              var option_side = "Put";
              var puts_oi = row.find(".text-start").eq(1).text();
              var puts_iv = row.find(".text-start").eq(2).text();
              var expiry_date = row.find(".expiry_date").text();
              var strike_price = row.find(".strike_price").text();
              var opiton_lot_size = row.find(".opiton_lot_size").text();
              var opiton_selected = row.find(".opiton_selected").text();
              // console.log(option_side);
              // console.log("Put Side - Action:", action);
              // console.log("Put Side - puts_ltp:", ltpValue);
              // console.log("Put Side - puts_oi:", puts_oi);
              // console.log("Put Side - puts_iv:", puts_iv);
              // console.log(expiry_date);
              // console.log(opiton_lot_size);
              // console.log(strike_price);
              populateInputTable(
                option_side,
                expiry_date,
                strike_price,
                action,
                opiton_lot_size,
                ltpValue,
                opiton_selected
              );
            }
            $(".inner_p_l_greeks").show();
            if ($(this).data("HI1") === undefined) {
              console.log("Yes");
              // Remove the "HI1" data attribute

              calculate_data();
            } else {
              console.log("No");
              $(this).removeData("HI1");
            }
            checkMainPositionContent();

          });

          var positions = 1;
          var positions_input = 1;
          $(".add-btn").off("click");
          $(".add-btn").click(function (event) {
            event.preventDefault(); // Prevent default behavior

            var selectedOption = $("#stockDropdown").val();
            loadExpiryData(selectedOption);

            var newRow = $("<tr>").addClass("strategy_table_input");

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="optionSide">Option Side</label>
                    <select class="option_side_input form-select">
                     
                        <option value="Call">Call</option>
                        <option value="Put">Put</option>
                       
                    </select>
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="expiryDate">Expiry Date</label>
                    <select class="expiry_date_input form-select">
                    
                        <option value=""></option>
                    </select>
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="strikePrice">Strike Price</label>
                    <select class="strike_price_input form-select">
                     
                        <option value=""></option>
                    </select>
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="action">Position</label>
                    <select class="action_input form-select">
                     
                        <option value="Short">Short</option>
                        <option value="Long">Long</option>
                    </select>
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="optionLots">Option Lot Size</label>
                    <input type="number" class="option_lot_size_input form-control">
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`
                <div class="textOnInput">
                    <label for="ltpValue">LTP Value</label>
                    <input type="number" class="ltpValue_input form-control" value="">
                </div>
            `)
            );

            newRow.append(
              $("<td>").html(`   <i class="delete-btn bi bi-trash-fill"></i>`)
            );

            $(".data-display-table").append(newRow);
          });

          function populateInputTable(
            option_side,
            expiry_date,
            strike_price,
            action,
            option_lot_size,
            ltpValue,
            opiton_selected
          ) {
            // console.log("Option Side:", option_side);
            // console.log("Expiry Date:", expiry_date);
            // console.log("Strike Price:", strike_price);
            // console.log("Action:", action);

            // console.log("Option Lot Size:", option_lot_size);
            // console.log("LTP Value:", ltpValue);
            // console.log("opiton_selected:", opiton_selected);
            var parsedDate = new Date(expiry_date);
            var day = parsedDate.getDate().toString().padStart(2, "0");
            var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
            var year = parsedDate.getFullYear();
            var formattedDate_initial = day + "-" + month + "-" + year;

            function formatDate(inputDate) {
              const dateParts = inputDate.split("-"); // Split the input date by hyphen
              const day = dateParts[0]; // Extract day
              const month = dateParts[1]; // Extract month
              const year = dateParts[2]; // Extract year

              // Create an array of month abbreviations
              const monthAbbreviations = [
                "JAN",
                "FEB",
                "MAR",
                "APR",
                "MAY",
                "JUN",
                "JUL",
                "AUG",
                "SEP",
                "OCT",
                "NOV",
                "DEC",
              ];

              // Get the abbreviated month using the month value as an index
              const abbreviatedMonth = monthAbbreviations[parseInt(month) - 1];

              // Create the formatted date string
              const formattedDate = `${day}${abbreviatedMonth}${year}`;

              return formattedDate;
            }

            const inputDate = formattedDate_initial;
            const formattedDate = formatDate(inputDate);

            // console.log(formattedDate); // Output: "14SEP"
            var stockDropdown = $("#stockDropdown").val();
            // +1x NIFTY07SEP 19350CE -  125.3 (0.00)
            var add_position = $(`
                                    <div class="main_add_position_actions d-flex justify-content-between" id=${positions++}>
                                        <div class="inner_position d-flex gap-1">
                                          <div class="${action === "Long" ? "bg_indicator_buy" : "bg_indicator_sell"}" > ${action === "Long" ? "B" : "S"}</div>
                                            <div class="main_short_long_lot_size">
                                            <div class="short_long"><span class="long_short_inner">${action === "Long" ? "+" : "-"
              }</span></div> <div class="option_lot_size_input">1</div>x
                                        </div>
                                        <div class="symbol_expiry"><span class="symbol">${stockDropdown}</span><span class="expiry">${formattedDate}</span><span class="expiry_initial" style="display:none">${expiry_date}</span></div>
                                        <div class="strike_price_call_put"> <span class="strikePrice">${parseFloat(
                strike_price
              )}</span><span class="call_put_entrance">${option_side === "Call" ? "CE" : "PE"
              }</span></div>
                                        <div class="ltp_main">-<span class="entryPrice">${parseFloat(
                ltpValue
              )}</span>(<span class="exit_price">0</span>) <span class="current_price">0</span></div></div>

                                        <div class="action_option_strategy d-flex justify-content-center align-items-center gap-1">
                                                    <i class="bi bi-pencil-square edit-button" data-bs-toggle="modal" data-bs-target="#editPositionModal"></i>
                                                    <i class="bi bi-trash-fill delete-button dlt-btn" id="delete-btn"></i>
                                                    <i class='green-option-indicator exit_indicator'></i>
                                                </div>
                                            
                                            
                                            </div>

                                    `);

            $(".main_position").append(add_position);

            $(".dlt-btn").click(function () {
              // Find the closest parent element with class main_add_position_actions
              var main_add_position_actions = $(this).closest(
                ".main_add_position_actions"
              );

              // Get the id attribute from the found element
              var idValue = main_add_position_actions.attr("id");

              // Remove the clicked element
              main_add_position_actions.remove();
              $("#table-PL")
                .find("tr#" + idValue)
                .remove();
              $("#resultTable tbody")
                .find("tr#" + idValue)
                .remove();
              $(".data-display-table")
                .find("tr#" + idValue)
                .remove();

              var childrenLength = $(".main_position").children().length;
              //console.log("Children length in #myTable:", childrenLength);

              // Check if #myTable has no child elements
              if (childrenLength < 1) {
                // If it has no children, hide .main_table_instruments_data
                $(".inner_p_l_greeks").hide();
                $(".straddle").removeClass("option_strategies_active");
              } else {
                calculate_data();
              }
              Table_chart_pyoff()

              // Output the id value to the console
              // console.log(idValue);
            });

            $(".edit-button").on("click", function (event) {
              event.stopPropagation();
              // console.log('Hii there');

              var position = $(this).closest(".main_add_position_actions");
              var option_lot_size_input = position
                .find(".option_lot_size_input")
                .text();
              var expiry_initial = position.find(".expiry_initial").text();
              var strikePrice = position.find(".strikePrice").text();
              var call_put_entrance = position
                .find(".call_put_entrance")
                .text();

              var long_short_inner = position.find(".long_short_inner").text();

              // Check the appropriate radio button based on long_short_inner
              if (long_short_inner === "+") {
                $("#long_radio").prop("checked", true);
              } else if (long_short_inner === "-") {
                $("#short_radio").prop("checked", true);
              }

              var selectStrikePrice = $("#selectStrikePrice");

              selectStrikePrice.find("option").each(function () {
                // Get the value of the current option
                var optionValue = $(this).val();

                // Check if the option value matches the value of closest_strike_price
                if (optionValue === strikePrice) {
                  // Add the 'selected' attribute to the matching option
                  $(this).prop("selected", true);
                }
              });

              var optionType = $("#optionType");

              optionType.find("option").each(function () {
                // Get the value of the current option
                var optionValue = $(this).val();

                // Check if the option value matches the value of closest_strike_price
                if (optionValue === call_put_entrance) {
                  // Add the 'selected' attribute to the matching option
                  $(this).prop("selected", true);
                }
              });
              // console.log(expiry_initial);
              var selectExpiry = $("#selectExpiry");

              selectExpiry.find("option").each(function () {
                // Get the value of the current option
                var expiryDate = $(this).val();
                // console.log(expiryDate);

                // Check if the option value matches the value of closest_strike_price
                if (expiryDate === expiry_initial) {
                  // Add the 'selected' attribute to the matching option
                  $(this).prop("selected", true);
                }
              });

              // Use a more specific selector for entryPrice
              var entryPrice = position.find(".entryPrice").first().text();
              $(".edit_entry ").val(entryPrice);

              var exit_price = position.find(".current_price").first().text();
              $(".exit_price").val(exit_price);

              $("#counter_input_edit").val(option_lot_size_input);

              // console.log(entryPrice);

              function Edit_counter() {
                var counterValue = position
                  .find(".option_lot_size_input")
                  .text();

                // Function to update the input field with the current value
                function updateCounterInput() {
                  $("#counter_input_edit").val(counterValue);
                }

                // Initialize the input field
                updateCounterInput();

                // Increment button click handler
                $("#increment_edit").click(function () {
                  counterValue++;
                  updateCounterInput();
                });

                // Decrement button click handler
                $("#decrement_edit").click(function () {
                  if (counterValue > 1) {
                    counterValue--;
                    updateCounterInput();
                  }
                });
              }

              $("#editPositionModal").data("position", position);
              // console.log($('#editPositionModal').data('position', position));

              Edit_counter();
            });
          }
          // Add a click event handler to the delete-button
        },
      });
    }


    loadStocks();

    loadExpiryData("NIFTY");

    loadOptionData("NIFTY", "");
    loadOptionData(selectedOption, selectedExpiry);
    function loadExpiryData(selectedOption) {
      // console.log("Hi there" + selectedOption);
      $.ajax({
        url: "/option_strategies_expiry",
        method: "GET",
        data: {
          selected_option: selectedOption,
        },
        success: function (response) {
          // Process the response from the server here

          var expiryDates = response.option_date.optionExpiryDate;
          var expiryStrikes = response.option_strike;
          populateExpiry_Strike(expiryDates, expiryStrikes);
        },
        error: function (error) {
          console.error("Error loading expiry data:", error);
        },
      });
    }

    function populateExpiry_Strike(expiryDates, expiryStrikes) {
      // Get the existing selected values before appending new options
      // console.log('Log Expiry');

      // Add each expiry date as an option without duplicates
      var addedExpiryDates = [];
      $(".expiry_date_input option").each(function () {
        addedExpiryDates.push(this.value);
      });

      expiryDates.forEach((expiry) => {
        var inputDate = expiry.expiry_date.split("T")[0];
        if (!addedExpiryDates.includes(inputDate)) {
          addedExpiryDates.push(inputDate);
          var parsedDate = new Date(inputDate);
          var day = parsedDate.getDate().toString().padStart(2, "0");
          var month = (parsedDate.getMonth() + 1).toString().padStart(2, "0");
          var year = parsedDate.getFullYear();
          var formattedDate = day + "-" + month + "-" + year;

          $(".expiry_date_input").append(
            $("<option>", {
              value: inputDate, // You can keep the original value or use formattedDate if needed
              text: formattedDate,
            })
          );
        }
      });

      // Add each strike as an option without duplicates
      var addedStrikes = [];
      $(".strike_price_input option").each(function () {
        addedStrikes.push(parseInt(this.value));
      });
      // console.log(addedStrikes);
      expiryStrikes.forEach((strike) => {
        if (!addedStrikes.includes(strike)) {
          addedStrikes.push(strike);
          $(".strike_price_input").append(
            $("<option>", {
              value: strike,
              text: strike,
            })
          );
        }
      });
    }

    function loadStocks(selectedOption) {
      $.ajax({
        url: '{% url "get_stock_symbol" %}',
        type: "GET",
        success: function (data) {
          var stocksOptgroup = $("#stockDropdown optgroup[label='Stocks']");
          stocksOptgroup.empty();
          $.each(data, function (index, stock) {
            var option = $("<option>").text(stock.symbol_name);
            stocksOptgroup.append(option);
          });

          // If a selectedOption is provided, set it as selected
          if (selectedOption) {
            $("#stockDropdown").val(selectedOption);
          }
        },
      });
    }



    function Table_chart_pyoff() {


      var main_strike_price_dynamic = []
      $(".main_add_position_actions").each(function () {

        var lot_size_value = $("#lot_size_value").text()

        var long_shorts = $(this).find(".long_short_inner").text()
        var strikePrice_edit = $(this).find(".strikePrice").text()
        var premiums = $(this).find(".entryPrice").text()


        var requiredStringValue = $(this).find(".call_put_entrance").text()
        var final_strikePrice_edit = parseFloat(strikePrice_edit)
        var final_premiums = parseFloat(premiums)


        main_strike_price_dynamic.push({ final_strikePrice_edit, long_shorts, premiums, requiredStringValue })
      });
      // console.log( "main_strike_price_dynamic",main_strike_price_dynamic);



      // final_long_call_new.push(MAX(0, strike_price -spot_strike ) - long_call);
      //     final_long_put_new.push( MAX(0, spot_strike -strike_price )-long_put );


      var resultArray = []; // Array to hold arrays

      var lot_size = parseInt($("#lot_size_value").text())

      var option_simulator_body = $(".strategy_option_chain");

      function ULTRAMAX(a, b) {
        return a > b ? a : b;
      }


      option_simulator_body.find(".strike_price").each(function () {
        var ultra_strike_price = parseInt($(this).text());

        // console.log("ultra_strike_price         "  + ultra_strike_price);


        var tempArray = []; // Temporary array to store values
        main_strike_price_dynamic.forEach(function (item) {
          if (item.requiredStringValue === 'CE' && item.long_shorts === '+') {
            console.log('Inside CE and + condition');
            console.log(parseFloat(item.final_strikePrice_edit));
            console.log(parseFloat(item.premiums));
            console.log(ultra_strike_price);
            tempArray.push(ULTRAMAX(0, ultra_strike_price - parseFloat(item.final_strikePrice_edit)) - parseFloat(item.premiums));
          }
          if (item.requiredStringValue === 'CE' && item.long_shorts === '-') {
            // console.log('Inside CE and - condition');
            tempArray.push(parseFloat(item.premiums) - ULTRAMAX(0, ultra_strike_price - parseFloat(item.final_strikePrice_edit)));
          }
          if (item.requiredStringValue === 'PE' && item.long_shorts === '+') {
            // console.log('Inside PE and + condition');
            tempArray.push(ULTRAMAX(0, parseFloat(item.final_strikePrice_edit) - ultra_strike_price) - parseFloat(item.premiums));
          }
          if (item.requiredStringValue === 'PE' && item.long_shorts === '-') {
            // console.log('Inside PE and - condition');
            tempArray.push(parseFloat(item.premiums) - ULTRAMAX(0, parseFloat(item.final_strikePrice_edit) - ultra_strike_price));
          }
        });
        // console.log(tempArray);
        resultArray.push(tempArray); // Push the tempArray into the resultArray
      });

      console.log(resultArray);


      var sumArray = []; // Array to store the sums

      // Looping through each array in resultArray to calculate the sum
      resultArray.forEach(function (array) {
        var sum = 0;
        array.forEach(function (value) {
          sum += value; // Adding each value to the sum
        });
        sum *= lot_size; // Multiplying the sum by lot_size
        sumArray.push(sum); // Pushing the sum into the sumArray
      });

      // Logging the sums of each array in resultArray multiplied by lot_size
      console.log(sumArray);

      console.log(Math.min(...sumArray));
      console.log(Math.max(...sumArray));
      $("#max_profit").text(Math.max(...sumArray).toFixed(2));
      $("#max_loss").text(Math.min(...sumArray).toFixed(2));

      // Calculate and set the ratio
      var ratio = Math.max(...sumArray) / Math.min(...sumArray);
      $("#ratio").text(ratio.toFixed(2));







      var all_premium_chart = []
      $(".main_logic").each(function () {
        var premium_condition = $(this).find(".short_long").text()
        var premuim_values = parseFloat($(this).find(".ltp_edit").text())
        // console.log(premium_condition);
        if (premium_condition === "-") {
          all_premium_chart.push(-Math.abs(premuim_values))
        } else {
          all_premium_chart.push(Math.abs(premuim_values))

        }
      })
      // console.log(all_premium_chart);

      var sum_all_premium_chart = all_premium_chart.reduce(function (a, b) {
        return a + b;
      }, 0);

      // console.log("Sum of all elements in all_premium_chart array: ", sum_all_premium_chart);
      // Your existing code to generate chart data goes here
      var option_simulator_body = $(".strategy_option_chain");
      // console.log(option_simulator_body);
      const closest_value = parseInt($(".closest_value").text()); // Parse closest_value as an integer
      // Create a new array to store strike prices
      var strikePrices = [];
      var main_calls_ltp = 0;
      var main_puts_ltp = 0;

      // Use the .each() method to iterate through elements with the class .simulator_strike
      option_simulator_body.find(".strike_price").each(function () {
        var strike_price = $(this).text(); // Get the text value of the current element
        strikePrices.push(strike_price); // Push it into the array
        console.log(strike_price);

        if (parseInt(strike_price) === closest_value) {
          var calls_ltp = $(this).closest('.call_put_tr').find(".calls_ltp").text();
          var puts_ltp = $(this).closest('.call_put_tr').find(".puts_ltp").text();
          main_calls_ltp = calls_ltp;
          main_puts_ltp = puts_ltp;
        }
      });














      // Define the MAX function
      function MAX(a, b) {
        return a > b ? a : b;
      }

      // Initialize arrays
      var final_long_call_new = [];
      var final_long_put_new = [];
      var addition_result = [];

      // Add the arrays








      // Loop through each element
      option_simulator_body.find(".simulator_strike").each(function () {








        var strike_price = parseInt($(this).text()); // Get the text value of the current element
        var spot_strike = 19800;
        var long_call = 113;
        var long_put = 111.3;
        // MAX(0,13650-14700)-136.8)
        // Calculate and push the values
        final_long_call_new.push(MAX(0, strike_price - spot_strike) - long_call);
        final_long_put_new.push(MAX(0, spot_strike - strike_price) - long_put);

        // Perform addition between the elements
        var index = final_long_call_new.length - 1;
        addition_result.push((final_long_call_new[index] + final_long_put_new[index]) * 50);
      });

      // Display the results
      // console.log("Final Long Call New: ", final_long_call_new);
      // console.log("Final Long Put New: ", final_long_put_new);
      // console.log("Addition Result: ", addition_result);







      // console.log(strikePrices);
      // console.log("Main calls_ltp: " + main_calls_ltp);
      // console.log("Main puts_ltp: " + main_puts_ltp);

      var final_p_l = []
      const priceDifferences = strikePrices.map((strikePrice) => Math.abs(closest_value - strikePrice));
      // console.log(priceDifferences);
      priceDifferences.forEach((p_l) => {
        final_p_l.push(-(sum_all_premium_chart - p_l) * parseInt(lot_size))
      });
      // console.log(final_p_l)

      var spot_price = $(".last_traded_price").text()

      // Add the following code to your Table_chart_pyoff function after the final_p_l array is populated
      var chart = am4core.create("chartdiv", am4charts.XYChart);

      // Add data
      var chartData = [];
      var tableData = []
      for (var i = 0; i < strikePrices.length; i++) {
        var cleanCategory = strikePrices[i].trim();
        tableData.push({ category: cleanCategory, value: sumArray[i] });
        chartData.push({ category: strikePrices[i], value: sumArray[i] });
      }

      console.log(tableData);
      var tableBody = $(".payoff_table_data");

      // Clear any existing rows
      tableBody.empty();

      // Loop through the tableData array and create table rows and cells
      tableData.forEach(function (item) {
        var main_payoff_table_condition = item.value < 0 ? "text-danger" : "text-success"
        var row = $("<tr>");

        var categoryCell = $("<td>").text(item.category);
        var valueCell = $("<td>").text(item.value.toFixed(2)).addClass(main_payoff_table_condition);

        row.append(categoryCell);
        row.append(valueCell);

        tableBody.append(row);
      });

      $(".payoff_expiry").text($("#optionExpiryDropdown").val())





      chart.data = chartData;

      // Create axes
      var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
      categoryAxis.dataFields.category = "category";
      categoryAxis.renderer.grid.template.location = 0;
      categoryAxis.renderer.minGridDistance = 100;
      chart.logo.disabled = true;
      var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

      // Draw a horizontal line at y-axis 0
      var zeroLine = valueAxis.axisRanges.create();
      zeroLine.value = 0;
      zeroLine.grid.stroke = am4core.color("#000"); // Color of the line
      zeroLine.grid.strokeWidth = 2; // Line width
      zeroLine.grid.strokeOpacity = 0.5; // Line opacity

      // Create series
      var series = chart.series.push(new am4charts.LineSeries());
      series.dataFields.valueY = "value";
      series.dataFields.categoryX = "category";
      series.strokeWidth = 2;
      series.minBulletDistance = 10;
      series.tooltipText = " StrikePrice:{category}   \n  P&L:{value}";

      series.strokeDasharray = "5,5"; // This sets the line as dashed with 5px dashes and 5px gaps
      series.tooltip.getFillFromObject = false;
      series.tooltip.background.fill = am4core.color("white"); // Set the tooltip background color to gray
      series.tooltip.background.stroke = am4core.color("#000000"); // Set the tooltip border color to black
      series.tooltip.background.strokeWidth = 1; // Set the tooltip border width
      series.tooltip.background.strokeOpacity = 0.4; // Set the tooltip border opacity
      series.tooltip.background.filters.push(new am4core.DropShadowFilter());
      series.tooltip.label.fill = am4core.color("#000000"); // Set the font color to black


      // Remove chart watermark


      var spot_price = parseFloat($(".last_traded_price").text()); // Get the spot price value as a float

      // Find the index of the spot price in the strikePrices array
      var spotIndex = strikePrices.indexOf(spot_price.toString());

      // Highlight the spot price on the chart
      if (spotIndex !== -1) {
        var range = categoryAxis.axisRanges.create();
        range.category = strikePrices[spotIndex];
        range.endCategory = strikePrices[spotIndex];
        range.axisFill.fill = am4core.color("#ff0000"); // Set the fill color to red
        range.axisFill.fillOpacity = 0.2; // Adjust the opacity of the fill
      }



      var range = valueAxis.createSeriesRange(series);
      range.value = 0;
      range.endValue = Infinity;

      range.contents.fill = am4core.color("rgba(0, 255, 0, 1.0)"); // Set the fill color above 0 to green with opacity

      range.contents.fillOpacity = 0.2; // Adjust the opacity of the fill

      var range2 = valueAxis.createSeriesRange(series);
      range2.value = -Infinity;
      range2.endValue = 0;

      range2.contents.fill = am4core.color("rgba(255, 0, 0, 1.0)"); // Set the fill color below 0 to red with opacity
      range2.contents.fillOpacity = 0.2; // Adjust the opacity of the fill



      // Set the tooltip appearance
      chart.tooltip.getFillFromObject = false;
      chart.tooltip.background.fill = am4core.color("#888888"); // Set the tooltip background color to gray
      chart.tooltip.background.stroke = am4core.color("#000000"); // Set the tooltip border color to black
      chart.tooltip.background.strokeWidth = 2; // Set the tooltip border width
      chart.tooltip.background.strokeOpacity = 0.8; // Set the tooltip border opacity
      chart.tooltip.background.filters.push(new am4core.DropShadowFilter()); // Add a slight shadow to the tooltip

      // Add scrollbar
      chart.scrollbarX = new am4core.Scrollbar();
      chart.scrollbarX.minHeight = 5;
      chart.scrollbarX.marginBottom = 15;
      chart.scrollbarX.thumbMinHeight = 100; // Adjust the value as per your requirement

      function customizeGrip(grip) {
        // This is empty for now
        grip.icon.disabled = true;

        grip.width = 10;
        grip.height = 20;
      }

      customizeGrip(chart.scrollbarX.startGrip);
      customizeGrip(chart.scrollbarX.endGrip);




      var bullet = series.bullets.push(new am4charts.CircleBullet());
      bullet.circle.stroke = am4core.color("#fff");
      bullet.circle.strokeWidth = 2;
      bullet.fillOpacity = 0;
      bullet.strokeOpacity = 0;
      bullet.circle.radius = 6; // Adjust this value to change the size of the bullet


      var bulletState = bullet.states.create("hover");
      bulletState.properties.fillOpacity = 1;
      bulletState.properties.strokeOpacity = 1;







      var cursor = new am4charts.XYCursor();
      cursor.lineX.stroke = am4core.color("black"); // set color for the X-axis cursor line
      cursor.lineY.stroke = am4core.color("#000"); // set color for the Y-axis cursor line
      cursor.lineX.strokeWidth = 2; // set width of the X-axis cursor line
      cursor.lineY.strokeWidth = 0; // set width of the Y-axis cursor line
      chart.cursor = cursor;

      // chart.scrollbarX = new am4core.Scrollbar();
      // chart.scrollbarX.position = "bottom"; // set the position of the scrollbar at the bottom of the chart


      // Make chart take up the entire space of its container
      chart.width = am4core.percent(100);
      chart.height = am4core.percent(100);


      // console.log('Hi');


    }



    // Select the elements
  });
</script>

{% endblock dashboard_body %}