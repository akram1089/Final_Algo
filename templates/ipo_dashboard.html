{% extends "base_dashboard.html" %}
{% load static %}
{% block dashboard_body %}
<style>
    .main_ipo_tables {
        box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
        padding: 1rem;
        border-radius: 10px;
    }

    .eventMainDiv {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        grid-gap: 11px;
    }

    .main_event_card {
        border: 0.2px solid lightgray;
        cursor: pointer;
        transition: ease-in-out;
    }

    .cal-item,
    .placeholder_main {
        text-align: center;
        padding: 10px;
        height: 6rem !important;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .ipo_table_head {
        font-size: 15px;
        font-weight: 700;
        color: #000;
        background-color: #eff9ff;
        border: none;
        padding: 10px;
        white-space: nowrap;
    }

    .table-box {
   
        border-radius: 17px;
        padding-top: 12px;
        padding-bottom: 12px !important;
    }

    .ipos {
        background-color: transparent;
        color: rgb(8, 139, 247);
        border: 1px solid rgb(8, 139, 247);
        padding: 4px 8px;
        border-radius: 3px;
    }

    .active {
        color: whitesmoke;
        background-color: rgb(8, 139, 247);
        border: 1px solid rgb(8, 139, 247);
        padding: 4px;
        border-radius: 3px;
    }

    .IPOnews-wq {
        display: inline-block;
        width: 49%;
        right: 12px;
        margin-right: 1%;
        margin-top: 19px;
        background: #fff 0 0 no-repeat padding-box;
        box-shadow: inset -10px -10px 20px rgba(4, 115, 233, .0784313725490196);
        border-radius: 28px;
        padding: 1rem;
        position: relative;
        right: auto;
        cursor: pointer;
 
    }
    .IPOnews-wq:hover {
  transform: scale(1.01);
  transition: transform 0.3s ease; /* This adds a smooth transition effect */
}

    .ipos_list {
        background-color: transparent;
        border: 1px solid rgb(8, 139, 247);
        color: rgb(8, 139, 247);
        padding: 5px 8px;
        border-radius: 6px;
    }

    .btn_active {
        border: 1px solid rgb(8, 139, 247);
        border-radius: 6px;
        background-color: rgb(8, 139, 247);
        padding: 5px 8px;
        color: white;
    }
    .main_event_card:hover, .main_event_card:focus{
        box-shadow: rgb(147 221 255 / 93%) 0px 1px 4px;
    border: 0.2px solid #4399eb;
    }

</style>
<style>
    .main_ipo_tables {
        box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
        padding: 1rem;
        border-radius: 10px;
    }

    .eventMainDiv {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        grid-gap: 11px;
    }

    .main_event_card {
        border: 0.2px solid lightgray;
        cursor: pointer;
        transition: ease-in-out;
    }

    .cal-item,
    .placeholder_main {
        text-align: center;
        padding: 10px;
        height: 6rem !important;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .main_event_card p {
        margin-bottom: 0 !important;
    }
    thead {
    padding: 10px 15px !important;
    font-size: 17px !important;
    background: #eff9ff;

    font-weight: bold !important;
    /* border-right: 1px solid var(--border-gray) !important; */
  }
  tbody tr {
    border-bottom: .5px solid #00000024 !important;
    font-size: 14px;
  
  }

</style>
<section class="pt-4">
    <div class="ipos_data">
        <h3>IPO Dashboard</h3>
    </div>
    <div class="main_ipo_tables">
        <div class="boxes_data">
            <div class="eventMainDiv" id="box">
                <div class="main_event_card ipo_return_button cal-item" data-bs-toggle="modal"
                    data-bs-target="#ipo_return_modal" style="background:#F6EDEB;">

                    <p class="CalFont">IPO Return</p>
                </div>

                <style>
                    .btn_bse_nse,
                    .right_ipo_day_filters button,
                    .best_performer_filter_btn button,
                    .main_draft_filter button {
                        color: #4399eb;
                        border: 1px solid #4399eb !important;
                        border: none;
                        padding: 5px 12px;
                        border-radius: 5px;
                        font-size: 15px;
                        margin-right: 9px;
                        background: white;
                        transition: ease-in-out;
                    }

                    .main_filter_ipo_return {
                        display: flex;
                        justify-content: space-between;
                    }

                    .right_ipo_day_filters_active,
                    .btn_bse_nse_active,
                    .best_performer_filter_btn_active,
                    .main_draft_filter_active,
                    .btn_bse_nse:hover,
                    .right_ipo_day_filters button:hover,
                    .main_draft_filter button:hover,
                    .best_performer_filter_btn button:hover {
                        background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
                        color: white !important;
                    }

                    .best_performer_filter_btn {
                        margin: 0 0 11px 0;

                    }
                </style>

                <!-- Modal -->
                <div class="modal fade" id="ipo_return_modal" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true" style="z-index: 9999999999999999  !important;">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">IPO Return</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="modal_inner_ipo_return">

                                    <div class="main_filter_ipo_return">
                                        <div class="left_nse_bse">
                                            <button class="btn_bse_nse right_ipo_day_filters_active"
                                                data-market="nse">NSE</button>
                                            <button class="btn_bse_nse" data-market="bse">BSE</button>
                                        </div>
                                        <div class="right_ipo_day_filters">
                                            <button class="btn_bse_nse_active" data-duration="1M">1M</button>
                                            <button data-duration="3M">3M</button>
                                            <button data-duration="6M">6M</button>
                                            <button data-duration="1Y">1Y</button>
                                            <button data-duration="3Y">3Y</button>
                                        </div>



                                    </div>

                                    <div class="main_ipo_return">

                                        <div id="chart-container" style="width: 100%; height: 400px;"></div>

                                    </div>



                                </div>
                            </div>
                          
                        </div>
                    </div>
                </div>














                <div class="main_event_card ipo_watch cal-item" style="background:#F6EDEB;">

                    <p class="CalFont">IPO Watch</p>
                </div>

                <div id="myModal" class="modal fade" tabindex="-1" style="z-index: 9999999999;">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">IPO Watch</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="ipo_watch_btns">
                                    <button class="ipos active" data-value="1">Upcoming IPO</button>
                                    <button class="ipos " data-value="2">Open IPO</button>
                                    <button class="ipos " data-value="3">Closed IPO</button>
                                </div>
                                <div class="ipo_watch_table mt-5">
                                    <table class="table" id="ipo-watch">
                                        <thead>
                                            <tr class="ipo_table_head">
                                                <th class="text-left">Company Name</th>
                                                <th class="text-left">Issue Type</th>
                                                <th class="text-right">Issue SizeCr</th>
                                                <th class="text-right">Open Date</th>
                                                <th class="text-right">Closed Date</th>
                                                <th class="text-right">Offer Price</th>
                                            </tr>
                                        </thead>
                                        <tbody id="table_data_to_show">
        
                                        </tbody>
                                    </table>
                                </div>
                            </div>
        
                        </div>
                    </div>
                </div>
                <div class="main_event_card new_listing cal-item" style="background:#F6EDEB;">

                    <p class="CalFont">New Listing</p>
                </div>


                <div id="newListing" class="modal fade" tabindex="-1" style="z-index: 9999999999;">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">New Listing</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="ipo_list_btns">
                                    <button class="ipos_list btn_active" data-value="BSE/main">BSE</button>
                                    <button class="ipos_list" data-value="NSE/main">NSE</button>
                                    <button class="ipos_list" data-value="bse/sme">BSE SME</button>
                                    <button class="ipos_list" data-value="nse/sme">NSE EMERGE</button>
                                </div>
                                <div class="ipo_watch_table mt-5">
                                    <table class="table" id="new-lists">
                                        <thead>
                                            <tr class="ipo_table_head">
                                                <th class="text-left">Company Name</th>
                                                <th class="text-left">Listing Date</th>
                                                <th class="text-right">Listing Price</th>
                                                <th class="text-right">High</th>
                                                <th class="text-right">Low</th>
                                                <th class="text-right">Last Price</th>
        
                                            </tr>
                                        </thead>
                                        <tbody id="new_listing_data">
        
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                         
                        </div>
                    </div>
                </div>







                <div class="main_event_card best_performer_card cal-item" data-bs-toggle="modal"
                    data-bs-target="#ipo_best_performer" style="background:#F6EDEB;">

                    <p class="CalFont">Best Performer</p>
                </div>



                <div class="modal fade" id="ipo_best_performer" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true" style="z-index: 9999999999999999  !important;">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Best Performer</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="modal_best_performer">

                                    <div class="main_best_performer">
                                        <div class="best_performer_filter_btn">
                                            <button data-market="NSE" data-segment="main" data-duration="8"
                                                class="best_performer_filter_btn_active">NSE</button>
                                            <button data-market="BSE" data-segment="main" data-duration="8">BSE</button>
                                            <button data-market="BSE" data-segment="sme" data-duration="8">BSE
                                                SME</button>
                                            <button data-market="NSE" data-segment="sme" data-duration="8">NSE
                                                EMERGE</button>

                                        </div>
                                        <table id="best-performers-table" class="table">
                                            <thead>
                                                <tr>
                                                    <th>Company</th>
                                                    <th>Listing Date</th>
                                                    <th>Listing Price </th>
                                                    <th>Offer Price </th>
                                                    <th>LTP</th>
                                                    <th>High</th>
                                                    <th>Low</th>
                                                    <th>Volume(Nos.)</th>
                                                    <th>Change(%)</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>


                                    </div>
                                </div>
                            </div>
                         
                        </div>
                    </div>
                </div>


                <div class="main_event_card basic_allotment cal-item" style="background:#F6EDEB;">

                    <p class="CalFont">Basis of Allotment</p>
                </div>


                <div id="basic_allotment" class="modal fade" tabindex="-1" style="z-index: 9999999999;">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Basis Allotment</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
        
                                <div class="ipo_watch_table mt-5">
                                    <table class="table" id="basis-allotment">
                                        <thead>
                                            <tr class="ipo_table_head">
                                                <th class="text-left">Company Name</th>
                                                <th class="text-left">Issue Type</th>
                                                <th class="text-right">Closed Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="basis_allotment">
        
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                      
                        </div>
                    </div>
                </div>











                <div class="main_event_card draft_btn cal-item" style="background:#F6EDEB;" data-bs-toggle="modal"
                    data-bs-target="#ipo_drafy_prospectus">

                    <p class="CalFont">Draft Prospectus</p>
                </div>
                <div class="modal fade" id="ipo_drafy_prospectus" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true" style="z-index: 9999999999999999  !important;">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Draft Prospectus</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="modal_drafy_prospectus">

                                    <div class="main_drafy_prospectus">
                                        <div class="main_draft_filter mb-2">
                                            <button data-draft="sebi" class="main_draft_filter_active">SEBI</button>
                                            <button data-draft="CLEARED">CLEARED</button>
                                        </div>

                                        <table id="draft-prospectus-table" class="table">
                                            <thead>
                                                <tr>
                                                    <th>Company Name</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be displayed here -->
                                            </tbody>
                                        </table>

                                    </div>
                                </div>
                            </div>
                          
                        </div>
                    </div>
                </div>
                <div class="main_event_card news_card cal-item" style="background:#F6EDEB;">

                    <p class="CalFont">IPO News</p>
                </div>
                <div id="ipo_news" class="modal fade" tabindex="-1" style="z-index: 9999999999;">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">IPO News</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
        
                                <div class="table-box d-flex flex-wrap" id="news-boxs">
        
                                </div>
                            </div>
                          
                        </div>
                    </div>
                </div>
        

            </div>
        </div>
    </div>
</section>



<script>
    $(document).ready(function () {




        var table_pros = $('#draft-prospectus-table').DataTable();

        // Function to update the table with data
        function updateTable_pros(data_props) {
            table_pros.clear().draw();

            data_props.forEach(function (item) {
                table_pros.row.add([
                    item.lname,
                ]).draw(false);
            });
        }

        // Handle filter button clicks
        $('.main_draft_filter button').click(function () {
            $(".main_draft_filter button").removeClass("main_draft_filter_active")
            $(this).addClass("main_draft_filter_active")
            console.log('Button clicked');

            var draftType = $(this).data('draft');
            console.log('Draft Type:', draftType);

            $.ajax({
                url: '/draft_prospectus', // Update the URL to your Django view
                method: 'GET',
                data: {
                    draft_type: draftType
                },
                success: function (data) {
                    console.log('Data received:', data);
                    updateTable_pros(data.data);
                },
                error: function () {
                    alert('Error fetching data from the server.');
                }
            });
        });


        $(".draft_btn").click(function () {


            $.ajax({
                url: '/draft_prospectus',
                data: {
                    draft_type: 'sebi', // Set your initial market here

                },
                success: function (data) {
                    updateTable_pros(data.data);
                }
            });


        })

        // Function to update the stock data table



        // Function to update the table with data
        var table = $('#best-performers-table').DataTable();
        function updateTable(data) {
            console.log(data);
            table.clear().draw();


            function formatDate(inputDate) {
                const dateParts = inputDate.split('-');
                const year = dateParts[0];
                const month = dateParts[1];
                const day = dateParts[2].split('T')[0];

                // Define an array of month names
                const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

                return `${day}-${monthNames[parseInt(month) - 1]}-${year}`;
            }


            data.forEach(function (data) {
                table.row.add([
                    data.CO_NAME,
                    formatDate(data.LISTDATE),          // Company
                    // Listing Date
                    data.listprice,            // Listing Price 
                    data.OfferPrice,           // Offer Price 
                    data.CLOSE,                // LTP
                    data.HIGH,                 // High
                    data.LOW,                  // Low
                    data.LISTVOL,              // Volume(Nos.)
                    data.PerChange.toFixed(2)             // Change(%)
                ]).draw(false);

            });
        }



        // Handle filter button clicks
        $('.best_performer_filter_btn button').click(function () {

            $(".best_performer_filter_btn button").removeClass("best_performer_filter_btn_active")
            $(this).addClass("best_performer_filter_btn_active")

            var market = $(this).data('market');
            var segment = $(this).data('segment');


            console.log(market, segment);




            $.ajax({
                url: '/best_performers', // Update the URL to your Django view
                method: 'GET',
                data: {
                    market: market,
                    segment: segment

                },
                success: function (data) {

                    updateTable(data.data);
                },
                error: function () {
                    alert('Error fetching data from the server.');
                }
            });


        });



        $(".best_performer_card").click(function () {
            $.ajax({
                url: '/best_performers',
                data: {
                    market: 'NSE', // Set your initial market here
                    segment: 'main' // Set your initial duration here
                },
                success: function (data) {
                    updateTable(data.data);
                }
            });
        })


        function updateStockTable(data) {
            console.log(data);
            var main_return_data = data.data;
            const tbody = $('#return_ipo tbody');
            tbody.empty(); // Clear previous data
            var chartData = [];
            main_return_data.forEach(function (stock) {
                console.log(stock.CO_NAME);
                chartData.push({
                    "company_name": stock.CO_NAME,
                    "PerChange": stock.PerChange
                });
            });

            // Create a chart instance
            var chart = am4core.create("chart-container", am4charts.XYChart);

            // Enable mouse wheel zoom for the x-axis
            chart.mouseWheelZoomEnabled = true;

            // Remove chart watermark
            chart.logo.disabled = true;

            // Add data to the chart
            chart.data = chartData;

            // Create category axis (company_name)
            var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
            categoryAxis.dataFields.category = "company_name";
            categoryAxis.title.text = "Company Name";

            // Create value axis (PerChange)
            var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
            valueAxis.title.text = "PerChange";

            // Draw a horizontal line at y-axis 0
            var zeroLine = valueAxis.axisRanges.create();
            zeroLine.value = 0;
            zeroLine.grid.stroke = am4core.color("#000"); // Color of the line
            zeroLine.grid.strokeWidth = 2; // Line width
            zeroLine.grid.strokeOpacity = 0.5; // Line opacity

            // Find the maximum PerChange value and its corresponding category
            var maxPerChange = -Infinity;
            var maxPerChangeCategory = "";
            chartData.forEach(function (dataItem) {
                if (dataItem.PerChange > maxPerChange) {
                    maxPerChange = dataItem.PerChange;
                    maxPerChangeCategory = dataItem.company_name;
                }
            });

            // Create a vertical line at the maximum PerChange value
            var maxLine = valueAxis.axisRanges.create();
            maxLine.value = maxPerChange.toFixed(3);
            maxLine.grid.stroke = am4core.color("#FF6F61"); // Color of the line
            maxLine.grid.strokeWidth = 2; // Line width
            maxLine.grid.strokeOpacity = 0.5; // Line opacity
            maxLine.label.text = "Max: " + maxPerChange.toFixed(3); // Display the maximum value as a label
            maxLine.label.fill = am4core.color("#FF6F61"); // Label text color
            maxLine.label.fontSize = 12; // Label font size

            // Create a series for the column chart
            var series = chart.series.push(new am4charts.ColumnSeries());
            series.dataFields.valueY = "PerChange";
            series.dataFields.categoryX = "company_name";
            series.name = "PerChange";
            series.columns.template.tooltipText = "{categoryX}: [bold]{valueY}[/]";

            // Set the background color of the bars and border color manually based on the value of PerChange
            series.columns.template.adapter.add("fill", function (fill, target) {
                if (target.dataItem && target.dataItem.dataContext.PerChange < 0) {
                    return am4core.color("#FF6F61"); // Red for negative values
                } else {
                    return am4core.color("#5cb85c"); // Green for positive or zero values
                }
            });

            series.columns.template.adapter.add("stroke", function (stroke, target) {
                if (target.dataItem && target.dataItem.dataContext.PerChange < 0) {
                    return am4core.color("#FF6F61"); // Red border for negative values
                } else {
                    return am4core.color("#5cb85c"); // Green border for positive or zero values
                }
            });

            categoryAxis.renderer.labels.template.disabled = true; // Hide the labels

            // Enable pan and zoom features for the chart
            chart.cursor = new am4charts.XYCursor();
            chart.cursor.behavior = "selectX";
            chart.events.on("datavalidated", function () {
                maxLine.value = maxPerChange;
            });

            // Configure pan and zoom settings
            chart.scrollbarX = new am4core.Scrollbar();
            chart.scrollbarX.wheelX = "zoomX";
            chart.scrollbarX.parent = chart.bottomAxesContainer;

            // Finally, update the chart
            chart.invalidateData();
        }


        // Market filter click event handler
        $('.btn_bse_nse').click(function () {
            $('.btn_bse_nse').removeClass('right_ipo_day_filters_active');

            // Add 'right_ipo_day_filters_active' class to the clicked market button
            $(this).addClass('right_ipo_day_filters_active');
            const market = $(this).data('market');
            console.log(`Market: ${market}`);
            console.log($('.right_ipo_day_filters button.btn_bse_nse_active').data('duration'));


            // Make an AJAX request based on the selected market
            $.ajax({
                url: '/ipo_return_data',
                data: {
                    market: market,
                    duration: $('.right_ipo_day_filters button.btn_bse_nse_active').data('duration')
                },
                success: function (data) {
                    updateStockTable(data);
                }
            });
        });

        // Duration filter click event handler
        $('.right_ipo_day_filters button').click(function () {
            $('.right_ipo_day_filters button').removeClass('btn_bse_nse_active');

            // Add 'btn_bse_nse_active' class to the clicked duration button
            $(this).addClass('btn_bse_nse_active');

            const duration = $(this).data('duration');
            console.log(`Duration: ${duration}`);
            console.log($('.btn_bse_nse.right_ipo_day_filters_active').data('market'));

            // Make an AJAX request based on the selected duration
            $.ajax({
                url: '/ipo_return_data',
                data: {
                    market: $('.btn_bse_nse.right_ipo_day_filters_active').data('market'),
                    duration: duration
                },
                success: function (data) {
                    updateStockTable(data);
                }
            });
        });


        $(".ipo_return_button").click(function () {


            $.ajax({
                url: '/ipo_return_data',
                data: {
                    market: 'nse', // Set your initial market here
                    duration: '1M' // Set your initial duration here
                },
                success: function (data) {
                    updateStockTable(data);
                }
            });


        })
        // Handle button active states


            // Basis Allotment Start Here !

    $(".basic_allotment").click(function () {
        $("#basic_allotment").modal("show")
        basis_allotment()
    })

    function basis_allotment() {
        $.ajax({
            type: "get",
            url: "/basic_allotment",
            dataType: "json",
            success: function (data) {
                var res_data = data.data
                $("#basis_allotment").empty()
                res_data.forEach(element => {
                    var row = `<tr>
                            <td>${element.lname}</td>
                            <td>${element.IssueType}</td>
                            <td>${element.ClosDate.split("T")[0]}</td>
                          </tr>`
                    var table = $("#basis_allotment")
                    table.append(row)
                });
                $("#basis-allotment").DataTable()
            }
        })
    }


    // IPO News Start Here !

    $(".news_card").click(function () {
        $("#ipo_news").modal("show")
        get_ipo_news()
    })

    function get_ipo_news() {
        $.ajax({
            type: "get",
            url: "/ipo_news",
            dataType: "json",
            success: function (data) {
                var news = data.data
                console.log(news);
                news.forEach(element => {
                    console.log(element);
                    var news_box = `<div class="IPOnews-wq" 
                data-sno="${element.Sno}" 
                data-heading="${element.Heading}">
                                  <div>
                                    <h5>${element.Heading}</h5>
                                    <span>${element.Date.split("T")[0]}</span> <span>(${element.Time})</span>
                                    </div>
                               </div>   
                                `
                    $(".table-box").append(news_box)

                });

                $(".IPOnews-wq").click(function () {
                    var sno = $(this).data("sno");
                    var heading = $(this).data("heading");


                    heading = heading.replace(/\s+/g, '-');


                    var url = `/news_details/${sno}/${heading}/`;


                    window.open(url, '_blank');
                    
                });


            }
        })
    }

        //   New Listing Start Here !


        $(".new_listing").click(function () {
            $("#newListing").modal("show")
            var intialData = {
                bse_main: "BSE/main"
            }
            new_listed_ipo(intialData)
        })

        $(".ipos_list").click(function () {
            $(".ipos_list").removeClass("btn_active")
            $(this).addClass("btn_active")
            var new_list = $(this).data("value")
            console.log(new_list);
            new_listed_ipo(new_list)
        })

        function new_listed_ipo(new_listed) {



            $.ajax({
                type: "post",
                url: "/new_listed_ipo",
                data: {

                    all_listed_data: new_listed
                },
                success: function (data) {
                    new_listing = data.data;
                    $("#new_listing_data").empty()
                    new_listing.forEach(element => {
                        console.log(element);
                        var row = `<tr>
                            <td>${element.CO_NAME}</td>
                            <td>${element.LISTDATE.split("T")[0]}</td>
                            <td>${element.LISTPRICE}</td>
                            <td>${element.HIGH}</td>
                            <td>${element.LOW}</td>
                            <td>${element.CLOSE}</td>
                         </tr>`
                        var table = $("#new_listing_data")
                        table.append(row)
                    });
                    $("#new-lists").DataTable()
                }
            })
        }

    // Ipo Watch Start

    $(".ipo_watch").click(function () {
            $("#myModal").modal('show');
            var intial_w_val = {
                value_one: "1"
            }
            ipo_watch_data(intial_w_val)
        })

        $(".ipos").click(function () {
            $(".ipos").removeClass("active");
            $(this).addClass("active");
            var btn_values = $(this).data("value")

            ipo_watch_data(btn_values)
        })






        function ipo_watch_data(btn_value) {
            console.log(btn_value);

            $.ajax({
                type: "post",
                url: "/ipo_watch",
                data: {
                    all_data: btn_value
                },
                success: function (response) {
                    var table_data = response.data
                    $("#table_data_to_show").empty()

                    table_data.forEach(element => {


                        if (!element) {
                            var table = $("#table_data_to_show")
                            console.log("no data found");
                        }
                        else {

                            if (btn_value == 2) {
                                var row = `<tr>
                                     <td>${element.lname || element.LNAME}</td>
                                     <td>${element.ISSUETYPE}</td>
                                     <td>${element.IssueSize}</td>
                                     <td>${element.OPENDATE.split("T")[0]}</td>
                                     <td>${element.CLOSDATE.split("T")[0]}</td>
                                     <td>${element.ISSUEPRICE}</td>
                                    </tr>`
                                var table = $("#table_data_to_show")
                                table.append(row)
                            }
                            else if (btn_value == 3) {
                                var row = `<tr>
                                     <td>${element.Lname}</td>
                                     <td>${element.IssueType}</td>
                                     <td>${element.IssueSize}</td>
                                     <td>${element.OPENDATE.split("T")[0]}</td>
                                     <td>${element.CLOSDATE.split("T")[0]}</td>
                                     <td>${element.ISSUEPRICE}</td>
                                    </tr>`
                                var table = $("#table_data_to_show")
                                table.append(row)
                            }
                            else {
                                var row = `<tr>
                                     <td>${element.lname || element.LNAME}</td>
                                     <td>${element.ISSUETYPE || element.IssueType}</td>
                                     <td>${element.IssueSize}</td>
                                     <td>${element.OPENDATE.split("T")[0]}</td>
                                     <td>${element.CLOSDATE.split("T")[0]}</td>
                                     <td>${element.ISSUEPRICE}</td>
                                    </tr>`
                                var table = $("#table_data_to_show")
                                table.append(row)
                            }
                        }




                    });
                    $("#ipo-watch").DataTable()
                }




            })
        }


    });
</script>

{% endblock dashboard_body %}