{% extends "base_dashboard.html" %}
{% load static %}
{% block title %}
Event Tracker | OptionPerks
{% endblock title %}

{% block description_keywords %}  

<meta name="description" content="Stay updated with the latest financial events and market happenings with the Event Tracker on OptionPerks. Track key economic indicators, earnings releases, corporate announcements, and industry events to make timely and informed trading decisions. With real-time event tracking, you can anticipate market movements and capitalize on trading opportunities effectively.">

<meta name="keywords" content="OptionPerks, event tracker, financial events, market happenings, economic indicators, earnings releases, corporate announcements, industry events, trading decisions, real-time tracking, market movements, trading opportunities">
<meta name="generator" content="Python,Django,Javascript,Jquery,Ajax">
<meta name="author" content="Option perks">

{% endblock description_keywords %}
{% block dashboard_body %}
<style>
    .events_list li {
        cursor: pointer;
    }


    .events_showing_btn button {

        color: #4399eb;
        border: 1px solid #4399eb !important;
        border: none;
        padding: 5px 12px;
        border-radius: 5px;
        font-size: 15px;
        margin-right: 9px;
        background: white;
        transition: ease-in-out;
    }

    .events_showing_btn button:hover {
        background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
        color: white !important;
    }

    .btn_active {
        background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
        color: white !important;
    }

    .cal-item,
    .placeholder_main {
        text-align: center;
        padding: 10px;
        height: 6rem !important;

    }

    .eventMainDiv {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        grid-gap: 11px;


    }

    .cal-num {
        font-size: 34px;
        line-height: 40px;
        font-weight: 700;
        color: #000000d6;
    }

    .CalFont {
        color: #000000d6;
        font-size: 16px;
        cursor: pointer;
    }
</style>
<style>
    /* Akram changes */
    .main_event {
        box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
        padding: 1rem;
        border-radius: 10px;
    }

    .placeholder_main {
        display: none;
    }

    .calender-header h2 {
        margin-bottom: 2.5rem;
        font-size: 2.5rem;
        text-align: center;
        font-family: BoldText;
        display: block;
        color: #4399eb;
    }

    .calender-header h2 span:after {
        position: absolute;
        content: "";

        background: url(../static/event.png);

        background-repeat: no-repeat;
        width: 0.9rem;
        height: 0.9rem;
    }

    .modal-header {
        border: none;
    }

    #main_event_modal table thead tr th {
        font-size: 15px;

        color: #081a76;
        background-color: #eff9ff;
        border: none;
        padding: 10px;
        white-space: nowrap;
        font-weight: 700 !important;
    }

    .no-data-available {
        display: flex;
        justify-content: center;
        color: red;
        font-size: 1.5rem;
    }
    .main_spinner{
        display: flex;
        justify-content: center;
    }
    .dataTables_length{
        margin-bottom: 1rem;
    }
    .main_event_card {
        border: 0.2px solid lightgray;
        cursor: pointer;
        transition: ease-in-out;
    }
    .main_event_card:hover, .main_event_card:focus{
        box-shadow: rgb(147 221 255 / 93%) 0px 1px 4px;
    border: 0.2px solid #4399eb;
    }
    

    .ofs_data{
        box-shadow: 1px 0 11px #d3cccc;
        border-radius: 17px;
      }
      .ofs_filter button{
        color: #4399eb;
        border: 1px solid #4399eb !important;
        border: none;
        padding: 5px 12px;
        border-radius: 5px;
        font-size: 15px;
        margin-right: 9px;
        background: white;
        transition: ease-in-out;
      }
      .ofs_active{
        background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
        color: white !important;
      }
      .ofs_filter button:hover{
        background: linear-gradient(180deg, #4399eb, #5cadfb) !important;
        color: white !important;
      }
      #ofs_table thead tr{
       background-color: #eff9ff;
       color: #081a76;
      }
      .ofs_text{
        margin-top:23px;
      }
     #exampleModalofs{
      z-index: 9999999999;
     }
     .ofs_table thead tr{
        background-color: #eff9ff;
       color: #081a76;
     }


     .dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        color: white !important;
        border: 1px solid #59aaf9 !important;
        background-color: rgba(230, 230, 230, 0.1);
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, rgba(230, 230, 230, 0.1)), color-stop(100%, rgba(0, 0, 0, 0.1)));
        background: -webkit-linear-gradient(top, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%);
        background: -moz-linear-gradient(top, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%);
        background: -ms-linear-gradient(top, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%);
        background: -o-linear-gradient(top, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%);
        /* background: linear-gradient(to bottom, rgba(230, 230, 230, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%); */
        background: #59aaf9;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button {
        box-sizing: border-box;
        display: inline-block;
        min-width: 1.5em;
        padding: 0.5em 1em;
        margin-left: 7px;
        text-align: center;
        text-decoration: none !important;
        cursor: pointer;
        color: inherit !important;
        border: 1px solid transparent;
        border-radius: 7px;
        background: transparent;
    }
    
    .dataTables_wrapper .dataTables_paginate .paginate_button:active {
        outline: none;
        background-color: #2b2b2b;
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #2b2b2b), color-stop(100%, #0c0c0c));
        background: -webkit-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
        background: -moz-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
        background: -ms-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
        background: -o-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
        background: #59aaf9 !important;
        box-shadow: inset 0 0 3px #111;
    }
    
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        color: white !important;
        border: 1px solid #59aaf9 !important;
        background-color: #585858;
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #585858), color-stop(100%, #111));
        background: -webkit-linear-gradient(top, #585858 0%, #111 100%);
        background: -moz-linear-gradient(top, #585858 0%, #111 100%);
        background: -ms-linear-gradient(top, #585858 0%, #111 100%);
        background: -o-linear-gradient(top, #585858 0%, #111 100%);
        background: linear-gradient(to bottom, #585858 0%, #111 100%);
        background: #59aaf9 !important;
    }
    
    .paginate_button.previous::before {
      content: "<"; /* Unicode left arrow character */
      font-size: 16px !important;
    }

    .paginate_button.previous:hover::before {
        color: white !important;
    }

    .paginate_button.next:hover::before{
        color: white !important;
    }

    .dataTables_wrapper .dataTables_info {
        padding-top: 1.7rem !important;
    }

    .dataTables_wrapper .dataTables_paginate {
        padding-top: 1.7rem !important;
    }
    
    /* Next page button icon */
    .paginate_button.next::before {
      content: ">"; /* Unicode right arrow character */
      font-size: 16px !important;
    }
    
    /* Hide text for Previous and Next buttons */
    #DataTables_Table_0_previous {
      font-size: 0 !important;
      background-color: white; 
      color: black;
      padding: 7px 18px; 
      border-radius: 4px; 
      cursor: pointer; 
      transition: background-color 0.3s ease; 
      box-shadow: 0 3px 16px 0 rgba(35,47,62,.15)!important;
    }
    #DataTables_Table_0_previous:hover {
      color: white !important;
      
    }
    #DataTables_Table_0_next {
      font-size: 0 !important;
      background-color: white; /* Button background color */
      color: black; /* Button text color */
       /* Button border */
      padding: 7px 18px; /* Button padding */
      border-radius: 4px; /* Button border-radius */
      cursor: pointer; /* Add pointer cursor on hover */
      transition: background-color 0.3s ease; 
      box-shadow: 0 3px 16px 0 rgba(35,47,62,.15)!important;
    }
    #DataTables_Table_0_next:hover{
        color: white !important;
    }
    .paginate_button {
      box-shadow: 0 3px 16px 0 rgba(35,47,62,.15)!important; /* Adjust the values as needed */
    }

    .paginate_button.previous {
        font-size: 0 !important;
        padding: 7px 16px !important;
    }

    .paginate_button.next{
        font-size: 0 !important;
        padding: 7px 16px !important;
    }

    .dataTables_filter label {
        display: none !important;
    }

    .dataTables_length select{
        border: 1px solid #aaa;
          background-color: transparent;
         
          margin: 0 5px !important;
          font-weight: 500 !important;
      }

    .dataTables_length label {
        text-transform: capitalize !important;
    }

    .events_showing_btn{
        display: flex;
    }

     @media only screen and (max-width: 768px) {
        
        .ofs_filter button{
            width: 100%;
            margin-top: 5px;
        }
     }

     @media only screen and (max-width: 372px){
        .events_showing_btn{
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .events_showing_btn button {
         width: 100%;
        }
     }

     table thead th{
        width: 282px !important;
     }

     .modal_close_btn:hover{
        /* background-color: #f2f2f2 !important; */
        background-color: #f1eded !important;
        }
     
</style>
<section class="pt-4">

    <div class="events_inner_data">
        <div class="calender_header ms-4">
            <h3>Event/Result Calender</h3>
        </div>
        <div class="main_event">
            <div class="events_showing_btn mb-4">

                <button class="btn_event btn_active" data-value="day" id="day">Today</button>
                <button class="btn_event" data-value="week" id="week">This Week</button>
                <button class="btn_event" data-value="month" id="month">This Month</button>

            </div>
            <div class="boxes_data">
                <div class="eventMainDiv" id="box">
                    
                </div>
                <div class="modal fade" id="exampleModalofs" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-xl ">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h1 class="modal-title fs-5 text-center" id="exampleModalLabel">OFS - Offer For Sale</h1>
                          <button type="button" class="btn-close modal_close_btn" data-bs-dismiss="modal" aria-label="Close" style="border-radius: 50%; display: flex; align-items: center; justify-content: center; padding: 12px;"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4 modal_cut"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                        </div>
                        <div class="modal-body">
                            <div class="ofs_filter pt-4">
                                <button class="ofs_btn" data-value="OFSOngoing">ONGOING OFSS</button>
                                <button class="ofs_btn" data-value= "OFSUpcoming"> UPCOMING OFSS</button>
                                <button class="ofs_btn" data-value= "OFSAboutList"> ABOUT TO BE SETTLED </button>
                                <button class="ofs_btn ofs_active" data-value="OFSListed">RECENTLY SETTLED OFSS  </button>
                              </div>
                              <div class="ofs_table mt-4">
                                
                                <div id="table4" class="table-responsive">
                                 
                                </div>
                             </div>
                        </div>
                       
                      </div>
                    </div>
                </div>
                </div>

             
                {% comment %} <div class="ofs_section mt-4">
                    <h3>Offer for Sale - OFS</h3>
                     <div class="ofs_data p-4">
                       
                      
                       
                     </div>
                </div> {% endcomment %}
            </div>
            
        </div>
    </div>
    </div>
</section>
<!-- Button to open the modal -->

<button id="openModalBtn" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#dataModal"
    style="display: none;">

</button>

<!-- Modal -->
<div class="modal fade" id="dataModal" tabindex="-1" role="dialog" aria-bs-labelledby="dataModalLabel"
    aria-bs-hidden="true" style="z-index: 9999999999999999999;">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">

                <button type="button" class="btn-close modal_close_btn" data-bs-dismiss="modal" aria-label="Close" style="border-radius: 50%; display: flex; align-items: center; justify-content: center; padding: 12px;"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4 modal_cut"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>

            </div>
            <h5 class="modal-title" id="dataModalLabel"></h5>
            <div class="modal-body table-responsive" id="main_event_modal">


              <div class="main_spinner">
                <div class="spinner-border text-primary" role="status" id="event-spinner">
                    <span class="visually-hidden">Loading...</span>
                  </div>
              </div>




            </div>

        </div>
    </div>
</div>

<script>
    $(document).ready(function () {

   
        
        $(".btn_event").click(function () {
            $(".btn_event").removeClass("btn_active");
            $(this).addClass("btn_active");
            var selectedData = $(this).data("value");
            pass_calender_data(selectedData);
        });


        function pass_calender_data(all_dates) {
            console.log(all_dates);
            $("#box").empty();
            for (var i = 1; i < 15; i++) {
                $("#box").append(`
            <p class="placeholder-glow">
                <span class="placeholder_main placeholder col-12"></span>
            </p>
        `);
            }


            $(".placeholder_main").show();
            $.ajax({
                type: "post",
                url: "/event_tracker_dates",
                dataType: "json",
                data: {
                    all_date: all_dates,
                },
                success: function (response) {
                    
                    

                    var res_data = response.data;
                    $("#box").empty();

                    var color_arr = [
                        "#F6EDEB",
                        "#F7E4E6",
                        "#E8F2FB",
                        "#E4F2FD",
                        "#E4F3EF",
                        "#EEEDFB",
                        "#E8F3FC",
                        "#F3E8E6",
                        "#F6EAE8",
                        "#E8F7E4"
                    ];
                     
                    
                    res_data.forEach(function (item, index) {
                        item.color = color_arr[index];

                    });
                    console.log(res_data);
                    
                    var lastIndex = res_data.pop(); // Remove and store the last element
                    res_data.unshift(lastIndex); 

                    res_data.forEach((element) => {
                        var dynamicID = element.corptype.replace(/\s+/g, "_");
                        if (element.corptype === "Result") {
                            // Change the corptype for a specific element
                            element.corptype = "Earning Result";
                            
                          }
                        var card = `<div class="main_event_card cal-item" data-value2=${dynamicID} id=${dynamicID} style=background:${element.color}>
                                         <div class="cal-num">${element.totalcount}</div>
                                         <p class="CalFont">${element.corptype}</p>
                                     </div>`;
                      
                      
                        var div_ele = $("#box");
                        div_ele.append(card);
                      });
                    var div_ele = $("#box");
                    var staticcard = `<div class="main_event_card ofs_box cal-item" style="background:#F6EDEB;">
                                    <p class="CalFont ofs_text">OFS</p>
                                   </div> 
                                   
                                   `
                   div_ele.append(staticcard);
                   $(".ofs_box").click(function () {
                    $("#exampleModalofs").modal("show")
                    var initial_ofs_filter = "OFSListed"
                    get_ofs_data(initial_ofs_filter)
                  })

                    $(".placeholder_main").hide()

                    
                    $(".main_event_card").click(function () {
                        
                        var value2 = ($(this).data("value2"));
                        var originalValue = value2.replace(/_/g, ' ');
                        data_table_events(value2)
                        $('#openModalBtn').click();
                        $("#dataModalLabel").empty().append(
                            `
                            <div class="calender-header"><h2><span>${originalValue}</span></h2></div>`
                        )

                    })


                },
            });

        }

        pass_calender_data();


        function data_table_events(value2) {
            var originalValue = value2.replace(/_/g, ' ');

            
            
            var events_showing_btn = $(".events_showing_btn .btn_event.btn_active").data("value");

            console.log(originalValue);
            console.log(events_showing_btn);
            
            
            var currentDate = new Date();

            if (events_showing_btn === "day") {
                
                
                var from_date = formatDate(currentDate);
                var to_date = formatDate(currentDate);
            } else if (events_showing_btn === "week") {
                
                
                var startOfWeek = new Date(currentDate);
                startOfWeek.setDate(currentDate.getDate() - currentDate.getDay()); 
                
                var endOfWeek = new Date(currentDate);
                endOfWeek.setDate(startOfWeek.getDate() + 6); 
                

                var from_date = formatDate(startOfWeek);
                var to_date = formatDate(endOfWeek);
            } else if (events_showing_btn === "month") {
                
                
                var startOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                var endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);

                var from_date = formatDate(startOfMonth);
                var to_date = formatDate(endOfMonth);
            }

            
            
            function formatDate(date) {
                var year = date.getFullYear();
                var month = (date.getMonth() + 1).toString().padStart(2, '0');
                var day = date.getDate().toString().padStart(2, '0');
                return year + '-' + month + '-' + day;
            }

            console.log("from_date:", from_date);
            console.log("to_date:", to_date);
            $("#main_event_modal").empty().append(`

            <div class="main_spinner">
                <div class="spinner-border text-primary" role="status" id="event-spinner">
                    <span class="visually-hidden">Loading...</span>
                  </div>
              </div>
            
            `)

            $.ajax({
                type: "post",
                url: "/events_table_data",
                data: {
                    from_date: from_date,
                    to_date: to_date,
                    originalValue: originalValue,

                },
                success: function (all_data) {

                    var data = all_data.data;


                    openModalWithData(data, value2);

                }
            });


            function openModalWithData(event_data, value2) {
                console.log(value2);
                console.log(event_data);
                var modalBody = $("#main_event_modal");
                modalBody.empty();

                
                
                if (!event_data || event_data.length === 0) {
                    
                    
                    var noDataDiv = $("<div>").addClass("no-data-available");
                    noDataDiv.text("No Data Found");
                    modalBody.empty().append(noDataDiv);
                    return;
                }
                var headers = []
                if (value2 === "Dividend") {
                    headers = [
                        'Company Name',
                        'Div Type',
                        'Div %',
                        'Div Amount',
                        'Announcement Date',
                        'Record Date',
                        'Ex-Div Date'

                    ];

                }
                else if (value2 === 'Bonus') {
                    headers = [
                        'Company Name',
                        'Ratio',
                        'Record Date',
                        'Ex Date',
                    ];
                }

                else if (value2 === 'Split') {
                    headers = [
                        'Company Name',
                        'Announcement Date',
                        'Split Date',
                        'FV Before(₹)',
                        'FV After(₹)',
                    ];
                }
                else if (value2 === 'BuyBack') {
                    headers = [
                        ' Company Name', 'Buyback Price', 'Buyback Type', 'Announcement Date', 'Open Date', 'Close Date'
                    ];
                }
                else if (value2 === 'Rights') {
                    headers = [
                        '    Company Name', '	Premium (₹)', 'Ratio', 'Record Date', '	Ex Date'
                    ];
                }
                else if (value2 === 'AGM') {
                    headers = [
              '      Company Name'	,' Announcement Date',	'AGM Date'
                    ];
                }
                else if (value2 === 'Board_Meeting') {
                    headers = [
              '      Company Name'	,	'Announcement Date'	,'Board Meeting Date'
                    ];
                }
                else if (value2 === 'EGM') {
                    headers = [
              '      Company Name'	,	'Announcement Date'	,'EGM Date'
                    ];
                }
                else if (value2 === 'Book_Closure') {
                    headers = [
                    'Company Name'	,' Announcement Date',	'Book Closure (From Date)','	Book Closure (To Date)'
                    ];
                }
                else if (value2 === 'Result') {
                    headers = [
                    'Company Name'	,' Announcement Date','	Result Date'
                    ];
                }


                
                
                var table = $('<table>').addClass('table');

                
                    
                var headerRow = '<tr>';
                headers.forEach(function (header) {
                    headerRow += `<th>${header}</th>`;
                });
                headerRow += '</tr>';

                
                
                table.append($('<thead>').html(headerRow));

                
                    
                var tableBody = $('<tbody>');

                
                    
                
                
                function formatDate(dateStr) {
                    const options = { year: 'numeric', month: 'short', day: '2-digit' };
                    return new Date(dateStr).toLocaleDateString('en-US', options);
                }

                if (value2 === "Dividend") {

                    event_data.forEach(function (item) {
                        var formattedAnnouncementDate = formatDate(item.AnnouncementDate);
                        var formattedRecordDate = formatDate(item.RecordDate);
                        var formattedDivDate = formatDate(item.DivDate);

                        var row = `<tr>
                                        <td>${item.co_name}</td>
                                        <td>${item.DividendType}</td>
                                        <td>${item.DivPer}</td>
                                        <td>${item.DivAmount}</td>
                                        <td>${formattedAnnouncementDate}</td>
                                        <td>${formattedRecordDate}</td>
                                        <td>${formattedDivDate}</td>
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                } else if (value2 === "Bonus") {
                    event_data.forEach(function (item) {
                        var BonusDate = formatDate(item.BonusDate);
                        var formattedRecordDate = formatDate(item.RecordDate);


                        var row = `<tr>
                                        <td>${item.co_name}</td>
                                        <td>${item.BonusRatio}</td>
                                      
                                        <td>${formattedRecordDate}</td>
                                        <td>${BonusDate}</td>
                                 
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                }
                else if (value2 === "Split") {
                    event_data.forEach(function (item) {
                        var AnnouncementDate = formatDate(item.AnnouncementDate);
                        var SplitDate = formatDate(item.SplitDate);


                        var row = `<tr>
                                        <td>${item.co_name}</td>
                                        <td>${AnnouncementDate}</td>
                                      
                                      
                                        <td>${SplitDate}</td>
                                        <td>${item.FVBefore}</td>
                                        <td>${item.FVAfter}</td>
                                 
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                }
                else if (value2 === "BuyBack") {
                    event_data.forEach(function (item) {
                        var AnnouncementDate = formatDate(item.AnnouncementDate);
                        var BBFromdate = formatDate(item.BBFromdate);
                        var BBToDate = formatDate(item.BBToDate);


                        var row = `<tr>
                                        <td>${item.co_name}</td>
                                        <td>${item.maxbuybackprice}</td>
                                        <td>${item.offertype}</td>
                                        <td>${AnnouncementDate}</td>
                                      
                                      
                                        <td>${BBFromdate}</td>
                                        <td>${BBToDate}</td>
                                      
                                 
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                }
                else if (value2 === "Rights") {
                    event_data.forEach(function (item) {
                        var recorddate = formatDate(item.recorddate);
                        var RightDate = formatDate(item.RightDate);
                        var BBToDate = formatDate(item.BBToDate);


                        var row = `<tr>
                                        <td>${item.co_name}</td>
                                        <td>${item.premium}</td>
                                        <td>${item.RightsRatio}</td>
                                        <td>${recorddate}</td>
                                      
                                      
                                        <td>${RightDate}</td>
                             
                                      
                                 
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                }
                else if (value2 === "AGM") {
                    event_data.forEach(function (item) {
                        var AnnouncementDate = formatDate(item.AnnouncementDate);
                        var GMdate = formatDate(item.GMdate);
                      


                        var row = `<tr>
                                        <td>${item.co_name}</td>
                                    
                                        <td>${AnnouncementDate}</td>
                                      
                                      
                                        <td>${GMdate}</td>
                             
                                      
                                 
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                }
                else if (value2 === "Board_Meeting") {
                    event_data.forEach(function (item) {
                        var AnnouncementDate = formatDate(item.AnnouncementDate);
                        var BMdate = formatDate(item.BMdate);
                      


                        var row = `<tr>
                                        <td>${item.co_name}</td>
                                    
                                        <td>${AnnouncementDate}</td>
                                      
                                      
                                        <td>${BMdate}</td>
                             
                                      
                                 
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                }
                else if (value2 === "EGM") {
                    event_data.forEach(function (item) {
                        var AnnouncementDate = formatDate(item.AnnouncementDate);
                        var GMdate = formatDate(item.GMdate);
                      


                        var row = `<tr>
                                        <td>${item.co_name}</td>
                                    
                                        <td>${AnnouncementDate}</td>
                                      
                                      
                                        <td>${GMdate}</td>
                             
                                      
                                 
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                }
                else if (value2 === "Book_Closure") {
                    event_data.forEach(function (item) {
                        var AnnouncementDate = formatDate(item.AnnouncementDate);
                        var BCFromdate = formatDate(item.BCFromdate);
                        var BCToDate = formatDate(item.BCToDate);
                      


                        var row = `<tr>
                                        <td>${item.Co_name}</td>
                                    
                                        <td>${AnnouncementDate}</td>
                                      
                                      
                                        <td>${BCFromdate}</td>
                                        <td>${BCToDate}</td>
                             
                                      
                                 
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                }
                else if (value2 === "Result") {
                    event_data.forEach(function (item) {
                        var AnnouncementDate = formatDate(item.AnnouncementDate);
                        var ResultDate = formatDate(item.ResultDate);
                     


                        var row = `<tr>
                                        <td>${item.co_name}</td>
                                    
                                        <td>${AnnouncementDate}</td>
                                        <td>${ResultDate}</td>
                                      
                                     
                             
                                      
                                 
                                    </tr>`;
                        tableBody.append(row);
                    });

                    
                    
                    table.append(tableBody);
                    
                    

                    
                    
                    $("#main_event_modal").empty().append(table);
                }



                var dataTable = table.DataTable({
                    paging: true,
                    searching: true,
                    dom: '<"top"lf>rt<"bottom"ip><"clear">', // Define the DataTables layout
                    language: {
                        // Customize the search placeholder text
                        searchPlaceholder: "Search..."
                    },
                    initComplete: function() {
                        // Hide the default search input
                        $('.dataTables_filter input').hide();
                
                        // Append a custom search input field
                        $('.dataTables_filter').append('<input type="search" class="form-control" placeholder="Search..." aria-controls="example"><i class="bi bi-search" style="position: absolute; top: 10px; right: 7px;"></i>');
                
                        // Bind keyup event to custom search input to update DataTable search
                        $('.dataTables_filter input').keyup(function() {
                            dataTable.search($(this).val()).draw();
                        });
                    }
                });

                dataTable.draw();
                
                

            }


        }


        var ofs_filter_inner="OFSListed"
  var condition_of_filter = true
            function get_ofs_data(pass_initial_ofs) {
                console.log(pass_initial_ofs);
                $("#loading-spinner").show();
    
                $.ajax({
                    type:"get",
                    url:'/offer_for_sale',
                    success:function(data){
                        console.log(data.OFSOngoing);
                        console.log(data.OFSUpcoming);
                        console.log(data.OFSAboutList);

if (condition_of_filter) {
    
    All_ofs_data_filter(ofs_filter_inner)
    condition_of_filter=false
}
                      
          $(".ofs_btn").click(function () {
            $(".ofs_btn").removeClass("ofs_active")
            $(this).addClass("ofs_active")
            initial_ofs_filter = $(this).data("value")
            All_ofs_data_filter(initial_ofs_filter);
          })
    



          function All_ofs_data_filter(initial_ofs_filter) {
            var dataTable = $("#ofs_table").DataTable();
    dataTable.clear().destroy(); // Clear DataTable
    if (initial_ofs_filter === "OFSListed") {
        var listed_ofs = data.OFSListed;
        console.log(listed_ofs);
        $("#main_event_modal").empty();
        $("#recently_ofs_table").empty();
        $("#table4").empty()

        if(listed_ofs.length > 0){

            var table = $("<table>").addClass("table ofs_table")
            var thead = $("<thead>");
            var tbody = $("<tbody>");
            var headerRow = `
            <tr>
              <th>Company</th>
              <th>Settled On</th>
              <th>Settled Price (₹) </th>
              <th>Settled Price (Post Retail Discount) (₹)</th>
              <th>% Change After Allotment</th>
            </tr>
          `;
            thead.append(headerRow);
            $("#table4").empty()
                listed_ofs.forEach(element => {
                var rowHTML = `
                <tr>
                  <td>${element.Name}</br>  LTP:${element.LTP} | <span class= " ${(element.ChangeLTP)>=0? "text-success": "text-danger"}"> ${element.ChangeLTP} (${element.ChangeLTPPer}%) </span></td>
                  <td>${element.AllottedOn.split("T")[0]}</td>
                  <td>${element.AllotmentPrice !== null ? element.AllotmentPrice : "-"}</td>
                  <td>${element.AllotmentPriceAfterDiscount !== null ? AllotmentPriceAfterDiscount : "-"}</td>
                  <td>${typeof element.chngpriceper === 'number' && !isNaN(element.chngpriceper) ? parseFloat(element.chngpriceper).toFixed(2) : "-"}</td>
                </tr>
              `;
                  tbody.append(rowHTML);
            });
            table.append(thead, tbody);
            $("#table4").append(table)
        }
        else{
            var h3Element = $("<h3 class='text-center text-danger'>").text("No Data Available");
                $("#table4").html(h3Element);
        }
        
    } 
    else if (initial_ofs_filter === "OFSOngoing") {
        var listed_ofs = data.OFSOngoing;
        console.log(listed_ofs);
        $("#table4").empty()

        if(listed_ofs.length > 0){
            var table = $("<table>").addClass("table ofs_table")
            var thead = $("<thead>");
            var tbody = $("<tbody>");
            $("#main_event_modal").empty();
            $("#recently_ofs_table").empty();
            
            var headerRow = `
            <tr>
              <th>Company Name</th>
              <th>Floor Price</th>
              <th>Min Bid Amount</th>
              <th>Open Date</th>
              <th>Close Date</th>
              <th>Indicative Price</th>
              <th>No. of Times Subscribed</th>
            </tr>
          `;
          thead.append(headerRow);
          $("#table4").empty()
            listed_ofs.forEach(element => {
                var rowHTML = `
                <tr>
                  <td>${element.Name} </br>  LTP:${element.LTP} | <span class= " ${(element.ChangeLTP)>=0? "text-success": "text-danger"}"> ${element.ChangeLTP} (${element.ChangeLTPPer}%) </span></td>
                  <td>${element.FloorPrice}</td>
                  <td>${element.MinBidAmount !== null ? element.MinBidAmount : "-"}</td>
                  <td>${element.OPENDATE.split("T")[0]}</td>
                  <td>${element.CLOSDATE.split("T")[0]}</td>
                  <td>${element.IndicativePrice  !== null ? element.IndicativePrice : "-"}</td>
                  <td>${element.NoofTimesSubscribed !== null ? element.NoofTimesSubscribed : "-"}</td>
                </tr>
              `;
                  tbody.append(rowHTML);
            });
            table.append(thead, tbody);
            $("#table4").append(table)
           
        }
        else{
            var h3Element = $("<h3 class='text-center text-danger'>").text("No Data Available");
            $("#table4").html(h3Element);
        }
       

           
    
    }


    // OFSUpcoming list
    else if (initial_ofs_filter==="OFSUpcoming") {
        var listed_ofs = data.OFSUpcoming;
        console.log(listed_ofs);
        $("#table4").empty()

        if(listed_ofs.length > 0){
            var table = $("<table>").addClass("table ofs_table")
        var thead = $("<thead>");
        var tbody = $("<tbody>");
        $("#main_event_modal").empty();
        $("#recently_ofs_table").empty();
        var headerRow = `
        <tr>
          <th>Company Name</th>
          <th>Floor Price</th>
          <th>List Date</th>
          <th>Indicative Price</th>
          <th>No. of Times Subscribed</th>
        </tr>
      `;
      thead.append(headerRow);
      $("#table4").empty()
        listed_ofs.forEach(element => {
            var rowHTML = `
            <tr>
              <td>${element.Name}</td>
              <td>${element.FloorPrice}</td>
              <td>${element.AllotmentDate.split("T")[0]}</td>
              <td>${element.IndicativePrice}</td>
              <td>${element.NoofTimesSubscribed}</td>
            </tr>
          `;
              tbody.append(rowHTML);
        });
        table.append(thead, tbody);
        $("#table4").append(table)

        }
        else{
            var h3Element = $("<h3 class='text-center text-danger'>").text("No Data Available");
            $("#table4").html(h3Element);
        }
        
            
    }

    // OFS AboutList
    else if (initial_ofs_filter==="OFSAboutList") {
        var listed_ofs = data.OFSAboutList;
        console.log(listed_ofs);
        $("#table4").empty()
        if(listed_ofs.length > 0){

            var table = $("<table>").addClass("table ofs_table")
            var thead = $("<thead>");
            var tbody = $("<tbody>");
            $("#main_event_modal").empty();
            $("#recently_ofs_table").empty();
            var headerRow = `
            <tr>
              <th>Company Name</th>
              <th>Floor Price</th>
              <th>List Date</th>
              <th>Indicative Price</th>
              <th>No. of Times Subscribed</th>
            </tr>
          `;
           thead.append(headerRow);
           
            listed_ofs.forEach(element => {
                var rowHTML = `
                <tr>
                  <td>${element.Name} </br>  LTP:${element.LTP} | <span class= " ${(element.ChangeLTP)>=0? "text-success": "text-danger"}"> ${element.ChangeLTP} (${element.ChangeLTPPer}%)</span></td>
                  <td>${element.FloorPrice}</td>
                  <td>${element.AllotmentDate.split("T")[0]}</td>
                  <td>${element.IndicativePrice !== null ? element.IndicativePrice: "-"}</td>
                  <td>${element.NoofTimesSubscribed !== null ? element.NoofTimesSubscribed : "-" }</td>
                </tr>
              `;
                  tbody.append(rowHTML);
            });
            table.append(thead, tbody);
            $("#table4").append(table)
        }
        else{
            var h3Element = $("<h3 class='text-center text-danger'>").text("No Data Available");
            $("#table4").html(h3Element);
        }
            
    }
    $("#ofs_table").DataTable();

}

   
                    },
                })
            }

    });
</script>

{% endblock dashboard_body%}